{% extends "base.html" %}

{% block title %}{{ post.title }} - TrustMyRecord{% endblock %}

{% block content %}
<div class="container">
    <div class="post-card">
        <div class="post-meta">
            <a href="{{ url_for('main.profile', user_id=post.author.id) }}" class="post-author-link">
                <img src="{{ url_for('static', filename='img/' + post.author.avatar_url) if post.author.avatar_url else url_for('static', filename='img/placeholder.png') }}" alt="Avatar" class="avatar">
                <span class="username">{{ post.author.username }}</span>
            </a>
            <span class="post-info">
                Joined: {{ post.author.date_joined.strftime('%Y-%m-%d') }}<br>
                Posts: {{ post.author.posts|length }}<br>
                Total Units: {{ user_stats[post.author.id].total_units if user_stats[post.author.id] else 'N/A' }}<br>
                Average Odds: {{ user_stats[post.author.id].aop if user_stats[post.author.id] else 'N/A' }}<br>
                Favorite Team: {{ post.author.favorite_team if post.author.favorite_team else 'N/A' }}
            </span>
        </div>
        <div class="post-body">
            <h2>{{ post.title }}</h2>
            <p>{{ post.body }}</p>
            <span class="post-timestamp">{{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
        </div>
    </div>

    <div class="replies-section">
        <h2 class="section-heading">Replies</h2>
        {% for reply in post.replies %}
        <div class="post-card">
            <div class="post-meta">
                <a href="{{ url_for('main.profile', user_id=reply.author.id) }}" class="post-author-link">
                    <img src="{{ url_for('static', filename='img/' + reply.author.avatar_url) if reply.author.avatar_url else url_for('static', filename='img/placeholder.png') }}" alt="Avatar" class="avatar">
                    <span class="username">{{ reply.author.username }}</span>
                </a>
                <span class="post-info">
                    Joined: {{ reply.author.date_joined.strftime('%Y-%m-%d') }}<br>
                    Posts: {{ reply.author.posts|length }}<br>
                    Total Units: {{ user_stats[reply.author.id].total_units if user_stats[reply.author.id] else 'N/A' }}<br>
                    Average Odds: {{ user_stats[reply.author.id].aop if user_stats[reply.author.id] else 'N/A' }}<br>
                    Favorite Team: {{ reply.author.favorite_team if reply.author.favorite_team else 'N/A' }}
                </span>
            </div>
            <div class="post-body">
                <p>{{ reply.body }}</p>
                <span class="post-timestamp">{{ reply.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="post-form-section">
        <h2>Post a Reply</h2>
        <form method="POST" action="" class="post-form">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.body.label }}
                {{ form.body(class="form-control", rows="5", placeholder="What's on your mind?") }}
            </div>
            <div class="form-group">
                {{ form.submit(class="submit-btn") }}
            </div>
        </form>
    </div>
</div>
{% endblock %}
