{% extends "base.html" %}

{% block title %}{{ title }} - TrustMyRecord{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ title }}</h1>
    <p class="centered-text">Discuss and share your thoughts on {{ title }}.</p>

    <div class="post-form-section">
        <h2>Create a New Post</h2>
        <form method="POST" action="" class="post-form">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.body.label }}
                {{ form.body(class="form-control", rows="5", placeholder="What's on your mind?") }}
            </div>
            <div class="form-group">
                {{ form.submit(class="submit-btn") }}
            </div>
        </form>
    </div>

    <h2 class="section-heading">Recent Posts</h2>
    <div class="posts-list">
        {% if posts %}
            {% for post in posts %}
            <div class="post-card">
                <div class="post-meta">
                    <a href="{{ url_for('main.profile', user_id=post.author.id) }}" class="post-author-link">
                        <img src="{{ url_for('static', filename='img/' + post.author.avatar_url) if post.author.avatar_url else url_for('static', filename='img/placeholder.png') }}" alt="Avatar" class="avatar">
                        <span class="username">{{ post.author.username }}</span>
                    </a>
                    <span class="post-info">
                        Joined: {{ post.author.date_joined.strftime('%Y-%m-%d') }}<br>
                        Posts: {{ post.author.posts|length }}<br>
                        Total Units: {{ user_stats[post.author.id].total_units if user_stats[post.author.id] else 'N/A' }}<br>
                        Average Odds: {{ user_stats[post.author.id].aop if user_stats[post.author.id] else 'N/A' }}<br>
                        Favorite Team: {{ post.author.favorite_team if post.author.favorite_team else 'N/A' }}
                    </span>
                </div>
                <div class="post-body">
                    <a href="{{ url_for('main.post', post_id=post.id) }}">
                        <h2>{{ post.title }}</h2>
                    </a>
                    <p>{{ post.body }}</p>
                    <span class="post-timestamp">{{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="centered-text">No posts in this category yet. Be the first to post!</p>
        {% endif %}
    </div>
</div>
{% endblock %}