{% extends "base.html" %}

{% block title %}Profile - TrustMyRecord{% endblock %}

{% block content %}
<div class="container">
    <div class="glass-card profile-card">
        <h1>{{ user.username }}'s Profile</h1>
        <div class="profile-details">
            <img src="{{ url_for('static', filename='img/' + user.avatar_url) }}" alt="User Avatar" class="profile-avatar">
            <p><strong>Email:</strong> {% if user.email_private %}Private{% else %}{{ user.email }}{% endif %}</p>
            <p><strong>Joined:</strong> {{ user.date_joined.strftime('%Y-%m-%d') }}</p>
            <p><strong>Favorite Team:</strong> {{ user.favorite_team if user.favorite_team else 'N/A' }}</p>
            <p><strong>Total Posts:</strong> {{ user.posts|length }}</p>
            <p><strong>Career Record:</strong> [Coming Soon]</p>
        </div>

        <div class="profile-actions">
            <a href="{{ url_for('main.edit_profile') }}" class="cta-button small-btn">Edit Profile</a>
            <a href="{{ url_for('main.search_users') }}" class="cta-button small-btn">Search for Users</a>
            <a href="{{ url_for('main.user_messages') }}" class="cta-button small-btn">My Messages</a>
        </div>

        <h2 class="section-heading">Friend Requests</h2>
        {% if pending_requests %}
            <div class="friend-requests-list">
                {% for req in pending_requests %}
                    <div class="glass-card friend-request-card">
                        <span>{{ req.sender.username }} wants to be friends.</span>
                        <div class="friend-request-actions">
                            <form method="POST" action="{{ url_for('main.accept_friend_request', request_id=req.id) }}">
                                <button type="submit" class="cta-button small-btn accept-btn">Accept</button>
                            </form>
                            <form method="POST" action="{{ url_for('main.reject_friend_request', request_id=req.id) }}">
                                <button type="submit" class="cta-button small-btn reject-btn">Reject</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="centered-text">No pending friend requests.</p>
        {% endif %}

        <h2 class="section-heading">My Friends</h2>
        {% if friends %}
            <div class="friends-list">
                {% for friend in friends %}
                    <div class="glass-card friend-card">
                        <span>{{ friend.username }}</span>
                        <a href="{{ url_for('main.send_message', recipient_id=friend.id) }}" class="cta-button small-btn">Message</a>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="centered-text">You don't have any friends yet.</p>
        {% endif %}

        <h2 class="section-heading">Your Picks</h2>
        {% if user.picks %}
            <div class="picks-list">
                {% for pick in user.picks %}
                    <div class="glass-card pick-item">
                        <p><strong>Sport:</strong> {{ pick.sport }}</p>
                        <p><strong>Event:</strong> {{ pick.event_details }}</p>
                        <p><strong>Pick:</strong> {{ pick.pick_selection }}</p>
                        <p><strong>Stake:</strong> {{ pick.stake_units }} units</p>
                        <p><strong>Odds:</strong> {{ pick.odds }}</p>
                        <p><strong>Status:</strong> {{ pick.status | title }}</p>
                        {% if pick.result %}
                            <p><strong>Result:</strong> {{ pick.result | title }}</p>
                        {% endif %}
                        <p class="pick-timestamp">{{ pick.date_posted.strftime('%Y-%m-%d %H:%M') }}</p>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="centered-text">You haven't made any picks yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}