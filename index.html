<!DOCTYPE html>
<html lang="en">
<head>
    <!-- CRITICAL: Early script to define core functions BEFORE anything else loads -->
    <script>
    // This runs FIRST, before any other scripts
    console.log('[TMR EARLY] Defining core functions...');

    // Core variables
    window.TMR = window.TMR || {};
    window.TMR.selectedSport = null;
    window.TMR.sportKeyMap = {
        'NFL': 'americanfootball_nfl',
        'NBA': 'basketball_nba',
        'NHL': 'icehockey_nhl',
        'MLB': 'baseball_mlb',
        'NCAAF': 'americanfootball_ncaaf',
        'NCAAB': 'basketball_ncaab'
    };

    // ESPN free API - map sport keys to ESPN URL paths
    window.TMR.espnPaths = {
        'americanfootball_nfl': 'football/nfl',
        'basketball_nba': 'basketball/nba',
        'icehockey_nhl': 'hockey/nhl',
        'baseball_mlb': 'baseball/mlb',
        'americanfootball_ncaaf': 'football/college-football',
        'basketball_ncaab': 'basketball/mens-college-basketball'
    };

    // Parse ESPN odds into The Odds API format (bookmakers[].markets[].outcomes[])
    window.TMR.parseEspnOdds = function(oddsArray, homeTeam, awayTeam) {
        if (!oddsArray || oddsArray.length === 0) return [];
        var results = [];
        for (var i = 0; i < oddsArray.length; i++) {
            var o = oddsArray[i];
            var provName = (o.provider && o.provider.name) || 'ESPN';
            var provKey = provName.toLowerCase().replace(/\s+/g, '');
            var markets = [];

            // Moneyline
            var homeML = null, awayML = null;
            if (o.moneyline) {
                if (o.moneyline.home && o.moneyline.home.close) homeML = parseFloat(o.moneyline.home.close.odds);
                if (o.moneyline.away && o.moneyline.away.close) awayML = parseFloat(o.moneyline.away.close.odds);
            }
            if (!homeML && o.homeTeamOdds && o.homeTeamOdds.moneyLine) homeML = parseFloat(o.homeTeamOdds.moneyLine);
            if (!awayML && o.awayTeamOdds && o.awayTeamOdds.moneyLine) awayML = parseFloat(o.awayTeamOdds.moneyLine);
            if (homeML && awayML && !isNaN(homeML) && !isNaN(awayML)) {
                markets.push({ key: 'h2h', outcomes: [
                    { name: homeTeam, price: homeML },
                    { name: awayTeam, price: awayML }
                ]});
            }

            // Spread
            var homeLine = null, awayLine = null, homeSpreadOdds = -110, awaySpreadOdds = -110;
            if (o.pointSpread) {
                if (o.pointSpread.home && o.pointSpread.home.close) {
                    homeLine = parseFloat(o.pointSpread.home.close.line);
                    var hso = parseFloat(o.pointSpread.home.close.odds);
                    if (!isNaN(hso)) homeSpreadOdds = hso;
                }
                if (o.pointSpread.away && o.pointSpread.away.close) {
                    awayLine = parseFloat(o.pointSpread.away.close.line);
                    var aso = parseFloat(o.pointSpread.away.close.odds);
                    if (!isNaN(aso)) awaySpreadOdds = aso;
                }
            }
            if (homeLine == null && o.spread != null) {
                homeLine = parseFloat(o.spread);
                awayLine = -homeLine;
            }
            if (homeLine != null && awayLine != null && !isNaN(homeLine) && !isNaN(awayLine)) {
                markets.push({ key: 'spreads', outcomes: [
                    { name: homeTeam, price: homeSpreadOdds, point: homeLine },
                    { name: awayTeam, price: awaySpreadOdds, point: awayLine }
                ]});
            }

            // Totals
            var totalLine = null, overOdds = -110, underOdds = -110;
            if (o.total) {
                if (o.total.over && o.total.over.close) {
                    var tl = o.total.over.close.line;
                    if (typeof tl === 'string') tl = tl.replace(/[ou]/gi, '');
                    totalLine = parseFloat(tl);
                    var oo = parseFloat(o.total.over.close.odds);
                    if (!isNaN(oo)) overOdds = oo;
                }
                if (o.total.under && o.total.under.close) {
                    var uo = parseFloat(o.total.under.close.odds);
                    if (!isNaN(uo)) underOdds = uo;
                    if (totalLine == null) {
                        var tl2 = o.total.under.close.line;
                        if (typeof tl2 === 'string') tl2 = tl2.replace(/[ou]/gi, '');
                        totalLine = parseFloat(tl2);
                    }
                }
            }
            if (totalLine == null && o.overUnder != null) totalLine = parseFloat(o.overUnder);
            if (totalLine != null && !isNaN(totalLine)) {
                markets.push({ key: 'totals', outcomes: [
                    { name: 'Over', price: overOdds, point: totalLine },
                    { name: 'Under', price: underOdds, point: totalLine }
                ]});
            }

            if (markets.length > 0) {
                results.push({ key: provKey, title: provName, markets: markets });
            }
        }
        return results;
    };

    // Fetch games from ESPN free API and convert to Odds API format
    window.TMR.fetchGamesFromESPN = function(sportKey, callback) {
        var espnPath = window.TMR.espnPaths[sportKey];
        if (!espnPath) { callback([]); return; }

        var url = 'https://site.api.espn.com/apis/site/v2/sports/' + espnPath + '/scoreboard';
        console.log('[TMR] ESPN FETCH:', url);

        fetch(url)
            .then(function(r) {
                console.log('[TMR] ESPN RESPONSE: status=' + r.status);
                if (!r.ok) throw new Error('ESPN returned ' + r.status);
                return r.json();
            })
            .then(function(data) {
                var events = data.events || [];
                console.log('[TMR] ESPN EVENTS: ' + events.length);
                var games = [];
                for (var i = 0; i < events.length; i++) {
                    var evt = events[i];
                    var comp = evt.competitions && evt.competitions[0];
                    if (!comp) continue;
                    var competitors = comp.competitors || [];
                    var homeComp = null, awayComp = null;
                    for (var j = 0; j < competitors.length; j++) {
                        if (competitors[j].homeAway === 'home') homeComp = competitors[j];
                        if (competitors[j].homeAway === 'away') awayComp = competitors[j];
                    }
                    if (!homeComp || !awayComp) continue;
                    var homeTeam = homeComp.team && homeComp.team.displayName;
                    var awayTeam = awayComp.team && awayComp.team.displayName;
                    if (!homeTeam || !awayTeam) continue;

                    // Skip completed games
                    var status = (comp.status && comp.status.type) || (evt.status && evt.status.type) || {};
                    if (status.completed === true) continue;

                    var bookmakers = window.TMR.parseEspnOdds(comp.odds || [], homeTeam, awayTeam);
                    games.push({
                        id: 'espn_' + evt.id,
                        sport_key: sportKey,
                        sport_title: evt.shortName || sportKey,
                        home_team: homeTeam,
                        away_team: awayTeam,
                        commence_time: evt.date || comp.date,
                        bookmakers: bookmakers
                    });
                }
                console.log('[TMR] PARSED GAMES: ' + games.length);
                callback(games);
            })
            .catch(function(err) {
                console.error('[TMR] ESPN FETCH ERROR:', err);
                callback(null, err);
            });
    };
    window.TMR.currentSelectedPick = null;

    // Core function - Show Pick Step
    window.showPickStep = function(stepId) {
        console.log('[TMR] showPickStep:', stepId);
        var allSteps = document.querySelectorAll('.pick-step');
        allSteps.forEach(function(s) { s.classList.remove('active'); });
        var el = document.getElementById(stepId);
        if (el) el.classList.add('active');
    };

    // Core function - Go Back to Sports
    window.goBackToSports = function() {
        window.showPickStep('sportSelection');
    };

    // Core function - Go Back to Games
    window.goBackToGames = function() {
        window.showPickStep('gamesListSection');
    };

    // Core function - Units Mode Toggle (Risk vs To Win)
    window.TMR.selectedUnitsMode = 'risk';
    window.setUnitsMode = function(mode) {
        window.TMR.selectedUnitsMode = mode;
        var riskBtn = document.getElementById('modeRisk');
        var toWinBtn = document.getElementById('modeToWin');
        var explanation = document.getElementById('unitsExplanation');
        if (mode === 'risk') {
            if (riskBtn) { riskBtn.style.background = 'var(--gradient-gold)'; riskBtn.style.color = 'var(--dark-bg)'; }
            if (toWinBtn) { toWinBtn.style.background = 'var(--card-bg)'; toWinBtn.style.color = 'var(--text-primary)'; }
            if (explanation) explanation.textContent = 'Enter units you want to RISK (0.5 - 5). Winnings calculated from odds.';
        } else {
            if (toWinBtn) { toWinBtn.style.background = 'var(--gradient-gold)'; toWinBtn.style.color = 'var(--dark-bg)'; }
            if (riskBtn) { riskBtn.style.background = 'var(--card-bg)'; riskBtn.style.color = 'var(--text-primary)'; }
            if (explanation) explanation.textContent = 'Enter units you want to WIN (0.5 - 5). Risk calculated from odds.';
        }
        console.log('[TMR] Units mode set to:', mode);
    };

    // Core function - Get Units Value from input
    window.TMR.getUnitsValue = function() {
        var input = document.getElementById('unitsInput');
        var val = parseFloat(input ? input.value : '1');
        if (isNaN(val) || val < 0.5) val = 0.5;
        if (val > 5) val = 5;
        val = Math.round(val * 2) / 2;
        return val;
    };

    // Core function - Select Sport and Show Games (ESPN free API, no server needed)
    window.selectSportAndShowGames = function(sport) {
        console.log('[TMR] === SELECT SPORT: ' + sport + ' ===');
        window.TMR.selectedSport = sport;

        document.querySelectorAll('.sport-card').forEach(function(c) { c.classList.remove('selected'); });
        var card = document.querySelector('.sport-card[data-sport="' + sport + '"]');
        if (card) card.classList.add('selected');

        var icons = { 'NBA': 'üèÄ', 'NFL': 'üèà', 'NHL': 'üèí', 'MLB': '‚öæ', 'NCAAF': 'üéì', 'NCAAB': 'üè´' };
        var titleEl = document.getElementById('selectedSportTitle');
        if (titleEl) titleEl.textContent = (icons[sport] || '') + ' ' + sport + ' Games';

        window.showPickStep('gamesListSection');

        var container = document.getElementById('gamesListContainer');
        if (!container) { console.error('[TMR] gamesListContainer NOT FOUND'); return; }

        container.innerHTML = '<div class="loading-games">Loading ' + sport + ' games...</div>';
        var sportKey = window.TMR.sportKeyMap[sport];
        if (!sportKey) { container.innerHTML = '<div class="no-games-message"><h4>Unknown sport</h4></div>'; return; }

        console.log('[TMR] Calling ESPN for ' + sportKey);
        window.TMR.fetchGamesFromESPN(sportKey, function(games, err) {
            if (err) {
                console.error('[TMR] ESPN ERROR:', err);
                container.innerHTML = '<div class="no-games-message"><h4>Error loading games</h4><p>' + err.message + '</p></div>';
                return;
            }
            console.log('[TMR] GOT ' + games.length + ' GAMES');
            window.TMR.currentGames = games;

            // Update games count badge
            var badge = document.getElementById('gamesCountBadge');
            if (badge) badge.textContent = games.length + ' game' + (games.length !== 1 ? 's' : '');

            if (games.length === 0) {
                container.innerHTML = '<div class="no-games"><div class="no-games-icon">üìÖ</div><h3>No Games Available</h3><p>Check back later for upcoming matchups</p></div>';
                return;
            }

            var html = '<div class="market-headers"><div class="market-label">Matchup</div><div class="market-label">Spread</div><div class="market-label">Moneyline</div><div class="market-label">Total</div></div>';
            games.forEach(function(game, index) {
                var bookmaker = game.bookmakers && game.bookmakers[0];
                var markets = bookmaker ? bookmaker.markets : [];
                var homeSpread = {point: '--', price: -110}, awaySpread = {point: '--', price: -110};
                var homeML = '--', awayML = '--', total = '--', overPrice = -110, underPrice = -110;
                markets.forEach(function(m) {
                    if (m.key === 'spreads') m.outcomes.forEach(function(o) {
                        if (o.name === game.home_team) homeSpread = {point: o.point, price: o.price};
                        else awaySpread = {point: o.point, price: o.price};
                    });
                    if (m.key === 'h2h') m.outcomes.forEach(function(o) {
                        if (o.name === game.home_team) homeML = o.price;
                        else awayML = o.price;
                    });
                    if (m.key === 'totals') m.outcomes.forEach(function(o) {
                        if (o.name === 'Over') { total = o.point; overPrice = o.price; }
                        else underPrice = o.price;
                    });
                });
                var gameTime = new Date(game.commence_time).toLocaleTimeString('en-US', {hour:'numeric',minute:'2-digit'});
                var fmtSpread = function(p) { return p === '--' ? '--' : (p > 0 ? '+' + p : p); };
                var fmtOdds = function(o) { return o === '--' ? '--' : (o > 0 ? '+' + o : o); };
                html += '<div class="game-row">' +
                    '<div class="game-time-header"><span class="game-time">' + gameTime + '</span></div>' +
                    '<div class="team-row">' +
                    '<div class="team-info"><div class="team-details"><div class="team-name">' + game.away_team + '</div></div></div>' +
                    '<button class="odds-btn" onclick="window.selectGameBet(' + index + ',\'spread\',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'' + fmtSpread(awaySpread.point) + '\',' + (awaySpread.price||'-110') + ',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'' + game.home_team.replace(/'/g, "\\'") + '\')"><span class="odds-line">' + fmtSpread(awaySpread.point) + '</span><span class="odds-value">' + fmtOdds(awaySpread.price||-110) + '</span></button>' +
                    '<button class="odds-btn" onclick="window.selectGameBet(' + index + ',\'ml\',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'ML\',' + awayML + ',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'' + game.home_team.replace(/'/g, "\\'") + '\')"><span class="odds-line">ML</span><span class="odds-value ' + (awayML >= 0 ? 'positive' : '') + '">' + fmtOdds(awayML) + '</span></button>' +
                    '<button class="odds-btn" onclick="window.selectGameBet(' + index + ',\'over\',\'Over\',\'' + total + '\',' + overPrice + ',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'' + game.home_team.replace(/'/g, "\\'") + '\')"><span class="odds-line">Over ' + total + '</span><span class="odds-value">' + fmtOdds(overPrice) + '</span></button>' +
                    '</div>' +
                    '<div class="team-row">' +
                    '<div class="team-info"><div class="team-details"><div class="team-name">' + game.home_team + '</div></div></div>' +
                    '<button class="odds-btn" onclick="window.selectGameBet(' + index + ',\'spread\',\'' + game.home_team.replace(/'/g, "\\'") + '\',\'' + fmtSpread(homeSpread.point) + '\',' + (homeSpread.price||'-110') + ',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'' + game.home_team.replace(/'/g, "\\'") + '\')"><span class="odds-line">' + fmtSpread(homeSpread.point) + '</span><span class="odds-value">' + fmtOdds(homeSpread.price||-110) + '</span></button>' +
                    '<button class="odds-btn" onclick="window.selectGameBet(' + index + ',\'ml\',\'' + game.home_team.replace(/'/g, "\\'") + '\',\'ML\',' + homeML + ',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'' + game.home_team.replace(/'/g, "\\'") + '\')"><span class="odds-line">ML</span><span class="odds-value ' + (homeML >= 0 ? 'positive' : '') + '">' + fmtOdds(homeML) + '</span></button>' +
                    '<button class="odds-btn" onclick="window.selectGameBet(' + index + ',\'under\',\'Under\',\'' + total + '\',' + underPrice + ',\'' + game.away_team.replace(/'/g, "\\'") + '\',\'' + game.home_team.replace(/'/g, "\\'") + '\')"><span class="odds-line">Under ' + total + '</span><span class="odds-value">' + fmtOdds(underPrice) + '</span></button>' +
                    '</div></div>';
            });
            container.innerHTML = html;
        });
    };

    // Core function - Select Game Bet (when user clicks an odds button)
    window.selectGameBet = function(gameIndex, betType, team, line, odds, awayTeam, homeTeam) {
        console.log('[TMR] selectGameBet called:', { gameIndex, betType, team, line, odds });

        // Get game time from stored games
        var gameTime = null;
        var gameId = null;
        if (window.TMR && window.TMR.currentGames && window.TMR.currentGames[gameIndex]) {
            var game = window.TMR.currentGames[gameIndex];
            gameTime = game.commence_time;
            gameId = game.id;
        }

        // Store the selection
        window.TMR.currentSelectedPick = {
            gameIndex: gameIndex,
            betType: betType,
            team: team,
            line: line,
            odds: odds,
            awayTeam: awayTeam,
            homeTeam: homeTeam,
            sport: window.TMR.selectedSport,
            gameTime: gameTime,
            gameId: gameId
        };

        // Update UI to show selection
        document.querySelectorAll('.bet-pick-btn, .total-btn, .odds-btn').forEach(function(btn) {
            btn.classList.remove('selected');
        });

        // Update summary
        var summaryGame = document.getElementById('summaryGame');
        var summaryPick = document.getElementById('summaryPick');
        var summaryOdds = document.getElementById('summaryOdds');

        if (summaryGame) summaryGame.textContent = awayTeam + ' @ ' + homeTeam;
        if (summaryPick) summaryPick.textContent = team + ' ' + line;
        if (summaryOdds) summaryOdds.textContent = odds;

        // Go to confirmation step
        window.showPickStep('pickDetails');
    };

    // ============ LOCK IN PICK (localStorage version) ============
    window.lockInPick = function() {
        var thePick = window.TMR.currentSelectedPick;
        if (!thePick) return;

        // Check login via localStorage auth
        if (!window.auth || !window.auth.isLoggedIn()) {
            if (typeof openLoginModal === 'function') openLoginModal();
            else alert('Please log in to submit picks.');
            return;
        }

        var units = 1;
        try { var inp = document.getElementById('unitsInput'); if (inp) units = parseFloat(inp.value) || 1; } catch(e) {}
        units = Math.max(0.5, Math.min(10, units));

        // Map betType to market_type
        var betType = thePick.betType || 'ml';
        var marketTypeMap = { ml: 'h2h', spread: 'spreads', over: 'totals', under: 'totals' };
        var marketType = marketTypeMap[betType] || 'h2h';

        // Determine selection name
        var selection;
        if (betType === 'over') {
            selection = 'Over';
        } else if (betType === 'under') {
            selection = 'Under';
        } else {
            selection = thePick.team || thePick.pick || '';
        }

        // Determine line snapshot (spread number or total number, null for ML)
        var lineSnapshot = null;
        if (betType === 'spread' || betType === 'over' || betType === 'under') {
            lineSnapshot = parseFloat(thePick.line) || null;
        }

        // Build pick object
        var sportKeyMap = { 'NFL': 'americanfootball_nfl', 'NBA': 'basketball_nba', 'NHL': 'icehockey_nhl', 'MLB': 'baseball_mlb', 'NCAAF': 'americanfootball_ncaaf', 'NCAAB': 'basketball_ncaab' };
        var user = window.auth.getCurrentUser();

        var newPick = {
            id: 'pick_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
            user_id: user.username || user.id || 'local',
            game_id: thePick.gameId || ('espn_' + thePick.gameIndex),
            sport_key: sportKeyMap[thePick.sport] || thePick.sport || '',
            sport_display: thePick.sport || '',
            home_team: thePick.homeTeam,
            away_team: thePick.awayTeam,
            selection: selection,
            market_type: marketType,
            line_snapshot: lineSnapshot,
            odds_snapshot: parseInt(thePick.odds, 10) || -110,
            units: units,
            status: 'pending',
            result_units: null,
            locked_at: new Date().toISOString(),
            commence_time: thePick.gameTime || new Date().toISOString(),
            graded_at: null,
            home_score: null,
            away_score: null
        };

        // Save to localStorage
        var allPicks = [];
        try { allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]'); } catch(e) { allPicks = []; }
        allPicks.unshift(newPick); // newest first
        localStorage.setItem('tmr_picks', JSON.stringify(allPicks));

        console.log('[TMR] Pick saved to localStorage:', newPick.selection, newPick.line_snapshot, newPick.odds_snapshot);

        // Show inline confirmation
        var el1 = document.getElementById('confirmPickDetail');
        var el2 = document.getElementById('confirmPickMeta');
        var displayPick = selection + (lineSnapshot != null ? ' ' + lineSnapshot : '') + ' (' + (newPick.odds_snapshot > 0 ? '+' : '') + newPick.odds_snapshot + ')';
        var displayMeta = thePick.awayTeam + ' @ ' + thePick.homeTeam + '  |  ' + units + 'u  |  ' + (thePick.sport || '');
        if (el1) el1.textContent = displayPick;
        if (el2) el2.textContent = displayMeta;

        window.showPickStep('pickConfirmation');
        window.TMR.currentSelectedPick = null;
        try { document.getElementById('pickReasoning').value = ''; document.getElementById('unitsInput').value = '1'; } catch(e) {}
    };
    window.submitPickNew = window.lockInPick; // alias

    // ============ RENDER PICKS LIST (localStorage version) ============
    window.renderPicksList = function() {
        var container = document.getElementById('picksListContainer');
        var statsBar = document.getElementById('picksStatsBar');
        if (!container) return;

        // Must be logged in
        if (!window.auth || !window.auth.isLoggedIn()) {
            container.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted);"><div style="font-size:48px;margin-bottom:15px;">&#128274;</div><p>Please log in to view your picks.</p></div>';
            if (statsBar) statsBar.innerHTML = '';
            return;
        }

        var picks = [];
        try { picks = JSON.parse(localStorage.getItem('tmr_picks') || '[]'); } catch(e) { picks = []; }

        // Filter to current user's picks
        var user = window.auth.getCurrentUser();
        var userId = user.username || user.id || 'local';
        picks = picks.filter(function(p) { return p.user_id === userId; });

        if (picks.length === 0) {
            container.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted);"><div style="font-size:48px;margin-bottom:15px;">&#127919;</div><p>No picks yet. Make your first pick!</p></div>';
            if (statsBar) statsBar.innerHTML = '';
            return;
        }

        var wins = 0, losses = 0, pushes = 0, pending = 0, totalUnits = 0;
        picks.forEach(function(p) {
            if (p.status === 'won') wins++;
            else if (p.status === 'lost') losses++;
            else if (p.status === 'push') pushes++;
            else pending++;
            totalUnits += (parseFloat(p.result_units) || 0);
        });

        if (statsBar) {
            var s = '<div style="background:var(--card-bg);border:1px solid var(--glass-border);border-radius:8px;padding:12px 20px;text-align:center;"><div style="color:var(--text-muted);font-size:11px;">RECORD</div><div style="color:var(--text-primary);font-size:20px;font-weight:bold;">' + wins + '-' + losses + (pushes > 0 ? '-' + pushes : '') + '</div></div>';
            s += '<div style="background:var(--card-bg);border:1px solid var(--glass-border);border-radius:8px;padding:12px 20px;text-align:center;"><div style="color:var(--text-muted);font-size:11px;">PENDING</div><div style="color:#ff9800;font-size:20px;font-weight:bold;">' + pending + '</div></div>';
            s += '<div style="background:var(--card-bg);border:1px solid var(--glass-border);border-radius:8px;padding:12px 20px;text-align:center;"><div style="color:var(--text-muted);font-size:11px;">UNITS</div><div style="color:' + (totalUnits >= 0 ? '#00c853' : '#ff4444') + ';font-size:20px;font-weight:bold;">' + (totalUnits >= 0 ? '+' : '') + totalUnits.toFixed(2) + '</div></div>';
            if (wins + losses > 0) {
                var wr = Math.round((wins / (wins + losses)) * 100);
                s += '<div style="background:var(--card-bg);border:1px solid var(--glass-border);border-radius:8px;padding:12px 20px;text-align:center;"><div style="color:var(--text-muted);font-size:11px;">WIN RATE</div><div style="color:#00c8ff;font-size:20px;font-weight:bold;">' + wr + '%</div></div>';
            }
            statsBar.innerHTML = s;
        }

        var sportDisplayMap = { 'basketball_nba': 'NBA', 'americanfootball_nfl': 'NFL', 'icehockey_nhl': 'NHL', 'baseball_mlb': 'MLB', 'americanfootball_ncaaf': 'NCAAF', 'basketball_ncaab': 'NCAAB' };

        var html = '';
        picks.forEach(function(p) {
            var status = p.status || 'pending';
            var borderColor = status === 'won' ? '#00c853' : status === 'lost' ? '#ff4444' : status === 'push' ? '#888' : '#ff9800';
            var badgeBg = status === 'won' ? 'rgba(0,200,83,0.2)' : status === 'lost' ? 'rgba(255,68,68,0.2)' : status === 'push' ? 'rgba(136,136,136,0.2)' : 'rgba(255,152,0,0.2)';
            var badgeColor = borderColor;
            var odds = p.odds_snapshot || -110;
            var units = p.units || 1;
            var resultUnits = p.result_units;
            var pickDisplay = p.selection + (p.line_snapshot ? ' ' + p.line_snapshot : '');
            var matchup = (p.away_team || '') + ' @ ' + (p.home_team || '');
            var sportLabel = sportDisplayMap[p.sport_key] || p.sport_display || p.sport_key || '';
            var resultText = '';
            if (resultUnits !== undefined && resultUnits !== null && status !== 'pending') {
                resultText = ' | <span style="color:' + (resultUnits >= 0 ? '#00c853' : '#ff4444') + ';font-weight:bold;">' + (resultUnits >= 0 ? '+' : '') + parseFloat(resultUnits).toFixed(2) + 'u</span>';
            }
            html += '<div style="background:var(--card-bg);border-left:4px solid ' + borderColor + ';border-radius:8px;padding:15px;margin:10px 0;">';
            html += '<div style="display:flex;justify-content:space-between;align-items:flex-start;">';
            html += '<div>';
            html += '<div style="font-size:16px;font-weight:bold;color:var(--text-primary);">' + pickDisplay + '</div>';
            html += '<div style="color:var(--text-muted);font-size:13px;margin-top:3px;">' + matchup + '</div>';
            html += '<div style="color:var(--neon-cyan);font-size:13px;margin-top:3px;">' + (odds > 0 ? '+' : '') + odds + ' | ' + units + 'u | ' + sportLabel + resultText + '</div>';
            html += '</div>';
            html += '<div style="text-align:right;">';
            html += '<span style="display:inline-block;padding:3px 10px;border-radius:12px;font-size:12px;font-weight:bold;background:' + badgeBg + ';color:' + badgeColor + ';">' + status.toUpperCase() + '</span>';
            html += '<div style="color:var(--text-muted);font-size:11px;margin-top:5px;">' + new Date(p.locked_at || p.commence_time).toLocaleDateString() + '</div>';
            html += '</div></div></div>';
        });
        container.innerHTML = html;
    };

    // ============ CLIENT-SIDE AUTO-GRADING ENGINE ============
    // Fetches completed game scores from ESPN and grades pending picks locally.
    window.TMR.espnSportPaths = { 'NFL': 'football/nfl', 'NBA': 'basketball/nba', 'NHL': 'hockey/nhl', 'NCAAB': 'basketball/mens-college-basketball', 'NCAAF': 'football/college-football', 'MLB': 'baseball/mlb' };

    // Unit calculation (matches gradingEngine.js exactly)
    window.TMR.calculateResultUnits = function(status, units, odds) {
        if (status === 'push') return 0;
        if (status === 'won') {
            return odds < 0 ? units : parseFloat((units * odds / 100).toFixed(2));
        }
        if (status === 'lost') {
            return odds < 0 ? parseFloat((-(units * Math.abs(odds) / 100)).toFixed(2)) : -units;
        }
        return 0;
    };

    // Grade a moneyline pick
    window.TMR.gradeML = function(pick, homeScore, awayScore) {
        var sel = pick.selection.trim().toLowerCase();
        var isHome = sel === pick.home_team.trim().toLowerCase();
        var isAway = sel === pick.away_team.trim().toLowerCase();
        if (!isHome && !isAway) return 'pending'; // can't match
        if (homeScore === awayScore) return 'push';
        var selectedWon = isHome ? (homeScore > awayScore) : (awayScore > homeScore);
        return selectedWon ? 'won' : 'lost';
    };

    // Grade a spread pick
    window.TMR.gradeSpread = function(pick, homeScore, awayScore) {
        var line = parseFloat(pick.line_snapshot);
        if (isNaN(line)) return 'pending';
        var sel = pick.selection.trim().toLowerCase();
        var isHome = sel === pick.home_team.trim().toLowerCase();
        var selectedScore = isHome ? homeScore : awayScore;
        var opponentScore = isHome ? awayScore : homeScore;
        var margin = selectedScore - opponentScore + line;
        if (margin > 0) return 'won';
        if (margin < 0) return 'lost';
        return 'push';
    };

    // Grade a totals (over/under) pick
    window.TMR.gradeTotal = function(pick, homeScore, awayScore) {
        var line = parseFloat(pick.line_snapshot);
        if (isNaN(line)) return 'pending';
        var total = homeScore + awayScore;
        if (total === line) return 'push';
        var sel = pick.selection.trim().toLowerCase();
        if (sel === 'over') return total > line ? 'won' : 'lost';
        if (sel === 'under') return total < line ? 'won' : 'lost';
        return 'pending';
    };

    // Grade one pick given final scores
    window.TMR.gradePick = function(pick, homeScore, awayScore) {
        var status;
        if (pick.market_type === 'h2h') status = window.TMR.gradeML(pick, homeScore, awayScore);
        else if (pick.market_type === 'spreads') status = window.TMR.gradeSpread(pick, homeScore, awayScore);
        else if (pick.market_type === 'totals') status = window.TMR.gradeTotal(pick, homeScore, awayScore);
        else return { status: 'pending', resultUnits: 0 };

        if (status === 'pending') return { status: 'pending', resultUnits: 0 };
        var resultUnits = window.TMR.calculateResultUnits(status, pick.units, pick.odds_snapshot);
        return { status: status, resultUnits: resultUnits };
    };

    // Fetch scores for a sport from ESPN (includes completed games)
    window.TMR.fetchScoresFromESPN = function(sportPath) {
        return fetch('https://site.api.espn.com/apis/site/v2/sports/' + sportPath + '/scoreboard')
            .then(function(r) { return r.ok ? r.json() : { events: [] }; })
            .then(function(data) {
                var scoreMap = {}; // espn_eventId -> { homeScore, awayScore, completed }
                var events = data.events || [];
                for (var i = 0; i < events.length; i++) {
                    var evt = events[i];
                    var comp = evt.competitions && evt.competitions[0];
                    if (!comp) continue;
                    var status = (comp.status && comp.status.type) || (evt.status && evt.status.type) || {};
                    if (!status.completed) continue;
                    var competitors = comp.competitors || [];
                    var homeComp = null, awayComp = null;
                    for (var j = 0; j < competitors.length; j++) {
                        if (competitors[j].homeAway === 'home') homeComp = competitors[j];
                        if (competitors[j].homeAway === 'away') awayComp = competitors[j];
                    }
                    if (!homeComp || !awayComp) continue;
                    var hs = parseInt(homeComp.score, 10);
                    var as = parseInt(awayComp.score, 10);
                    if (isNaN(hs) || isNaN(as)) continue;
                    scoreMap['espn_' + evt.id] = { homeScore: hs, awayScore: as };
                }
                return scoreMap;
            })
            .catch(function() { return {}; });
    };

    // Main auto-grade function: checks all pending picks against ESPN scores
    window.autoGradeAll = async function() {
        var statusEl = document.getElementById('gradeStatusMsg');
        if (statusEl) statusEl.textContent = 'Checking scores...';
        console.log('[TMR] Auto-grading: fetching scores from ESPN...');

        var allPicks = [];
        try { allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]'); } catch(e) { allPicks = []; }

        var pendingPicks = allPicks.filter(function(p) { return p.status === 'pending'; });
        if (pendingPicks.length === 0) {
            if (statusEl) statusEl.textContent = 'No pending picks to grade.';
            console.log('[TMR] No pending picks.');
            return;
        }

        // Collect unique sport paths needed
        var sportKeyToPath = {
            'americanfootball_nfl': 'football/nfl', 'basketball_nba': 'basketball/nba',
            'icehockey_nhl': 'hockey/nhl', 'baseball_mlb': 'baseball/mlb',
            'americanfootball_ncaaf': 'football/college-football', 'basketball_ncaab': 'basketball/mens-college-basketball'
        };
        var neededPaths = {};
        pendingPicks.forEach(function(p) {
            var path = sportKeyToPath[p.sport_key];
            if (path) neededPaths[path] = true;
        });

        // Fetch scores for each needed sport in parallel
        var allScores = {};
        var fetchPromises = Object.keys(neededPaths).map(function(path) {
            return window.TMR.fetchScoresFromESPN(path).then(function(scores) {
                Object.assign(allScores, scores);
            });
        });
        await Promise.all(fetchPromises);

        // Grade pending picks that have scores
        var gradedCount = 0;
        for (var i = 0; i < allPicks.length; i++) {
            var pick = allPicks[i];
            if (pick.status !== 'pending') continue;
            var scores = allScores[pick.game_id];
            if (!scores) continue; // game not completed yet

            var result = window.TMR.gradePick(pick, scores.homeScore, scores.awayScore);
            if (result.status !== 'pending') {
                pick.status = result.status;
                pick.result_units = result.resultUnits;
                pick.home_score = scores.homeScore;
                pick.away_score = scores.awayScore;
                pick.graded_at = new Date().toISOString();
                gradedCount++;
                console.log('[TMR] Graded: ' + pick.selection + ' -> ' + result.status + ' (' + (result.resultUnits >= 0 ? '+' : '') + result.resultUnits.toFixed(2) + 'u)');
            }
        }

        // Save updated picks back
        localStorage.setItem('tmr_picks', JSON.stringify(allPicks));

        if (statusEl) statusEl.textContent = gradedCount > 0 ? 'Graded ' + gradedCount + ' pick(s)!' : 'No completed games found for pending picks.';
        console.log('[TMR] Auto-grade complete: ' + gradedCount + ' picks graded.');

        // Refresh UI
        if (typeof window.renderPicksList === 'function') window.renderPicksList();
        if (typeof window.loadMyPicks === 'function') window.loadMyPicks(window.currentPicksTab || 'pending');
    };
    window.tryAutoGradeAll = window.autoGradeAll;

    console.log('[TMR EARLY] Core functions + grading engine defined.');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Trust My Record | The Future of Transparent Sports Betting</title>
    
    <link rel="canonical" href="https://trustmyrecord.com">
    <meta name="description" content="Tired of fake sports betting gurus? Trust My Record is a 100% transparent, verifiable sports betting platform with records, stats, forums, and social features. This is the end of the bullshit.">
    <meta name="keywords" content="sports betting transparency, verified sports picks, honest handicapper, sports betting community, sports forum, betting record tracker, no bs sports picks">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://trustmyrecord.com">
    <meta property="og:title" content="Trust My Record | The Future of Transparent Sports Betting">
    <meta property="og:description" content="100% transparent, verifiable sports betting platform. Track your record, compete with others, and prove your expertise. The end of the bullshit.">
    <meta property="og:image" content="https://trustmyrecord.com/static/og-image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://trustmyrecord.com">
    <meta property="twitter:title" content="Trust My Record | The Future of Transparent Sports Betting">
    <meta property="twitter:description" content="100% transparent, verifiable sports betting platform. Track your record, compete with others, and prove your expertise. The end of the bullshit.">
    <meta property="twitter:image" content="https://trustmyrecord.com/static/og-image.png">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üìä</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üìä</text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="static/css/social.css" rel="stylesheet">
    <link href="static/css/sportsbook.css" rel="stylesheet">

    <style>
        :root {
            --neon-cyan: #00ffff;
            --neon-purple: #ff00ff;
            --neon-green: #39ff14;
            --neon-gold: #ffd700;
            --neon-red: #ff073a;
            --dark-bg: #0a0a0f;
            --darker-bg: #050508;
            --card-bg: rgba(20, 20, 35, 0.8);
            --glass-border: rgba(0, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #b0b0c0;
            --text-muted: #808090;
            --gradient-neon: linear-gradient(45deg, var(--neon-cyan), var(--neon-purple));
            --gradient-gold: linear-gradient(45deg, var(--neon-gold), var(--neon-cyan));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--dark-bg);
            background-image:
                radial-gradient(circle at 25% 75%, rgba(0, 255, 255, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 75% 25%, rgba(255, 215, 0, 0.06) 0%, transparent 50%),
                linear-gradient(180deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-move 20s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes grid-move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .live-ticker {
            flex: 1;
            overflow: hidden;
            margin: 0 20px;
            background: rgba(0, 255, 255, 0.05);
            border-radius: 20px;
            padding: 8px 15px;
        }

        .ticker-scroll {
            display: flex;
            gap: 30px;
            animation: tickerScroll 30s linear infinite;
        }

        @keyframes tickerScroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ticker-item {
            white-space: nowrap;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            margin-right: 20px;
        }

        /* Main Navigation */
        .main-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .main-nav .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .main-nav .nav-link:hover {
            color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.1);
        }

        .main-nav .nav-link.profile-link {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            border-radius: 20px;
            padding: 8px 18px;
        }

        .main-nav .nav-link.profile-link:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        @media (max-width: 900px) {
            .main-nav {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }
            .main-nav .nav-link {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }

        /* Arena Dropdown Styles */
        .nav-dropdown { position: relative; display: flex; align-items: center; }
        .nav-dropdown-toggle { cursor: pointer; display: flex; align-items: center; gap: 5px; color: var(--text-secondary); text-decoration: none; font-weight: 600; font-size: 0.9rem; padding: 8px 16px; border-radius: 8px; transition: all 0.3s; }
        .nav-dropdown-toggle::after { content: '‚ñº'; font-size: 8px; transition: transform 0.3s; }
        .nav-dropdown:hover .nav-dropdown-toggle::after { transform: rotate(180deg); }
        .nav-dropdown:hover .nav-dropdown-toggle { color: var(--neon-cyan); background: rgba(0, 255, 255, 0.1); }
        .nav-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            min-width: 220px;
            background: rgba(15, 15, 25, 0.98);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6), 0 0 20px rgba(0, 255, 255, 0.1);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1001;
            overflow: hidden;
            margin-top: 10px;
        }
        .nav-dropdown:hover .nav-dropdown-menu { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        .nav-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .nav-dropdown-item:last-child { border-bottom: none; }
        .nav-dropdown-item:hover { background: rgba(0, 255, 255, 0.1); color: var(--neon-cyan); padding-left: 22px; }
        .nav-dropdown-item .dropdown-icon { font-size: 18px; width: 24px; text-align: center; }

        /* Profile Tabs Styles */
        .profile-tabs-container { display: flex; justify-content: center; gap: 5px; margin-bottom: 30px; flex-wrap: wrap; padding: 0 10px; }
        .profile-tab { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); padding: 12px 24px; border-radius: 10px; color: var(--text-secondary); font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease; }
        .profile-tab:hover { background: rgba(0, 255, 255, 0.1); color: var(--neon-cyan); }
        .profile-tab.active { background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.1)); border-color: var(--neon-cyan); color: var(--neon-cyan); }
        .profile-tab-content { display: none; }
        .profile-tab-content.active { display: block; }

        /* Friends Tab Styles */
        .friends-stats-bar { display: flex; justify-content: center; gap: 40px; margin-bottom: 25px; padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 12px; }
        .friend-stat { text-align: center; }
        .friend-stat .count { display: block; font-size: 2rem; font-weight: 700; color: var(--neon-cyan); font-family: Orbitron, sans-serif; }
        .friend-stat .label { color: var(--text-muted); font-size: 14px; }
        .friends-subtabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .friends-subtab { background: transparent; border: 1px solid var(--glass-border); padding: 8px 20px; border-radius: 20px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .friends-subtab:hover, .friends-subtab.active { background: rgba(0, 255, 255, 0.1); border-color: var(--neon-cyan); color: var(--neon-cyan); }
        .friends-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .friend-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 15px; display: flex; align-items: center; gap: 15px; transition: all 0.3s; }
        .friend-card:hover { border-color: var(--neon-cyan); transform: translateY(-2px); }
        .friend-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple)); display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .friend-info { flex: 1; }
        .friend-name { color: var(--text-primary); font-weight: 600; margin-bottom: 3px; }
        .friend-stats { color: var(--text-muted); font-size: 12px; }
        .friend-action { background: transparent; border: 1px solid var(--neon-cyan); color: var(--neon-cyan); padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.3s; }
        .friend-action:hover { background: var(--neon-cyan); color: var(--dark-bg); }

        /* Posts Tab Styles */
        .posts-filter { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .posts-filter-btn { background: transparent; border: 1px solid var(--glass-border); padding: 8px 16px; border-radius: 20px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .posts-filter-btn:hover, .posts-filter-btn.active { background: rgba(255, 215, 0, 0.1); border-color: var(--neon-gold); color: var(--neon-gold); }
        .user-posts-feed { max-width: 700px; margin: 0 auto; }
        .user-post-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .user-post-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .user-post-type { background: rgba(0, 255, 255, 0.1); color: var(--neon-cyan); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .user-post-date { color: var(--text-muted); font-size: 12px; }
        .user-post-content { color: var(--text-secondary); line-height: 1.6; }
        .user-post-pick { background: rgba(255, 215, 0, 0.1); border-left: 3px solid var(--neon-gold); padding: 12px 15px; border-radius: 0 8px 8px 0; margin-top: 10px; }
        .user-post-pick-team { color: var(--neon-gold); font-weight: 700; font-size: 16px; }
        .user-post-pick-details { color: var(--text-muted); font-size: 13px; margin-top: 5px; }

        .header-icon-btn {
            position: relative;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .header-icon-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .header-icon-btn .icon {
            font-size: 20px;
        }

        .header-icon-btn .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--neon-red);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .premium-btn {
            background: var(--gradient-gold) !important;
            color: var(--dark-bg) !important;
            font-weight: 700 !important;
            padding: 10px 20px !important;
            border-radius: 25px !important;
        }

        .login-btn {
            background: rgba(0, 255, 255, 0.1) !important;
            border: 1px solid var(--neon-cyan) !important;
            color: var(--neon-cyan) !important;
            font-weight: 600 !important;
            padding: 10px 20px !important;
            border-radius: 25px !important;
            transition: all 0.3s !important;
        }

        .login-btn:hover {
            background: rgba(0, 255, 255, 0.2) !important;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4) !important;
        }

        .signup-btn {
            background: var(--gradient-neon) !important;
            color: white !important;
            font-weight: 700 !important;
            padding: 10px 20px !important;
            border-radius: 25px !important;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3) !important;
            transition: all 0.3s !important;
        }

        .signup-btn:hover {
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6) !important;
            transform: scale(1.05) !important;
        }

        /* Header Auth Buttons (in header-actions) */
        .header-auth-btn {
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .header-auth-btn.login-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .header-auth-btn.login-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .header-auth-btn.signup-btn {
            background: var(--gradient-neon);
            color: white;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .header-auth-btn.signup-btn:hover {
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
            transform: scale(1.05);
        }

        .notifications-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            width: 380px;
            max-height: 500px;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .notifications-header h3 {
            color: var(--neon-cyan);
            font-size: 18px;
            font-weight: 700;
            margin: 0;
        }

        .mark-read-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mark-read-btn:hover {
            color: var(--neon-cyan);
        }

        .notifications-list {
            max-height: 350px;
            overflow-y: auto;
        }

        .notification-item {
            display: flex;
            gap: 12px;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .notification-item:hover {
            background: rgba(0, 255, 255, 0.05);
        }

        .notification-item.unread {
            background: rgba(0, 255, 255, 0.08);
            border-left: 3px solid var(--neon-cyan);
        }

        .notif-icon {
            font-size: 24px;
            min-width: 24px;
        }

        .notif-content {
            flex: 1;
        }

        .notif-text {
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .notif-time {
            color: var(--text-muted);
            font-size: 12px;
        }

        .notifications-footer {
            padding: 15px;
            text-align: center;
            border-top: 1px solid var(--glass-border);
        }

        .notifications-footer a {
            color: var(--neon-cyan);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .notifications-footer a:hover {
            text-decoration: underline;
        }

        /* Enhanced Notifications Styling */
        .unread-count {
            display: inline-block;
            background: var(--neon-red);
            color: white;
            font-size: 12px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }

        .notif-filters {
            display: flex;
            gap: 8px;
            padding: 10px 15px;
            border-bottom: 1px solid var(--glass-border);
            overflow-x: auto;
        }

        .notif-filter-btn {
            background: transparent;
            border: 1px solid rgba(0, 255, 255, 0.2);
            color: var(--text-secondary);
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .notif-filter-btn.active {
            background: rgba(0, 255, 255, 0.15);
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .notif-filter-btn:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-1px);
        }

        .notification-item {
            position: relative;
        }

        .notif-action-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .notif-action-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .notif-action-btn.premium-btn {
            background: var(--gradient-gold);
            border-color: var(--neon-gold);
            color: var(--dark-bg);
        }

        /* Notification Icon States */
        .notif-icon.win {
            color: var(--neon-green);
            filter: drop-shadow(0 0 8px var(--neon-green));
        }

        .notif-icon.loss {
            color: var(--neon-red);
            filter: drop-shadow(0 0 8px var(--neon-red));
        }

        .notif-icon.pending {
            color: var(--neon-gold);
            filter: drop-shadow(0 0 8px var(--neon-gold));
            animation: pulse 2s infinite;
        }

        .notif-icon.achievement {
            color: var(--neon-gold);
            filter: drop-shadow(0 0 10px var(--neon-gold));
            animation: goldPulse 2s infinite;
        }

        .notif-icon.rank-up {
            color: var(--neon-cyan);
            filter: drop-shadow(0 0 8px var(--neon-cyan));
        }

        .notif-icon.premium {
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Profit/Loss Indicators */
        .profit {
            color: var(--neon-green);
            font-weight: 700;
            font-size: 15px;
        }

        .loss-amount {
            color: var(--neon-red);
            font-weight: 700;
            font-size: 15px;
        }

        /* Notification List Scrollbar */
        .notifications-list::-webkit-scrollbar {
            width: 6px;
        }

        .notifications-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .notifications-list::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 255, 0.3);
            border-radius: 3px;
        }

        .notifications-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 255, 0.5);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-family: 'Orbitron', monospace;
            font-size: clamp(1.3rem, 2.5vw, 1.6rem);
            font-weight: 700;
            background: var(--gradient-gold);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse-gold 3s ease-in-out infinite alternate;
            letter-spacing: 1px;
            cursor: pointer;
        }

        @keyframes pulse-gold {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }

        nav {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
            align-items: center;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 700;
            padding: 14px 20px;
            border: 1px solid transparent;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: 1.1rem;
            white-space: nowrap;
            flex-shrink: 0;
            cursor: pointer;
            letter-spacing: 0.5px;
        }

        nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-neon);
            transition: left 0.3s ease;
            z-index: -1;
        }

        nav a.active {
            color: var(--neon-gold);
            border-color: var(--neon-gold);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        nav a:hover {
            color: var(--dark-bg);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        nav a:hover::before {
            left: 0;
        }

        /* Sign Up Button */
        .signup-btn {
            background: var(--gradient-gold) !important;
            color: var(--dark-bg) !important;
            border: 2px solid var(--neon-gold) !important;
            font-weight: 700 !important;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 14px 24px !important;
            margin-left: 12px;
            font-size: 1.1rem !important;
        }

        .signup-btn::before {
            display: none !important;
        }

        .signup-btn:hover {
            background: var(--gradient-neon) !important;
            border-color: var(--neon-cyan) !important;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6) !important;
            color: var(--dark-bg) !important;
        }

        /* Page Sections */
        .page-section {
            display: none;
            min-height: 80vh;
        }

        .page-section.active {
            display: block;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 60px 20px;
            position: relative;
        }

        .hero h1 {
            font-family: 'Orbitron', monospace;
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 900;
            margin-bottom: 20px;
            color: #00ffff;
            line-height: 1.1;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        @keyframes neon-flash {
            0% {
                text-shadow: 
                    0 0 3px #00ffff,
                    0 0 6px #00ffff,
                    0 0 9px #00ffff;
            }
            100% {
                text-shadow: 
                    0 0 5px #00ffff,
                    0 0 10px #00ffff,
                    0 0 15px #00ffff,
                    0 0 20px #00ffff;
            }
        }

        .hero p {
            font-size: clamp(1rem, 2.2vw, 1.3rem);
            color: var(--text-secondary);
            margin-bottom: 35px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            font-weight: 400;
        }

        /* Glass Cards */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            min-height: 200px;
        }

        /* Stats Dashboard */
        .stats-dashboard {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .stats-title {
            color: var(--neon-cyan);
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 0 0 20px var(--neon-cyan);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            padding: 30px 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--neon-gold);
            margin-bottom: 10px;
            text-shadow: 0 0 15px var(--neon-gold);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quick-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--gradient-gold);
            color: var(--dark-bg);
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
        }

        .action-btn.secondary {
            background: transparent;
            color: var(--neon-cyan);
            border: 2px solid var(--neon-cyan);
        }

        .action-btn.secondary:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
        }

        /* NEW COMMAND CENTER DASHBOARD STYLES */
        .dashboard-command-center {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .dashboard-profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .profile-avatar-section {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .dashboard-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dashboard-username {
            font-size: 2rem;
            font-weight: 900;
            color: var(--neon-gold);
            text-shadow: 0 0 15px var(--neon-gold);
            margin: 0;
        }

        .dashboard-member-since {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 0;
        }

        .dashboard-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge-item {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-item.newbie {
            background: rgba(57, 255, 20, 0.1);
            border-color: var(--neon-green);
            color: var(--neon-green);
        }

        .badge-item.winner {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--neon-gold);
            color: var(--neon-gold);
        }

        .profile-rank-section {
            text-align: center;
        }

        .rank-display {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .rank-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rank-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--neon-gold);
            text-shadow: 0 0 20px var(--neon-gold);
        }

        .dashboard-stats-section,
        .dashboard-activity-section,
        .dashboard-actions,
        .dashboard-recent {
            margin-bottom: 30px;
        }

        .section-label {
            color: var(--neon-cyan);
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-grid.enhanced {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .stat-card.primary { border-color: var(--neon-cyan); }
        .stat-card.success { border-color: var(--neon-green); }
        .stat-card.profit { border-color: var(--neon-gold); }
        .stat-card.streak { border-color: var(--neon-purple); }

        .stat-subtitle {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 8px;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .activity-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .activity-card:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-3px);
        }

        .activity-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .activity-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 5px;
        }

        .activity-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .quick-actions-grid .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 18px 25px;
        }

        .action-btn.primary-action {
            grid-column: span 1;
            background: var(--gradient-neon);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
        }

        .action-icon {
            font-size: 1.3rem;
        }

        .action-text {
            font-size: 1rem;
            font-weight: 700;
        }

        .recent-picks-mini {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            min-height: 100px;
        }

        .no-picks-message {
            text-align: center;
            color: var(--text-muted);
            padding: 30px;
            font-size: 1rem;
        }

        .recent-pick-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .recent-pick-item:last-child {
            border-bottom: none;
        }

        .pick-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .pick-game {
            font-weight: 600;
            color: var(--text-primary);
        }

        .pick-details-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .pick-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .pick-status.pending {
            background: rgba(255, 215, 0, 0.2);
            color: var(--neon-gold);
        }

        .pick-status.won {
            background: rgba(57, 255, 20, 0.2);
            color: var(--neon-green);
        }

        .pick-status.lost {
            background: rgba(255, 7, 58, 0.2);
            color: var(--neon-red);
        }

        @media (max-width: 1024px) {
            .stats-grid.enhanced,
            .activity-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .dashboard-profile-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            .profile-avatar-section {
                flex-direction: column;
            }
            .stats-grid.enhanced,
            .activity-grid,
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ENHANCED PROFILE PAGE STYLES */
        .profile-page-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .profile-header-banner {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 215, 0, 0.1));
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .profile-main-info {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .profile-avatar-large {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .profile-avatar-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            object-fit: cover;
            background: var(--card-bg);
        }

        .upload-avatar-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--gradient-neon);
            border: 2px solid white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .upload-avatar-btn:hover {
            transform: scale(1.1);
        }

        .avatar-options {
            display: flex;
            gap: 8px;
        }

        .avatar-option-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--glass-border);
            background: var(--card-bg);
            cursor: pointer;
            padding: 5px;
            transition: all 0.2s;
        }

        .avatar-option-btn:hover {
            border-color: var(--neon-cyan);
        }

        .avatar-option-btn img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .profile-identity h1 {
            font-size: 2rem;
            color: var(--neon-gold);
            margin: 0 0 5px 0;
        }

        .profile-username {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin: 0 0 15px 0;
        }

        .edit-profile-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .edit-profile-btn:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        .profile-content-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 25px;
        }

        
/* Pending Picks Card Styles */
.pending-picks-card {
    border: 2px solid var(--neon-gold) !important;
}

.pending-pick-item:hover {
    background: rgba(255, 215, 0, 0.15) !important;
    transform: translateX(5px);
    transition: all 0.2s;
}

.profile-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .profile-card h3 {
            color: var(--neon-cyan);
            font-size: 1.1rem;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--glass-border);
        }

        .no-data-message {
            color: var(--text-muted);
            font-size: 0.95rem;
            text-align: center;
            padding: 15px;
            margin: 0;
        }

        /* Team Badges */
        .favorite-teams-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .team-badge {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--text-primary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .team-badge .remove-team {
            cursor: pointer;
            opacity: 0.6;
            margin-left: 5px;
        }

        .team-badge .remove-team:hover {
            opacity: 1;
            color: var(--neon-red);
        }

        .add-teams-btn {
            background: var(--gradient-neon);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .add-teams-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        /* Points Section */
        .points-breakdown {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .point-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .point-icon {
            font-size: 1.5rem;
        }

        .point-details {
            flex: 1;
        }

        .point-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .point-value {
            color: var(--neon-cyan);
            font-size: 1.2rem;
            font-weight: 700;
        }

        .point-value.total {
            color: var(--neon-gold);
        }

        /* Stats Grid */
        .stats-grid-profile {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-box-profile {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--neon-gold);
        }

        .stat-label-profile {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 5px;
        }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .activity-icon {
            font-size: 1.2rem;
        }

        .activity-text {
            flex: 1;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .activity-time {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        /* Avatar Upload Section */
        .avatar-upload-section {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .upload-image-btn, .default-avatar-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .upload-image-btn:hover, .default-avatar-btn:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        /* Team Selector Modal */
        .team-selector-modal {
            max-width: 600px;
        }

        .team-selector-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .team-select-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--glass-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .team-select-item:hover {
            border-color: var(--neon-cyan);
        }

        .team-select-item.selected {
            border-color: var(--neon-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .team-select-item input {
            display: none;
        }

        .sport-filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .sport-filter-tab {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .sport-filter-tab.active {
            background: rgba(0, 255, 255, 0.15);
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        @media (max-width: 768px) {
            .profile-main-info {
                flex-direction: column;
                text-align: center;
            }
            .profile-content-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid-profile {
                grid-template-columns: repeat(2, 1fr);
            }
            .team-selector-grid {
                grid-template-columns: 1fr;
            }
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-neon);
            border-radius: 17px;
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
        }

        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 255, 255, 0.2);
        }

        .glass-card:hover::before {
            opacity: 0.2;
        }

        /* Sections */
        .section {
            padding: 30px 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-header h2 {
            font-family: 'Orbitron', monospace;
            font-size: clamp(1.5rem, 3.5vw, 2rem);
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .section-header .highlight {
            background: var(--gradient-gold);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-header p {
            font-size: clamp(0.9rem, 2vw, 1rem);
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-top: 25px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .feature-card {
            text-align: center;
            position: relative;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--neon-cyan), var(--neon-purple), var(--neon-gold));
            border-radius: 17px;
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
        }

        .feature-card:hover::before {
            opacity: 0.2;
        }

        .feature-icon {
            width: 55px;
            height: 55px;
            margin: 0 auto 15px;
            background: var(--gradient-neon);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--dark-bg);
            font-weight: bold;
        }

        .feature-card h3 {
            font-family: 'Orbitron', monospace;
            font-size: clamp(1rem, 2vw, 1.2rem);
            color: var(--neon-gold);
            margin-bottom: 12px;
        }

        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: clamp(0.85rem, 1.8vw, 0.95rem);
        }

        /* CTA Section */
        .cta {
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }

        .cta-button {
            font-family: 'Orbitron', monospace;
            font-size: clamp(0.95rem, 2vw, 1.1rem);
            font-weight: 700;
            color: var(--dark-bg);
            background: var(--gradient-gold);
            border: none;
            padding: 12px 28px;
            border-radius: 30px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
        }

        .cta-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.5);
            background: var(--gradient-neon);
        }

        /* Make Your Picks Section */
        .picks-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .pick-form {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: var(--neon-gold);
            font-weight: 600;
            margin-bottom: 8px;
            font-family: 'Orbitron', monospace;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .submit-pick {
            background: var(--gradient-gold);
            color: var(--dark-bg);
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-pick:hover {
            background: var(--gradient-neon);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .picks-history {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 30px;
        }

        .pick-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 4px solid var(--neon-cyan);
        }

        .pick-item.win {
            border-left-color: var(--neon-green);
        }

        .pick-item.loss {
            border-left-color: var(--neon-red);
        }

        .pick-details {
            flex: 1;
        }

        .pick-game {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .pick-bet {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .pick-result {
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .pick-result.pending {
            background: rgba(255, 215, 0, 0.2);
            color: var(--neon-gold);
        }

        .pick-result.win {
            background: rgba(57, 255, 20, 0.2);
            color: var(--neon-green);
        }

        .pick-result.loss {
            background: rgba(255, 7, 58, 0.2);
            color: var(--neon-red);
        }

        /* Coming Soon Overlay */
        .coming-soon {
            text-align: center;
            padding: 100px 20px;
        }

        .coming-soon h2 {
            font-family: 'Orbitron', monospace;
            font-size: clamp(2rem, 4vw, 3rem);
            color: var(--neon-cyan);
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .coming-soon p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 25px 20px;
            margin-top: 25px;
            border-top: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.2);
        }

        footer p {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            nav {
                justify-content: center;
                gap: 12px;
            }
            
            .signup-btn {
                margin-left: 0 !important;
            }
            
            .hero {
                padding: 40px 20px;
            }
            
            .section {
                padding: 30px 0;
            }
            
            .feature-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .section-header {
                margin-bottom: 30px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* Scroll reveal animations */
        .reveal {
            opacity: 1;
            transform: translateY(0);
        }

        /* ========================================
           SOCIAL MEDIA FEATURES CSS
           ======================================== */

        /* Social Feed Styles */
        .feed-container-social {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }

        .feed-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        .feed-main-column {
            min-width: 0;
        }

        .create-post-box {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
        }

        .create-post-box textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 16px;
            resize: vertical;
            min-height: 80px;
        }

        .create-post-box textarea:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .post-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .toolbar-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.2);
            color: var(--neon-cyan);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .toolbar-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .post-submit-btn {
            background: var(--gradient-neon);
            border: none;
            color: white;
            padding: 10px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
        }

        .post-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        .feed-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 10px;
        }

        .feed-tab {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 10px 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
        }

        .feed-tab.active {
            color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.1);
            border-bottom: 2px solid var(--neon-cyan);
        }

        .feed-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .feed-post {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .feed-post:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .post-author-info {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .post-avatar {
            font-size: 32px;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid var(--neon-cyan);
        }

        .post-meta {
            display: flex;
            flex-direction: column;
        }

        .post-author {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 15px;
        }

        .post-time {
            font-size: 13px;
            color: var(--text-muted);
        }

        .post-content {
            color: var(--text-primary);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .post-actions {
            display: flex;
            gap: 20px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .post-action-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .post-action-btn:hover {
            background: rgba(0, 255, 255, 0.1);
            color: var(--neon-cyan);
        }

        /* Feed Sidebar */
        .feed-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .feed-sidebar-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-widget {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
        }

        .sidebar-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
        }

        .sidebar-card h4 {
            color: var(--neon-cyan);
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .quick-stat {
            text-align: center;
            padding: 15px 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .quick-stat .stat-value {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 5px;
        }

        .quick-stat .stat-label {
            display: block;
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .suggested-users {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .suggested-user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .suggested-user-item:hover {
            background: rgba(0, 255, 255, 0.05);
        }

        .user-avatar-sm {
            font-size: 28px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid var(--neon-cyan);
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 3px;
        }

        .user-stat {
            font-size: 12px;
            color: var(--text-muted);
        }

        .follow-btn-sm {
            background: var(--gradient-neon);
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: 18px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .follow-btn-sm:hover {
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
        }

        .trending-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag-item {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag-item:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .top-users-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .top-user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .top-user-item .rank-badge {
            width: 30px;
            height: 30px;
            background: var(--gradient-gold);
            color: var(--dark-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .top-username {
            flex: 1;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .top-stat {
            color: var(--neon-green);
            font-weight: 700;
            font-size: 14px;
        }

        .widget-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .user-suggestion {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-suggestion:last-child {
            border-bottom: none;
        }

        .user-suggestion-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-suggestion-avatar {
            font-size: 24px;
        }

        .user-suggestion-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        .follow-btn {
            background: var(--gradient-neon);
            border: none;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .follow-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .follow-btn.following {
            background: rgba(0, 255, 255, 0.2);
            color: var(--neon-cyan);
        }

        .trending-tag {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .trending-tag:last-child {
            border-bottom: none;
        }

        .tag-name {
            color: var(--neon-cyan);
            font-weight: 600;
            font-size: 15px;
        }

        .tag-count {
            color: var(--text-muted);
            font-size: 13px;
        }

        .top-handicapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .top-handicapper:last-child {
            border-bottom: none;
        }

        .handicapper-rank {
            font-size: 20px;
            font-weight: 700;
            color: var(--neon-gold);
            min-width: 30px;
        }

        .handicapper-info {
            flex: 1;
            margin-left: 10px;
        }

        .handicapper-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        .handicapper-record {
            color: var(--text-muted);
            font-size: 12px;
        }

        .handicapper-units {
            color: var(--neon-green);
            font-weight: 700;
            font-size: 14px;
        }

        /* Profile Page Styles */
        .profile-page-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }

        .profile-header-banner {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
        }

        .profile-cover-photo {
            height: 200px;
            background: var(--gradient-neon);
            position: relative;
        }

        .profile-main-info {
            padding: 0 30px 30px;
            margin-top: -50px;
            position: relative;
        }

        .profile-avatar-large {
            position: relative;
            display: inline-block;
        }

        .avatar-display {
            font-size: 80px;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-bg);
            border: 4px solid var(--neon-cyan);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .change-avatar-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--neon-cyan);
            border: none;
            color: var(--dark-bg);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .change-avatar-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
        }

        .profile-identity {
            display: inline-block;
            vertical-align: top;
            margin-left: 30px;
            padding-top: 20px;
        }

        .profile-identity h1 {
            font-size: 32px;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .profile-username {
            color: var(--text-secondary);
            font-size: 18px;
            margin-bottom: 15px;
        }

        .edit-profile-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .edit-profile-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        .profile-content-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
        }

        .profile-left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .profile-right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .profile-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 25px;
        }

        
        /* Stats Card Futuristic Enhancements */
        .stats-card-futuristic {
            background: linear-gradient(135deg, rgba(10, 15, 25, 0.98), rgba(5, 10, 20, 0.99)) !important;
            border: 1px solid rgba(0, 255, 255, 0.2) !important;
            position: relative;
            overflow: hidden;
        }

        .stats-card-futuristic::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.03), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stats-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
        }

        .stats-card-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            letter-spacing: 1px;
        }

        .header-icon {
            font-size: 20px;
        }

        .stats-live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            font-weight: 700;
            color: var(--neon-green);
            letter-spacing: 1px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--neon-green);
            border-radius: 50%;
            animation: pulse-live 1.5s infinite;
        }

        @keyframes pulse-live {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(57, 255, 20, 0.7); }
            50% { opacity: 0.7; box-shadow: 0 0 0 6px rgba(57, 255, 20, 0); }
        }

        .stats-disclaimer {
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 11px;
            color: rgba(255, 255, 255, 0.3);
            text-align: center;
            letter-spacing: 0.5px;
        }

        /* Orbitron font for numbers */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap');


        /* FUTURISTIC STATS GRID */
        .stats-grid-profile {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        @media (max-width: 768px) {
            .stats-grid-profile {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-box-profile {
            position: relative;
            background: linear-gradient(145deg, rgba(15, 20, 30, 0.95), rgba(5, 10, 20, 0.98));
            border: 1px solid rgba(0, 255, 255, 0.15);
            border-radius: 12px;
            padding: 24px 16px;
            text-align: center;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .stat-box-profile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
            opacity: 0.6;
        }

        .stat-box-profile::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center top, rgba(0, 255, 255, 0.05), transparent 70%);
            pointer-events: none;
        }

        .stat-box-profile:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-5px) scale(1.02);
            box-shadow:
                0 10px 40px rgba(0, 255, 255, 0.25),
                0 0 30px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .stat-box-profile:hover::before {
            animation: scanline 1.5s ease-in-out infinite;
        }

        @keyframes scanline {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .stat-number {
            font-family: 'Orbitron', 'Courier New', monospace;
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(180deg, #00ffff, #00cccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
            letter-spacing: 1px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .stat-box-profile.positive .stat-number {
            background: linear-gradient(180deg, #39ff14, #00cc00);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .stat-box-profile.negative .stat-number {
            background: linear-gradient(180deg, #ff073a, #cc0000);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .stat-box-profile.highlight .stat-number {
            background: linear-gradient(180deg, #ffd700, #ffaa00);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .stat-label-profile {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }

        /* Empty State Styling */
        .stat-box-profile.no-data .stat-number {
            color: rgba(255, 255, 255, 0.2);
            background: none;
            -webkit-text-fill-color: rgba(255, 255, 255, 0.2);
        }

        .stat-box-profile.no-data {
            opacity: 0.6;
        }

        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .activity-item:hover {
            background: rgba(0, 255, 255, 0.05);
            border-color: rgba(0, 255, 255, 0.2);
        }

        .activity-icon {
            font-size: 24px;
        }

        .activity-text {
            flex: 1;
            color: var(--text-primary);
            font-size: 14px;
        }

        .activity-time {
            color: var(--text-muted);
            font-size: 12px;
        }

        /* Messages Page Styles */
        .messages-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 20px;
        }

        .messages-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            overflow: hidden;
            height: 700px;
        }

        .conversations-sidebar {
            border-right: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
        }

        .conversations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .conversations-header h3 {
            color: var(--neon-cyan);
            font-size: 18px;
            font-weight: 700;
            margin: 0;
        }

        .new-message-btn {
            background: var(--gradient-neon);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .new-message-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
        }

        .conversation-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .conversation-item:hover {
            background: rgba(0, 255, 255, 0.05);
        }

        .conversation-item.active {
            background: rgba(0, 255, 255, 0.1);
            border-left: 3px solid var(--neon-cyan);
        }

        .conversation-avatar {
            font-size: 32px;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid var(--neon-cyan);
        }

        .conversation-details {
            flex: 1;
            min-width: 0;
        }

        .conversation-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .conversation-preview {
            color: var(--text-muted);
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .conversation-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .unread-badge {
            background: var(--neon-cyan);
            color: var(--dark-bg);
            font-size: 11px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .message-thread {
            display: flex;
            flex-direction: column;
        }

        .thread-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .thread-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .thread-avatar {
            font-size: 32px;
        }

        .thread-user-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
        }

        .thread-options-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
            transition: all 0.3s;
        }

        .thread-options-btn:hover {
            color: var(--neon-cyan);
        }

        .messages-display {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message-group {
            display: flex;
            flex-direction: column;
            max-width: 70%;
        }

        .message-group.sent {
            align-self: flex-end;
        }

        .message-group.received {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message-group.sent .message-bubble {
            background: var(--gradient-neon);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-group.received .message-bubble {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.2);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 5px;
        }

        .message-timestamp {
            font-size: 11px;
            opacity: 0.7;
            text-align: right;
        }

        .message-group.received .message-timestamp {
            text-align: left;
        }

        .message-input-container {
            display: flex;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid var(--glass-border);
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 20px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 14px;
            resize: none;
            max-height: 120px;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .send-message-btn {
            background: var(--gradient-neon);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .send-message-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        /* Groups & Communities CSS */
        .groups-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .groups-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .create-group-btn {
            background: var(--gradient-neon);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .create-group-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.4);
        }

        .groups-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--glass-border);
            padding-bottom: 2px;
        }

        .groups-tab {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .groups-tab.active {
            color: var(--neon-cyan);
            border-bottom-color: var(--neon-cyan);
        }

        .groups-tab:hover:not(.active) {
            color: var(--text-primary);
        }

        .groups-panel {
            display: none;
        }

        .groups-panel.active {
            display: block;
        }

        .groups-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-dropdown {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            min-width: 150px;
        }

        .search-groups {
            flex: 1;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 14px;
            min-width: 250px;
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .group-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
            position: relative;
        }

        .group-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
            border-color: var(--neon-cyan);
        }

        .group-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .group-avatar {
            font-size: 40px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 12px;
            border: 2px solid var(--neon-cyan);
        }

        .group-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .group-badge.verified {
            background: rgba(0, 255, 255, 0.2);
            color: var(--neon-cyan);
            border: 1px solid var(--neon-cyan);
        }

        .group-badge.premium {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }

        .group-name {
            color: var(--text-primary);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .group-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .group-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .group-stat {
            color: var(--text-muted);
            font-size: 13px;
        }

        .group-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .tag {
            background: rgba(147, 51, 234, 0.2);
            color: var(--neon-purple);
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid rgba(147, 51, 234, 0.3);
        }

        .join-group-btn {
            width: 100%;
            background: var(--gradient-neon);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .join-group-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        .join-group-btn.premium {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }

        /* My Groups */
        .my-groups-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .my-group-item {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .my-group-item:hover {
            border-color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.05);
        }

        .my-group-item.active-group {
            border-color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.1);
        }

        .my-group-icon {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 10px;
        }

        .my-group-info {
            flex: 1;
        }

        .my-group-info h4 {
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 4px;
        }

        .my-group-info p {
            color: var(--text-muted);
            font-size: 13px;
        }

        .premium-text {
            color: #ffd700;
        }

        .my-group-badge {
            background: var(--neon-cyan);
            color: #000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }

        .my-group-badge.premium-badge {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
        }

        /* Group Chat View */
        .group-chat-view {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            overflow: hidden;
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .group-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.3);
        }

        .group-chat-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .group-icon-large {
            font-size: 40px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 10px;
        }

        .group-chat-title h3 {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 4px;
        }

        .group-chat-title p {
            color: var(--text-muted);
            font-size: 13px;
        }

        .group-settings-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .group-settings-btn:hover {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .group-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .group-message {
            display: flex;
            gap: 12px;
        }

        .msg-avatar {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .msg-content {
            flex: 1;
        }

        .msg-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .msg-author {
            color: var(--neon-cyan);
            font-weight: 600;
            font-size: 14px;
        }

        .badge-verified {
            background: var(--neon-cyan);
            color: #000;
            padding: 2px 6px;
            border-radius: 50%;
            font-size: 10px;
        }

        .msg-time {
            color: var(--text-muted);
            font-size: 12px;
        }

        .msg-text {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .msg-reactions {
            display: flex;
            gap: 10px;
        }

        .reaction {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reaction:hover {
            border-color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.1);
        }

        .group-message.highlight {
            background: rgba(147, 51, 234, 0.1);
            border-left: 3px solid var(--neon-purple);
            padding-left: 15px;
            margin-left: -15px;
            border-radius: 8px;
        }

        .group-chat-input {
            display: flex;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.3);
        }

        .attach-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .attach-btn:hover {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .group-chat-input input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
        }

        .send-msg-btn {
            background: var(--gradient-neon);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-msg-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        /* Betting Syndicates */
        .syndicates-intro {
            text-align: center;
            margin-bottom: 40px;
        }

        .syndicates-intro h3 {
            color: var(--text-primary);
            font-size: 28px;
            margin-bottom: 10px;
        }

        .syndicates-intro p {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .syndicates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .syndicate-card {
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 15px;
            padding: 30px;
            transition: all 0.3s;
        }

        .syndicate-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(147, 51, 234, 0.3);
            border-color: var(--neon-purple);
        }

        .syndicate-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .syndicate-icon {
            font-size: 48px;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(147, 51, 234, 0.1);
            border-radius: 15px;
            border: 2px solid var(--neon-purple);
        }

        .syndicate-badge {
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .syndicate-badge.elite {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }

        .syndicate-badge.pro {
            background: linear-gradient(135deg, #9333ea, #a855f7);
            color: white;
        }

        .syndicate-badge.starter {
            background: linear-gradient(135deg, #00ffff, #00cccc);
            color: #000;
        }

        .syndicate-card h3 {
            color: var(--text-primary);
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .syndicate-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .syndicate-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .syn-stat {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .syn-stat-label {
            color: var(--text-muted);
            font-size: 12px;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .syn-stat-value {
            color: var(--neon-cyan);
            font-size: 20px;
            font-weight: 700;
        }

        .syndicate-members {
            display: flex;
            align-items: center;
            gap: -8px;
            margin-bottom: 20px;
        }

        .member-avatar {
            font-size: 20px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.2);
            border-radius: 50%;
            border: 2px solid var(--card-bg);
            margin-left: -8px;
        }

        .member-avatar:first-child {
            margin-left: 0;
        }

        .member-count {
            color: var(--text-muted);
            font-size: 13px;
            margin-left: 12px;
        }

        .apply-syndicate-btn {
            width: 100%;
            background: linear-gradient(135deg, #9333ea, #a855f7);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .apply-syndicate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(147, 51, 234, 0.5);
        }

        .create-syndicate-section {
            background: var(--card-bg);
            border: 2px dashed var(--glass-border);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
        }

        .create-syndicate-section h4 {
            color: var(--text-primary);
            font-size: 22px;
            margin-bottom: 10px;
        }

        .create-syndicate-section p {
            color: var(--text-secondary);
            font-size: 15px;
            margin-bottom: 25px;
        }

        .create-syndicate-btn {
            background: var(--gradient-neon);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .create-syndicate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 255, 0.4);
        }

        /* Live Games CSS */
        .live-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .live-games-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 25px;
        }

        .live-games-main {
            min-width: 0;
        }

        .live-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .live-filter-btn {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .live-filter-btn.active {
            background: var(--gradient-neon);
            color: white;
            border-color: transparent;
        }

        .live-filter-btn:hover:not(.active) {
            border-color: var(--neon-cyan);
            color: var(--text-primary);
        }

        .live-games-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .live-game-card {
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }

        .live-game-card:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.2);
        }

        .live-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff0000, #ff4444);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .live-badge.pulsing {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .game-score-container {
            margin-bottom: 20px;
        }

        .team-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .team-row:last-child {
            border-bottom: none;
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-emoji {
            font-size: 24px;
        }

        .team-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 16px;
        }

        .team-score {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .team-score.winning {
            color: var(--neon-cyan);
        }

        .live-odds-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .odds-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .odds-row:last-child {
            margin-bottom: 0;
        }

        .odds-label {
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 600;
            min-width: 80px;
        }

        .odds-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .odds-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: var(--neon-cyan);
            transform: translateY(-2px);
        }

        .odds-btn.hot {
            background: rgba(255, 68, 68, 0.2);
            border-color: #ff4444;
            color: #ff4444;
        }

        /* === DRAFTKINGS-STYLE SPORTSBOOK LAYOUT === */
        /* IMPORTANT: These styles are locked and must not be overridden */
        .market-headers {
            display: grid !important;
            grid-template-columns: 1fr 110px 110px 130px !important;
            gap: 10px !important;
            padding: 14px 18px !important;
            background: #121418 !important;
            border-bottom: 1px solid #2d3340 !important;
            border-radius: 8px 8px 0 0 !important;
            margin-bottom: 0 !important;
            position: sticky !important;
            top: 0 !important;
            z-index: 10 !important;
        }

        .market-headers .market-label {
            color: #8b9ab0 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            font-size: 12px !important;
            font-weight: 700 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            text-align: center !important;
        }

        .market-headers .market-label:first-child {
            text-align: left !important;
        }

        .game-row {
            background: #1a1d24 !important;
            border: 1px solid #2d3340 !important;
            border-top: none !important;
            padding: 0 !important;
            margin-bottom: 8px !important;
            border-radius: 0 0 8px 8px !important;
        }

        .game-row:hover {
            border-color: #3d4250 !important;
        }

        .game-row .game-time-header {
            background: #121418 !important;
            padding: 8px 16px !important;
            border-bottom: 1px solid #2d3340 !important;
        }

        .game-row .game-time {
            color: #6c7380 !important;
            font-size: 12px !important;
            font-weight: 500 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        }

        .game-row .team-row {
            display: grid !important;
            grid-template-columns: 1fr 110px 110px 130px !important;
            gap: 10px !important;
            align-items: center !important;
            padding: 12px 18px !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03) !important;
        }

        .game-row .team-row:last-child {
            border-bottom: none !important;
        }

        .game-row .team-info {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
        }

        .game-row .team-name {
            color: #ffffff !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        }

        /* DraftKings-style buttons - LARGER */
        .game-row .odds-btn {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            background: #2a2f38 !important;
            border: 1px solid #3d4250 !important;
            border-radius: 4px !important;
            padding: 10px 8px !important;
            cursor: pointer !important;
            transition: all 0.15s ease !important;
            min-height: 58px !important;
            width: 100% !important;
        }

        .game-row .odds-btn:hover {
            background: #363c48 !important;
            border-color: #4a5060 !important;
        }

        .game-row .odds-btn:active {
            background: #1a4d1a !important;
            border-color: #00c853 !important;
        }

        /* DraftKings Style: Spread/Line is BIG, odds are small below - LARGER */
        .game-row .odds-btn .odds-line {
            color: #ffffff !important;
            font-size: 17px !important;
            font-weight: 700 !important;
            margin-bottom: 3px !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            line-height: 1.2 !important;
        }

        .game-row .odds-btn .odds-value {
            color: #a0a8b8 !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        }

        .game-row .odds-btn .odds-value.positive {
            color: #00c853 !important;
        }

        /* Loading State */
        .loading-games {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* No Games State */
        .no-games {
            text-align: center;
            padding: 60px 20px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
        }

        .no-games-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .no-games h3 {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .no-games p {
            color: var(--text-secondary);
        }

        /* Responsive DraftKings-style Sportsbook */
        @media (max-width: 768px) {
            .market-headers {
                grid-template-columns: 1fr 80px 80px 95px !important;
                padding: 10px 12px !important;
                gap: 6px !important;
            }

            .market-headers .market-label {
                font-size: 10px !important;
            }

            .game-row .team-row {
                grid-template-columns: 1fr 80px 80px 95px !important;
                padding: 8px 12px !important;
                gap: 6px !important;
            }

            .game-row .team-name {
                font-size: 13px !important;
            }

            .game-row .odds-btn {
                padding: 6px 4px !important;
                min-height: 46px !important;
            }

            .game-row .odds-btn .odds-line {
                font-size: 13px !important;
            }

            .game-row .odds-btn .odds-value {
                font-size: 10px !important;
            }
        }

        @media (max-width: 480px) {
            .market-headers {
                grid-template-columns: 1fr 60px 60px 75px !important;
                padding: 8px 10px !important;
                gap: 4px !important;
            }

            .market-headers .market-label {
                font-size: 9px !important;
                letter-spacing: 0 !important;
            }

            .game-row .team-row {
                grid-template-columns: 1fr 60px 60px 75px !important;
                padding: 6px 10px !important;
                gap: 4px !important;
            }

            .game-row .team-name {
                font-size: 12px !important;
            }

            .game-row .odds-btn {
                padding: 5px 2px !important;
                min-height: 42px !important;
            }

            .game-row .odds-btn .odds-line {
                font-size: 12px !important;
            }

            .game-row .odds-btn .odds-value {
                font-size: 9px !important;
            }
        }
        /* === END DRAFTKINGS-STYLE SPORTSBOOK - LOCKED === */

        .live-stats-quick {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-muted);
            font-size: 13px;
        }

        .hot-pick {
            color: #ff4444;
            font-weight: 600;
        }

        /* Live Chat Sidebar */
        .live-chat-sidebar {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            height: fit-content;
            max-height: 800px;
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 100px;
        }

        .live-chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .live-chat-header h3 {
            color: var(--text-primary);
            font-size: 18px;
            margin: 0;
        }

        .online-count {
            color: #00ff00;
            font-size: 13px;
            font-weight: 600;
        }

        .live-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
        }

        .chat-message {
            display: flex;
            gap: 10px;
        }

        .chat-message.highlight {
            background: rgba(147, 51, 234, 0.1);
            border-left: 3px solid var(--neon-purple);
            padding: 10px;
            margin-left: -10px;
            border-radius: 8px;
        }

        .chat-avatar {
            font-size: 20px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .chat-content {
            flex: 1;
        }

        .chat-user {
            color: var(--neon-cyan);
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .chat-time {
            color: var(--text-muted);
            font-size: 11px;
            font-weight: normal;
            margin-left: 6px;
        }

        .verified-check {
            background: var(--neon-cyan);
            color: #000;
            padding: 2px 5px;
            border-radius: 50%;
            font-size: 10px;
            margin-left: 4px;
        }

        .chat-text {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
        }

        .live-chat-input {
            display: flex;
            gap: 10px;
            padding: 15px;
            border-top: 1px solid var(--glass-border);
        }

        .live-chat-input input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 14px;
        }

        .chat-send-btn {
            background: var(--gradient-neon);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        /* Marketplace CSS */
        .marketplace-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .marketplace-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .marketplace-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            margin-top: 8px;
        }

        .sell-btn {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            padding: 14px 28px;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s;
        }

        .sell-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }

        .marketplace-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--glass-border);
            padding-bottom: 2px;
        }

        .market-tab {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .market-tab.active {
            color: var(--neon-cyan);
            border-bottom-color: var(--neon-cyan);
        }

        .market-tab:hover:not(.active) {
            color: var(--text-primary);
        }

        .market-panel {
            display: none;
        }

        .market-panel.active {
            display: block;
        }

        .market-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .market-filter-dropdown {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            min-width: 180px;
        }

        .marketplace-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .market-product-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
            position: relative;
        }

        .market-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
            border-color: var(--neon-cyan);
        }

        .product-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .product-badge.bestseller {
            background: linear-gradient(135deg, #ff4444, #ff6666);
            color: white;
        }

        .product-badge.trending {
            background: linear-gradient(135deg, #9333ea, #a855f7);
            color: white;
        }

        .product-badge.new {
            background: linear-gradient(135deg, #00ffff, #00cccc);
            color: #000;
        }

        .seller-info {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .seller-avatar {
            font-size: 28px;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid var(--neon-cyan);
        }

        .seller-details {
            flex: 1;
        }

        .seller-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .verified-badge {
            background: var(--neon-cyan);
            color: #000;
            padding: 2px 6px;
            border-radius: 50%;
            font-size: 10px;
            margin-left: 4px;
        }

        .seller-rating {
            color: var(--text-muted);
            font-size: 13px;
        }

        .product-title {
            color: var(--text-primary);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .product-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .product-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .stat-label {
            display: block;
            color: var(--text-muted);
            font-size: 11px;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .stat-value {
            display: block;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 700;
        }

        .stat-value.success {
            color: #00ff00;
        }

        .product-pricing {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
        }

        .price-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .price {
            color: var(--text-primary);
            font-size: 24px;
            font-weight: 700;
        }

        .price-note {
            color: var(--text-muted);
            font-size: 12px;
        }

        .buy-btn {
            background: var(--gradient-neon);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        /* Seller Benefits Section */
        .seller-stats-section {
            margin-top: 60px;
            background: var(--card-bg);
            border: 2px dashed var(--glass-border);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
        }

        .seller-stats-section h3 {
            color: var(--text-primary);
            font-size: 28px;
            margin-bottom: 12px;
        }

        .seller-stats-section > p {
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 30px;
        }

        .seller-benefits {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .benefit-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 25px;
        }

        .benefit-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .benefit-card h4 {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 8px;
        }

        .benefit-card p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .become-seller-btn {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            padding: 16px 40px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .become-seller-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
        }

        /* Premium CSS */
        .premium-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .premium-hero {
            text-align: center;
            margin-bottom: 60px;
        }

        .premium-hero-title {
            color: var(--text-primary);
            font-size: 48px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ffd700, #ff69b4, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .premium-hero-subtitle {
            color: var(--text-secondary);
            font-size: 20px;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 80px;
        }

        .pricing-card {
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            transition: all 0.3s;
            position: relative;
        }

        .pricing-card.featured {
            border-color: var(--neon-cyan);
            transform: scale(1.05);
            box-shadow: 0 15px 50px rgba(0, 255, 255, 0.3);
        }

        .pricing-card.elite-card {
            border-color: #ffd700;
        }

        .pricing-card:hover {
            transform: translateY(-10px) scale(1.02);
        }

        .pricing-card.featured:hover {
            transform: translateY(-10px) scale(1.07);
        }

        .tier-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .tier-badge.free {
            background: rgba(128, 128, 128, 0.3);
            color: var(--text-secondary);
        }

        .tier-badge.pro {
            background: var(--gradient-neon);
            color: white;
        }

        .tier-badge.elite {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }

        .tier-name {
            color: var(--text-primary);
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin: 30px 0 20px 0;
        }

        .tier-price {
            text-align: center;
            margin-bottom: 10px;
        }

        .price-amount {
            color: var(--text-primary);
            font-size: 48px;
            font-weight: 700;
        }

        .price-period {
            color: var(--text-muted);
            font-size: 18px;
        }

        .tier-savings {
            text-align: center;
            color: #00ff00;
            font-size: 14px;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .features-list {
            list-style: none;
            padding: 0;
            margin: 30px 0;
        }

        .feature-item {
            color: var(--text-primary);
            padding: 12px 0;
            border-bottom: 1px solid var(--glass-border);
            font-size: 15px;
        }

        .feature-item:last-child {
            border-bottom: none;
        }

        .feature-item.disabled {
            color: var(--text-muted);
            opacity: 0.5;
        }

        .pricing-btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }

        .pricing-btn.pro {
            background: var(--gradient-neon);
            color: white;
        }

        .pricing-btn.elite {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }

        .pricing-btn:not([disabled]):hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.4);
        }

        .pricing-btn[disabled] {
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Comparison Table */
        .comparison-section {
            margin-bottom: 80px;
        }

        .comparison-title {
            color: var(--text-primary);
            font-size: 32px;
            text-align: center;
            margin-bottom: 40px;
        }

        .comparison-table {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            overflow: hidden;
        }

        .comparison-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            border-bottom: 1px solid var(--glass-border);
        }

        .comparison-row:last-child {
            border-bottom: none;
        }

        .comparison-row.header {
            background: rgba(0, 255, 255, 0.1);
        }

        .comparison-cell {
            padding: 20px;
            text-align: center;
            color: var(--text-primary);
            font-size: 15px;
        }

        .comparison-cell.feature-name {
            text-align: left;
            font-weight: 600;
        }

        .comparison-row.header .comparison-cell {
            font-weight: 700;
            font-size: 16px;
        }

        /* Testimonials */
        .testimonials-section {
            margin-bottom: 80px;
        }

        .testimonials-title {
            color: var(--text-primary);
            font-size: 32px;
            text-align: center;
            margin-bottom: 40px;
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        .testimonial-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 30px;
        }

        .testimonial-rating {
            color: #ffd700;
            font-size: 20px;
            margin-bottom: 15px;
        }

        .testimonial-text {
            color: var(--text-primary);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            font-style: italic;
        }

        .testimonial-author {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .author-name {
            color: var(--neon-cyan);
            font-weight: 600;
        }

        .author-tier {
            color: var(--text-muted);
            font-size: 13px;
        }

        /* FAQ */
        .faq-section {
            margin-bottom: 40px;
        }

        .faq-title {
            color: var(--text-primary);
            font-size: 32px;
            text-align: center;
            margin-bottom: 40px;
        }

        .faq-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        .faq-item {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 25px;
        }

        .faq-question {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 12px;
        }

        .faq-answer {
            color: var(--text-secondary);
            font-size: 15px;
            line-height: 1.6;
        }

        .profile-card h3 {
            color: var(--neon-cyan);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-bio {
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 15px;
        }

        .favorite-teams-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .team-badge {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--text-primary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .team-badge-add {
            background: transparent;
            border: 1px dashed rgba(255, 255, 255, 0.3);
            color: var(--text-secondary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .team-badge-add:hover {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.05);
        }

        .points-breakdown {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .point-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .point-icon {
            font-size: 32px;
        }

        .point-details {
            flex: 1;
        }

        .point-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 5px;
        }

        .point-value {
            color: var(--text-primary);
            font-size: 24px;
            font-weight: 700;
        }

        .point-value.total {
            color: var(--neon-gold);
        }

        .achievements-badges {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .achievement-badge {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid var(--neon-gold);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .achievement-badge:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .achievement-badge.locked {
            opacity: 0.3;
            filter: grayscale(100%);
        }

        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .profile-stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 5px;
        }

        .profile-stat-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        /* Profile Edit Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--dark-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.3);
        }

        .profile-edit-modal h2 {
            color: var(--neon-cyan);
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 32px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-modal:hover {
            color: var(--neon-red);
            transform: scale(1.2);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 15px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 15px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }

        .profile-save-btn {
            width: 100%;
            background: var(--gradient-neon);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.4);
        }

        /* Leaderboards Styles */
        /* ========================================
           MODERNIZED LEADERBOARDS - PROFESSIONAL LAYOUT
           ======================================== */

        .leaderboards-container {
            max-width: 1400px;
            margin: 60px auto;
            padding: 40px;
        }

        .leaderboards-container .section-title {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--neon-gold), var(--neon-cyan), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            letter-spacing: 2px;
        }

        .leaderboard-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .compare-users-btn {
            background: linear-gradient(135deg, var(--neon-gold), #ff8c00);
            border: none;
            color: var(--dark-bg);
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .compare-users-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
        }

        .leaderboard-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 40px 0;
            overflow-x: auto;
            padding: 10px 0;
        }

        .lb-tab {
            background: rgba(0, 255, 255, 0.08);
            border: 2px solid rgba(0, 255, 255, 0.3);
            color: var(--text-primary);
            padding: 16px 32px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .lb-tab.active {
            background: var(--gradient-neon);
            color: white;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
            transform: scale(1.05);
        }

        .lb-tab:hover {
            transform: translateY(-3px);
            border-color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.15);
        }

        .leaderboard-panel {
            display: none;
            animation: fadeIn 0.4s ease-in;
        }

        .leaderboard-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 50px;
            padding: 30px;
            background: rgba(0, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .leaderboard-header h3 {
            font-size: 42px;
            color: var(--neon-gold);
            margin-bottom: 15px;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            letter-spacing: 1px;
        }

        .leaderboard-header p {
            color: var(--text-secondary);
            font-size: 18px;
            font-weight: 500;
        }

        .leaderboard-table {
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .lb-table-header {
            display: grid;
            grid-template-columns: 100px 1fr 140px 140px 180px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.15), rgba(255, 0, 255, 0.15));
            padding: 24px 30px;
            font-weight: 800;
            color: var(--neon-cyan);
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border-bottom: 2px solid var(--neon-cyan);
        }

        .lb-table-body {
            max-height: 700px;
            overflow-y: auto;
        }

        .lb-row {
            display: grid;
            grid-template-columns: 100px 1fr 140px 140px 180px;
            padding: 24px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s;
            align-items: center;
        }

        .lb-row:hover {
            background: rgba(0, 255, 255, 0.08);
            transform: scale(1.01);
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.2);
        }

        .lb-row:last-child {
            border-bottom: none;
        }

        /* Highlight top 3 rows */
        .lb-row:nth-child(1) {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent);
        }

        .lb-row:nth-child(2) {
            background: linear-gradient(90deg, rgba(192, 192, 192, 0.08), transparent);
        }

        .lb-row:nth-child(3) {
            background: linear-gradient(90deg, rgba(205, 127, 50, 0.08), transparent);
        }

        .lb-col-rank {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rank-badge {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 900;
            font-size: 20px;
            border: 3px solid transparent;
        }

        .rank-badge.gold {
            background: var(--gradient-gold);
            color: var(--dark-bg);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.7);
            border-color: #ffd700;
            animation: goldPulse 2s infinite;
        }

        @keyframes goldPulse {
            0%, 100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.7); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 1); }
        }

        .rank-badge.silver {
            background: linear-gradient(45deg, #c0c0c0, #e8e8e8);
            color: var(--dark-bg);
            box-shadow: 0 0 15px rgba(192, 192, 192, 0.5);
            border-color: #c0c0c0;
        }

        .rank-badge.bronze {
            background: linear-gradient(45deg, #cd7f32, #d4a574);
            color: var(--dark-bg);
            box-shadow: 0 0 15px rgba(205, 127, 50, 0.5);
            border-color: #cd7f32;
        }

        /* Default rank badge for 4+ */
        .rank-badge {
            background: rgba(0, 255, 255, 0.15);
            color: var(--neon-cyan);
            border-color: rgba(0, 255, 255, 0.3);
        }

        .lb-col-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar-tiny {
            font-size: 32px;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid var(--glass-border);
        }

        .user-name-lb {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 18px;
            letter-spacing: 0.5px;
        }

        .lb-col-stat {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 17px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .lb-col-total {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: var(--neon-gold);
            font-size: 22px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        /* Pagination for Profile Posts */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
        }

        .pagination-link {
            padding: 10px 20px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .pagination-link:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .pagination-link.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .current-date {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Responsive Design for Social Features */
        @media (max-width: 1024px) {
            .feed-grid {
                grid-template-columns: 1fr;
            }

            .feed-sidebar-column {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .profile-content-grid {
                grid-template-columns: 1fr;
            }

            .messages-layout {
                grid-template-columns: 300px 1fr;
            }

            .lb-table-header,
            .lb-row {
                grid-template-columns: 80px 1fr 120px 120px 150px;
                font-size: 15px;
                padding: 20px 25px;
            }

            .leaderboard-header h3 {
                font-size: 38px;
            }
        }

        @media (max-width: 768px) {
            .feed-tabs {
                overflow-x: auto;
            }

            .feed-sidebar-column {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(3, 1fr);
            }

            .messages-layout {
                grid-template-columns: 1fr;
                height: auto;
            }

            .conversations-sidebar {
                display: none;
            }

            .leaderboard-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            .leaderboards-container {
                padding: 30px 20px;
            }

            .leaderboards-container .section-title {
                font-size: 36px;
            }

            .lb-tab {
                font-size: 14px;
                padding: 14px 24px;
            }

            .lb-table-header,
            .lb-row {
                grid-template-columns: 70px 1fr 100px 100px 120px;
                padding: 18px 20px;
                font-size: 14px;
            }

            .leaderboard-header {
                padding: 25px;
                margin-bottom: 35px;
            }

            .leaderboard-header h3 {
                font-size: 32px;
            }

            .leaderboard-header p {
                font-size: 16px;
            }

            .rank-badge {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }

            .user-name-lb {
                font-size: 16px;
            }

            .lb-col-total {
                font-size: 20px;
            }

            .profile-main-info {
                text-align: center;
            }

            .profile-identity {
                display: block;
                margin-left: 0;
                margin-top: 20px;
            }
        }

        @media (max-width: 480px) {
            .post-actions {
                flex-wrap: wrap;
            }

            .leaderboards-container {
                padding: 20px 15px;
                margin: 40px auto;
            }

            .leaderboards-container .section-title {
                font-size: 28px;
            }

            .leaderboard-tabs {
                gap: 8px;
            }

            .lb-tab {
                font-size: 12px;
                padding: 12px 18px;
            }

            .leaderboard-header {
                padding: 20px 15px;
                margin-bottom: 25px;
            }

            .leaderboard-header h3 {
                font-size: 24px;
            }

            .leaderboard-header p {
                font-size: 14px;
            }

            .lb-table-header,
            .lb-row {
                grid-template-columns: 50px 1fr 90px;
                gap: 10px;
                padding: 15px 12px;
                font-size: 12px;
            }

            .lb-col-stat:nth-child(3),
            .lb-col-stat:nth-child(4) {
                display: none;
            }

            .rank-badge {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }

            .user-avatar-tiny {
                width: 35px;
                height: 35px;
                font-size: 24px;
            }

            .user-name-lb {
                font-size: 14px;
            }

            .lb-col-total {
                font-size: 16px;
            }

            .quick-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Responsive CSS for New Features */
        @media (max-width: 1024px) {
            /* Live Games */
            .live-games-layout {
                grid-template-columns: 1fr;
            }

            .live-chat-sidebar {
                max-height: 400px;
            }

            /* Groups */
            .groups-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }

            /* Marketplace */
            .marketplace-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }

            /* Premium */
            .pricing-grid {
                grid-template-columns: 1fr;
            }

            .pricing-card.featured {
                transform: scale(1);
            }

            .testimonials-grid {
                grid-template-columns: 1fr;
            }

            .comparison-row {
                grid-template-columns: 1.5fr 1fr 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            /* Header adjustments */
            .live-ticker {
                display: none;
            }

            .header-actions {
                gap: 8px;
            }

            /* Groups */
            .groups-grid {
                grid-template-columns: 1fr;
            }

            .syndicates-grid {
                grid-template-columns: 1fr;
            }

            .seller-benefits {
                grid-template-columns: 1fr;
            }

            /* Live Games */
            .live-filters {
                flex-wrap: wrap;
                gap: 8px;
            }

            .live-filter-btn {
                padding: 8px 12px;
                font-size: 13px;
            }

            /* Marketplace */
            .marketplace-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .market-filters {
                flex-direction: column;
                width: 100%;
            }

            .market-filter-dropdown {
                width: 100%;
            }

            .product-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Premium */
            .premium-hero-title {
                font-size: 32px;
            }

            .comparison-table {
                overflow-x: auto;
            }

            .faq-grid {
                grid-template-columns: 1fr;
            }

            /* Syndicates */
            .syndicate-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            /* Navigation */
            nav {
                overflow-x: auto;
                white-space: nowrap;
            }

            nav a {
                padding: 10px 12px;
                font-size: 13px;
            }

            /* Groups tabs */
            .groups-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }

            .groups-tab {
                padding: 10px 15px;
                font-size: 14px;
            }

            /* Marketplace tabs */
            .marketplace-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }

            .market-tab {
                padding: 10px 15px;
                font-size: 14px;
            }

            /* Live games */
            .odds-row {
                flex-wrap: wrap;
            }

            .odds-btn {
                font-size: 12px;
                padding: 6px 10px;
            }

            .team-name {
                font-size: 14px;
            }

            .team-score {
                font-size: 24px;
            }

            /* Product cards */
            .product-stats {
                grid-template-columns: 1fr;
            }

            .product-pricing {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            /* Premium */
            .premium-hero-title {
                font-size: 24px;
            }

            .premium-hero-subtitle {
                font-size: 16px;
            }

            .price-amount {
                font-size: 36px;
            }

            .comparison-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .comparison-cell {
                border-bottom: 1px solid var(--glass-border);
                text-align: left !important;
                padding: 15px;
            }

            .comparison-cell:before {
                content: attr(data-label);
                font-weight: 600;
                display: block;
                margin-bottom: 5px;
                color: var(--neon-cyan);
            }

            /* Notifications panel */
            .notifications-panel {
                right: 10px;
                left: 10px;
                width: auto;
            }
        }

        /* Common Section Styles */
        .section-title {
            font-size: 36px;
            font-weight: 900;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .section-title span {
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Highlight text */
        .highlight {
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div class="logo" onclick="showSection('home')">TRUST<span style="color: var(--neon-cyan);">MY</span>RECORD</div>
                </div>


                <div class="header-actions">
                    <button class="header-icon-btn" onclick="toggleNotifications()" id="notificationBtn">
                        <span class="icon">üîî</span>
                        <span class="badge" id="notificationBadge">5</span>
                    </button>
                    <button class="header-icon-btn" onclick="toggleSearch()">
                        <span class="icon">üîç</span>
                    </button>
                </div>

                <nav class="main-nav">
                    <a href="#home" class="nav-link" onclick="showSection('home')">Home</a>
                    <a href="#picks" class="nav-link" onclick="showSection('picks')">Make Picks</a>
                    <a href="#mypicks" class="nav-link" onclick="showSection('mypicks')">My Picks</a>
                    <div class="nav-dropdown">
                        <a href="#" class="nav-link nav-dropdown-toggle">The Arena</a>
                        <div class="nav-dropdown-menu">
                            <a href="#trivia" class="nav-dropdown-item" onclick="showSection('trivia'); return false;"><span class="dropdown-icon">üéØ</span><span>Trivia</span></a>
                            <a href="#polls-trivia" class="nav-dropdown-item" onclick="showSection('polls-trivia'); return false;"><span class="dropdown-icon">üìä</span><span>Prediction Polls</span></a>
                            <a href="#contests" class="nav-dropdown-item" onclick="showSection('contests'); return false;"><span class="dropdown-icon">üèÜ</span><span>Handicapping Contests</span></a>
                            <a href="#arena" class="nav-dropdown-item" onclick="showSection('arena'); return false;"><span class="dropdown-icon">‚öîÔ∏è</span><span>Challenges</span></a>
                        </div>
                    </div>
                    <a href="#forums" class="nav-link" onclick="showSection('forums'); return false;">Forums</a>
                    <a href="premium.html" class="nav-link" style="color: var(--neon-gold);">üëë Premium</a>
                    <a href="#profile" class="nav-link profile-link" onclick="showSection('profile')">My Profile</a>
                    <!-- Additional auth buttons populated by auth.js -->
                </nav>
            </div>

            <!-- Notifications Dropdown -->
            <div id="notificationsPanel" class="notifications-panel" style="display: none;">
                <div class="notifications-header">
                    <h3>Notifications <span class="unread-count" id="unreadCount">12</span></h3>
                    <button class="mark-read-btn" onclick="markAllRead()">‚úì Mark all read</button>
                </div>

                <!-- Notification Filters -->
                <div class="notif-filters">
                    <button class="notif-filter-btn active" onclick="filterNotifications('all')">All</button>
                    <button class="notif-filter-btn" onclick="filterNotifications('picks')">Picks</button>
                    <button class="notif-filter-btn" onclick="filterNotifications('social')">Social</button>
                    <button class="notif-filter-btn" onclick="filterNotifications('alerts')">Alerts</button>
                </div>

                <div class="notifications-list" id="notificationsList">
                    <!-- Notifications will be populated dynamically -->
                    <div class="no-notifications-message" style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
                        <div style="font-size: 48px; margin-bottom: 15px;">üîî</div>
                        <p style="margin: 0; font-size: 14px;">No notifications yet</p>
                        <p style="margin: 8px 0 0 0; font-size: 12px; opacity: 0.7;">Your picks, social activity, and alerts will appear here</p>
                    </div>
                </div>

                <div class="notifications-footer">
                    <a onclick="showSection('notifications')">View all notifications ‚Üí</a>
                </div>
            </div>
        </header>

        <main>
            <!-- Home Section -->
            <div id="home" class="page-section active">
                <section class="hero">
                    <h1 class="reveal">THE END OF THE BULLSHIT</h1>
                    <p class="reveal">A new standard for sports betting has arrived. Built on absolute proof, radical transparency, and zero excuses.</p>
                </section>

                <!-- LOGGED-IN USER DASHBOARD - Command Center -->
                <section id="userStatsDashboard" class="section" style="display: none;">
                    <div class="dashboard-command-center">
                        <!-- Profile Overview Header -->
                        <div class="dashboard-profile-header">
                            <div class="profile-avatar-section">
                                <img id="dashboardAvatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=1" alt="Avatar" class="dashboard-avatar">
                                <div class="profile-info">
                                    <h2 id="dashboardUsername" class="dashboard-username">Welcome Back!</h2>
                                    <p class="dashboard-member-since">Member since <span id="dashboardJoinDate">Today</span></p>
                                    <div class="dashboard-badges" id="dashboardBadges">
                                        <span class="badge-item newbie">Newcomer</span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-rank-section">
                                <div class="rank-display">
                                    <span class="rank-label">Leaderboard Rank</span>
                                    <span class="rank-value" id="dashboardRank">#--</span>
                                </div>
                            </div>
                        </div>

                        <!-- Main Stats Grid -->
                        <div class="dashboard-stats-section">
                            <h3 class="section-label">Your Performance</h3>
                            <div class="stats-grid enhanced">
                                <div class="stat-card primary">
                                    <div class="stat-icon">üìä</div>
                                    <div class="stat-value" id="totalPicks">0</div>
                                    <div class="stat-label">Total Picks</div>
                                    <div class="stat-subtitle" id="picksBreakdown">0W - 0L - 0P</div>
                                </div>
                                <div class="stat-card success">
                                    <div class="stat-icon">‚úÖ</div>
                                    <div class="stat-value" id="winRate">0%</div>
                                    <div class="stat-label">Win Rate</div>
                                    <div class="stat-subtitle">Overall Record</div>
                                </div>
                                <div class="stat-card profit">
                                    <div class="stat-icon">üí∞</div>
                                    <div class="stat-value" id="totalUnits">+0.00u</div>
                                    <div class="stat-label">Net Units</div>
                                    <div class="stat-subtitle" id="roiDisplay">0% ROI</div>
                                </div>
                                <div class="stat-card streak">
                                    <div class="stat-icon">üî•</div>
                                    <div class="stat-value" id="currentStreak">0</div>
                                    <div class="stat-label">Current Streak</div>
                                    <div class="stat-subtitle" id="bestStreak">Best: 0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Activity Section -->
                        <div class="dashboard-activity-section">
                            <h3 class="section-label">Community Activity</h3>
                            <div class="activity-grid">
                                <div class="activity-card">
                                    <div class="activity-icon">üí¨</div>
                                    <div class="activity-value" id="forumPosts">0</div>
                                    <div class="activity-label">Forum Posts</div>
                                </div>
                                <div class="activity-card">
                                    <div class="activity-icon">üéØ</div>
                                    <div class="activity-value" id="triviaScore">0</div>
                                    <div class="activity-label">Trivia Points</div>
                                </div>
                                <div class="activity-card">
                                    <div class="activity-icon">üó≥Ô∏è</div>
                                    <div class="activity-value" id="pollVotes">0</div>
                                    <div class="activity-label">Poll Votes</div>
                                </div>
                                <div class="activity-card">
                                    <div class="activity-icon">‚ùì</div>
                                    <div class="activity-value" id="triviaCreated">0</div>
                                    <div class="activity-label">Trivia Created</div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="dashboard-actions">
                            <h3 class="section-label">Quick Actions</h3>
                            <div class="quick-actions-grid">
                                <button onclick="showSection('picks')" class="action-btn primary-action">
                                    <span class="action-icon">üéØ</span>
                                    <span class="action-text">Make a Pick</span>
                                </button>
                                <button onclick="showSection('my-record')" class="action-btn" style="background: linear-gradient(135deg, var(--neon-gold), #cc9900);">
                                    <span class="action-icon">üìä</span>
                                    <span class="action-text">My Record</span>
                                </button>
                                <button onclick="showGradingModal()" class="action-btn" style="background: linear-gradient(135deg, var(--neon-green), #00cc00);">
                                    <span class="action-icon">‚úÖ</span>
                                    <span class="action-text">Grade Picks</span>
                                </button>
                                <button onclick="showSection('leaderboards')" class="action-btn">
                                    <span class="action-icon">üèÜ</span>
                                    <span class="action-text">Leaderboards</span>
                                </button>
                                <button onclick="showSection('polls-trivia')" class="action-btn">
                                    <span class="action-icon">üß†</span>
                                    <span class="action-text">Take Quiz</span>
                                </button>
                                <button onclick="showSection('forums')" class="action-btn">
                                    <span class="action-icon">üí¨</span>
                                    <span class="action-text">Forums</span>
                                </button>
                                <button onclick="exportUserData()" class="action-btn secondary">
                                    <span class="action-icon">üì•</span>
                                    <span class="action-text">Export Data</span>
                                </button>
                                <button onclick="showSection('profile')" class="action-btn secondary">
                                    <span class="action-icon">‚öôÔ∏è</span>
                                    <span class="action-text">Settings</span>
                                </button>
                            </div>
                        </div>

                        <!-- Recent Activity Feed -->
                        <div class="dashboard-recent">
                            <h3 class="section-label">Recent Picks</h3>
                            <div id="dashboardRecentPicks" class="recent-picks-mini">
                                <p class="no-picks-message">No picks yet. Make your first pick to start building your record!</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="section">
                    <div class="section-header reveal">
                        <h2>The Platform is the <span class="highlight">Future</span></h2>
                        <p>This is more than just a page for picks. We are building the definitive ecosystem for bettors who value real data over loud hype.</p>
                    </div>
                    <div class="feature-grid">
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üìä</div>
                            <h3>Track Every Pick</h3>
                            <p>Your complete betting history stored permanently and publicly. Every user's picks, wins, losses, and stats are tracked with surgical precision. No hiding, no editing, no excuses.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üìà</div>
                            <h3>Advanced Analytics</h3>
                            <p>Deep statistical breakdowns by sport, bet type, odds range, team, and more. Identify your strengths, expose your weaknesses, and track your improvement over time. The ultimate handicapping tool.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üí∞</div>
                            <h3>Sell Your Picks</h3>
                            <p>Prove you're a knowledgeable handicapper and monetize your skills. Set your own prices, build a subscriber base, and earn from your expertise. Your verified track record is your resume.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üß†</div>
                            <h3>Sports Trivia & Polls</h3>
                            <p>Think you know sports? Prove it. Compete in daily trivia, predict outcomes, and vote in polls against other users. Earn points, climb rankings, and show off your sports IQ.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üîí</div>
                            <h3>Immutable Records</h3>
                            <p>Every pick is permanently locked in our system. Filter by user, sport, bet type, or date. Compare anyone's track record instantly. The proof is always one click away.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">‚öîÔ∏è</div>
                            <h3>Compete & Prove It</h3>
                            <p>Challenge other handicappers head-to-head. Join tournaments. Climb the leaderboards. Talk your game in the forums, but your record does the real talking.</p>
                        </div>
                    </div>
                </section>

                <section class="section">
                    <div class="section-header reveal">
                        <h2>Enter <span class="highlight">The Arena</span></h2>
                        <p>Where legends are made and egos are destroyed. Face off against the best handicappers in the world in our competitive battleground.</p>
                    </div>
                    <div class="feature-grid">
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">‚öîÔ∏è</div>
                            <h3>Head-to-Head Battles</h3>
                            <p>Challenge anyone, anytime. Set your stakes, pick your sport, and let your records do the talking. Winner takes glory, loser takes the walk of shame.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üèÜ</div>
                            <h3>Tournament Mode</h3>
                            <p>Monthly tournaments with bracketed elimination. Survive multiple rounds against increasingly skilled opponents. Only the elite make it to the finals.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üëë</div>
                            <h3>Beat The Founder</h3>
                            <p>Think you're better than the house? Prove it. Take on our founder's record in a public showdown. Beat the creator of the platform and earn eternal bragging rights.</p>
                        </div>
                    </div>
                </section>

                <section class="section">
                    <div class="section-header reveal">
                        <h2>Community <span class="highlight">Forums</span></h2>
                        <p>No echo chambers. No fake positivity. Just raw, unfiltered discussion where your record speaks louder than your mouth.</p>
                    </div>
                    <div class="feature-grid">
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üéØ</div>
                            <h3>Sport-Specific Channels</h3>
                            <p>NFL, NBA, MLB, NHL, Soccer, Tennis - dedicated spaces for serious discussion about every major sport and league.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üìä</div>
                            <h3>Data-Driven Debates</h3>
                            <p>Back up your opinions with stats. Your posting privilege is tied to your track record. Performance determines credibility.</p>
                        </div>
                        <div class="glass-card feature-card reveal">
                            <div class="feature-icon">üî•</div>
                            <h3>No Bullshit Zone</h3>
                            <p>Verified records only. If you talk the talk, you better walk the walk. Your history is your reputation.</p>
                        </div>
                    </div>
                </section>
                
                <section class="cta">
                    <div class="section-header reveal">
                        <h2>The Record Starts Now.</h2>
                        <p>The era of the guru is over. The era of the record has begun. Witness the transparency from day one.</p>
                    </div>
                    <a onclick="showSection('picks')" class="cta-button reveal">JOIN THE REVOLUTION</a>
                </section>
            </div>

<!-- SOCIAL FEED SECTION -->
<div id="feed" class="page-section">
    <div class="feed-container-social">
        <h2 class="section-title">Community Feed</h2>

        <div class="feed-grid">
            <!-- Main Feed Column -->
            <div class="feed-main-column">
                <!-- Create Post Box -->
                <div class="create-post-box">
                    <textarea id="newPostContent" placeholder="Share your picks, analysis, or join the discussion..." rows="3"></textarea>
                    <div class="post-toolbar">
                        <button class="toolbar-btn" title="Add pick reference">üéØ Pick</button>
                        <button class="toolbar-btn" title="Add hashtag">#Ô∏è‚É£ Tag</button>
                        <button class="post-submit-btn" onclick="createFeedPost()">Post</button>
                    </div>
                </div>

                <!-- Feed Filter Tabs -->
                <div class="feed-tabs">
                    <button class="feed-tab active" onclick="filterFeed('all')">All Posts</button>
                    <button class="feed-tab" onclick="filterFeed('picks')">Picks Only</button>
                    <button class="feed-tab" onclick="filterFeed('following')">Following</button>
                    <button class="feed-tab" onclick="filterFeed('trending')">Trending</button>
                </div>

                <!-- Feed Posts Container -->
                <div id="socialFeedContainer">
                    <p style="text-align: center; color: var(--text-muted); padding: 40px;">No posts yet. Be the first to share!</p>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="feed-sidebar-column">
                <!-- User Quick Stats -->
                <div class="sidebar-card">
                    <h4>Your Stats</h4>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <span class="stat-value" id="sidebarPicks">0</span>
                            <span class="stat-label">Picks</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="sidebarWinRate">0%</span>
                            <span class="stat-label">Win Rate</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-value" id="sidebarFollowers">0</span>
                            <span class="stat-label">Followers</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- REDESIGNED PICKS SECTION - Games First Flow -->
<div id="picks" class="page-section">
    <div class="picks-container-modern">
        <div class="section-header">
            <h2>Make Your <span class="highlight">Picks</span></h2>
            <p>Select a sport, see all games, choose your bet</p>
        </div>

        <!-- Step 1: Sport Selection -->
        <div id="sportSelection" class="pick-step active">
            <h3>Select Sport</h3>
            <div class="sport-cards-grid">
                <div class="sport-card" data-sport="NBA" onclick="window.selectSportAndShowGames('NBA')" style="cursor:pointer;">
                    <div class="sport-icon">üèÄ</div>
                    <div class="sport-name">NBA</div>
                    <div class="sport-games" id="nba-game-count">Loading...</div>
                </div>
                <div class="sport-card" data-sport="NFL" onclick="window.selectSportAndShowGames('NFL')" style="cursor:pointer;">
                    <div class="sport-icon">üèà</div>
                    <div class="sport-name">NFL</div>
                    <div class="sport-games" id="nfl-game-count">Loading...</div>
                </div>
                <div class="sport-card" data-sport="NHL" onclick="window.selectSportAndShowGames('NHL')" style="cursor:pointer;">
                    <div class="sport-icon">üèí</div>
                    <div class="sport-name">NHL</div>
                    <div class="sport-games" id="nhl-game-count">Loading...</div>
                </div>
                <div class="sport-card" data-sport="NCAAB" onclick="window.selectSportAndShowGames('NCAAB')" style="cursor:pointer;">
                    <div class="sport-icon">üè´</div>
                    <div class="sport-name">NCAAB</div>
                    <div class="sport-games" id="ncaab-game-count">Loading...</div>
                </div>
                <div class="sport-card" data-sport="NCAAF" onclick="window.selectSportAndShowGames('NCAAF')" style="cursor:pointer;">
                    <div class="sport-icon">üéì</div>
                    <div class="sport-name">NCAAF</div>
                    <div class="sport-games" id="ncaaf-game-count">Loading...</div>
                </div>
                <div class="sport-card" data-sport="MLB" onclick="window.selectSportAndShowGames('MLB')" style="cursor:pointer;">
                    <div class="sport-icon">‚öæ</div>
                    <div class="sport-name">MLB</div>
                    <div class="sport-games" id="mlb-game-count">Loading...</div>
                </div>
            </div>
            <div style="margin-top: 25px;">
                <button onclick="window.showPickStep('picksList')" style="padding: 12px 28px; background: linear-gradient(135deg, #ff9800, #e65100); color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer;">View Your Picks</button>
            </div>
        </div>

        <!-- Step 2: Games List with All Bet Options -->
        <div id="gamesListSection" class="pick-step">
            <div class="back-button" onclick="goBackToSports()">‚Üê Back to Sports</div>
            <div class="games-header">
                <h3 id="selectedSportTitle">NBA Games</h3>
                <span class="games-count" id="gamesCountBadge">0 games</span>
            </div>
            <div id="gamesListContainer" class="games-list-new">
                <!-- Games will be loaded dynamically -->
                <div class="loading-games">Loading games...</div>
            </div>
        </div>

        <!-- Step 3: Pick Details (Confirmation) -->
        <div id="pickDetails" class="pick-step">
            <div class="back-button" onclick="goBackToGames()">‚Üê Back to Games</div>
            <h3>Confirm Your Pick</h3>

            <div class="pick-summary-card">
                <div class="summary-section">
                    <div class="summary-label">Game</div>
                    <div class="summary-value" id="summaryGame">Lakers @ Celtics</div>
                </div>
                <div class="summary-section">
                    <div class="summary-label">Your Pick</div>
                    <div class="summary-value" id="summaryPick">Lakers +5.5</div>
                </div>
                <div class="summary-section">
                    <div class="summary-label">Odds</div>
                    <div class="summary-value" id="summaryOdds">-110</div>
                </div>
            </div>

            <div class="pick-options">
                <div class="option-group">
                    <label>Units</label>
                    <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
                        <input type="number" id="unitsInput" min="0.5" max="5" step="0.5" value="1" style="width: 90px; padding: 12px 14px; background: var(--card-bg); border: 2px solid var(--glass-border); border-radius: 10px; color: var(--text-primary); font-size: 18px; font-weight: 700; text-align: center; font-family: 'Orbitron', monospace;" />
                        <div id="unitsModeToggle" style="display: flex; border-radius: 10px; overflow: hidden; border: 2px solid var(--glass-border);">
                            <button type="button" id="modeRisk" class="units-mode-btn active" onclick="setUnitsMode('risk')" style="padding: 12px 18px; background: var(--gradient-gold); border: none; color: var(--dark-bg); font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.2s;">RISK</button>
                            <button type="button" id="modeToWin" class="units-mode-btn" onclick="setUnitsMode('towin')" style="padding: 12px 18px; background: var(--card-bg); border: none; color: var(--text-primary); font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.2s;">TO WIN</button>
                        </div>
                    </div>
                    <p id="unitsExplanation" style="color: var(--text-muted); font-size: 0.85rem; margin-top: 8px;">Enter units you want to RISK (0.5 - 5). Winnings calculated from odds.</p>
                </div>

                <div class="option-group">
                    <label>Reasoning (Optional)</label>
                    <textarea id="pickReasoning" placeholder="Why do you like this pick?" rows="3"></textarea>
                </div>
            </div>

            <button class="submit-pick-btn" onclick="window.lockInPick()">
                <span class="btn-icon">üîí</span>
                <span class="btn-text">LOCK IN PICK</span>
            </button>
        </div>

        <!-- Step 4: Inline Confirmation (replaces alert) -->
        <div id="pickConfirmation" class="pick-step">
            <div style="background: linear-gradient(135deg, rgba(0,200,83,0.1), rgba(0,200,83,0.05)); border: 2px solid #00c853; border-radius: 12px; padding: 30px; text-align: center; animation: fadeIn 0.4s ease;">
                <div style="font-size: 48px; margin-bottom: 10px;">&#10003;</div>
                <h3 style="color: #00c853; font-size: 24px; margin-bottom: 8px;">Pick Confirmed</h3>
                <div id="confirmPickDetail" style="color: var(--text-primary); font-size: 20px; font-weight: bold; margin: 10px 0;">-</div>
                <div id="confirmPickMeta" style="color: var(--text-muted); font-size: 14px;">-</div>
                <div style="margin-top: 25px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="window.showPickStep('picksList')" style="padding: 12px 28px; background: linear-gradient(135deg, var(--neon-cyan), #0088cc); color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer;">View Your Picks</button>
                    <button onclick="window.showPickStep('sportSelection')" style="padding: 12px 28px; background: var(--card-bg); color: var(--text-primary); border: 2px solid var(--glass-border); border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer;">Make Another Pick</button>
                </div>
            </div>
        </div>

        <!-- Step 5: Your Picks List -->
        <div id="picksList" class="pick-step">
            <div class="back-button" onclick="window.showPickStep('sportSelection')">&#8592; Back to Sports</div>
            <h3>Your Picks</h3>
            <div style="display: flex; gap: 10px; margin: 15px 0; align-items: center; flex-wrap: wrap;">
                <button onclick="window.autoGradeAll()" style="background: linear-gradient(135deg, #00c853, #009624); color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-size: 15px; font-weight: 700; cursor: pointer;">&#9889; Auto-Grade Pending</button>
                <span id="gradeStatusMsg" style="color: var(--text-muted); font-size: 14px;"></span>
            </div>
            <div id="gradingLogBox" style="background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; padding: 15px; margin: 10px 0; font-family: monospace; font-size: 13px; color: #0f0; max-height: 200px; overflow-y: auto; display: none;"></div>
            <div id="picksStatsBar" style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;"></div>
            <div id="picksListContainer"></div>
        </div>
    </div>
</div>

<style>
/* MODERNIZED PICKS PAGE STYLES */
.picks-container-modern {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
}

.pick-step {
    display: none;
    animation: fadeIn 0.3s ease-in;
    position: relative;
    z-index: 5;
}

.pick-step.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.back-button {
    color: var(--neon-cyan);
    cursor: pointer;
    margin-bottom: 20px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    transition: all 0.2s;
}

.back-button:hover {
    color: var(--neon-gold);
    transform: translateX(-5px);
}

/* Sport Cards Grid */
.sport-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.sport-card {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 30px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.sport-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
    transition: left 0.5s;
}

.sport-card:hover::before {
    left: 100%;
}

.sport-card:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
    transform: translateY(-5px);
}

.sport-card.selected {
    border-color: var(--neon-gold);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
}

.sport-icon {
    font-size: 3rem;
    margin-bottom: 15px;
}

.sport-name {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--neon-gold);
    margin-bottom: 8px;
}

.sport-games {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

/* Bet Type Buttons */
.bet-type-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.bet-type-btn {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 30px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.1rem;
    color: var(--text-primary);
}

.bet-type-btn:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
    transform: translateY(-3px);
}

.bet-type-btn.selected {
    border-color: var(--neon-gold);
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
}

.bet-icon {
    font-size: 2.5rem;
}

.bet-label {
    font-weight: 700;
}

/* Games Grid */
.games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

/* NEW GAMES LIST STYLES - Games First Flow */
.games-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
}

.games-header h3 {
    margin: 0;
    color: var(--neon-gold);
}

.games-count {
    background: rgba(0, 255, 255, 0.1);
    color: var(--neon-cyan);
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

.loading-games {
    text-align: center;
    padding: 60px;
    color: var(--text-muted);
    font-size: 1.1rem;
}

.games-list-new {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* Individual Game Card - New Design */
.game-card-new {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.game-card-new:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 25px rgba(0, 255, 255, 0.2);
}

.game-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: rgba(0, 255, 255, 0.05);
    border-bottom: 1px solid var(--glass-border);
}

.game-time-new {
    color: var(--neon-gold);
    font-weight: 600;
    font-size: 0.95rem;
}

.game-status {
    background: rgba(57, 255, 20, 0.2);
    color: var(--neon-green);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 700;
}

/* Teams Section */
.game-teams-section {
    padding: 20px;
}

.team-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
}

.team-row:first-child {
    border-bottom: 1px solid var(--glass-border);
    padding-bottom: 15px;
    margin-bottom: 5px;
}

.team-info-left {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.team-name-large {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
}

.team-record-small {
    color: var(--text-muted);
    font-size: 0.85rem;
}

/* Bet Buttons Row */
.bet-buttons-row {
    display: flex;
    gap: 8px;
}

.bet-pick-btn {
    background: rgba(0, 255, 255, 0.1);
    border: 2px solid var(--glass-border);
    border-radius: 10px;
    padding: 10px 16px;
    min-width: 90px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.bet-pick-btn:hover {
    background: rgba(0, 255, 255, 0.2);
    border-color: var(--neon-cyan);
    transform: scale(1.02);
}

.bet-pick-btn.selected {
    background: var(--gradient-neon);
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
}

.bet-pick-btn .line {
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--text-primary);
    display: block;
}

.bet-pick-btn .odds {
    font-size: 0.85rem;
    color: var(--neon-gold);
    font-weight: 600;
}

/* Bet Type Tabs */
.bet-types-tabs {
    display: flex;
    gap: 5px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-top: 1px solid var(--glass-border);
    flex-wrap: wrap;
}

.bet-type-tab {
    background: transparent;
    border: 1px solid var(--glass-border);
    color: var(--text-secondary);
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.bet-type-tab:hover {
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

.bet-type-tab.active {
    background: rgba(0, 255, 255, 0.15);
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

/* Totals Row */
.totals-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 15px 20px;
    border-top: 1px solid var(--glass-border);
    background: rgba(0, 0, 0, 0.2);
}

.total-btn {
    background: rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 10px;
    padding: 12px 25px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    min-width: 120px;
}

.total-btn:hover {
    background: rgba(255, 215, 0, 0.2);
    border-color: var(--neon-gold);
}

.total-btn.selected {
    background: var(--gradient-gold);
    border-color: var(--neon-gold);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
}

.total-btn .label {
    font-size: 0.8rem;
    color: var(--text-secondary);
    display: block;
    margin-bottom: 3px;
}

.total-btn .value {
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--neon-gold);
}

.total-btn .odds {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* More Markets Button */
.more-markets-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 12px;
    background: transparent;
    border: none;
    border-top: 1px solid var(--glass-border);
    color: var(--neon-cyan);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.more-markets-btn:hover {
    background: rgba(0, 255, 255, 0.05);
}

/* Expanded Markets Section */
.expanded-markets {
    display: none;
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-top: 1px solid var(--glass-border);
}

.expanded-markets.show {
    display: block;
}

.market-section {
    margin-bottom: 20px;
}

.market-section:last-child {
    margin-bottom: 0;
}

.market-title {
    color: var(--neon-cyan);
    font-size: 0.9rem;
    font-weight: 700;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.market-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* No Games Message */
.no-games-message {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
}

.no-games-message h4 {
    color: var(--neon-cyan);
    margin-bottom: 10px;
}

@media (max-width: 768px) {
    .bet-buttons-row {
        flex-wrap: wrap;
    }
    .bet-pick-btn {
        min-width: 70px;
        padding: 8px 12px;
    }
    .team-name-large {
        font-size: 1rem;
    }
    .totals-row {
        flex-direction: column;
        gap: 10px;
    }
    .total-btn {
        width: 100%;
    }
}

.game-card {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.game-card:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
    transform: translateY(-3px);
}

.game-time {
    color: var(--neon-gold);
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 15px;
}

.game-matchup {
    margin-bottom: 15px;
}

.team {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
}

.team-name {
    font-weight: 700;
    font-size: 1.1rem;
}

.team-record {
    color: var(--text-muted);
    font-size: 0.9rem;
}

.at-symbol {
    text-align: center;
    color: var(--text-muted);
    font-size: 0.8rem;
    margin: 5px 0;
}

.game-odds {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    padding-top: 15px;
    border-top: 1px solid var(--glass-border);
}

.game-odds > div {
    background: rgba(0, 255, 255, 0.05);
    padding: 8px;
    border-radius: 8px;
    font-size: 0.85rem;
    text-align: center;
    color: var(--text-secondary);
}

/* Enhanced Odds Display */
.odds-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: rgba(0, 255, 255, 0.05);
    border-radius: 8px;
    margin-bottom: 6px;
}

.odds-row:last-child {
    margin-bottom: 0;
}

.team-short {
    font-weight: 600;
    color: var(--text-primary);
    min-width: 80px;
}

.total-label {
    font-weight: 600;
    color: var(--neon-cyan);
    min-width: 60px;
}

.odds-value {
    font-weight: 700;
    color: var(--neon-gold);
    font-family: 'Orbitron', monospace;
}

.odds-value.ml {
    font-size: 1.1rem;
}

.no-odds, .prop-notice, .alt-notice, .alt-preview {
    padding: 12px;
    text-align: center;
    color: var(--text-muted);
    font-style: italic;
}

.prop-notice {
    color: var(--neon-cyan);
    font-style: normal;
    font-weight: 600;
}

.alt-notice {
    color: var(--neon-gold);
    font-style: normal;
    font-weight: 600;
}

.alt-preview {
    font-size: 0.85rem;
    margin-top: 4px;
}

/* Pick History Styles */
.pick-history-item {
    background: var(--card-bg);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    position: relative;
}

.pick-history-item.pending {
    border-left: 3px solid var(--neon-cyan);
}

.pick-history-item.won {
    border-left: 3px solid #00ff00;
}

.pick-history-item.lost {
    border-left: 3px solid #ff4444;
}

.pick-history-header {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
}

.pick-sport-badge {
    background: var(--neon-gold);
    color: #000;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
}

.pick-bet-type {
    color: var(--neon-cyan);
    font-size: 0.85rem;
    font-weight: 600;
}

.pick-date {
    color: var(--text-muted);
    font-size: 0.8rem;
    margin-left: auto;
}

.pick-history-details {
    margin-bottom: 10px;
}

.pick-game-info {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 5px;
}

.pick-selection {
    color: var(--neon-gold);
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 5px;
}

.pick-meta {
    color: var(--text-muted);
    font-size: 0.85rem;
}

.pick-status-badge {
    position: absolute;
    top: 16px;
    right: 16px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
}

.pick-status-badge.status-pending {
    background: rgba(0, 255, 255, 0.2);
    color: var(--neon-cyan);
}

.pick-status-badge.status-won {
    background: rgba(0, 255, 0, 0.2);
    color: #00ff00;
}

.pick-status-badge.status-lost {
    background: rgba(255, 68, 68, 0.2);
    color: #ff4444;
}

/* Pick Summary Card */
.pick-summary-card {
    background: var(--card-bg);
    border: 2px solid var(--neon-gold);
    border-radius: 16px;
    padding: 25px;
    margin: 20px 0;
}

.summary-section {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid var(--glass-border);
}

.summary-section:last-child {
    border-bottom: none;
}

.summary-label {
    color: var(--text-secondary);
    font-weight: 600;
}

.summary-value {
    color: var(--neon-gold);
    font-weight: 700;
    font-size: 1.1rem;
}

/* Pick Options */
.pick-options {
    margin: 30px 0;
    position: relative;
    z-index: 10;
}

.option-group {
    margin-bottom: 30px;
    position: relative;
    z-index: 10;
}

.option-group label {
    display: block;
    color: var(--text-secondary);
    font-weight: 600;
    margin-bottom: 12px;
}

#unitsInput {
    position: relative;
    z-index: 20;
    -webkit-appearance: none;
    -moz-appearance: textfield;
}

#unitsInput:focus {
    border-color: var(--neon-gold);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
    outline: none;
}

.units-mode-btn {
    position: relative;
    z-index: 20;
}

#pickReasoning {
    position: relative;
    z-index: 20;
}

.confidence-buttons,
.units-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.conf-btn,
.unit-btn {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 10px;
    padding: 12px 20px;
    color: var(--text-primary);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    flex: 1;
    min-width: 70px;
}

.conf-btn:hover,
.unit-btn:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

.conf-btn.active,
.unit-btn.active {
    background: var(--gradient-gold);
    border-color: var(--neon-gold);
    color: var(--dark-bg);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
}

#pickReasoning {
    width: 100%;
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 10px;
    padding: 15px;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 1rem;
    resize: vertical;
    transition: all 0.2s;
}

#pickReasoning:focus {
    outline: none;
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
}

/* Submit Button */
.submit-pick-btn {
    width: 100%;
    background: var(--gradient-gold);
    border: none;
    border-radius: 12px;
    padding: 20px;
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--dark-bg);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    transition: all 0.3s;
}

.submit-pick-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
}

.btn-icon {
    font-size: 1.5rem;
}

/* Picks History Modern */
.picks-history-modern {
    margin-top: 60px;
}

.picks-history-modern h3 {
    color: var(--neon-gold);
    font-size: 1.8rem;
    margin-bottom: 25px;
}

.picks-timeline {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.pick-item-modern {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.2s;
}

.pick-item-modern:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
}

.pick-status-icon {
    font-size: 2rem;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
}

.pick-item-modern.win .pick-status-icon {
    background: rgba(57, 255, 20, 0.2);
    color: var(--neon-green);
}

.pick-item-modern.loss .pick-status-icon {
    background: rgba(255, 7, 58, 0.2);
    color: var(--neon-red);
}

.pick-item-modern.pending .pick-status-icon {
    background: rgba(255, 215, 0, 0.2);
    color: var(--neon-gold);
}

.pick-info {
    flex: 1;
}

.pick-game-name {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 5px;
}

.pick-meta {
    color: var(--text-muted);
    font-size: 0.9rem;
}

.pick-badge {
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.85rem;
    text-transform: uppercase;
}

.pick-badge.win {
    background: rgba(57, 255, 20, 0.2);
    color: var(--neon-green);
    border: 1px solid var(--neon-green);
}

.pick-badge.loss {
    background: rgba(255, 7, 58, 0.2);
    color: var(--neon-red);
    border: 1px solid var(--neon-red);
}

/* Additional styles for localStorage-based picks */
.pick-history-item {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.2s;
    position: relative;
}

.pick-history-item:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
}

.pick-history-header {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.pick-sport-badge {
    background: var(--gradient-neon);
    color: var(--dark-bg);
    padding: 4px 12px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 0.85rem;
}

.pick-bet-type {
    color: var(--neon-cyan);
    font-weight: 600;
}

.pick-date {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-left: auto;
}

.pick-history-details {
    color: var(--text-secondary);
    line-height: 1.6;
}

.pick-game-info {
    font-weight: 600;
    margin-bottom: 5px;
}

.pick-confidence {
    font-size: 0.9rem;
    color: var(--text-muted);
}

.pick-reasoning {
    margin-top: 10px;
    padding: 10px;
    background: rgba(0, 255, 255, 0.05);
    border-left: 3px solid var(--neon-cyan);
    border-radius: 4px;
    font-style: italic;
}

.pick-status-badge {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: 700;
    font-size: 0.75rem;
}

.pick-status-badge.pending {
    background: rgba(255, 215, 0, 0.2);
    color: var(--neon-gold);
    border: 1px solid var(--neon-gold);
}

.pick-status-badge.win {
    background: rgba(57, 255, 20, 0.2);
    color: var(--neon-green);
    border: 1px solid var(--neon-green);
}

.pick-status-badge.loss {
    background: rgba(255, 7, 58, 0.2);
    color: var(--neon-red);
    border: 1px solid var(--neon-red);
}

.pick-badge.pending {
    background: rgba(255, 215, 0, 0.2);
    color: var(--neon-gold);
    border: 1px solid var(--neon-gold);
}

@media (max-width: 768px) {
    .sport-cards-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    }

    .games-grid {
        grid-template-columns: 1fr;
    }

    .confidence-buttons,
    .units-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
    }
}
</style>

                            <li>Public leaderboards</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="arena" class="page-section">
                <div style="max-width: 1000px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="font-family: Orbitron, sans-serif; font-size: 2.5rem; background: linear-gradient(45deg, #ff6b35, #ff073a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px;">THE ARENA</h1>
                        <p style="color: var(--text-secondary); font-size: 1.1rem;">Challenge other handicappers to head-to-head pick battles</p>
                    </div>

                    <!-- Arena Stats -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px;">
                        <div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #ff6b35;" id="arenaRecord">0-0</div>
                            <div style="color: #6c7380; font-size: 11px; text-transform: uppercase;">Record</div>
                        </div>
                        <div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--neon-cyan);" id="arenaWinRate">0%</div>
                            <div style="color: #6c7380; font-size: 11px; text-transform: uppercase;">Win Rate</div>
                        </div>
                        <div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--neon-gold);" id="arenaActive">0</div>
                            <div style="color: #6c7380; font-size: 11px; text-transform: uppercase;">Active</div>
                        </div>
                        <div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #00c853;" id="arenaUnits">+0.0</div>
                            <div style="color: #6c7380; font-size: 11px; text-transform: uppercase;">Net Units</div>
                        </div>
                    </div>

                    <!-- Arena Mode Toggle -->
                    <div style="display: flex; gap: 8px; margin-bottom: 20px; background: rgba(255,255,255,0.03); border-radius: 12px; padding: 4px;">
                        <button id="arenaModeChallenge" onclick="switchArenaMode('challenges')" style="flex: 1; background: rgba(255,107,53,0.2); color: #ff6b35; border: 1px solid #ff6b35; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 14px;">‚öîÔ∏è Challenges</button>
                        <button id="arenaModePolls" onclick="switchArenaMode('polls')" style="flex: 1; background: transparent; color: #6c7380; border: 1px solid #333; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 14px;">üìä Prediction Polls</button>
                    </div>

                    <!-- Challenges Sub-Section -->
                    <div id="arenaChallengesSection">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; gap: 8px;">
                                <button class="arena-tab active" onclick="filterChallenges('all', this)" style="background: rgba(255,107,53,0.2); color: #ff6b35; border: 1px solid #ff6b35; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">All</button>
                                <button class="arena-tab" onclick="filterChallenges('open', this)" style="background: transparent; color: #6c7380; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Open</button>
                                <button class="arena-tab" onclick="filterChallenges('active', this)" style="background: transparent; color: #6c7380; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Active</button>
                                <button class="arena-tab" onclick="filterChallenges('completed', this)" style="background: transparent; color: #6c7380; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Completed</button>
                            </div>
                            <button onclick="openCreateChallengeModal()" style="background: linear-gradient(45deg, #ff6b35, #ff073a); color: white; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px;">+ Create Challenge</button>
                        </div>
                        <div id="challengesList" style="display: grid; gap: 12px;">
                            <div style="text-align: center; padding: 60px 20px; color: #6c7380;">
                                <div style="font-size: 48px; margin-bottom: 15px;">‚öîÔ∏è</div>
                                <p>No challenges yet. Create one to get started!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Arena Polls Sub-Section -->
                    <div id="arenaPollsSection" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="arena-poll-filter active" onclick="filterArenaPolls('all', this)" style="background: rgba(102,126,234,0.2); color: #667eea; border: 1px solid #667eea; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">All</button>
                                <button class="arena-poll-filter" onclick="filterArenaPolls('nba', this)" style="background: transparent; color: #6c7380; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">üèÄ NBA</button>
                                <button class="arena-poll-filter" onclick="filterArenaPolls('nfl', this)" style="background: transparent; color: #6c7380; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">üèà NFL</button>
                                <button class="arena-poll-filter" onclick="filterArenaPolls('nhl', this)" style="background: transparent; color: #6c7380; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">üèí NHL</button>
                                <button class="arena-poll-filter" onclick="filterArenaPolls('mlb', this)" style="background: transparent; color: #6c7380; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">‚öæ MLB</button>
                            </div>
                            <button onclick="openCreatePollModal()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px;">+ Create Poll</button>
                        </div>
                        <div id="arenaPollsList" style="display: grid; gap: 12px;"></div>
                    </div>
                </div>

                <!-- Create Challenge Modal -->
                <div id="createChallengeModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 500px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 30px;">
                        <span class="close-modal" onclick="document.getElementById('createChallengeModal').style.display='none'">&times;</span>
                        <h2 style="color: #ff6b35; font-family: Orbitron, sans-serif; margin-bottom: 20px;">Create Challenge</h2>
                        <form id="createChallengeForm" onsubmit="submitChallenge(event)">
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 6px; font-size: 13px;">Sport</label>
                                <select id="challengeSport" required style="width: 100%; background: var(--dark-bg); color: var(--text-primary); border: 1px solid var(--glass-border); border-radius: 8px; padding: 10px;">
                                    <option value="">Select Sport</option>
                                    <option value="NFL">üèà NFL</option>
                                    <option value="NBA">üèÄ NBA</option>
                                    <option value="NHL">üèí NHL</option>
                                    <option value="MLB">‚öæ MLB</option>
                                    <option value="NCAAF">üéì NCAAF</option>
                                    <option value="NCAAB">üè´ NCAAB</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 6px; font-size: 13px;">Description (e.g., "Lakers vs Celtics spread")</label>
                                <input type="text" id="challengeDescription" placeholder="Describe the matchup" required style="width: 100%; background: var(--dark-bg); color: var(--text-primary); border: 1px solid var(--glass-border); border-radius: 8px; padding: 10px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 6px; font-size: 13px;">Your Pick</label>
                                <input type="text" id="challengeCreatorPick" placeholder="e.g., Lakers -4.5" required style="width: 100%; background: var(--dark-bg); color: var(--text-primary); border: 1px solid var(--glass-border); border-radius: 8px; padding: 10px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 6px; font-size: 13px;">Units Wagered</label>
                                <input type="number" id="challengeUnits" min="0.5" max="5" step="0.5" value="1" required style="width: 100%; background: var(--dark-bg); color: var(--text-primary); border: 1px solid var(--glass-border); border-radius: 8px; padding: 10px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 6px; font-size: 13px;">Opponent (leave blank for open challenge)</label>
                                <input type="text" id="challengeOpponent" placeholder="@username or leave empty" style="width: 100%; background: var(--dark-bg); color: var(--text-primary); border: 1px solid var(--glass-border); border-radius: 8px; padding: 10px;">
                            </div>
                            <button type="submit" style="width: 100%; background: linear-gradient(45deg, #ff6b35, #ff073a); color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 16px;">CREATE CHALLENGE</button>
                        </form>
                    </div>
                </div>

                <!-- Accept Challenge Modal -->
                <div id="acceptChallengeModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 500px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 30px;">
                        <span class="close-modal" onclick="document.getElementById('acceptChallengeModal').style.display='none'">&times;</span>
                        <h2 style="color: var(--neon-cyan); font-family: Orbitron, sans-serif; margin-bottom: 20px;">Accept Challenge</h2>
                        <div id="acceptChallengeDetails" style="margin-bottom: 20px;"></div>
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 6px; font-size: 13px;">Your Counter Pick</label>
                            <input type="text" id="acceptChallengePick" placeholder="e.g., Celtics +4.5" required style="width: 100%; background: var(--dark-bg); color: var(--text-primary); border: 1px solid var(--glass-border); border-radius: 8px; padding: 10px;">
                        </div>
                        <button onclick="confirmAcceptChallenge()" style="width: 100%; background: linear-gradient(135deg, var(--neon-cyan), #0088cc); color: #000; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 16px;">ACCEPT CHALLENGE</button>
                    </div>
                </div>
            </div>

            <div id="data" class="page-section">
                <div class="coming-soon">
                    <h2>Data Core</h2>
                    <p>Advanced analytics and insights hub in development...</p>
                </div>
            </div>

            <div id="blog" class="page-section">
                <div class="coming-soon">
                    <h2>Blog</h2>
                    <p>Expert analysis and betting insights coming soon...</p>
                </div>
            </div>

            <!-- MY PICKS SECTION -->
            <div id="mypicks" class="page-section">
                <div class="mypicks-container" style="max-width: 1000px; margin: 0 auto; padding: 20px;">
                    <div class="mypicks-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h1 style="font-family: 'Orbitron', sans-serif; color: #fff; margin: 0;">
                            <span style="color: #00ffff;">My</span> Picks
                        </h1>
                        <button onclick="showSection('picks')" style="background: linear-gradient(135deg, #00c853, #00a648); border: none; padding: 12px 24px; border-radius: 8px; color: #000; font-weight: 700; cursor: pointer; font-size: 14px;">
                            + Make New Pick
                        </button>
                    </div>

                    <!-- Tabs -->
                    <div class="mypicks-tabs" style="display: flex; gap: 0; margin-bottom: 20px; border-bottom: 2px solid #2d3340;">
                        <button class="mypicks-tab active" onclick="switchPicksTab('pending')" id="tabPending" style="background: transparent; border: none; padding: 12px 24px; color: #00ffff; font-weight: 600; cursor: pointer; border-bottom: 2px solid #00ffff; margin-bottom: -2px;">
                            Pending <span id="pendingCount" style="background: #ff9800; color: #000; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 6px;">0</span>
                        </button>
                        <button class="mypicks-tab" onclick="switchPicksTab('graded')" id="tabGraded" style="background: transparent; border: none; padding: 12px 24px; color: #6c7380; font-weight: 600; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px;">
                            Graded
                        </button>
                        <button class="mypicks-tab" onclick="switchPicksTab('all')" id="tabAll" style="background: transparent; border: none; padding: 12px 24px; color: #6c7380; font-weight: 600; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px;">
                            All Picks
                        </button>
                    </div>

                    <!-- Auto-Grade Bar -->
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: center; flex-wrap: wrap;">
                        <button onclick="if(typeof window.autoGradeAll==='function'){window.autoGradeAll().then(function(){loadMyPicks(window.currentPicksTab||'pending')})}" style="background: linear-gradient(135deg, #00c853, #009624); color: #fff; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                            <span>&#9889;</span> Auto-Grade Pending
                        </button>
                        <span id="myPicksGradeStatus" style="color: #6c7380; font-size: 13px;"></span>
                    </div>

                    <!-- Picks List -->
                    <div id="myPicksList" style="background: #1a1d24; border-radius: 12px; padding: 20px;">
                        <div class="loading-picks" style="text-align: center; padding: 40px; color: #6c7380;">
                            <div style="font-size: 24px; margin-bottom: 10px;">Loading picks...</div>
                        </div>
                    </div>

                    <!-- Stats Summary -->
                    <div class="mypicks-stats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px;">
                        <div style="background: #1a1d24; border-radius: 10px; padding: 20px; text-align: center; border: 1px solid #2d3340;">
                            <div style="font-size: 28px; font-weight: 700; color: #00c853;" id="myStatsRecord">0-0</div>
                            <div style="font-size: 12px; color: #6c7380; text-transform: uppercase;">Record</div>
                        </div>
                        <div style="background: #1a1d24; border-radius: 10px; padding: 20px; text-align: center; border: 1px solid #2d3340;">
                            <div style="font-size: 28px; font-weight: 700; color: #00ffff;" id="myStatsWinRate">0%</div>
                            <div style="font-size: 12px; color: #6c7380; text-transform: uppercase;">Win Rate</div>
                        </div>
                        <div style="background: #1a1d24; border-radius: 10px; padding: 20px; text-align: center; border: 1px solid #2d3340;">
                            <div style="font-size: 28px; font-weight: 700;" id="myStatsUnits" style="color: #00c853;">+0.00</div>
                            <div style="font-size: 12px; color: #6c7380; text-transform: uppercase;">Net Units</div>
                        </div>
                        <div style="background: #1a1d24; border-radius: 10px; padding: 20px; text-align: center; border: 1px solid #2d3340;">
                            <div style="font-size: 28px; font-weight: 700; color: #ff9800;" id="myStatsPending">0</div>
                            <div style="font-size: 12px; color: #6c7380; text-transform: uppercase;">Pending</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="forums" class="page-section">
                <div class="forum-container">
                    <div class="forum-breadcrumb">
                        <a onclick="showForumCategories()">Trust My Record Forums</a>
                        <span id="breadcrumbCategory"></span>
                        <span id="breadcrumbThread"></span>
                    </div>

                    <!-- Forum Categories Table -->
                    <div id="forumCategoriesView">
                        <div class="forum-table-header">
                            <h2>Trust My Record Community Forums</h2>
                            <p>Discussion, strategy, and picks from the community</p>
                        </div>
                        <table class="forum-table">
                            <thead>
                                <tr>
                                    <th class="forum-name">Forum</th>
                                    <th class="forum-threads">Threads</th>
                                    <th class="forum-posts">Posts</th>
                                    <th class="forum-lastpost">Last Post</th>
                                </tr>
                            </thead>
                            <tbody id="forumCategoriesTable">
                                <!-- Categories will be rendered here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Category Threads View -->
                    <div id="categoryThreadsView" style="display:none;">
                        <div class="forum-toolbar">
                            <button class="forum-btn" onclick="showCreateThreadForm()">New Thread</button>
                            <div class="forum-sort">
                                <label>Display:</label>
                                <select id="threadSort" onchange="sortThreads()">
                                    <option value="activity">Last Post Time</option>
                                    <option value="newest">Thread Start Time</option>
                                    <option value="popular">Most Popular</option>
                                    <option value="replies">Number of Replies</option>
                                </select>
                            </div>
                        </div>

                        <table class="forum-table thread-table">
                            <thead>
                                <tr>
                                    <th class="thread-title">Thread / Thread Starter</th>
                                    <th class="thread-replies">Replies</th>
                                    <th class="thread-views">Views</th>
                                    <th class="thread-lastpost">Last Post</th>
                                </tr>
                            </thead>
                            <tbody id="threadsTableBody">
                                <!-- Threads will be rendered here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Thread Detail View -->
                    <div id="threadDetailView" style="display:none;">
                        <div class="forum-toolbar">
                            <button class="forum-btn" onclick="document.getElementById('replyTextarea').scrollIntoView({behavior: 'smooth'})">Reply</button>
                        </div>

                        <div id="threadPostsContainer">
                            <!-- Thread and replies will be rendered here -->
                        </div>

                        <!-- Quick Reply -->
                        <div class="quick-reply-box">
                            <h3>Quick Reply</h3>
                            <textarea id="replyTextarea" placeholder="Type your reply here..." rows="6"></textarea>
                            <button class="forum-btn" onclick="submitReply()">Post Quick Reply</button>
                        </div>
                    </div>

                    <!-- Create Thread Modal -->
                    <div id="createThreadModal" class="modal" style="display:none;">
                        <div class="modal-content classic-modal">
                            <span class="close-modal" onclick="closeCreateThreadForm()">&times;</span>
                            <h2>Post New Thread</h2>
                            <form id="createThreadForm">
                                <div class="form-group">
                                    <label for="threadTitle">Title:</label>
                                    <input type="text" id="threadTitle" placeholder="Enter thread title..." required>
                                </div>
                                <div class="form-group">
                                    <label for="threadContent">Message:</label>
                                    <textarea id="threadContent" placeholder="Enter your message..." rows="10" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="threadTags">Tags (optional):</label>
                                    <input type="text" id="threadTags" placeholder="e.g., nfl, picks, strategy">
                                </div>
                                <button type="submit" class="forum-btn">Submit New Thread</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div id="app" class="page-section">
                <div class="coming-soon">
                    <h2>Mobile App</h2>
                    <p>iOS and Android apps launching Q2 2025...</p>
                </div>
            </div>

            <div id="odds" class="page-section">
                <div class="coming-soon">
                    <h2>Live Odds</h2>
                    <p>Real-time odds comparison from top sportsbooks...</p>
                </div>
            </div>


            <!-- TRIVIA STANDALONE SECTION -->
            <div id="trivia" class="page-section">
                <div class="container" style="max-width: 900px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <h1 style="font-family: Orbitron, sans-serif; font-size: 2.5rem; background: linear-gradient(45deg, var(--neon-cyan), var(--neon-gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 15px;">Sports Trivia</h1>
                        <p style="color: var(--text-secondary); font-size: 1.1rem;">Test your sports knowledge and climb the leaderboard</p>
                    </div>

                    <!-- Today's Score Card -->
                    <div id="triviaTodayCard" style="background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,215,0,0.1)); border: 1px solid var(--glass-border); border-radius: 16px; padding: 24px; margin-bottom: 30px; display: flex; justify-content: space-around; text-align: center;">
                        <div>
                            <div style="font-size: 32px; font-weight: 700; color: var(--neon-cyan);" id="triviaTodayScore">--</div>
                            <div style="color: #6c7380; font-size: 12px; text-transform: uppercase;">Today's Best</div>
                        </div>
                        <div>
                            <div style="font-size: 32px; font-weight: 700; color: var(--neon-gold);" id="triviaAllTimeBest">--</div>
                            <div style="color: #6c7380; font-size: 12px; text-transform: uppercase;">All-Time Best</div>
                        </div>
                        <div>
                            <div style="font-size: 32px; font-weight: 700; color: #00c853;" id="triviaTotalPlayed">0</div>
                            <div style="color: #6c7380; font-size: 12px; text-transform: uppercase;">Quizzes Played</div>
                        </div>
                        <div>
                            <div style="font-size: 32px; font-weight: 700; color: #ff9800;" id="triviaTotalPoints">0</div>
                            <div style="color: #6c7380; font-size: 12px; text-transform: uppercase;">Total Points</div>
                        </div>
                    </div>

                    <!-- Category Grid -->
                    <h3 style="color: var(--text-primary); margin-bottom: 16px;">Choose a Category</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; margin-bottom: 30px;">
                        <button onclick="startTrivia('nfl')" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px 12px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--neon-cyan)'" onmouseout="this.style.borderColor='var(--glass-border)'">
                            <div style="font-size: 32px; margin-bottom: 8px;">üèà</div>
                            <div style="color: var(--text-primary); font-weight: 600;">NFL</div>
                        </button>
                        <button onclick="startTrivia('nba')" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px 12px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--neon-cyan)'" onmouseout="this.style.borderColor='var(--glass-border)'">
                            <div style="font-size: 32px; margin-bottom: 8px;">üèÄ</div>
                            <div style="color: var(--text-primary); font-weight: 600;">NBA</div>
                        </button>
                        <button onclick="startTrivia('mlb')" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px 12px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--neon-cyan)'" onmouseout="this.style.borderColor='var(--glass-border)'">
                            <div style="font-size: 32px; margin-bottom: 8px;">‚öæ</div>
                            <div style="color: var(--text-primary); font-weight: 600;">MLB</div>
                        </button>
                        <button onclick="startTrivia('nhl')" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px 12px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--neon-cyan)'" onmouseout="this.style.borderColor='var(--glass-border)'">
                            <div style="font-size: 32px; margin-bottom: 8px;">üèí</div>
                            <div style="color: var(--text-primary); font-weight: 600;">NHL</div>
                        </button>
                        <button onclick="startTrivia('soccer')" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px 12px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--neon-cyan)'" onmouseout="this.style.borderColor='var(--glass-border)'">
                            <div style="font-size: 32px; margin-bottom: 8px;">‚öΩ</div>
                            <div style="color: var(--text-primary); font-weight: 600;">Soccer</div>
                        </button>
                        <button onclick="startTrivia('mixed')" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px 12px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--neon-cyan)'" onmouseout="this.style.borderColor='var(--glass-border)'">
                            <div style="font-size: 32px; margin-bottom: 8px;">üé≤</div>
                            <div style="color: var(--text-primary); font-weight: 600;">Mixed</div>
                        </button>
                    </div>

                    <!-- Recent Results -->
                    <h3 style="color: var(--text-primary); margin-bottom: 16px;">Recent Quizzes</h3>
                    <div id="triviaStandaloneResults" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px; margin-bottom: 30px;">
                        <div style="text-align: center; padding: 20px; color: #6c7380;">Take a quiz to see your results here</div>
                    </div>

                    <!-- Leaderboard -->
                    <h3 style="color: var(--text-primary); margin-bottom: 16px;">üß† Trivia Leaderboard</h3>
                    <div id="triviaStandaloneLeaderboard" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px;">
                        <div style="text-align: center; padding: 20px; color: #6c7380;">Play quizzes to appear on the leaderboard</div>
                    </div>
                </div>
            </div>

            <!-- PREDICTION POLLS SECTION - redirects to polls-trivia -->
            <div id="predictions" class="page-section">
                <div class="container" style="text-align: center; padding: 60px 20px;">
                    <h1 style="font-family: Orbitron, sans-serif; font-size: 2.5rem; background: linear-gradient(45deg, var(--neon-purple), var(--neon-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 15px;">Prediction Polls</h1>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Vote on upcoming matchups and see what the community thinks!</p>
                    <button onclick="showSection('polls-trivia')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 14px 32px; border-radius: 30px; font-weight: 700; cursor: pointer; font-size: 16px;">Go to Polls &amp; Trivia</button>
                </div>
            </div>

            <!-- HANDICAPPING CONTESTS SECTION -->
            <div id="contests" class="page-section">
                <div class="container" style="max-width: 900px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="font-family: Orbitron, sans-serif; font-size: 2.5rem; background: linear-gradient(45deg, var(--neon-gold), #ff6b35); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px;">Handicapping Contests</h1>
                        <p style="color: var(--text-secondary); font-size: 1.1rem;">Compete against other handicappers in weekly pick challenges</p>
                    </div>

                    <!-- How It Works -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 30px;">
                        <div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px; text-align: center;">
                            <div style="font-size: 28px; margin-bottom: 8px;">1Ô∏è‚É£</div>
                            <div style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">Enter Contest</div>
                            <div style="color: #6c7380; font-size: 12px;">Pick the winners for each featured game</div>
                        </div>
                        <div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px; text-align: center;">
                            <div style="font-size: 28px; margin-bottom: 8px;">2Ô∏è‚É£</div>
                            <div style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">Track Results</div>
                            <div style="color: #6c7380; font-size: 12px;">Watch as games complete and scores update</div>
                        </div>
                        <div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px; text-align: center;">
                            <div style="font-size: 28px; margin-bottom: 8px;">3Ô∏è‚É£</div>
                            <div style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">Win Bragging Rights</div>
                            <div style="color: #6c7380; font-size: 12px;">Top the leaderboard and earn your reputation</div>
                        </div>
                    </div>

                    <!-- Contests List -->
                    <div id="contestsList">
                        <div style="text-align: center; padding: 60px 20px; color: #6c7380;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üèÜ</div>
                            <p>Loading contests...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PROFILE SECTION -->
            <div id="profile" class="page-section">
                <div class="profile-page-container">
                    <div class="profile-header-banner">
                        <div class="profile-cover-photo" id="profileCoverPhoto">
                            <!-- Cover photo background -->
                        </div>
                        <div class="profile-main-info">
                            <div class="profile-avatar-large" id="profileAvatarLarge">
                                <div class="avatar-container">
                                    <img id="profileAvatarImage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='35' r='25' fill='%2366717d'/%3E%3Cellipse cx='50' cy='85' rx='35' ry='25' fill='%2366717d'/%3E%3C/svg%3E" alt="Profile" class="profile-avatar-img">
                                    <button class="upload-avatar-btn" onclick="uploadProfileImage()">
                                        <span>üì∑</span>
                                    </button>
                                </div>
                                <div class="avatar-options">
                                    <button class="avatar-option-btn" onclick="setDefaultAvatar('male')" title="Male silhouette">
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='30' r='22' fill='%234a90d9'/%3E%3Crect x='35' y='52' width='30' height='8' fill='%234a90d9'/%3E%3Cellipse cx='50' cy='80' rx='30' ry='22' fill='%234a90d9'/%3E%3C/svg%3E" alt="Male">
                                    </button>
                                    <button class="avatar-option-btn" onclick="setDefaultAvatar('female')" title="Female silhouette">
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='28' r='20' fill='%23e75480'/%3E%3Cellipse cx='50' cy='75' rx='28' ry='28' fill='%23e75480'/%3E%3C/svg%3E" alt="Female">
                                    </button>
                                </div>
                            </div>
                            <div class="profile-identity">
                                <h1 id="profileDisplayName">Your Name</h1>
                                <p class="profile-username">@<span id="profileUsername">username</span></p>
                                <button class="edit-profile-btn" onclick="openProfileEditor()">Edit Profile</button>
                            </div>
                        </div>
                    </div>


                    <!-- Profile Tabs -->
                    <div class="profile-tabs-container">
                        <button class="profile-tab active" onclick="showProfileTab('overview')">Overview</button>
                        <button class="profile-tab" onclick="showProfileTab('community')">Community</button>
                        <button class="profile-tab" onclick="showProfileTab('picks')">My Picks</button>
                        <button class="profile-tab" onclick="showProfileTab('posts')">Posts</button>
                        <button class="profile-tab" onclick="showProfileTab('friends')">Friends</button>
                    </div>

                    <!-- Overview Tab (existing stats) -->
                    <div id="profileOverviewTab" class="profile-tab-content active">
                    <div class="profile-content-grid">
                        <!-- Left Column - About & Stats -->
                        <div class="profile-left-column">
                            <!-- About Me Card -->
                            <div class="profile-card">
                                <h3>About Me</h3>
                                <div id="profileBio" class="profile-bio">
                                    No bio yet. Click "Edit Profile" to add one.
                                </div>
                            </div>

                            <!-- Favorite Teams Card -->
                            <div class="profile-card">
                                <h3>My Teams</h3>
                                <div id="profileFavoriteTeams" class="favorite-teams-display">
                                    <!-- Teams will be populated by JavaScript -->
                                    <p class="no-data-message" id="noTeamsMessage">No teams selected yet.</p>
                                    <button class="add-teams-btn" onclick="openTeamSelector()">+ Add Your Teams</button>
                                </div>
                            </div>

                            <!-- Points & Achievements -->
                            <div class="profile-card">
                                <h3>Points & Achievements</h3>
                                <div class="points-breakdown">
                                    <div class="point-item">
                                        <span class="point-icon">üéØ</span>
                                        <div class="point-details">
                                            <div class="point-label">Trivia Points</div>
                                            <div class="point-value" id="profileTriviaPoints">0</div>
                                        </div>
                                    </div>
                                    <div class="point-item">
                                        <span class="point-icon">üìä</span>
                                        <div class="point-details">
                                            <div class="point-label">Poll Prediction Points</div>
                                            <div class="point-value" id="profilePollPoints">0</div>
                                        </div>
                                    </div>
                                    <div class="point-item">
                                        <span class="point-icon">üèÜ</span>
                                        <div class="point-details">
                                            <div class="point-label">Total Points</div>
                                            <div class="point-value total" id="profileTotalPoints">0</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="achievements-badges" id="profileAchievements">
                                    <!-- Achievements populated by JavaScript based on actual user activity -->
                                    <p class="no-data-message" id="noAchievementsMessage">Complete activities to earn badges!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Stats & Activity -->
                        <div class="profile-right-column">
                            <!-- Betting Stats Card - Futuristic Design -->
                            <div class="profile-card stats-card-futuristic">
                                <div class="stats-card-header">
                                    <h3><span class="header-icon">üìä</span> Performance Analytics</h3>
                                    <div class="stats-live-indicator">
                                        <span class="live-dot"></span>
                                        <span>LIVE</span>
                                    </div>
                                </div>
                                <div class="stats-grid-profile">
                                    <div class="stat-box-profile" id="statBoxPicks">
                                        <div class="stat-icon">üéØ</div>
                                        <div class="stat-number" id="profileTotalPicks">‚Äî</div>
                                        <div class="stat-label-profile">Total Picks</div>
                                    </div>
                                    <div class="stat-box-profile" id="statBoxWinRate">
                                        <div class="stat-icon">üìà</div>
                                        <div class="stat-number" id="profileWinRate">‚Äî</div>
                                        <div class="stat-label-profile">Win Rate</div>
                                    </div>
                                    <div class="stat-box-profile" id="statBoxUnits">
                                        <div class="stat-icon">üí∞</div>
                                        <div class="stat-number" id="profileUnits">‚Äî</div>
                                        <div class="stat-label-profile">Net Units</div>
                                    </div>
                                    <div class="stat-box-profile" id="statBoxROI">
                                        <div class="stat-icon">‚ö°</div>
                                        <div class="stat-number" id="profileROI">‚Äî</div>
                                        <div class="stat-label-profile">ROI</div>
                                    </div>
                                    <div class="stat-box-profile" id="statBoxStreak">
                                        <div class="stat-icon">üî•</div>
                                        <div class="stat-number" id="profileStreak">‚Äî</div>
                                        <div class="stat-label-profile">Streak</div>
                                    </div>
                                    <div class="stat-box-profile" id="statBoxRecord">
                                        <div class="stat-icon">üìã</div>
                                        <div class="stat-number" id="profileRecord">‚Äî</div>
                                        <div class="stat-label-profile">W-L Record</div>
                                    </div>
                                </div>
                                <div class="stats-disclaimer">
                                    Stats update automatically based on graded picks
                                </div>
                            </div>

                            <!-- Pending Picks -->
                            <div class="profile-card pending-picks-card">
                                <h3>üéØ Pending Picks</h3>
                                <div id="profilePendingPicks" class="pending-picks-list">
                                    <p class="no-data-message" id="noPendingMessage">No pending picks. Make a pick to see it here!</p>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="profile-card">
                                <h3>Recent Activity</h3>
                                <div id="profileRecentActivity" class="activity-feed">
                                    <!-- Activity populated by JavaScript from actual user actions -->
                                    <p class="no-data-message" id="noActivityMessage">No activity yet. Make picks, vote in polls, or take trivia to see your activity here!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div><!-- end overview tab -->

                    <!-- Community Tab - Trivia, Polls, Forum Stats -->
                    <div id="profileCommunityTab" class="profile-tab-content">
                        <div class="community-stats-container" style="max-width: 1200px; margin: 0 auto;">
                            <!-- Community Stats Summary Cards -->
                            <div class="community-summary-row" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                                <div class="community-summary-card" style="background: linear-gradient(135deg, rgba(0, 174, 255, 0.15), rgba(0, 174, 255, 0.05)); border: 1px solid rgba(0, 174, 255, 0.3); border-radius: 15px; padding: 25px; text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 10px;">üèÜ</div>
                                    <div class="summary-value" id="communityTotalPoints" style="font-size: 32px; font-weight: 700; color: var(--neon-cyan); font-family: Orbitron, sans-serif;">0</div>
                                    <div style="color: var(--text-secondary); font-size: 14px; margin-top: 5px;">Total Community Points</div>
                                </div>
                                <div class="community-summary-card" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05)); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 25px; text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 10px;">üéØ</div>
                                    <div class="summary-value" id="communityTriviaAnswered" style="font-size: 32px; font-weight: 700; color: var(--neon-gold); font-family: Orbitron, sans-serif;">0</div>
                                    <div style="color: var(--text-secondary); font-size: 14px; margin-top: 5px;">Trivia Answered</div>
                                </div>
                                <div class="community-summary-card" style="background: linear-gradient(135deg, rgba(138, 43, 226, 0.15), rgba(138, 43, 226, 0.05)); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 15px; padding: 25px; text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 10px;">üìä</div>
                                    <div class="summary-value" id="communityPollsVoted" style="font-size: 32px; font-weight: 700; color: #8a2be2; font-family: Orbitron, sans-serif;">0</div>
                                    <div style="color: var(--text-secondary); font-size: 14px; margin-top: 5px;">Polls Voted</div>
                                </div>
                                <div class="community-summary-card" style="background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 255, 136, 0.05)); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 15px; padding: 25px; text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 10px;">üí¨</div>
                                    <div class="summary-value" id="communityForumPosts" style="font-size: 32px; font-weight: 700; color: #00ff88; font-family: Orbitron, sans-serif;">0</div>
                                    <div style="color: var(--text-secondary); font-size: 14px; margin-top: 5px;">Forum Posts</div>
                                </div>
                            </div>

                            <!-- Detailed Stats Grid -->
                            <div class="community-detail-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                                <!-- Trivia Stats Card -->
                                <div class="profile-card" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 25px;">
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border);">
                                        <span style="font-size: 32px;">üéØ</span>
                                        <div>
                                            <h3 style="margin: 0; color: var(--text-primary); font-size: 1.3rem;">Trivia Performance</h3>
                                            <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">Test your sports knowledge</p>
                                        </div>
                                    </div>
                                    <div class="trivia-stats-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                                        <div style="text-align: center; padding: 15px; background: rgba(0,174,255,0.1); border-radius: 10px;">
                                            <div id="triviaQuestionsAnswered" style="font-size: 24px; font-weight: 700; color: var(--neon-cyan);">0</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Answered</div>
                                        </div>
                                        <div style="text-align: center; padding: 15px; background: rgba(0,255,136,0.1); border-radius: 10px;">
                                            <div id="triviaCorrect" style="font-size: 24px; font-weight: 700; color: #00ff88;">0</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Correct</div>
                                        </div>
                                        <div style="text-align: center; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">
                                            <div id="triviaAccuracy" style="font-size: 24px; font-weight: 700; color: var(--neon-gold);">0%</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Accuracy</div>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                            <span style="font-size: 20px;">üî•</span>
                                            <div>
                                                <div style="font-size: 11px; color: var(--text-secondary);">Current Streak</div>
                                                <div id="triviaCurrentStreak" style="font-size: 18px; font-weight: 600; color: var(--text-primary);">0</div>
                                            </div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                            <span style="font-size: 20px;">‚≠ê</span>
                                            <div>
                                                <div style="font-size: 11px; color: var(--text-secondary);">Best Streak</div>
                                                <div id="triviaBestStreak" style="font-size: 18px; font-weight: 600; color: var(--text-primary);">0</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: linear-gradient(135deg, rgba(0,174,255,0.2), rgba(0,174,255,0.05)); border-radius: 10px;">
                                        <span style="color: var(--text-secondary);">Total Points Earned</span>
                                        <span id="triviaTotalPoints" style="font-size: 24px; font-weight: 700; color: var(--neon-cyan); font-family: Orbitron, sans-serif;">0</span>
                                    </div>
                                    <a href="trivia.html" style="display: block; text-align: center; margin-top: 15px; padding: 12px; background: var(--neon-cyan); color: #000; font-weight: 600; border-radius: 8px; text-decoration: none;">Play Trivia</a>
                                </div>

                                <!-- Poll Stats Card -->
                                <div class="profile-card" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 25px;">
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border);">
                                        <span style="font-size: 32px;">üìä</span>
                                        <div>
                                            <h3 style="margin: 0; color: var(--text-primary); font-size: 1.3rem;">Prediction Polls</h3>
                                            <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">Vote and predict outcomes</p>
                                        </div>
                                    </div>
                                    <div class="poll-stats-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                                        <div style="text-align: center; padding: 15px; background: rgba(138,43,226,0.1); border-radius: 10px;">
                                            <div id="pollsVoted" style="font-size: 24px; font-weight: 700; color: #8a2be2;">0</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Polls Voted</div>
                                        </div>
                                        <div style="text-align: center; padding: 15px; background: rgba(0,255,136,0.1); border-radius: 10px;">
                                            <div id="pollsCorrect" style="font-size: 24px; font-weight: 700; color: #00ff88;">0</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Correct</div>
                                        </div>
                                        <div style="text-align: center; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">
                                            <div id="pollsAccuracy" style="font-size: 24px; font-weight: 700; color: var(--neon-gold);">0%</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Accuracy</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: linear-gradient(135deg, rgba(138,43,226,0.2), rgba(138,43,226,0.05)); border-radius: 10px; margin-bottom: 15px;">
                                        <span style="color: var(--text-secondary);">Total Points Earned</span>
                                        <span id="pollsTotalPoints" style="font-size: 24px; font-weight: 700; color: #8a2be2; font-family: Orbitron, sans-serif;">0</span>
                                    </div>
                                    <a href="polls.html" style="display: block; text-align: center; padding: 12px; background: #8a2be2; color: #fff; font-weight: 600; border-radius: 8px; text-decoration: none;">View Polls</a>
                                </div>

                                <!-- Forum Stats Card -->
                                <div class="profile-card" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 25px;">
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border);">
                                        <span style="font-size: 32px;">üí¨</span>
                                        <div>
                                            <h3 style="margin: 0; color: var(--text-primary); font-size: 1.3rem;">Forum Activity</h3>
                                            <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">Discussions and engagement</p>
                                        </div>
                                    </div>
                                    <div class="forum-stats-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                                        <div style="text-align: center; padding: 20px; background: rgba(0,255,136,0.1); border-radius: 10px;">
                                            <div id="forumThreadsCreated" style="font-size: 28px; font-weight: 700; color: #00ff88;">0</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Threads Created</div>
                                        </div>
                                        <div style="text-align: center; padding: 20px; background: rgba(0,174,255,0.1); border-radius: 10px;">
                                            <div id="forumPostsMade" style="font-size: 28px; font-weight: 700; color: var(--neon-cyan);">0</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Posts Made</div>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                            <span style="font-size: 20px;">‚ù§Ô∏è</span>
                                            <div>
                                                <div style="font-size: 11px; color: var(--text-secondary);">Likes Received</div>
                                                <div id="forumLikesReceived" style="font-size: 18px; font-weight: 600; color: var(--text-primary);">0</div>
                                            </div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                            <span style="font-size: 20px;">üîî</span>
                                            <div>
                                                <div style="font-size: 11px; color: var(--text-secondary);">Subscriptions</div>
                                                <div id="forumSubscriptions" style="font-size: 18px; font-weight: 600; color: var(--text-primary);">0</div>
                                            </div>
                                        </div>
                                    </div>
                                    <a href="forum.html" style="display: block; text-align: center; margin-top: 15px; padding: 12px; background: #00ff88; color: #000; font-weight: 600; border-radius: 8px; text-decoration: none;">Visit Forums</a>
                                </div>

                                <!-- Recent Community Activity Card -->
                                <div class="profile-card" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 25px;">
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border);">
                                        <span style="font-size: 32px;">üìú</span>
                                        <div>
                                            <h3 style="margin: 0; color: var(--text-primary); font-size: 1.3rem;">Recent Activity</h3>
                                            <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">Your latest community actions</p>
                                        </div>
                                    </div>
                                    <div id="communityRecentActivity" style="max-height: 350px; overflow-y: auto;">
                                        <p class="no-data-message" style="color: var(--text-secondary); text-align: center; padding: 30px;">
                                            No community activity yet. Start playing trivia, voting in polls, or posting in forums!
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!-- end community tab -->

                    <!-- My Picks Tab -->
                    <div id="profilePicksTab" class="profile-tab-content">
                        <div class="profile-card" style="max-width: 900px; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin: 0;">Pick History</h3>
                                <div class="posts-filter">
                                    <button class="posts-filter-btn active" onclick="filterPicks('all')">All</button>
                                    <button class="posts-filter-btn" onclick="filterPicks('won')">Won</button>
                                    <button class="posts-filter-btn" onclick="filterPicks('lost')">Lost</button>
                                    <button class="posts-filter-btn" onclick="filterPicks('pending')">Pending</button>
                                </div>
                            </div>
                            <div id="profilePickHistory" class="picks-history-list">
                                <p class="no-data-message">No picks yet. Make your first pick to see your history here!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Posts Tab -->
                    <div id="profilePostsTab" class="profile-tab-content">
                        <div class="posts-filter" style="margin-bottom: 25px;">
                            <button class="posts-filter-btn active" onclick="filterPosts('all')">All Activity</button>
                            <button class="posts-filter-btn" onclick="filterPosts('picks')">Picks Only</button>
                            <button class="posts-filter-btn" onclick="filterPosts('trivia')">Trivia</button>
                            <button class="posts-filter-btn" onclick="filterPosts('polls')">Polls</button>
                        </div>
                        <div class="user-posts-feed" id="userPostsFeed">
                            <div class="user-post-card">
                                <div class="user-post-header">
                                    <span class="user-post-type">PICK</span>
                                    <span class="user-post-date">Just now</span>
                                </div>
                                <div class="user-post-content">
                                    Your picks and activity will appear here as you use Trust My Record.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Friends Tab -->
                    <div id="profileFriendsTab" class="profile-tab-content">
                        <div class="friends-stats-bar">
                            <div class="friend-stat">
                                <span class="count" id="followingCount">0</span>
                                <span class="label">Following</span>
                            </div>
                            <div class="friend-stat">
                                <span class="count" id="followersCount">0</span>
                                <span class="label">Followers</span>
                            </div>
                        </div>
                        <div class="friends-subtabs">
                            <button class="friends-subtab active" onclick="showFriendsSubtab('following')">Following</button>
                            <button class="friends-subtab" onclick="showFriendsSubtab('followers')">Followers</button>
                        </div>
                        <div id="friendsFollowingList" class="friends-list">
                            <div class="friend-card">
                                <div class="friend-avatar">üë§</div>
                                <div class="friend-info">
                                    <div class="friend-name">Find handicappers to follow</div>
                                    <div class="friend-stats">Browse the leaderboard to find top performers</div>
                                </div>
                                <button class="friend-action" onclick="showSection('leaderboard')">Browse</button>
                            </div>
                        </div>
                        <div id="friendsFollowersList" class="friends-list" style="display: none;">
                            <div class="friend-card">
                                <div class="friend-avatar">üë§</div>
                                <div class="friend-info">
                                    <div class="friend-name">No followers yet</div>
                                    <div class="friend-stats">Share your profile to get followers</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Profile Edit Modal -->
            <div id="profileEditModal" class="modal" style="display:none;">
                <div class="modal-content profile-edit-modal">
                    <span class="close-modal" onclick="closeProfileEditor()">&times;</span>
                    <h2>Edit Profile</h2>
                    <form id="profileEditForm">
                        <div class="form-group">
                            <label for="editDisplayName">Display Name:</label>
                            <input type="text" id="editDisplayName" placeholder="Your Name">
                        </div>
                        <div class="form-group">
                            <label for="editUsername">Username:</label>
                            <input type="text" id="editUsername" placeholder="username">
                        </div>
                        <div class="form-group">
                            <label for="editBio">Bio:</label>
                            <textarea id="editBio" rows="4" placeholder="Tell us about yourself, your betting style, favorite sports..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Profile Image:</label>
                            <div class="avatar-upload-section">
                                <input type="file" id="avatarFileInput" accept="image/*" style="display:none" onchange="handleAvatarUpload(event)">
                                <button type="button" class="upload-image-btn" onclick="document.getElementById('avatarFileInput').click()">
                                    üì∑ Upload Photo
                                </button>
                                <span style="color: var(--text-muted); margin: 0 10px;">or</span>
                                <button type="button" class="default-avatar-btn" onclick="setDefaultAvatar('male')">üë§ Male</button>
                                <button type="button" class="default-avatar-btn" onclick="setDefaultAvatar('female')">üë© Female</button>
                            </div>
                        </div>
                        <button type="submit" class="profile-save-btn">Save Changes</button>
                    </form>
                </div>
            </div>

            <!-- Team Selector Modal -->
            <div id="teamSelectorModal" class="modal" style="display:none;">
                <div class="modal-content team-selector-modal">
                    <span class="close-modal" onclick="closeTeamSelector()">&times;</span>
                    <h2>Select Your Teams</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Choose the teams you follow. These will display on your profile and in forums.</p>

                    <div class="sport-filter-tabs">
                        <button class="sport-filter-tab active" onclick="filterTeamsBySport('all')">All</button>
                        <button class="sport-filter-tab" onclick="filterTeamsBySport('nba')">NBA</button>
                        <button class="sport-filter-tab" onclick="filterTeamsBySport('nfl')">NFL</button>
                        <button class="sport-filter-tab" onclick="filterTeamsBySport('mlb')">MLB</button>
                        <button class="sport-filter-tab" onclick="filterTeamsBySport('nhl')">NHL</button>
                    </div>

                    <div id="teamSelectorGrid" class="team-selector-grid">
                        <!-- Teams populated by JavaScript -->
                    </div>

                    <button class="profile-save-btn" onclick="saveSelectedTeams()" style="margin-top: 20px;">Save Teams</button>
                </div>
            </div>

            <!-- MESSAGES SECTION -->
            <div id="messages" class="page-section">
                <div class="messages-container">
                    <h2 class="section-title">Messages</h2>

                    <div class="messages-layout">
                        <!-- Conversations List -->
                        <div class="conversations-sidebar">
                            <div class="conversations-header">
                                <h3>Conversations</h3>
                                <button class="new-message-btn" onclick="openNewMessageModal()">+ New</button>
                            </div>
                            <div class="conversations-list" id="conversationsList">
                                <!-- Empty state - conversations load from database -->
                                <div class="empty-conversations" style="text-align: center; padding: 40px 20px; color: #6c7380;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">üì¨</div>
                                    <p style="font-size: 16px; margin-bottom: 8px;">No conversations yet</p>
                                    <p style="font-size: 13px; opacity: 0.7;">Start a conversation with another bettor!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Message Thread -->
                        <div class="message-thread" id="messageThread">
                            <div class="thread-header" id="threadHeader" style="display: none;">
                                <div class="thread-user-info">
                                    <div class="thread-avatar" id="threadAvatar">üë§</div>
                                    <div class="thread-user-name" id="threadUserName">Select a conversation</div>
                                </div>
                                <button class="thread-options-btn">‚ãÆ</button>
                            </div>

                            <div class="messages-display" id="messagesDisplay">
                                <!-- Empty state - select a conversation -->
                                <div style="text-align: center; padding: 60px 20px; color: #6c7380;">
                                    <div style="font-size: 64px; margin-bottom: 20px;">üí¨</div>
                                    <p style="font-size: 18px; margin-bottom: 10px;">Select a conversation</p>
                                    <p style="font-size: 14px; opacity: 0.7;">Choose from your conversations or start a new one</p>
                                </div>
                            </div>

                            <div class="message-input-container" id="messageInputContainer" style="display: none;">
                                <textarea class="message-input" placeholder="Type a message..." rows="1"></textarea>
                                <button class="send-message-btn">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GROUPS & COMMUNITIES SECTION -->
            <div id="groups" class="page-section">
                <div class="groups-container">
                    <div class="groups-header">
                        <h2 class="section-title">Groups & Communities</h2>
                        <button class="create-group-btn" onclick="openCreateGroupModal()">
                            <span>+ Create Group</span>
                        </button>
                    </div>

                    <!-- Groups Tabs -->
                    <div class="groups-tabs">
                        <button class="groups-tab active" onclick="switchGroupsTab('discover')">üîç Discover</button>
                        <button class="groups-tab" onclick="switchGroupsTab('mygroups')">üë• My Groups</button>
                        <button class="groups-tab" onclick="switchGroupsTab('syndicates')">üíé Syndicates</button>
                    </div>

                    <!-- Discover Groups -->
                    <div id="discoverGroups" class="groups-panel active">
                        <div class="groups-filters">
                            <select class="filter-dropdown">
                                <option>All Sports</option>
                                <option>NFL</option>
                                <option>NBA</option>
                                <option>MLB</option>
                                <option>NHL</option>
                                <option>Soccer</option>
                            </select>
                            <select class="filter-dropdown">
                                <option>All Categories</option>
                                <option>Strategy Discussion</option>
                                <option>Live Betting</option>
                                <option>Props</option>
                                <option>Futures</option>
                            </select>
                            <input type="text" class="search-groups" placeholder="Search groups...">
                        </div>

                        <div class="groups-grid" id="groupsGrid">
                            <!-- Empty state - groups will load from database -->
                            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">
                                <div style="font-size: 64px; margin-bottom: 20px;">üë•</div>
                                <p style="font-size: 18px; margin-bottom: 10px;">No groups yet</p>
                                <p style="font-size: 14px; opacity: 0.7; margin-bottom: 20px;">Be the first to create a community!</p>
                                <button onclick="openCreateGroupModal()" style="padding: 12px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Create Group</button>
                            </div>
                        </div>
                    </div>

                    <!-- My Groups -->
                    <div id="myGroups" class="groups-panel">
                        <div class="my-groups-list">
                            <div class="my-group-item active-group">
                                <div class="my-group-icon">üèà</div>
                                <div class="my-group-info">
                                    <h4>NFL Sharp Bettors</h4>
                                    <p>12 new messages</p>
                                </div>
                                <div class="my-group-badge">12</div>
                            </div>

                            <div class="my-group-item">
                                <div class="my-group-icon">üé≤</div>
                                <div class="my-group-info">
                                    <h4>Parlay Squad</h4>
                                    <p>Last active: 2h ago</p>
                                </div>
                            </div>

                            <div class="my-group-item">
                                <div class="my-group-icon">üèÄ</div>
                                <div class="my-group-info">
                                    <h4>NBA Props Masters</h4>
                                    <p class="premium-text">‚≠ê Premium</p>
                                </div>
                                <div class="my-group-badge premium-badge">5</div>
                            </div>
                        </div>

                        <!-- Group Chat View -->
                        <div class="group-chat-view" id="groupChatView" style="display: none;">
                            <div class="group-chat-header">
                                <div class="group-chat-title">
                                    <div class="group-icon-large" id="selectedGroupIcon">üë•</div>
                                    <div>
                                        <h3 id="selectedGroupName">Select a group</h3>
                                        <p id="selectedGroupStats">Join or create a group to chat</p>
                                    </div>
                                </div>
                                <button class="group-settings-btn">‚öôÔ∏è</button>
                            </div>

                            <div class="group-chat-messages" id="groupChatMessages">
                                <!-- Empty state - messages will load from database -->
                                <div style="text-align: center; padding: 60px 20px; color: #6c7380;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">üí¨</div>
                                    <p style="font-size: 16px; margin-bottom: 8px;">No messages yet</p>
                                    <p style="font-size: 13px; opacity: 0.7;">Be the first to start the conversation!</p>
                                </div>
                            </div>

                            <div class="group-chat-input">
                                <button class="attach-btn">üìé</button>
                                <input type="text" placeholder="Message NFL Sharp Bettors...">
                                <button class="send-msg-btn">Send</button>
                            </div>
                        </div>
                    </div>

                    <!-- Betting Syndicates -->
                    <div id="syndicates" class="groups-panel">
                        <div class="syndicates-intro">
                            <h3>üíé Betting Syndicates</h3>
                            <p>Pool funds with trusted members for higher stakes and shared profits</p>
                        </div>

                        <div class="syndicates-grid" id="syndicatesGrid">
                            <!-- Empty state - syndicates will load from database -->
                            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">
                                <div style="font-size: 64px; margin-bottom: 20px;">üíé</div>
                                <p style="font-size: 18px; margin-bottom: 10px;">No syndicates yet</p>
                                <p style="font-size: 14px; opacity: 0.7;">Create the first syndicate and pool resources with trusted bettors!</p>
                            </div>
                        </div>

                        <div class="create-syndicate-section">
                            <h4>Want to create your own syndicate?</h4>
                            <p>Gather your most trusted bettors and pool resources for bigger opportunities</p>
                            <button class="create-syndicate-btn">Create Syndicate</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LIVE GAMES SECTION -->
            <div id="live" class="page-section">
                <div class="live-container">
                    <h2 class="section-title">üî¥ Live Games & Betting</h2>

                    <!-- Live Games Grid -->
                    <div class="live-games-layout">
                        <!-- Main Live Games Feed -->
                        <div class="live-games-main">
                            <div class="live-filters">
                                <button class="live-filter-btn active" onclick="filterLiveGames('all')">All Live</button>
                                <button class="live-filter-btn" onclick="filterLiveGames('nfl')">üèà NFL</button>
                                <button class="live-filter-btn" onclick="filterLiveGames('nba')">üèÄ NBA</button>
                                <button class="live-filter-btn" onclick="filterLiveGames('mlb')">‚öæ MLB</button>
                                <button class="live-filter-btn" onclick="filterLiveGames('nhl')">üèí NHL</button>
                                <button class="live-filter-btn" onclick="filterLiveGames('soccer')">‚öΩ Soccer</button>
                            </div>

                            <!-- Live Game Cards -->
                            <div class="live-games-grid">
                                <!-- Game 1 - NFL -->
                                <div class="live-game-card nfl" data-sport="nfl">
                                    <div class="live-badge pulsing">üî¥ LIVE Q3 8:42</div>
                                    <div class="game-score-container">
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">üèà</span>
                                                <span class="team-name">Kansas City Chiefs</span>
                                            </div>
                                            <div class="team-score winning">27</div>
                                        </div>
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">ü¶¨</span>
                                                <span class="team-name">Buffalo Bills</span>
                                            </div>
                                            <div class="team-score">24</div>
                                        </div>
                                    </div>
                                    <div class="live-odds-section">
                                        <div class="odds-row">
                                            <span class="odds-label">Spread:</span>
                                            <button class="odds-btn">KC -2.5 (-110)</button>
                                            <button class="odds-btn">BUF +2.5 (-110)</button>
                                        </div>
                                        <div class="odds-row">
                                            <span class="odds-label">Total:</span>
                                            <button class="odds-btn">O 51.5 (-115)</button>
                                            <button class="odds-btn">U 51.5 (-105)</button>
                                        </div>
                                    </div>
                                    <div class="live-stats-quick">
                                        <span>üèÉ Chiefs driving, red zone</span>
                                        <span class="hot-pick">üî• 3,421 live bets</span>
                                    </div>
                                </div>

                                <!-- Game 2 - NBA -->
                                <div class="live-game-card nba" data-sport="nba">
                                    <div class="live-badge pulsing">üî¥ LIVE Q2 4:15</div>
                                    <div class="game-score-container">
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">üèÄ</span>
                                                <span class="team-name">LA Lakers</span>
                                            </div>
                                            <div class="team-score">48</div>
                                        </div>
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">‚òòÔ∏è</span>
                                                <span class="team-name">Boston Celtics</span>
                                            </div>
                                            <div class="team-score winning">52</div>
                                        </div>
                                    </div>
                                    <div class="live-odds-section">
                                        <div class="odds-row">
                                            <span class="odds-label">Spread:</span>
                                            <button class="odds-btn">LAL +4.5 (-105)</button>
                                            <button class="odds-btn hot">BOS -4.5 (-115)</button>
                                        </div>
                                        <div class="odds-row">
                                            <span class="odds-label">Total:</span>
                                            <button class="odds-btn">O 218.5 (-110)</button>
                                            <button class="odds-btn">U 218.5 (-110)</button>
                                        </div>
                                    </div>
                                    <div class="live-stats-quick">
                                        <span>‚≠ê LeBron: 18pts, 5reb, 7ast</span>
                                        <span class="hot-pick">üî• 2,847 live bets</span>
                                    </div>
                                </div>

                                <!-- Game 3 - Soccer -->
                                <div class="live-game-card soccer" data-sport="soccer">
                                    <div class="live-badge pulsing">üî¥ LIVE 67'</div>
                                    <div class="game-score-container">
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">‚öΩ</span>
                                                <span class="team-name">Manchester United</span>
                                            </div>
                                            <div class="team-score winning">2</div>
                                        </div>
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">üî¥</span>
                                                <span class="team-name">Liverpool</span>
                                            </div>
                                            <div class="team-score">1</div>
                                        </div>
                                    </div>
                                    <div class="live-odds-section">
                                        <div class="odds-row">
                                            <span class="odds-label">Match:</span>
                                            <button class="odds-btn">MU Win (1.85)</button>
                                            <button class="odds-btn">Draw (3.50)</button>
                                            <button class="odds-btn">LIV Win (3.20)</button>
                                        </div>
                                        <div class="odds-row">
                                            <span class="odds-label">Goals:</span>
                                            <button class="odds-btn hot">O 2.5 (1.95)</button>
                                            <button class="odds-btn">U 2.5 (1.90)</button>
                                        </div>
                                    </div>
                                    <div class="live-stats-quick">
                                        <span>‚ö° 67% possession for MU</span>
                                        <span class="hot-pick">üî• 5,234 live bets</span>
                                    </div>
                                </div>

                                <!-- Game 4 - MLB -->
                                <div class="live-game-card mlb" data-sport="mlb">
                                    <div class="live-badge pulsing">üî¥ LIVE Bottom 7th</div>
                                    <div class="game-score-container">
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">‚öæ</span>
                                                <span class="team-name">NY Yankees</span>
                                            </div>
                                            <div class="team-score winning">5</div>
                                        </div>
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">üß¶</span>
                                                <span class="team-name">Boston Red Sox</span>
                                            </div>
                                            <div class="team-score">3</div>
                                        </div>
                                    </div>
                                    <div class="live-odds-section">
                                        <div class="odds-row">
                                            <span class="odds-label">Moneyline:</span>
                                            <button class="odds-btn">NYY (-250)</button>
                                            <button class="odds-btn">BOS (+200)</button>
                                        </div>
                                        <div class="odds-row">
                                            <span class="odds-label">Total:</span>
                                            <button class="odds-btn">O 8.5 (-105)</button>
                                            <button class="odds-btn">U 8.5 (-115)</button>
                                        </div>
                                    </div>
                                    <div class="live-stats-quick">
                                        <span>‚öæ Runner on 2nd, 1 out</span>
                                        <span class="hot-pick">üî• 1,892 live bets</span>
                                    </div>
                                </div>

                                <!-- Game 5 - NHL -->
                                <div class="live-game-card nhl" data-sport="nhl">
                                    <div class="live-badge pulsing">üî¥ LIVE 2nd 12:34</div>
                                    <div class="game-score-container">
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">üèí</span>
                                                <span class="team-name">Toronto Maple Leafs</span>
                                            </div>
                                            <div class="team-score">2</div>
                                        </div>
                                        <div class="team-row">
                                            <div class="team-info">
                                                <span class="team-emoji">üêª</span>
                                                <span class="team-name">Boston Bruins</span>
                                            </div>
                                            <div class="team-score winning">3</div>
                                        </div>
                                    </div>
                                    <div class="live-odds-section">
                                        <div class="odds-row">
                                            <span class="odds-label">Puck Line:</span>
                                            <button class="odds-btn">TOR +1.5 (-180)</button>
                                            <button class="odds-btn">BOS -1.5 (+150)</button>
                                        </div>
                                        <div class="odds-row">
                                            <span class="odds-label">Total:</span>
                                            <button class="odds-btn">O 6.5 (-110)</button>
                                            <button class="odds-btn">U 6.5 (-110)</button>
                                        </div>
                                    </div>
                                    <div class="live-stats-quick">
                                        <span>üèí Power play: Bruins</span>
                                        <span class="hot-pick">üî• 1,234 live bets</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Live Chat Sidebar -->
                        <div class="live-chat-sidebar">
                            <div class="live-chat-header">
                                <h3>üí¨ Live Chat</h3>
                                <span class="online-count" id="onlineCount">üü¢ 0 online</span>
                            </div>
                            <div class="live-chat-messages" id="liveChatMessages">
                                <div style="text-align: center; padding: 40px 20px; color: #6c7380;">
                                    <div style="font-size: 32px; margin-bottom: 10px;">üí¨</div>
                                    <p>Be the first to chat!</p>
                                    <p style="font-size: 12px;">Sign in to join the conversation</p>
                                </div>
                            </div>
                            <div class="live-chat-input">
                                <input type="text" placeholder="Join the conversation..." />
                                <button class="chat-send-btn">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MARKETPLACE SECTION -->
            <div id="marketplace" class="page-section">
                <div class="marketplace-container">
                    <div class="marketplace-header">
                        <div>
                            <h2 class="section-title">üí∞ Marketplace</h2>
                            <p class="marketplace-subtitle">Buy and sell picks, strategies, and betting insights</p>
                        </div>
                        <button class="sell-btn" onclick="openSellModal()">
                            <span>üíé Start Selling</span>
                        </button>
                    </div>

                    <!-- Marketplace Tabs -->
                    <div class="marketplace-tabs">
                        <button class="market-tab active" onclick="switchMarketTab('picks')">üéØ Premium Picks</button>
                        <button class="market-tab" onclick="switchMarketTab('strategies')">üìä Strategies</button>
                        <button class="market-tab" onclick="switchMarketTab('tools')">üõ†Ô∏è Tools & Bots</button>
                        <button class="market-tab" onclick="switchMarketTab('data')">üìà Data & Models</button>
                    </div>

                    <!-- Premium Picks Tab -->
                    <div id="pickMarket" class="market-panel active">
                        <div class="market-filters">
                            <select class="market-filter-dropdown">
                                <option>All Sports</option>
                                <option>NFL</option>
                                <option>NBA</option>
                                <option>MLB</option>
                                <option>NHL</option>
                            </select>
                            <select class="market-filter-dropdown">
                                <option>Sort: Best Selling</option>
                                <option>Sort: Highest Rated</option>
                                <option>Sort: Lowest Price</option>
                                <option>Sort: Highest Price</option>
                            </select>
                        </div>

                        <div class="marketplace-grid" id="picksMarketGrid">
                            <!-- Empty state - products will load from database -->
                            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">
                                <div style="font-size: 64px; margin-bottom: 20px;">üõí</div>
                                <p style="font-size: 18px; margin-bottom: 10px;">No picks packages available yet</p>
                                <p style="font-size: 14px; opacity: 0.7;">Be the first to sell your picks!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Strategies Tab -->
                    <div id="strategiesMarket" class="market-panel">
                        <div class="marketplace-grid" id="strategiesMarketGrid">
                            <!-- Empty state - strategies will load from database -->
                            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">
                                <div style="font-size: 64px; margin-bottom: 20px;">üìö</div>
                                <p style="font-size: 18px; margin-bottom: 10px;">No strategies available yet</p>
                                <p style="font-size: 14px; opacity: 0.7;">Share your winning strategies!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tools Tab -->
                    <div id="toolsMarket" class="market-panel">
                        <div class="marketplace-grid" id="toolsMarketGrid">
                            <!-- Empty state - tools will load from database -->
                            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">
                                <div style="font-size: 64px; margin-bottom: 20px;">üîß</div>
                                <p style="font-size: 18px; margin-bottom: 10px;">No tools available yet</p>
                                <p style="font-size: 14px; opacity: 0.7;">List your betting tools!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Tab -->
                    <div id="dataMarket" class="market-panel">
                        <div class="marketplace-grid" id="dataMarketGrid">
                            <!-- Empty state - data will load from database -->
                            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">
                                <div style="font-size: 64px; margin-bottom: 20px;">üìä</div>
                                <p style="font-size: 18px; margin-bottom: 10px;">No data products available yet</p>
                                <p style="font-size: 14px; opacity: 0.7;">Sell your models and datasets!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Seller Stats Section -->
                    <div class="seller-stats-section">
                        <h3>üíé Want to become a seller?</h3>
                        <p>Share your expertise and earn money by selling picks, strategies, or tools</p>
                        <div class="seller-benefits">
                            <div class="benefit-card">
                                <div class="benefit-icon">üí∞</div>
                                <h4>Earn 70% Revenue</h4>
                                <p>Keep 70% of every sale</p>
                            </div>
                            <div class="benefit-card">
                                <div class="benefit-icon">üìä</div>
                                <h4>Track Performance</h4>
                                <p>Transparent verified stats</p>
                            </div>
                            <div class="benefit-card">
                                <div class="benefit-icon">üöÄ</div>
                                <h4>Grow Your Brand</h4>
                                <p>Build loyal following</p>
                            </div>
                        </div>
                        <button class="become-seller-btn" onclick="openSellerApplication()">Apply to Become a Seller</button>
                    </div>
                </div>
            </div>

            <!-- PREMIUM SECTION -->
            <div id="premium" class="page-section">
                <div class="premium-container">
                    <div class="premium-hero">
                        <h2 class="premium-hero-title">‚≠ê Upgrade to Premium</h2>
                        <p class="premium-hero-subtitle">Unlock exclusive features and take your betting to the next level</p>
                    </div>

                    <!-- Pricing Cards -->
                    <div class="pricing-grid">
                        <!-- Free Tier -->
                        <div class="pricing-card">
                            <div class="tier-badge free">FREE</div>
                            <h3 class="tier-name">Basic</h3>
                            <div class="tier-price">
                                <span class="price-amount">$0</span>
                                <span class="price-period">/forever</span>
                            </div>
                            <ul class="features-list">
                                <li class="feature-item">‚úì Access to public feed</li>
                                <li class="feature-item">‚úì Make 5 picks per week</li>
                                <li class="feature-item">‚úì Join public groups</li>
                                <li class="feature-item">‚úì Basic stats tracking</li>
                                <li class="feature-item">‚úì Community forums</li>
                                <li class="feature-item disabled">‚úó Premium picks packages</li>
                                <li class="feature-item disabled">‚úó Advanced analytics</li>
                                <li class="feature-item disabled">‚úó Private groups</li>
                            </ul>
                            <button class="pricing-btn" disabled>Current Plan</button>
                        </div>

                        <!-- Pro Tier -->
                        <div class="pricing-card featured">
                            <div class="tier-badge pro">MOST POPULAR</div>
                            <h3 class="tier-name">Pro</h3>
                            <div class="tier-price">
                                <span class="price-amount">$29.99</span>
                                <span class="price-period">/month</span>
                            </div>
                            <div class="tier-savings">Save 20% with annual: $287/year</div>
                            <ul class="features-list">
                                <li class="feature-item">‚úì Everything in Basic</li>
                                <li class="feature-item">‚úì Unlimited picks</li>
                                <li class="feature-item">‚úì Advanced analytics dashboard</li>
                                <li class="feature-item">‚úì Join private groups</li>
                                <li class="feature-item">‚úì Priority support</li>
                                <li class="feature-item">‚úì No ads</li>
                                <li class="feature-item">‚úì Export data (CSV)</li>
                                <li class="feature-item">‚úì Custom profile themes</li>
                            </ul>
                            <button class="pricing-btn pro" onclick="upgradeTier('pro')">Upgrade to Pro</button>
                        </div>

                        <!-- Elite Tier -->
                        <div class="pricing-card elite-card">
                            <div class="tier-badge elite">ELITE</div>
                            <h3 class="tier-name">Elite</h3>
                            <div class="tier-price">
                                <span class="price-amount">$99.99</span>
                                <span class="price-period">/month</span>
                            </div>
                            <div class="tier-savings">Save 25% with annual: $899/year</div>
                            <ul class="features-list">
                                <li class="feature-item">‚úì Everything in Pro</li>
                                <li class="feature-item">‚úì Access to premium syndicates</li>
                                <li class="feature-item">‚úì Live betting alerts</li>
                                <li class="feature-item">‚úì 1-on-1 expert consultations</li>
                                <li class="feature-item">‚úì API access</li>
                                <li class="feature-item">‚úì White-label options</li>
                                <li class="feature-item">‚úì Dedicated account manager</li>
                                <li class="feature-item">‚úì Early access to features</li>
                            </ul>
                            <button class="pricing-btn elite" onclick="upgradeTier('elite')">Upgrade to Elite</button>
                        </div>
                    </div>

                    <!-- Feature Comparison Table -->
                    <div class="comparison-section">
                        <h3 class="comparison-title">Detailed Feature Comparison</h3>
                        <div class="comparison-table">
                            <div class="comparison-row header">
                                <div class="comparison-cell">Feature</div>
                                <div class="comparison-cell">Basic</div>
                                <div class="comparison-cell">Pro</div>
                                <div class="comparison-cell">Elite</div>
                            </div>
                            <div class="comparison-row">
                                <div class="comparison-cell feature-name">Picks per Week</div>
                                <div class="comparison-cell">5</div>
                                <div class="comparison-cell">Unlimited</div>
                                <div class="comparison-cell">Unlimited</div>
                            </div>
                            <div class="comparison-row">
                                <div class="comparison-cell feature-name">Groups Access</div>
                                <div class="comparison-cell">Public Only</div>
                                <div class="comparison-cell">Private Groups</div>
                                <div class="comparison-cell">All + Syndicates</div>
                            </div>
                            <div class="comparison-row">
                                <div class="comparison-cell feature-name">Analytics</div>
                                <div class="comparison-cell">Basic</div>
                                <div class="comparison-cell">Advanced</div>
                                <div class="comparison-cell">Pro + Predictive</div>
                            </div>
                            <div class="comparison-row">
                                <div class="comparison-cell feature-name">Live Alerts</div>
                                <div class="comparison-cell">‚úó</div>
                                <div class="comparison-cell">‚úó</div>
                                <div class="comparison-cell">‚úì</div>
                            </div>
                            <div class="comparison-row">
                                <div class="comparison-cell feature-name">API Access</div>
                                <div class="comparison-cell">‚úó</div>
                                <div class="comparison-cell">‚úó</div>
                                <div class="comparison-cell">‚úì</div>
                            </div>
                            <div class="comparison-row">
                                <div class="comparison-cell feature-name">Support</div>
                                <div class="comparison-cell">Community</div>
                                <div class="comparison-cell">Priority Email</div>
                                <div class="comparison-cell">Dedicated Manager</div>
                            </div>
                        </div>
                    </div>

                    <!-- Testimonials Section -->
                    <div class="testimonials-section">
                        <h3 class="testimonials-title">What Our Premium Members Say</h3>
                        <div class="testimonials-grid" id="testimonialsGrid">
                            <!-- Empty state - testimonials will load from database -->
                            <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px; color: #6c7380;">
                                <div style="font-size: 48px; margin-bottom: 15px;">üí¨</div>
                                <p style="font-size: 16px; margin-bottom: 8px;">Be our first premium member!</p>
                                <p style="font-size: 13px; opacity: 0.7;">Member testimonials will appear here</p>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Section -->
                    <div class="faq-section">
                        <h3 class="faq-title">Frequently Asked Questions</h3>
                        <div class="faq-grid">
                            <div class="faq-item">
                                <h4 class="faq-question">Can I cancel anytime?</h4>
                                <p class="faq-answer">Yes! Cancel your subscription anytime. No long-term commitments or hidden fees.</p>
                            </div>
                            <div class="faq-item">
                                <h4 class="faq-question">Is there a money-back guarantee?</h4>
                                <p class="faq-answer">Absolutely. 30-day money-back guarantee if you're not satisfied with Premium.</p>
                            </div>
                            <div class="faq-item">
                                <h4 class="faq-question">Can I switch tiers later?</h4>
                                <p class="faq-answer">Yes, upgrade or downgrade your tier at any time. Changes take effect immediately.</p>
                            </div>
                            <div class="faq-item">
                                <h4 class="faq-question">Do you offer team/group plans?</h4>
                                <p class="faq-answer">Yes! Contact us for custom enterprise pricing for teams of 5+ members.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LEADERBOARDS SECTION -->
            <div id="leaderboards" class="page-section">
                <div class="leaderboards-container">
                    <div class="leaderboard-header-row">
                        <h2 class="section-title">Leaderboards</h2>
                        <button class="compare-users-btn" onclick="openCompareModal()">
                            <span>‚öîÔ∏è</span> Compare Users
                        </button>
                    </div>

                    <!-- Leaderboard Tabs -->
                    <div class="leaderboard-tabs">
                        <button class="lb-tab active" onclick="switchLeaderboard('points')">Total Points</button>
                        <button class="lb-tab" onclick="switchLeaderboard('picks')">Best Picks</button>
                        <button class="lb-tab" onclick="switchLeaderboard('trivia')">Trivia Masters</button>
                        <button class="lb-tab" onclick="switchLeaderboard('polls')">Poll Predictions</button>
                        <button class="lb-tab" onclick="switchLeaderboard('units')">Most Units</button>
                    </div>

                    <!-- Points Leaderboard -->
                    <div id="pointsLeaderboard" class="leaderboard-panel active">
                        <div class="leaderboard-header">
                            <h3>üèÜ Total Points Leaders</h3>
                            <p>Combined trivia and poll prediction points</p>
                        </div>
                        <div class="leaderboard-table">
                            <div class="lb-table-header">
                                <div class="lb-col-rank">Rank</div>
                                <div class="lb-col-user">User</div>
                                <div class="lb-col-stat">Trivia</div>
                                <div class="lb-col-stat">Polls</div>
                                <div class="lb-col-total">Total Points</div>
                            </div>
                            <div id="pointsLeaderboardBody" class="lb-table-body">
                                <!-- Empty state - will be populated from database -->
                                <div class="leaderboard-empty" style="text-align: center; padding: 40px 20px; color: #6c7380;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">üèÜ</div>
                                    <p style="font-size: 16px; margin-bottom: 8px;">No rankings yet</p>
                                    <p style="font-size: 13px; opacity: 0.7;">Be the first to compete and claim the top spot!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Other leaderboards will be shown/hidden via JavaScript -->
                    <div id="picksLeaderboard" class="leaderboard-panel">
                        <div class="leaderboard-header">
                            <h3>üéØ Best Handicappers</h3>
                            <p>Ranked by win rate and total units</p>
                        </div>
                        <div id="picksLeaderboardBody">
                            <!-- Will be populated -->
                        </div>
                    </div>

                    <div id="triviaLeaderboard" class="leaderboard-panel">
                        <div class="leaderboard-header">
                            <h3>üß† Trivia Champions</h3>
                            <p>Top quiz performers</p>
                        </div>
                        <div id="triviaLeaderboardBody">
                            <!-- Will be populated -->
                        </div>
                    </div>

                    <div id="pollsLeaderboard" class="leaderboard-panel">
                        <div class="leaderboard-header">
                            <h3>üìä Prediction Experts</h3>
                            <p>Most accurate poll predictions</p>
                        </div>
                        <div id="pollsLeaderboardBody">
                            <!-- Will be populated -->
                        </div>
                    </div>

                    <div id="unitsLeaderboard" class="leaderboard-panel">
                        <div class="leaderboard-header">
                            <h3>üí∞ Profit Leaders</h3>
                            <p>Most units won</p>
                        </div>
                        <div id="unitsLeaderboardBody">
                            <!-- Will be populated -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- LOGIN SECTION -->
            <div id="login" class="page-section">
                <div class="picks-container">
                    <div class="section-header">
                        <h2>Welcome <span class="highlight">Back</span></h2>
                        <p>Login to access your verified track record and continue dominating.</p>
                    </div>

                    <div class="pick-form" style="max-width: 500px; margin: 0 auto;">
                        <form id="loginForm" onsubmit="handleLogin(event)">
                            <div class="form-group">
                                <label for="loginEmail">Email or Username</label>
                                <input type="text" id="loginEmail" name="loginEmail" placeholder="Enter your email or username" required>
                            </div>

                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <input type="password" id="loginPassword" name="loginPassword" placeholder="Enter your password" required>
                            </div>

                            <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="rememberMe" name="rememberMe" checked>
                                    <span style="color: var(--text-secondary); font-size: 14px;">Remember me</span>
                                </label>
                                <a onclick="alert('Password reset feature coming soon!')" style="color: var(--neon-cyan); font-size: 14px; cursor: pointer; text-decoration: none;">Forgot password?</a>
                            </div>

                            <button type="submit" class="submit-pick" style="width: 100%; margin-top: 10px;">LOGIN</button>
                        </form>

                        <div style="text-align: center; margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--glass-border);">
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">Don't have an account?</p>
                            <button onclick="showSection('signup')" class="submit-pick" style="background: var(--gradient-neon); width: 100%;">CREATE ACCOUNT</button>
                        </div>

                        <!-- Social Login Options -->
                        <div style="margin-top: 30px;">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <span style="color: var(--text-muted); font-size: 14px;">Or continue with</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <button type="button" onclick="alert('Google login coming soon!')" style="background: rgba(255, 255, 255, 0.1); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    üîç Google
                                </button>
                                <button type="button" onclick="alert('Twitter login coming soon!')" style="background: rgba(255, 255, 255, 0.1); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    üê¶ Twitter
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIGNUP SECTION -->
            <div id="signup" class="page-section">
                <div class="picks-container">
                    <div class="section-header">
                        <h2>Join the <span class="highlight">Revolution</span></h2>
                        <p>Create your account and start building your verified track record today.</p>
                    </div>

                    <div class="pick-form">
                        <form id="signupForm">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" name="username" placeholder="Choose your username" required>
                            </div>

                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" placeholder="Enter your email" required>
                            </div>

                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" id="password" name="password" placeholder="Create a password" required>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">Confirm Password</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password" required>
                            </div>

                            <div class="form-group">
                                <label for="displayName">Display Name (Optional)</label>
                                <input type="text" id="displayName" name="displayName" placeholder="Your display name">
                            </div>

                            <div class="form-group">
                                <label for="favoriteTeam">Favorite Team (Optional)</label>
                                <input type="text" id="favoriteTeam" name="favoriteTeam" placeholder="e.g., Chiefs, Lakers, Yankees">
                            </div>

                            <div class="form-group">
                                <label for="favoriteSport">Favorite Sport (Optional)</label>
                                <select id="favoriteSport" name="favoriteSport">
                                    <option value="">Select a sport...</option>
                                    <option value="NFL">NFL</option>
                                    <option value="NBA">NBA</option>
                                    <option value="MLB">MLB</option>
                                    <option value="NHL">NHL</option>
                                    <option value="Soccer">Soccer</option>
                                    <option value="NCAA Football">NCAA Football</option>
                                    <option value="NCAA Basketball">NCAA Basketball</option>
                                    <option value="MMA/UFC">MMA/UFC</option>
                                    <option value="Boxing">Boxing</option>
                                    <option value="Tennis">Tennis</option>
                                    <option value="Golf">Golf</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="location">Location (Optional)</label>
                                <input type="text" id="location" name="location" placeholder="e.g., Los Angeles, CA">
                            </div>

                            <div class="form-group">
                                <label for="bio">Bio (Optional)</label>
                                <textarea id="bio" name="bio" placeholder="Tell us about yourself..." rows="3"></textarea>
                            </div>

                            <button type="submit" class="submit-pick">CREATE ACCOUNT</button>
                        </form>

                        <div style="text-align: center; margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--glass-border);">
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">Already have an account?</p>
                            <button onclick="showSection('login')" class="submit-pick" style="background: rgba(0, 255, 255, 0.1); border: 1px solid var(--neon-cyan); width: 100%;">LOGIN</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div id="search" class="page-section">
                <div class="search-container">
                    <div class="section-header">
                        <h2>Find <span class="highlight">Bettors</span></h2>
                        <p>Search for users by name, username, location, or favorite team</p>
                    </div>
                    <input type="text" id="userSearch" class="search-box" placeholder="Search users...">
                    <div id="searchResults"></div>
                </div>
            </div>
<!-- PREDICTION POLLS & TRIVIA SECTION -->
<div id="polls-trivia" class="page-section">
    <div class="polls-trivia-container">
        <!-- Section Toggle -->
        <div class="section-toggle">
            <button class="toggle-btn active" onclick="showSubSection('predictions')">
                üîÆ Predictions
            </button>
            <button class="toggle-btn" onclick="showSubSection('trivia')">
                üß† Trivia
            </button>
        </div>

        <!-- PREDICTIONS SECTION -->
        <div id="predictions-section" class="sub-section active">
            <div class="section-header">
                <h2>Prediction <span class="highlight">Polls</span></h2>
                <p>Make predictions on upcoming games and compete for the top spot on the leaderboard</p>
                <button class="create-poll-btn" onclick="openCreatePollModal()">
                    <span>‚ûï</span> Create Poll
                </button>
            </div>

            <!-- User Stats Card -->
            <div class="user-stats-card">
                <div class="stat-item">
                    <div class="stat-value" id="pollsAccuracy">--</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pollsVoteCount">0</div>
                    <div class="stat-label">Predictions</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pollsRank">--</div>
                    <div class="stat-label">Rank</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pollsPoints">0</div>
                    <div class="stat-label">Points</div>
                </div>
            </div>

            <!-- Active Polls -->
            <div class="polls-grid" id="pollsGrid">
                <!-- Empty state - polls will load from database -->
                <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">
                    <div style="font-size: 64px; margin-bottom: 20px;">üìä</div>
                    <p style="font-size: 18px; margin-bottom: 10px;">No active polls yet</p>
                    <p style="font-size: 14px; opacity: 0.7;">Create a poll to get predictions from the community!</p>
                    <button onclick="openCreatePollModal()" style="margin-top: 20px; padding: 12px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Create Poll</button>
                </div>
            </div>

            <!-- Leaderboard -->
            <div class="mini-leaderboard">
                <h3>üèÜ Top Predictors This Week</h3>
                <div class="leaderboard-list" id="predictorsLeaderboard">
                    <!-- Empty state - will load from database -->
                    <div style="text-align: center; padding: 30px 20px; color: #6c7380;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üèÜ</div>
                        <p style="font-size: 14px;">No predictions yet this week</p>
                    </div>
                </div>
                <button class="view-full-btn" onclick="showSection('leaderboards')">View Full Leaderboard ‚Üí</button>
            </div>
        </div>

        <!-- TRIVIA SECTION -->
        <div id="trivia-section" class="sub-section">
            <div class="section-header">
                <h2>Sports <span class="highlight">Trivia</span></h2>
                <p>Test your sports knowledge and climb the trivia leaderboard</p>
            </div>

            <!-- Daily Challenge -->
            <div class="daily-challenge">
                <div class="challenge-badge">üéØ DAILY CHALLENGE</div>
                <h3>Today's Trivia Quiz</h3>
                <p>Answer 10 questions to earn bonus points</p>
                <div class="challenge-stats">
                    <div class="stat">
                        <span class="stat-icon">‚è±Ô∏è</span>
                        <span>5 min</span>
                    </div>
                    <div class="stat">
                        <span class="stat-icon">üéÅ</span>
                        <span>500 pts</span>
                    </div>
                    <div class="stat">
                        <span class="stat-icon">üë•</span>
                        <span>1,234 played</span>
                    </div>
                </div>
                <button class="start-quiz-btn" onclick="startDailyQuiz()">
                    START DAILY QUIZ
                </button>
            </div>

            <!-- Trivia Categories -->
            <div class="trivia-categories">
                <h3>Choose a Category</h3>
                <div class="categories-grid">
                    <div class="category-card" onclick="startTrivia('nfl')">
                        <div class="category-icon">üèà</div>
                        <div class="category-name">NFL Trivia</div>
                        <div class="category-stats">250 questions</div>
                    </div>
                    <div class="category-card" onclick="startTrivia('nba')">
                        <div class="category-icon">üèÄ</div>
                        <div class="category-name">NBA Trivia</div>
                        <div class="category-stats">300 questions</div>
                    </div>
                    <div class="category-card" onclick="startTrivia('mlb')">
                        <div class="category-icon">‚öæ</div>
                        <div class="category-name">MLB Trivia</div>
                        <div class="category-stats">280 questions</div>
                    </div>
                    <div class="category-card" onclick="startTrivia('nhl')">
                        <div class="category-icon">üèí</div>
                        <div class="category-name">NHL Trivia</div>
                        <div class="category-stats">200 questions</div>
                    </div>
                    <div class="category-card" onclick="startTrivia('soccer')">
                        <div class="category-icon">‚öΩ</div>
                        <div class="category-name">Soccer Trivia</div>
                        <div class="category-stats">350 questions</div>
                    </div>
                    <div class="category-card" onclick="startTrivia('mixed')">
                        <div class="category-icon">üé≤</div>
                        <div class="category-name">Mixed Sports</div>
                        <div class="category-stats">500 questions</div>
                    </div>
                </div>
            </div>

            <!-- Recent Trivia Results -->
            <div class="trivia-results">
                <h3>Your Recent Quizzes</h3>
                <div class="results-list" id="triviaResultsList">
                    <!-- Empty state - will load from database -->
                    <div style="text-align: center; padding: 30px 20px; color: #6c7380;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üéØ</div>
                        <p style="font-size: 14px;">You haven't taken any quizzes yet</p>
                        <p style="font-size: 12px; opacity: 0.7;">Take a quiz above to earn points!</p>
                    </div>
                </div>
            </div>

            <!-- Trivia Leaderboard -->
            <div class="mini-leaderboard">
                <h3>üß† Top Trivia Masters</h3>
                <div class="leaderboard-list" id="triviaLeaderboardMini">
                    <!-- Empty state - will load from database -->
                    <div style="text-align: center; padding: 30px 20px; color: #6c7380;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üß†</div>
                        <p style="font-size: 14px;">No trivia scores yet</p>
                    </div>
                </div>
                <button class="view-full-btn" onclick="showSection('leaderboards')">View Full Leaderboard ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<!-- Create Poll Modal -->
<div id="createPollModal" class="modal" style="display: none;">
    <div class="modal-content poll-modal">
        <span class="close-modal" onclick="closeCreatePollModal()">&times;</span>
        <h2>Create Prediction Poll</h2>
        <form id="createPollForm" onsubmit="submitPoll(event)">
            <div class="form-group">
                <label>Sport Category</label>
                <select id="pollCategory" name="category" required>
                    <option value="">Select Sport</option>
                    <option value="nfl">üèà NFL</option>
                    <option value="nba">üèÄ NBA</option>
                    <option value="mlb">‚öæ MLB</option>
                    <option value="nhl">üèí NHL</option>
                    <option value="ncaaf">üéì NCAAF</option>
                    <option value="ncaab">üè´ NCAAB</option>
                    <option value="other">üé≤ Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Poll Question</label>
                <input type="text" id="pollQuestion" name="question" placeholder="e.g., Who will win tonight's game?" required>
            </div>

            <div class="form-group">
                <label>Poll Options (2-4 options)</label>
                <input type="text" id="pollOption1" name="option1" placeholder="Option 1" required>
                <input type="text" id="pollOption2" name="option2" placeholder="Option 2" required>
                <input type="text" id="pollOption3" name="option3" placeholder="Option 3 (optional)">
                <input type="text" id="pollOption4" name="option4" placeholder="Option 4 (optional)">
            </div>

            <div class="form-group">
                <label>End Time</label>
                <input type="datetime-local" id="pollEndTime" name="endTime" required>
            </div>

            <div class="form-group">
                <label>Points Reward</label>
                <select id="pollPoints" name="points" required>
                    <option value="25">25 points (Easy)</option>
                    <option value="50" selected>50 points (Medium)</option>
                    <option value="75">75 points (Hard)</option>
                    <option value="100">100 points (Expert)</option>
                </select>
            </div>

            <button type="submit" class="submit-poll-btn">CREATE POLL</button>
        </form>
    </div>
</div>

<!-- Trivia Quiz Modal -->
<div id="triviaQuizModal" class="modal" style="display: none;">
    <div class="modal-content quiz-modal">
        <div class="quiz-header">
            <div class="quiz-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 30%"></div>
                </div>
                <span class="progress-text">Question 3 of 10</span>
            </div>
            <span class="close-modal" onclick="closeQuizModal()">&times;</span>
        </div>

        <div class="quiz-question">
            <h3>Which NBA player holds the record for most career points?</h3>
        </div>

        <div class="quiz-options">
            <div class="quiz-option" onclick="selectAnswer(1)">
                <span class="option-letter">A</span>
                <span class="option-text">Michael Jordan</span>
            </div>
            <div class="quiz-option" onclick="selectAnswer(2)">
                <span class="option-letter">B</span>
                <span class="option-text">LeBron James</span>
            </div>
            <div class="quiz-option" onclick="selectAnswer(3)">
                <span class="option-letter">C</span>
                <span class="option-text">Kareem Abdul-Jabbar</span>
            </div>
            <div class="quiz-option" onclick="selectAnswer(4)">
                <span class="option-letter">D</span>
                <span class="option-text">Kobe Bryant</span>
            </div>
        </div>

        <button class="submit-answer-btn" onclick="submitAnswer()">SUBMIT ANSWER</button>

        <div class="quiz-stats">
            <div class="stat-item">
                <span class="stat-icon">‚úÖ</span>
                <span>2 Correct</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">‚ùå</span>
                <span>0 Wrong</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">üéØ</span>
                <span>200 pts</span>
            </div>
        </div>
    </div>
</div>

<!-- MY RECORD PAGE SECTION - Advanced Stats Dashboard -->
<div id="my-record" class="page-section">
    <div class="advanced-stats-container">
        <!-- Header -->
        <div class="stats-header">
            <h2>My <span class="highlight">Record</span></h2>
            <p>Advanced analytics and verified performance metrics</p>
        </div>

        <!-- Primary Stats Row - Big Numbers -->
        <div class="primary-stats-row">
            <div class="big-stat-card record-card">
                <div class="big-stat-value" id="advRecordDisplay">0-0-0</div>
                <div class="big-stat-label">RECORD (W-L-P)</div>
            </div>
            <div class="big-stat-card win-rate-card">
                <div class="big-stat-value" id="advWinRate">0.0%</div>
                <div class="big-stat-label">WIN RATE</div>
            </div>
            <div class="big-stat-card units-card">
                <div class="big-stat-value" id="advUnitsProfit">+0.00</div>
                <div class="big-stat-label">UNITS +/-</div>
            </div>
            <div class="big-stat-card roi-card">
                <div class="big-stat-value" id="advROI">0.0%</div>
                <div class="big-stat-label">ROI</div>
            </div>
        </div>

        <!-- Secondary Stats - Advanced Metrics -->
        <div class="secondary-stats-grid">
            <div class="adv-stat-box">
                <div class="adv-stat-icon">üìä</div>
                <div class="adv-stat-data">
                    <span class="adv-stat-value" id="advZScore">0.00</span>
                    <span class="adv-stat-label">Z-Score</span>
                </div>
                <div class="adv-stat-info" title="Statistical significance. >1.96 = 95% confidence your edge is real">‚ÑπÔ∏è</div>
            </div>
            <div class="adv-stat-box">
                <div class="adv-stat-icon">üéØ</div>
                <div class="adv-stat-data">
                    <span class="adv-stat-value" id="advAvgOdds">-110</span>
                    <span class="adv-stat-label">Avg Odds</span>
                </div>
                <div class="adv-stat-info" title="Average odds of all your picks">‚ÑπÔ∏è</div>
            </div>
            <div class="adv-stat-box">
                <div class="adv-stat-icon">üî•</div>
                <div class="adv-stat-data">
                    <span class="adv-stat-value" id="advCurrentStreak">-</span>
                    <span class="adv-stat-label">Current Streak</span>
                </div>
            </div>
            <div class="adv-stat-box">
                <div class="adv-stat-icon">üèÜ</div>
                <div class="adv-stat-data">
                    <span class="adv-stat-value" id="advBestStreak">0W</span>
                    <span class="adv-stat-label">Best Win Streak</span>
                </div>
            </div>
            <div class="adv-stat-box">
                <div class="adv-stat-icon">üíµ</div>
                <div class="adv-stat-data">
                    <span class="adv-stat-value" id="advAvgUnits">1.0</span>
                    <span class="adv-stat-label">Avg Units/Pick</span>
                </div>
            </div>
            <div class="adv-stat-box">
                <div class="adv-stat-icon">üìÖ</div>
                <div class="adv-stat-data">
                    <span class="adv-stat-value" id="advTotalPicks">0</span>
                    <span class="adv-stat-label">Total Picks</span>
                </div>
            </div>
        </div>

        <!-- Sport Breakdown Table -->
        <div class="breakdown-section">
            <h3>Performance by Sport</h3>
            <div class="breakdown-table-wrapper">
                <table class="breakdown-table" id="sportBreakdownTable">
                    <thead>
                        <tr>
                            <th>Sport</th>
                            <th>Record</th>
                            <th>Win %</th>
                            <th>Units</th>
                            <th>ROI</th>
                        </tr>
                    </thead>
                    <tbody id="sportBreakdownBody">
                        <tr><td colspan="5" style="text-align:center; color: var(--text-muted);">No data yet</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Bet Type Breakdown -->
        <div class="breakdown-section">
            <h3>Performance by Bet Type</h3>
            <div class="breakdown-table-wrapper">
                <table class="breakdown-table" id="betTypeBreakdownTable">
                    <thead>
                        <tr>
                            <th>Bet Type</th>
                            <th>Record</th>
                            <th>Win %</th>
                            <th>Units</th>
                            <th>ROI</th>
                        </tr>
                    </thead>
                    <tbody id="betTypeBreakdownBody">
                        <tr><td colspan="5" style="text-align:center; color: var(--text-muted);">No data yet</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Actions Bar -->
        <div class="stats-actions-bar">
            <button class="stats-action-btn primary" onclick="tryAutoGradeAll()">
                <span>‚ö°</span> Auto-Grade Pending
            </button>
            <button class="stats-action-btn" onclick="refreshAdvancedStats()">
                <span>üîÑ</span> Refresh
            </button>
            <button class="stats-action-btn" onclick="toggleFullHistory()">
                <span>üìú</span> <span id="historyToggleText">Show Full History</span>
            </button>
        </div>

        <!-- Pick History - Collapsible -->
        <div class="full-history-section" id="fullHistorySection" style="display: none;">
            <h3>Complete Pick History</h3>
            <div class="history-filter-bar">
                <button class="hist-filter active" data-filter="all" onclick="filterAdvHistory('all')">All</button>
                <button class="hist-filter win-filter" data-filter="win" onclick="filterAdvHistory('win')">Wins</button>
                <button class="hist-filter loss-filter" data-filter="loss" onclick="filterAdvHistory('loss')">Losses</button>
                <button class="hist-filter pending-filter" data-filter="pending" onclick="filterAdvHistory('pending')">Pending</button>
            </div>
            <div class="history-list" id="advHistoryList">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>
</div>

<style>
/* =====================================================
   ADVANCED STATS DASHBOARD - PICKMONITOR STYLE
   ===================================================== */

.advanced-stats-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
}

.stats-header {
    text-align: center;
    margin-bottom: 40px;
}

.stats-header h2 {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.stats-header p {
    color: var(--text-muted);
    font-size: 1rem;
}

/* Primary Stats Row - Big Numbers */
.primary-stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 30px;
}

.big-stat-card {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 30px 20px;
    text-align: center;
    transition: all 0.3s ease;
}

.big-stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
}

.big-stat-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.2rem;
    font-weight: 900;
    margin-bottom: 8px;
}

.big-stat-label {
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 1px;
    color: var(--text-muted);
    text-transform: uppercase;
}

/* Card Color Variants */
.record-card {
    border-color: var(--neon-cyan);
    background: linear-gradient(135deg, rgba(0,255,255,0.1) 0%, var(--card-bg) 100%);
}
.record-card .big-stat-value { color: var(--neon-cyan); }

.win-rate-card .big-stat-value { color: #00ff88; }
.units-card .big-stat-value.positive { color: #00ff88; }
.units-card .big-stat-value.negative { color: #ff4444; }
.roi-card .big-stat-value.positive { color: #00ff88; }
.roi-card .big-stat-value.negative { color: #ff4444; }

/* Secondary Stats Grid */
.secondary-stats-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 15px;
    margin-bottom: 40px;
}

.adv-stat-box {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 20px 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    position: relative;
}

.adv-stat-icon {
    font-size: 1.5rem;
}

.adv-stat-data {
    text-align: center;
}

.adv-stat-value {
    display: block;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--neon-cyan);
}

.adv-stat-label {
    display: block;
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 4px;
}

.adv-stat-info {
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 0.8rem;
    cursor: help;
    opacity: 0.5;
}

/* Breakdown Tables */
.breakdown-section {
    background: var(--card-bg);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 25px;
}

.breakdown-section h3 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.1rem;
    color: var(--neon-cyan);
    margin-bottom: 20px;
}

.breakdown-table-wrapper {
    overflow-x: auto;
}

.breakdown-table {
    width: 100%;
    border-collapse: collapse;
}

.breakdown-table th {
    background: rgba(0, 255, 255, 0.1);
    color: var(--neon-cyan);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 12px 15px;
    text-align: left;
    border-bottom: 2px solid var(--glass-border);
}

.breakdown-table td {
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    font-size: 0.95rem;
}

.breakdown-table tr:hover td {
    background: rgba(0, 255, 255, 0.03);
}

.breakdown-table .positive { color: #00ff88; }
.breakdown-table .negative { color: #ff4444; }
.breakdown-table .sport-icon { margin-right: 8px; }

/* Actions Bar */
.stats-actions-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.stats-action-btn {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 10px;
    padding: 12px 24px;
    color: var(--text-primary);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.stats-action-btn:hover {
    border-color: var(--neon-cyan);
    background: rgba(0, 255, 255, 0.05);
}

.stats-action-btn.primary {
    background: linear-gradient(135deg, var(--neon-cyan), #00cccc);
    border: none;
    color: #000;
}

.stats-action-btn.primary:hover {
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
}

/* Full History Section */
.full-history-section {
    background: var(--card-bg);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 25px;
    margin-top: 20px;
}

.full-history-section h3 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.1rem;
    color: var(--neon-cyan);
    margin-bottom: 20px;
}

.history-filter-bar {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.hist-filter {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 8px 20px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.hist-filter:hover, .hist-filter.active {
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
    background: rgba(0, 255, 255, 0.1);
}

.hist-filter.win-filter.active {
    border-color: #00ff88;
    color: #00ff88;
    background: rgba(0, 255, 136, 0.1);
}

.hist-filter.loss-filter.active {
    border-color: #ff4444;
    color: #ff4444;
    background: rgba(255, 68, 68, 0.1);
}

.hist-filter.pending-filter.active {
    border-color: var(--neon-gold);
    color: var(--neon-gold);
    background: rgba(255, 215, 0, 0.1);
}

.history-list {
    max-height: 600px;
    overflow-y: auto;
}

/* Pick Cards in History */
.history-pick-card {
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
}

.history-pick-card:hover {
    transform: translateX(5px);
}

/* WIN Card */
.history-pick-card.win {
    background: linear-gradient(90deg, rgba(0, 255, 136, 0.15) 0%, rgba(0, 255, 136, 0.02) 100%);
    border-left: 4px solid #00ff88;
}

/* LOSS Card */
.history-pick-card.loss {
    background: linear-gradient(90deg, rgba(255, 68, 68, 0.15) 0%, rgba(255, 68, 68, 0.02) 100%);
    border-left: 4px solid #ff4444;
}

/* PENDING Card */
.history-pick-card.pending {
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.02) 100%);
    border-left: 4px solid var(--neon-gold);
}

/* PUSH Card */
.history-pick-card.push {
    background: linear-gradient(90deg, rgba(128, 128, 128, 0.15) 0%, rgba(128, 128, 128, 0.02) 100%);
    border-left: 4px solid #888;
}

.pick-card-main {
    flex: 1;
}

.pick-card-game {
    font-weight: 600;
    color: #fff;
    font-size: 1rem;
    margin-bottom: 4px;
}

.pick-card-details {
    color: var(--neon-cyan);
    font-size: 0.9rem;
    margin-bottom: 4px;
}

.pick-card-meta {
    color: var(--text-muted);
    font-size: 0.8rem;
}

.pick-card-result {
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: 700;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.pick-card-result.win {
    background: rgba(0, 255, 136, 0.2);
    color: #00ff88;
}

.pick-card-result.loss {
    background: rgba(255, 68, 68, 0.2);
    color: #ff4444;
}

.pick-card-result.pending {
    background: rgba(255, 215, 0, 0.2);
    color: var(--neon-gold);
}

.pick-card-result.push {
    background: rgba(128, 128, 128, 0.2);
    color: #888;
}

/* Pending Pick Grade Buttons */
.pick-grade-btns {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.grade-btn-inline {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
}

.grade-btn-inline.win-btn {
    background: rgba(0, 255, 136, 0.15);
    border: 2px solid #00ff88;
    color: #00ff88;
}
.grade-btn-inline.win-btn:hover {
    background: rgba(0, 255, 136, 0.3);
    box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
}

.grade-btn-inline.loss-btn {
    background: rgba(255, 68, 68, 0.15);
    border: 2px solid #ff4444;
    color: #ff4444;
}
.grade-btn-inline.loss-btn:hover {
    background: rgba(255, 68, 68, 0.3);
    box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
}

.grade-btn-inline.push-btn {
    background: rgba(128, 128, 128, 0.15);
    border: 2px solid #888;
    color: #888;
}
.grade-btn-inline.push-btn:hover {
    background: rgba(128, 128, 128, 0.3);
}

/* Responsive */
@media (max-width: 1024px) {
    .primary-stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
    .secondary-stats-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .primary-stats-row {
        grid-template-columns: 1fr 1fr;
    }
    .secondary-stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .big-stat-value {
        font-size: 1.6rem;
    }
    .stats-actions-bar {
        flex-direction: column;
    }
    .stats-action-btn {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .primary-stats-row {
        grid-template-columns: 1fr;
    }
    .secondary-stats-grid {
        grid-template-columns: 1fr 1fr;
    }
}
</style>

<style>
/* POLLS & TRIVIA STYLES */
.polls-trivia-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
}

/* Section Toggle */
.section-toggle {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-bottom: 40px;
}

.toggle-btn {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 12px;
    padding: 15px 40px;
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.3s ease;
}

.toggle-btn:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

.toggle-btn.active {
    background: var(--gradient-gold);
    border-color: var(--neon-gold);
    color: var(--dark-bg);
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
}

.sub-section {
    display: none;
}

.sub-section.active {
    display: block;
    animation: fadeIn 0.3s ease-in;
}

.create-poll-btn {
    background: var(--gradient-gold);
    border: none;
    border-radius: 12px;
    padding: 12px 24px;
    font-weight: 700;
    color: var(--dark-bg);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
    margin-top: 15px;
}

.create-poll-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
}

/* User Stats Card */
.user-stats-card {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.stat-item {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--neon-gold);
    margin-bottom: 8px;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Polls Grid */
.polls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 25px;
    margin: 30px 0;
}

.poll-card {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 25px;
    transition: all 0.3s ease;
}

.poll-card:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
}

.poll-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.poll-category {
    background: rgba(0, 255, 255, 0.1);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--neon-cyan);
}

.poll-time {
    color: var(--neon-gold);
    font-size: 0.85rem;
    font-weight: 600;
}

.poll-question {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 12px;
    line-height: 1.4;
}

.poll-creator {
    color: var(--text-muted);
    font-size: 0.85rem;
    margin-bottom: 20px;
}

.poll-creator .username {
    color: var(--neon-cyan);
    font-weight: 600;
}

.poll-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
}

.poll-option {
    background: rgba(0, 255, 255, 0.05);
    border: 2px solid var(--glass-border);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.poll-option:hover {
    border-color: var(--neon-cyan);
    background: rgba(0, 255, 255, 0.1);
}

.poll-option.voted {
    border-color: var(--neon-gold);
    background: rgba(255, 215, 0, 0.1);
}

.option-content {
    position: relative;
}

.option-label {
    font-weight: 600;
    margin-bottom: 8px;
    display: block;
}

.option-votes {
    position: relative;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 5px;
}

.vote-bar {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple));
    transition: width 0.5s ease;
}

.vote-bar.voted-bar {
    background: var(--gradient-gold);
}

.vote-percent {
    font-size: 0.85rem;
    color: var(--text-secondary);
    float: right;
}

.vote-check {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--gradient-gold);
    color: var(--dark-bg);
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 700;
}

.poll-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid var(--glass-border);
}

.points-reward {
    color: var(--neon-green);
    font-weight: 600;
    font-size: 0.9rem;
}

.discuss-btn {
    background: rgba(0, 255, 255, 0.1);
    border: 1px solid var(--neon-cyan);
    border-radius: 8px;
    padding: 8px 15px;
    color: var(--neon-cyan);
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
}

.discuss-btn:hover {
    background: rgba(0, 255, 255, 0.2);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

/* Leaderboard */
.mini-leaderboard {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 30px;
    margin: 40px 0;
}

.mini-leaderboard h3 {
    color: var(--neon-gold);
    font-size: 1.5rem;
    margin-bottom: 20px;
    text-align: center;
}

.leaderboard-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.leaderboard-item {
    background: rgba(0, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.2s;
}

.leaderboard-item:hover {
    border-color: var(--neon-cyan);
    background: rgba(0, 255, 255, 0.1);
}

.leaderboard-item.rank-1 {
    border-color: var(--neon-gold);
    background: rgba(255, 215, 0, 0.1);
}

.leaderboard-item .rank {
    font-weight: 700;
    font-size: 1.1rem;
    min-width: 60px;
}

.leaderboard-item .username {
    flex: 1;
    font-weight: 600;
    color: var(--neon-cyan);
}

.leaderboard-item .accuracy {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.view-full-btn {
    width: 100%;
    margin-top: 20px;
    background: transparent;
    border: 2px solid var(--neon-cyan);
    border-radius: 10px;
    padding: 12px;
    color: var(--neon-cyan);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.view-full-btn:hover {
    background: rgba(0, 255, 255, 0.1);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

/* Daily Challenge */
.daily-challenge {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(0, 255, 255, 0.1));
    border: 2px solid var(--neon-gold);
    border-radius: 16px;
    padding: 35px;
    text-align: center;
    margin-bottom: 40px;
}

.challenge-badge {
    background: var(--gradient-gold);
    color: var(--dark-bg);
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.9rem;
    display: inline-block;
    margin-bottom: 15px;
}

.daily-challenge h3 {
    font-size: 1.8rem;
    margin-bottom: 10px;
}

.daily-challenge p {
    color: var(--text-secondary);
    margin-bottom: 20px;
}

.challenge-stats {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 25px 0;
}

.challenge-stats .stat {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
}

.stat-icon {
    font-size: 1.3rem;
}

.start-quiz-btn {
    background: var(--gradient-gold);
    border: none;
    border-radius: 12px;
    padding: 15px 40px;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--dark-bg);
    cursor: pointer;
    transition: all 0.3s;
}

.start-quiz-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
}

/* Trivia Categories */
.trivia-categories {
    margin: 40px 0;
}

.trivia-categories h3 {
    color: var(--neon-gold);
    font-size: 1.5rem;
    margin-bottom: 25px;
}

.categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
}

.category-card {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 30px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.category-card:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
    transform: translateY(-5px);
}

.category-icon {
    font-size: 3rem;
    margin-bottom: 15px;
}

.category-name {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 8px;
}

.category-stats {
    color: var(--text-muted);
    font-size: 0.85rem;
}

/* Trivia Results */
.trivia-results {
    margin: 40px 0;
}

.trivia-results h3 {
    color: var(--neon-gold);
    font-size: 1.5rem;
    margin-bottom: 20px;
}

.results-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.result-item {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
}

.result-icon {
    font-size: 2rem;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
}

.result-icon.perfect {
    background: rgba(57, 255, 20, 0.2);
}

.result-icon.good {
    background: rgba(0, 255, 255, 0.2);
}

.result-icon.average {
    background: rgba(255, 215, 0, 0.2);
}

.result-info {
    flex: 1;
}

.result-title {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 5px;
}

.result-meta {
    color: var(--text-muted);
    font-size: 0.85rem;
}

.result-score {
    font-weight: 700;
    font-size: 1.2rem;
    padding: 8px 16px;
    border-radius: 8px;
}

.result-score.perfect {
    color: var(--neon-green);
    background: rgba(57, 255, 20, 0.1);
}

.result-score.good {
    color: var(--neon-cyan);
    background: rgba(0, 255, 255, 0.1);
}

.result-score.average {
    color: var(--neon-gold);
    background: rgba(255, 215, 0, 0.1);
}

/* Modal Styles */
.poll-modal {
    max-width: 600px;
}

.poll-modal .form-group {
    margin-bottom: 20px;
}

.poll-modal label {
    display: block;
    color: var(--text-secondary);
    font-weight: 600;
    margin-bottom: 8px;
}

.poll-modal input,
.poll-modal select {
    width: 100%;
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 10px;
    padding: 12px;
    color: var(--text-primary);
    font-size: 1rem;
    margin-bottom: 10px;
}

.poll-modal input:focus,
.poll-modal select:focus {
    outline: none;
    border-color: var(--neon-cyan);
}

.submit-poll-btn {
    width: 100%;
    background: var(--gradient-gold);
    border: none;
    border-radius: 12px;
    padding: 15px;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--dark-bg);
    cursor: pointer;
    transition: all 0.3s;
}

.submit-poll-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
}

/* Quiz Modal */
.quiz-modal {
    max-width: 700px;
}

.quiz-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.quiz-progress {
    flex: 1;
}

.progress-bar {
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 8px;
}

.progress-fill {
    height: 100%;
    background: var(--gradient-gold);
    transition: width 0.3s ease;
}

.progress-text {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.quiz-question {
    margin-bottom: 30px;
}

.quiz-question h3 {
    font-size: 1.4rem;
    line-height: 1.5;
}

.quiz-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 25px;
}

.quiz-option {
    background: var(--card-bg);
    border: 2px solid var(--glass-border);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    cursor: pointer;
    transition: all 0.2s;
}

.quiz-option:hover {
    border-color: var(--neon-cyan);
    background: rgba(0, 255, 255, 0.1);
}

.quiz-option.selected {
    border-color: var(--neon-gold);
    background: rgba(255, 215, 0, 0.1);
}

.option-letter {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 255, 255, 0.1);
    border-radius: 50%;
    font-weight: 700;
    font-size: 1.2rem;
    flex-shrink: 0;
}

.option-text {
    flex: 1;
    font-size: 1.1rem;
}

.submit-answer-btn {
    width: 100%;
    background: var(--gradient-gold);
    border: none;
    border-radius: 12px;
    padding: 15px;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--dark-bg);
    cursor: pointer;
    margin-bottom: 20px;
    transition: all 0.3s;
}

.submit-answer-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
}

.quiz-stats {
    display: flex;
    justify-content: space-around;
    padding: 20px;
    background: rgba(0, 255, 255, 0.05);
    border-radius: 10px;
}

.quiz-stats .stat-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
}

@media (max-width: 768px) {
    .polls-grid,
    .categories-grid {
        grid-template-columns: 1fr;
    }

    .section-toggle {
        flex-direction: column;
    }

    .user-stats-card {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<script>
// POLLS & TRIVIA JAVASCRIPT WITH LOCALSTORAGE

// Poll voting state (legacy key kept for compat)
let pollVotes = JSON.parse(localStorage.getItem('trustMyRecordPollVotes') || '{}');

// Trivia state
let triviaScores = JSON.parse(localStorage.getItem('trustMyRecordTriviaScores') || '[]');
let currentQuiz = null;
let currentQuizProgress = 0;
let currentQuizScore = 0;
let selectedQuizAnswer = null;
let currentTriviaCategory = 'mixed';

function showSubSection(section) {
    document.querySelectorAll('.sub-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));

    if (section === 'predictions') {
        document.getElementById('predictions-section').classList.add('active');
        document.querySelector('.toggle-btn:first-child').classList.add('active');
        renderPollsGrid();
    } else if (section === 'trivia') {
        document.getElementById('trivia-section').classList.add('active');
        document.querySelector('.toggle-btn:last-child').classList.add('active');
        renderTriviaResults();
        renderTriviaLeaderboard();
    }
}

// ============ POLLS SYSTEM ============

function getPolls() {
    return JSON.parse(localStorage.getItem('trustmyrecord_polls') || '[]');
}

function savePolls(polls) {
    localStorage.setItem('trustmyrecord_polls', JSON.stringify(polls));
}

function seedSamplePolls() {
    var polls = getPolls();
    if (polls.length > 0) return; // Already seeded

    var now = Date.now();
    var samplePolls = [
        {
            id: 'poll_seed_1',
            question: 'Who wins the NBA Finals this season?',
            category: 'nba',
            options: [
                { text: 'Boston Celtics', votes: 12, voters: ['demo1','demo2','demo3','demo4','demo5','demo6','demo7','demo8','demo9','demo10','demo11','demo12'] },
                { text: 'Oklahoma City Thunder', votes: 18, voters: ['d1','d2','d3','d4','d5','d6','d7','d8','d9','d10','d11','d12','d13','d14','d15','d16','d17','d18'] },
                { text: 'Cleveland Cavaliers', votes: 8, voters: ['c1','c2','c3','c4','c5','c6','c7','c8'] },
                { text: 'Denver Nuggets', votes: 5, voters: ['n1','n2','n3','n4','n5'] }
            ],
            createdBy: 'BetLegend',
            createdAt: new Date(now - 172800000).toISOString(),
            expiresAt: new Date(now + 604800000).toISOString(),
            points: 100,
            totalVotes: 43
        },
        {
            id: 'poll_seed_2',
            question: 'Which NFL team will have the best record next season?',
            category: 'nfl',
            options: [
                { text: 'Kansas City Chiefs', votes: 22, voters: Array.from({length:22}, (_,i) => 'kc'+i) },
                { text: 'Philadelphia Eagles', votes: 15, voters: Array.from({length:15}, (_,i) => 'phi'+i) },
                { text: 'Detroit Lions', votes: 10, voters: Array.from({length:10}, (_,i) => 'det'+i) },
                { text: 'Buffalo Bills', votes: 8, voters: Array.from({length:8}, (_,i) => 'buf'+i) }
            ],
            createdBy: 'SharpMoney',
            createdAt: new Date(now - 86400000).toISOString(),
            expiresAt: new Date(now + 1209600000).toISOString(),
            points: 50,
            totalVotes: 55
        },
        {
            id: 'poll_seed_3',
            question: 'Best NHL goalie right now?',
            category: 'nhl',
            options: [
                { text: 'Connor Hellebuyck', votes: 14, voters: Array.from({length:14}, (_,i) => 'hel'+i) },
                { text: 'Igor Shesterkin', votes: 11, voters: Array.from({length:11}, (_,i) => 'igor'+i) },
                { text: 'Sergei Bobrovsky', votes: 6, voters: Array.from({length:6}, (_,i) => 'bob'+i) }
            ],
            createdBy: 'PuckAnalyst',
            createdAt: new Date(now - 43200000).toISOString(),
            expiresAt: new Date(now + 259200000).toISOString(),
            points: 50,
            totalVotes: 31
        },
        {
            id: 'poll_seed_4',
            question: 'Will the Dodgers repeat as World Series champions?',
            category: 'mlb',
            options: [
                { text: 'Yes, they repeat', votes: 20, voters: Array.from({length:20}, (_,i) => 'yes'+i) },
                { text: 'No, someone else wins', votes: 25, voters: Array.from({length:25}, (_,i) => 'no'+i) }
            ],
            createdBy: 'DiamondSharp',
            createdAt: new Date(now - 7200000).toISOString(),
            expiresAt: new Date(now + 2592000000).toISOString(),
            points: 75,
            totalVotes: 45
        }
    ];

    savePolls(samplePolls);
}

function renderPollsGrid(filterCategory) {
    var grid = document.getElementById('pollsGrid');
    if (!grid) return;

    var polls = getPolls();
    var now = new Date();
    var currentUser = (window.auth && window.auth.isLoggedIn()) ? window.auth.getCurrentUser() : null;
    var username = currentUser ? (currentUser.username || '') : '';

    // Filter by category if specified
    if (filterCategory && filterCategory !== 'all') {
        polls = polls.filter(function(p) { return p.category === filterCategory; });
    }

    // Filter out expired polls (move to bottom)
    var active = polls.filter(function(p) { return new Date(p.expiresAt) > now; });
    var expired = polls.filter(function(p) { return new Date(p.expiresAt) <= now; });
    var sorted = active.concat(expired);

    if (sorted.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #6c7380;">' +
            '<div style="font-size: 64px; margin-bottom: 20px;">üìä</div>' +
            '<p style="font-size: 18px; margin-bottom: 10px;">No active polls yet</p>' +
            '<p style="font-size: 14px; opacity: 0.7;">Create a poll to get predictions from the community!</p>' +
            '<button onclick="openCreatePollModal()" style="margin-top: 20px; padding: 12px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Create Poll</button>' +
            '</div>';
        return;
    }

    // Update user poll stats with real data
    var userVoteCount = 0;
    var allPolls = getPolls();
    allPolls.forEach(function(p) {
        p.options.forEach(function(o) {
            if (o.voters && o.voters.indexOf(username) !== -1) userVoteCount++;
        });
    });
    var vcEl = document.getElementById('pollsVoteCount');
    if (vcEl) vcEl.textContent = userVoteCount;

    // Calculate points from polls
    var pollPoints = parseInt(localStorage.getItem('trustMyRecordPollPoints') || '0', 10);
    var ppEl = document.getElementById('pollsPoints');
    if (ppEl) ppEl.textContent = pollPoints;

    // Rank is position among all voters
    var voterMap = {};
    allPolls.forEach(function(p) {
        p.options.forEach(function(o) {
            if (o.voters) o.voters.forEach(function(v) {
                voterMap[v] = (voterMap[v] || 0) + 1;
            });
        });
    });
    var voterList = Object.entries(voterMap).sort(function(a, b) { return b[1] - a[1]; });
    var rank = voterList.findIndex(function(v) { return v[0] === username; });
    var rkEl = document.getElementById('pollsRank');
    if (rkEl) rkEl.textContent = rank >= 0 ? '#' + (rank + 1) : '--';
    var acEl = document.getElementById('pollsAccuracy');
    if (acEl) acEl.textContent = userVoteCount > 0 ? Math.round((userVoteCount / Math.max(allPolls.length, 1)) * 100) + '%' : '--';

    var html = '';
    sorted.forEach(function(poll) {
        var isExpired = new Date(poll.expiresAt) <= now;
        var totalVotes = 0;
        poll.options.forEach(function(o) { totalVotes += (o.votes || 0); });
        var hasVoted = false;
        var votedIndex = -1;
        if (username) {
            poll.options.forEach(function(o, idx) {
                if (o.voters && o.voters.indexOf(username) !== -1) {
                    hasVoted = true;
                    votedIndex = idx;
                }
            });
        }
        var showResults = hasVoted || isExpired;
        var timeLeft = '';
        if (!isExpired) {
            var diff = new Date(poll.expiresAt) - now;
            var days = Math.floor(diff / 86400000);
            var hours = Math.floor((diff % 86400000) / 3600000);
            if (days > 0) timeLeft = days + 'd ' + hours + 'h left';
            else if (hours > 0) timeLeft = hours + 'h left';
            else timeLeft = Math.floor((diff % 3600000) / 60000) + 'm left';
        } else {
            timeLeft = 'Ended';
        }

        var catIcons = { nfl: 'üèà', nba: 'üèÄ', mlb: '‚öæ', nhl: 'üèí', ncaaf: 'üéì', ncaab: 'üè´', soccer: '‚öΩ', other: 'üé≤' };
        var catIcon = catIcons[poll.category] || 'üìä';

        html += '<div class="poll-card" style="background: var(--card-bg); border: 1px solid ' + (isExpired ? '#333' : 'var(--glass-border)') + '; border-radius: 16px; padding: 24px; opacity: ' + (isExpired ? '0.7' : '1') + ';">';
        html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">';
        html += '<span style="background: rgba(102, 126, 234, 0.2); color: #667eea; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">' + catIcon + ' ' + (poll.category || 'general').toUpperCase() + '</span>';
        html += '<span style="color: ' + (isExpired ? '#ff4444' : '#6c7380') + '; font-size: 12px;">' + timeLeft + '</span>';
        html += '</div>';
        html += '<h3 style="color: var(--text-primary); font-size: 1.1rem; margin-bottom: 6px;">' + escapeHtml(poll.question) + '</h3>';
        html += '<p style="color: #6c7380; font-size: 12px; margin-bottom: 16px;">by @' + escapeHtml(poll.createdBy) + ' &middot; ' + totalVotes + ' votes</p>';

        // Options
        poll.options.forEach(function(opt, idx) {
            var pct = totalVotes > 0 ? Math.round((opt.votes / totalVotes) * 100) : 0;
            var isWinner = showResults && pct === Math.max.apply(null, poll.options.map(function(o) { return totalVotes > 0 ? Math.round((o.votes / totalVotes) * 100) : 0; }));
            var isMyVote = votedIndex === idx;

            if (showResults) {
                html += '<div style="position: relative; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 12px 16px; margin-bottom: 8px; overflow: hidden; border: 1px solid ' + (isMyVote ? 'var(--neon-cyan)' : 'transparent') + ';">';
                html += '<div style="position: absolute; top: 0; left: 0; height: 100%; width: ' + pct + '%; background: ' + (isWinner ? 'rgba(0, 200, 83, 0.15)' : 'rgba(102, 126, 234, 0.1)') + '; border-radius: 10px; transition: width 0.5s;"></div>';
                html += '<div style="position: relative; display: flex; justify-content: space-between; align-items: center;">';
                html += '<span style="color: var(--text-primary); font-weight: ' + (isMyVote ? '700' : '500') + ';">' + escapeHtml(opt.text) + (isMyVote ? ' ‚úì' : '') + '</span>';
                html += '<span style="color: ' + (isWinner ? '#00c853' : '#6c7380') + '; font-weight: 700;">' + pct + '%</span>';
                html += '</div></div>';
            } else {
                html += '<button onclick="votePoll(\'' + poll.id + '\',' + idx + ')" style="display: block; width: 100%; text-align: left; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 10px; padding: 12px 16px; margin-bottom: 8px; color: var(--text-primary); cursor: pointer; font-size: 14px; transition: all 0.2s;" onmouseover="this.style.background=\'rgba(102,126,234,0.15)\';this.style.borderColor=\'#667eea\'" onmouseout="this.style.background=\'rgba(255,255,255,0.05)\';this.style.borderColor=\'var(--glass-border)\'">' + escapeHtml(opt.text) + '</button>';
            }
        });

        html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.05);">';
        html += '<span style="color: #6c7380; font-size: 12px;">üèÜ ' + (poll.points || 50) + ' pts</span>';
        html += '<span style="color: #6c7380; font-size: 12px;">' + totalVotes + ' total votes</span>';
        html += '</div>';
        html += '</div>';
    });

    grid.innerHTML = html;
}

function votePoll(pollId, optionIndex) {
    if (!window.auth || !window.auth.isLoggedIn()) {
        alert('Please log in to vote.');
        return;
    }

    var user = window.auth.getCurrentUser();
    var username = user.username || '';
    var polls = getPolls();
    var pollIdx = -1;
    for (var i = 0; i < polls.length; i++) {
        if (polls[i].id === pollId) { pollIdx = i; break; }
    }
    if (pollIdx === -1) return;

    var poll = polls[pollIdx];

    // Check expiry
    if (new Date(poll.expiresAt) <= new Date()) {
        alert('This poll has expired.');
        renderPollsGrid();
        return;
    }

    // Check if already voted
    for (var j = 0; j < poll.options.length; j++) {
        if (poll.options[j].voters && poll.options[j].voters.indexOf(username) !== -1) {
            alert('You already voted on this poll!');
            renderPollsGrid();
            return;
        }
    }

    // Cast vote
    poll.options[optionIndex].votes = (poll.options[optionIndex].votes || 0) + 1;
    if (!poll.options[optionIndex].voters) poll.options[optionIndex].voters = [];
    poll.options[optionIndex].voters.push(username);
    poll.totalVotes = (poll.totalVotes || 0) + 1;

    polls[pollIdx] = poll;
    savePolls(polls);

    renderPollsGrid();
}

function escapeHtml(str) {
    if (!str) return '';
    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function openCreatePollModal() {
    document.getElementById('createPollModal').style.display = 'flex';
}

function closeCreatePollModal() {
    document.getElementById('createPollModal').style.display = 'none';
    document.getElementById('createPollForm').reset();
}

function submitPoll(event) {
    event.preventDefault();

    if (!window.auth || !window.auth.isLoggedIn()) {
        alert('Please log in to create a poll.');
        return;
    }

    var user = window.auth.getCurrentUser();
    var question = document.getElementById('pollQuestion').value.trim();
    var category = document.getElementById('pollCategory').value;
    var opt1 = document.getElementById('pollOption1').value.trim();
    var opt2 = document.getElementById('pollOption2').value.trim();
    var opt3 = document.getElementById('pollOption3').value.trim();
    var opt4 = document.getElementById('pollOption4').value.trim();
    var endTime = document.getElementById('pollEndTime').value;
    var points = document.getElementById('pollPoints').value;

    if (!question || !opt1 || !opt2 || !category) {
        alert('Please fill in the question, category, and at least 2 options.');
        return;
    }

    var options = [
        { text: opt1, votes: 0, voters: [] },
        { text: opt2, votes: 0, voters: [] }
    ];
    if (opt3) options.push({ text: opt3, votes: 0, voters: [] });
    if (opt4) options.push({ text: opt4, votes: 0, voters: [] });

    var poll = {
        id: 'poll_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
        question: question,
        category: category,
        options: options,
        createdBy: user.username || user.displayName || 'Anonymous',
        createdAt: new Date().toISOString(),
        expiresAt: endTime ? new Date(endTime).toISOString() : new Date(Date.now() + 86400000).toISOString(),
        points: parseInt(points) || 50,
        totalVotes: 0
    };

    var polls = JSON.parse(localStorage.getItem('trustmyrecord_polls') || '[]');
    polls.unshift(poll);
    localStorage.setItem('trustmyrecord_polls', JSON.stringify(polls));

    console.log('Poll created:', poll);
    closeCreatePollModal();
    renderPollsGrid();
}

// Sample trivia questions by category
const triviaQuestions = {
    NFL: [
        { q: "Who has the most Super Bowl wins as a quarterback?", a: ["Tom Brady", "Joe Montana", "Terry Bradshaw", "John Elway"], correct: 0 },
        { q: "What team has the most Super Bowl appearances?", a: ["New England Patriots", "Dallas Cowboys", "Pittsburgh Steelers", "San Francisco 49ers"], correct: 0 },
        { q: "Who holds the record for most career passing yards?", a: ["Tom Brady", "Drew Brees", "Peyton Manning", "Brett Favre"], correct: 0 },
        { q: "Which team went undefeated in the regular season in 1972?", a: ["Miami Dolphins", "Chicago Bears", "Green Bay Packers", "Oakland Raiders"], correct: 0 },
        { q: "Who is known as 'The GOAT' in NFL?", a: ["Tom Brady", "Jerry Rice", "Walter Payton", "Jim Brown"], correct: 0 },
        { q: "What is the longest field goal in NFL history?", a: ["66 yards", "64 yards", "63 yards", "65 yards"], correct: 0 },
        { q: "Which QB has thrown the most career touchdowns?", a: ["Tom Brady", "Drew Brees", "Peyton Manning", "Brett Favre"], correct: 0 },
        { q: "What team has the most NFL championships?", a: ["Green Bay Packers", "Chicago Bears", "New York Giants", "Dallas Cowboys"], correct: 0 },
        { q: "Who has the most rushing yards in a single season?", a: ["Eric Dickerson", "Adrian Peterson", "Barry Sanders", "O.J. Simpson"], correct: 0 },
        { q: "Which team won the first Super Bowl?", a: ["Green Bay Packers", "Kansas City Chiefs", "Oakland Raiders", "Baltimore Colts"], correct: 0 }
    ],
    NBA: [
        { q: "Who has the most NBA championships?", a: ["Bill Russell", "Michael Jordan", "LeBron James", "Magic Johnson"], correct: 0 },
        { q: "Who is the all-time leading scorer in NBA history?", a: ["LeBron James", "Kareem Abdul-Jabbar", "Karl Malone", "Kobe Bryant"], correct: 0 },
        { q: "Which player has the most MVP awards?", a: ["Kareem Abdul-Jabbar", "Michael Jordan", "LeBron James", "Bill Russell"], correct: 0 },
        { q: "What team has won the most NBA titles?", a: ["Boston Celtics", "Los Angeles Lakers", "Golden State Warriors", "Chicago Bulls"], correct: 0 },
        { q: "Who holds the record for most points in a single game?", a: ["Wilt Chamberlain (100)", "Kobe Bryant (81)", "Devin Booker (70)", "David Robinson (71)"], correct: 0 },
        { q: "Which player has the most career assists?", a: ["John Stockton", "Magic Johnson", "Chris Paul", "Steve Nash"], correct: 0 },
        { q: "Who won the first NBA championship?", a: ["Philadelphia Warriors", "Boston Celtics", "Minneapolis Lakers", "New York Knicks"], correct: 0 },
        { q: "What player has the most triple-doubles?", a: ["Russell Westbrook", "Oscar Robertson", "Magic Johnson", "LeBron James"], correct: 0 },
        { q: "Who has made the most 3-pointers in NBA history?", a: ["Stephen Curry", "Ray Allen", "Reggie Miller", "James Harden"], correct: 0 },
        { q: "Which team has the best single-season record?", a: ["Golden State Warriors (73-9)", "Chicago Bulls (72-10)", "Lakers (69-13)", "Celtics (68-14)"], correct: 0 }
    ],
    MLB: [
        { q: "Who has the most career home runs?", a: ["Barry Bonds", "Hank Aaron", "Babe Ruth", "Alex Rodriguez"], correct: 0 },
        { q: "What team has won the most World Series?", a: ["New York Yankees", "St. Louis Cardinals", "Boston Red Sox", "San Francisco Giants"], correct: 0 },
        { q: "Who holds the record for most hits?", a: ["Pete Rose", "Ty Cobb", "Hank Aaron", "Stan Musial"], correct: 0 },
        { q: "What pitcher has the most career strikeouts?", a: ["Nolan Ryan", "Randy Johnson", "Roger Clemens", "Steve Carlton"], correct: 0 },
        { q: "Who hit .406 in 1941, the last player over .400?", a: ["Ted Williams", "Joe DiMaggio", "Ty Cobb", "Stan Musial"], correct: 0 },
        { q: "Which player has the longest hitting streak?", a: ["Joe DiMaggio (56)", "Pete Rose (44)", "Willie Keeler (45)", "Jimmy Rollins (38)"], correct: 0 },
        { q: "Who has won the most Cy Young Awards?", a: ["Roger Clemens", "Randy Johnson", "Greg Maddux", "Steve Carlton"], correct: 0 },
        { q: "What is the most stolen bases in a season?", a: ["Rickey Henderson (130)", "Lou Brock (118)", "Vince Coleman (110)", "Tim Raines (90)"], correct: 0 },
        { q: "Who pitched the most no-hitters?", a: ["Nolan Ryan", "Sandy Koufax", "Bob Feller", "Cy Young"], correct: 0 },
        { q: "Which team broke the Curse of the Bambino?", a: ["Boston Red Sox", "Chicago Cubs", "Chicago White Sox", "Cleveland Indians"], correct: 0 }
    ],
    NHL: [
        { q: "Who has won the most Stanley Cups as a franchise?", a: ["Montreal Canadiens", "Toronto Maple Leafs", "Detroit Red Wings", "Boston Bruins"], correct: 0 },
        { q: "Who holds the record for most career goals?", a: ["Wayne Gretzky", "Gordie Howe", "Jaromir Jagr", "Alex Ovechkin"], correct: 0 },
        { q: "Who holds the record for most points in a single season?", a: ["Wayne Gretzky (215)", "Mario Lemieux (199)", "Wayne Gretzky (212)", "Phil Esposito (152)"], correct: 0 },
        { q: "Which goalie has the most career wins?", a: ["Martin Brodeur", "Patrick Roy", "Roberto Luongo", "Ed Belfour"], correct: 0 },
        { q: "Who was the first European-born player to win the Hart Trophy?", a: ["Dominik Hasek", "Jaromir Jagr", "Peter Forsberg", "Sergei Fedorov"], correct: 0 },
        { q: "What year was the NHL founded?", a: ["1917", "1920", "1910", "1925"], correct: 0 },
        { q: "Who scored 'The Goal' in 2010 Olympics for Canada?", a: ["Sidney Crosby", "Jarome Iginla", "Ryan Getzlaf", "Jonathan Toews"], correct: 0 },
        { q: "Which team had the longest winning streak in NHL history?", a: ["Pittsburgh Penguins (17)", "Columbus Blue Jackets (16)", "Boston Bruins (14)", "Montreal Canadiens (12)"], correct: 0 },
        { q: "Who has the most career assists in NHL history?", a: ["Wayne Gretzky", "Ron Francis", "Mark Messier", "Ray Bourque"], correct: 0 },
        { q: "Which goalie recorded the most shutouts in a career?", a: ["Martin Brodeur", "Terry Sawchuk", "George Hainsworth", "Patrick Roy"], correct: 0 },
        { q: "Who was the youngest captain in NHL history?", a: ["Connor McDavid", "Sidney Crosby", "Gabriel Landeskog", "Vincent Lecavalier"], correct: 3 },
        { q: "What is the fastest hat trick in NHL history?", a: ["21 seconds", "44 seconds", "52 seconds", "1 minute 8 seconds"], correct: 0 }
    ],
    Soccer: [
        { q: "What country has won the most FIFA World Cups?", a: ["Brazil", "Germany", "Italy", "Argentina"], correct: 0 },
        { q: "Who holds the record for most international goals?", a: ["Cristiano Ronaldo", "Ali Daei", "Lionel Messi", "Pele"], correct: 0 },
        { q: "Which club has won the most Champions League titles?", a: ["Real Madrid", "AC Milan", "Liverpool", "Barcelona"], correct: 0 },
        { q: "Who won the first FIFA World Cup in 1930?", a: ["Uruguay", "Argentina", "Brazil", "Italy"], correct: 0 },
        { q: "Which player has won the most Ballon d'Or awards?", a: ["Lionel Messi", "Cristiano Ronaldo", "Michel Platini", "Johan Cruyff"], correct: 0 },
        { q: "What is the highest-scoring World Cup game ever?", a: ["Austria 7-5 Switzerland (1954)", "Brazil 6-5 Poland (1938)", "Hungary 10-1 El Salvador (1982)", "Germany 8-0 Saudi Arabia (2002)"], correct: 0 },
        { q: "Who scored the 'Hand of God' goal?", a: ["Diego Maradona", "Pele", "Thierry Henry", "Luis Suarez"], correct: 0 },
        { q: "Which English club has won the most league titles?", a: ["Manchester United", "Liverpool", "Arsenal", "Chelsea"], correct: 0 },
        { q: "Who is the Premier League's all-time top scorer?", a: ["Alan Shearer", "Wayne Rooney", "Andrew Cole", "Sergio Aguero"], correct: 0 },
        { q: "What year did the English Premier League start?", a: ["1992", "1990", "1988", "1995"], correct: 0 },
        { q: "Which country hosted the 2022 FIFA World Cup?", a: ["Qatar", "Russia", "Brazil", "South Africa"], correct: 0 },
        { q: "Who won the 2022 World Cup?", a: ["Argentina", "France", "Brazil", "Croatia"], correct: 0 }
    ],
    Mixed: [
        { q: "Who has the most Super Bowl wins as a QB?", a: ["Tom Brady", "Joe Montana", "Terry Bradshaw", "John Elway"], correct: 0 },
        { q: "Who is the NBA's all-time leading scorer?", a: ["LeBron James", "Kareem Abdul-Jabbar", "Karl Malone", "Kobe Bryant"], correct: 0 },
        { q: "What team has won the most World Series?", a: ["New York Yankees", "St. Louis Cardinals", "Boston Red Sox", "San Francisco Giants"], correct: 0 },
        { q: "Who has won the most Stanley Cups?", a: ["Montreal Canadiens", "Toronto Maple Leafs", "Detroit Red Wings", "Boston Bruins"], correct: 0 },
        { q: "Who has won the most Grand Slam titles in tennis?", a: ["Novak Djokovic", "Rafael Nadal", "Roger Federer", "Pete Sampras"], correct: 0 },
        { q: "What country has won the most FIFA World Cups?", a: ["Brazil", "Germany", "Italy", "Argentina"], correct: 0 },
        { q: "Who has the most Olympic gold medals?", a: ["Michael Phelps", "Usain Bolt", "Carl Lewis", "Paavo Nurmi"], correct: 0 },
        { q: "What golfer has won the most Masters tournaments?", a: ["Jack Nicklaus", "Tiger Woods", "Arnold Palmer", "Gary Player"], correct: 0 },
        { q: "Who is the fastest man in history?", a: ["Usain Bolt", "Tyson Gay", "Yohan Blake", "Asafa Powell"], correct: 0 },
        { q: "What boxer was known as 'The Greatest'?", a: ["Muhammad Ali", "Mike Tyson", "Floyd Mayweather", "Sugar Ray Robinson"], correct: 0 }
    ]
};

function startDailyQuiz() {
    currentQuiz = triviaQuestions.Mixed.slice(0, 10);
    currentQuizProgress = 0;
    currentQuizScore = 0;
    selectedQuizAnswer = null;
    loadQuizQuestion();
    document.getElementById('triviaQuizModal').style.display = 'flex';
}

function startTrivia(category) {
    console.log(`Starting ${category} trivia`);
    // Normalize category: 'nfl' -> 'NFL', 'mixed' -> 'Mixed'
    var catKey = category.toUpperCase();
    if (catKey === 'MIXED') catKey = 'Mixed';
    if (catKey === 'SOCCER') catKey = 'Soccer';
    const questions = triviaQuestions[catKey] || triviaQuestions.Mixed;
    currentQuiz = questions.slice(0, 10);
    currentQuizProgress = 0;
    currentQuizScore = 0;
    selectedQuizAnswer = null;
    loadQuizQuestion();
    document.getElementById('triviaQuizModal').style.display = 'flex';
}

function loadQuizQuestion() {
    if (currentQuizProgress >= currentQuiz.length) {
        finishQuiz();
        return;
    }

    const question = currentQuiz[currentQuizProgress];
    const modal = document.getElementById('triviaQuizModal');

    modal.querySelector('.progress-fill').style.width = ((currentQuizProgress / currentQuiz.length) * 100) + '%';
    modal.querySelector('.progress-text').textContent = `Question ${currentQuizProgress + 1} of ${currentQuiz.length}`;
    modal.querySelector('.quiz-question').textContent = question.q;

    const optionsContainer = modal.querySelector('.quiz-options');
    optionsContainer.innerHTML = question.a.map((answer, idx) => `
        <div class="quiz-option" onclick="selectAnswer(${idx})">
            <span class="option-letter">${String.fromCharCode(65 + idx)}</span>
            <span class="option-text">${answer}</span>
        </div>
    `).join('');

    selectedQuizAnswer = null;
}

function closeQuizModal() {
    var modal = document.getElementById('triviaQuizModal');
    modal.style.display = 'none';
    currentQuiz = null;

    // Restore quiz modal structure if finishQuiz replaced it
    var quizModal = modal.querySelector('.quiz-modal');
    if (quizModal && !quizModal.querySelector('.quiz-header')) {
        quizModal.innerHTML =
            '<div class="quiz-header">' +
            '<div class="quiz-progress"><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div><span class="progress-text">Question 1 of 10</span></div>' +
            '<span class="close-modal" onclick="closeQuizModal()">&times;</span></div>' +
            '<div class="quiz-question"><h3>Loading...</h3></div>' +
            '<div class="quiz-options"></div>' +
            '<button class="submit-answer-btn" onclick="submitAnswer()">SUBMIT ANSWER</button>' +
            '<div class="quiz-stats"></div>';
    }
}

function selectAnswer(answer) {
    document.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    selectedQuizAnswer = answer;
}

function submitAnswer() {
    if (selectedQuizAnswer === null) {
        // Flash the submit button red briefly
        var submitBtn = document.querySelector('.submit-answer-btn');
        if (submitBtn) { submitBtn.style.background = '#ff4444'; submitBtn.textContent = 'SELECT AN ANSWER FIRST'; setTimeout(function() { submitBtn.style.background = ''; submitBtn.textContent = 'SUBMIT ANSWER'; }, 1500); }
        return;
    }

    const question = currentQuiz[currentQuizProgress];
    const isCorrect = selectedQuizAnswer === question.correct;

    // Visual feedback on answer options
    var options = document.querySelectorAll('.quiz-option');
    options.forEach(function(opt, idx) {
        opt.style.pointerEvents = 'none';
        if (idx === question.correct) {
            opt.style.background = 'rgba(0, 200, 83, 0.25)';
            opt.style.border = '2px solid #00c853';
        } else if (idx === selectedQuizAnswer && !isCorrect) {
            opt.style.background = 'rgba(255, 68, 68, 0.25)';
            opt.style.border = '2px solid #ff4444';
        }
    });

    if (isCorrect) {
        currentQuizScore++;
    }

    // Update running stats in the quiz modal
    var statsContainer = document.querySelector('.quiz-stats');
    if (statsContainer) {
        var correctCount = currentQuizScore;
        var wrongCount = (currentQuizProgress + 1) - currentQuizScore;
        statsContainer.innerHTML =
            '<div class="stat-item"><span class="stat-icon">‚úÖ</span><span>' + correctCount + ' Correct</span></div>' +
            '<div class="stat-item"><span class="stat-icon">‚ùå</span><span>' + wrongCount + ' Wrong</span></div>' +
            '<div class="stat-item"><span class="stat-icon">üéØ</span><span>' + (correctCount * 50) + ' pts</span></div>';
    }

    // Show feedback briefly, then advance
    var submitBtn = document.querySelector('.submit-answer-btn');
    if (submitBtn) {
        submitBtn.textContent = isCorrect ? '‚úÖ CORRECT! +50 pts' : '‚ùå Wrong - ' + question.a[question.correct];
        submitBtn.style.background = isCorrect ? 'rgba(0,200,83,0.3)' : 'rgba(255,68,68,0.3)';
        submitBtn.style.color = isCorrect ? '#00c853' : '#ff4444';
        submitBtn.style.pointerEvents = 'none';
    }

    currentQuizProgress++;
    setTimeout(function() {
        if (submitBtn) {
            submitBtn.textContent = 'SUBMIT ANSWER';
            submitBtn.style.background = '';
            submitBtn.style.color = '';
            submitBtn.style.pointerEvents = '';
        }
        loadQuizQuestion();
    }, 1200);
}

function finishQuiz() {
    const percentage = (currentQuizScore / currentQuiz.length) * 100;
    const points = currentQuizScore * 50;
    var user = (window.auth && window.auth.isLoggedIn()) ? window.auth.getCurrentUser() : null;

    // Save score
    const score = {
        score: currentQuizScore,
        total: currentQuiz.length,
        percentage: percentage,
        points: points,
        category: currentTriviaCategory || 'mixed',
        username: user ? user.username : 'Guest',
        date: new Date().toISOString().split('T')[0],
        timestamp: new Date().toISOString()
    };

    triviaScores.unshift(score);
    triviaScores = triviaScores.slice(0, 100); // Keep last 100 scores
    localStorage.setItem('trustMyRecordTriviaScores', JSON.stringify(triviaScores));

    // Show results in modal instead of alert
    var modal = document.getElementById('triviaQuizModal');
    if (modal) {
        var emoji = percentage >= 80 ? 'üèÜ' : percentage >= 60 ? 'üéâ' : percentage >= 40 ? 'üëç' : 'üìö';
        modal.querySelector('.quiz-modal').innerHTML =
            '<div style="text-align: center; padding: 40px 20px;">' +
            '<div style="font-size: 64px; margin-bottom: 20px;">' + emoji + '</div>' +
            '<h2 style="color: var(--text-primary); margin-bottom: 10px;">Quiz Complete!</h2>' +
            '<div style="font-size: 48px; font-weight: 700; color: var(--neon-cyan); margin-bottom: 5px;">' + currentQuizScore + '/' + currentQuiz.length + '</div>' +
            '<div style="color: #6c7380; margin-bottom: 20px;">' + percentage.toFixed(0) + '% correct</div>' +
            '<div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; padding: 16px; margin-bottom: 24px;">' +
            '<span style="color: var(--neon-gold); font-weight: 700; font-size: 24px;">+' + points + '</span>' +
            '<span style="color: #6c7380; margin-left: 8px;">points earned</span>' +
            '</div>' +
            '<button onclick="closeQuizModal()" style="background: linear-gradient(135deg, var(--neon-cyan), #0088cc); color: #000; border: none; padding: 14px 40px; border-radius: 30px; font-weight: 700; cursor: pointer; font-size: 16px; margin-right: 10px;">Done</button>' +
            '<button onclick="closeQuizModal(); startTrivia(\'' + (currentTriviaCategory || 'mixed') + '\')" style="background: var(--card-bg); color: var(--text-primary); border: 1px solid var(--glass-border); padding: 14px 40px; border-radius: 30px; font-weight: 700; cursor: pointer; font-size: 16px;">Play Again</button>' +
            '</div>';
    }

    renderTriviaResults();
    renderTriviaLeaderboard();
    updateTriviaTodayCard();
}

// Enhanced startTrivia to track category
var _originalStartTrivia = startTrivia;
startTrivia = function(category) {
    currentTriviaCategory = category;
    _originalStartTrivia(category);
};

function updateTriviaTodayCard() {
    var today = new Date().toISOString().split('T')[0];
    var todayScores = triviaScores.filter(function(s) { return s.date === today; });
    var allScores = triviaScores;

    var todayBest = todayScores.length > 0 ? Math.max.apply(null, todayScores.map(function(s) { return s.percentage || 0; })) : null;
    var allTimeBest = allScores.length > 0 ? Math.max.apply(null, allScores.map(function(s) { return s.percentage || 0; })) : null;
    var totalPlayed = allScores.length;
    var totalPoints = 0;
    allScores.forEach(function(s) { totalPoints += (s.points || 0); });

    var el1 = document.getElementById('triviaTodayScore');
    var el2 = document.getElementById('triviaAllTimeBest');
    var el3 = document.getElementById('triviaTotalPlayed');
    var el4 = document.getElementById('triviaTotalPoints');

    if (el1) el1.textContent = todayBest !== null ? todayBest.toFixed(0) + '%' : '--';
    if (el2) el2.textContent = allTimeBest !== null ? allTimeBest.toFixed(0) + '%' : '--';
    if (el3) el3.textContent = totalPlayed;
    if (el4) el4.textContent = totalPoints;
}

function renderTriviaResults() {
    var containers = [
        document.getElementById('triviaResultsList'),
        document.getElementById('triviaStandaloneResults')
    ];

    var recentScores = triviaScores.slice(0, 10);
    if (recentScores.length === 0) return;

    var catIcons = { nfl: 'üèà', nba: 'üèÄ', mlb: '‚öæ', nhl: 'üèí', soccer: '‚öΩ', mixed: 'üé≤' };

    var html = '';
    recentScores.forEach(function(s) {
        var icon = catIcons[s.category] || 'üé≤';
        var pctColor = s.percentage >= 80 ? '#00c853' : s.percentage >= 50 ? '#ff9800' : '#ff4444';
        var dateStr = s.date || new Date(s.timestamp).toLocaleDateString();
        html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">';
        html += '<div style="display: flex; align-items: center; gap: 12px;">';
        html += '<span style="font-size: 20px;">' + icon + '</span>';
        html += '<div><div style="color: var(--text-primary); font-weight: 600;">' + (s.category || 'Mixed').toUpperCase() + ' Quiz</div>';
        html += '<div style="color: #6c7380; font-size: 12px;">' + dateStr + '</div></div>';
        html += '</div>';
        html += '<div style="text-align: right;">';
        html += '<div style="color: ' + pctColor + '; font-weight: 700;">' + s.score + '/' + s.total + '</div>';
        html += '<div style="color: var(--neon-gold); font-size: 12px;">+' + (s.points || 0) + ' pts</div>';
        html += '</div></div>';
    });

    containers.forEach(function(el) {
        if (el) el.innerHTML = html;
    });
}

function renderTriviaLeaderboard() {
    var containers = [
        document.getElementById('triviaLeaderboardMini'),
        document.getElementById('triviaStandaloneLeaderboard')
    ];

    // Aggregate scores by username
    var userMap = {};
    triviaScores.forEach(function(s) {
        var name = s.username || 'Guest';
        if (!userMap[name]) userMap[name] = { username: name, totalCorrect: 0, totalQuestions: 0, totalPoints: 0, quizzes: 0 };
        userMap[name].totalCorrect += (s.score || 0);
        userMap[name].totalQuestions += (s.total || 0);
        userMap[name].totalPoints += (s.points || 0);
        userMap[name].quizzes++;
    });

    var leaderboard = Object.values(userMap).sort(function(a, b) { return b.totalPoints - a.totalPoints; }).slice(0, 10);

    if (leaderboard.length === 0) return;

    var medals = ['ü•á', 'ü•à', 'ü•â'];
    var html = '';
    leaderboard.forEach(function(entry, idx) {
        var accuracy = entry.totalQuestions > 0 ? Math.round((entry.totalCorrect / entry.totalQuestions) * 100) : 0;
        html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">';
        html += '<div style="display: flex; align-items: center; gap: 12px;">';
        html += '<span style="font-size: 18px; width: 28px; text-align: center;">' + (idx < 3 ? medals[idx] : '#' + (idx + 1)) + '</span>';
        html += '<div><div style="color: var(--text-primary); font-weight: 600;">@' + escapeHtml(entry.username) + '</div>';
        html += '<div style="color: #6c7380; font-size: 12px;">' + entry.quizzes + ' quizzes &middot; ' + accuracy + '% accuracy</div></div>';
        html += '</div>';
        html += '<div style="color: var(--neon-gold); font-weight: 700;">' + entry.totalPoints + ' pts</div>';
        html += '</div>';
    });

    containers.forEach(function(el) {
        if (el) el.innerHTML = html;
    });
}

// ============ ARENA - HEAD-TO-HEAD CHALLENGES ============

var currentAcceptChallengeId = null;
var arenaFilterMode = 'all';

function getChallenges() {
    return JSON.parse(localStorage.getItem('tmr_challenges') || '[]');
}
function saveChallenges(c) {
    localStorage.setItem('tmr_challenges', JSON.stringify(c));
}

function seedSampleChallenges() {
    var challenges = getChallenges();
    if (challenges.length > 0) return;

    var now = Date.now();
    var samples = [
        {
            id: 'ch_seed_1', creator: 'SharpMoney', opponent: null, sport: 'NBA',
            description: 'Lakers vs Celtics tonight', creatorPick: 'Lakers -4.5',
            opponentPick: null, units: 2, status: 'open',
            createdAt: new Date(now - 7200000).toISOString(), result: null
        },
        {
            id: 'ch_seed_2', creator: 'BetLegend', opponent: 'SharpMoney', sport: 'NFL',
            description: 'Chiefs vs Bills AFC Championship', creatorPick: 'Chiefs -3',
            opponentPick: 'Bills +3', units: 3, status: 'accepted',
            createdAt: new Date(now - 86400000).toISOString(), result: null
        },
        {
            id: 'ch_seed_3', creator: 'DiamondSharp', opponent: 'PuckAnalyst', sport: 'NHL',
            description: 'Panthers vs Rangers game', creatorPick: 'Panthers ML',
            opponentPick: 'Rangers ML', units: 1, status: 'completed',
            createdAt: new Date(now - 172800000).toISOString(),
            result: { winner: 'DiamondSharp', loser: 'PuckAnalyst' }
        }
    ];
    saveChallenges(samples);
}

function openCreateChallengeModal() {
    if (!window.auth || !window.auth.isLoggedIn()) {
        alert('Please log in to create a challenge.');
        return;
    }
    document.getElementById('createChallengeModal').style.display = 'flex';
}

function submitChallenge(event) {
    event.preventDefault();
    if (!window.auth || !window.auth.isLoggedIn()) { alert('Please log in.'); return; }

    var user = window.auth.getCurrentUser();
    var sport = document.getElementById('challengeSport').value;
    var desc = document.getElementById('challengeDescription').value.trim();
    var pick = document.getElementById('challengeCreatorPick').value.trim();
    var units = parseFloat(document.getElementById('challengeUnits').value) || 1;
    var opponent = document.getElementById('challengeOpponent').value.trim().replace('@', '');

    if (!sport || !desc || !pick) { alert('Please fill in all required fields.'); return; }
    units = Math.max(0.5, Math.min(5, units));

    var challenge = {
        id: 'ch_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
        creator: user.username || user.displayName || 'Anonymous',
        opponent: opponent || null,
        sport: sport,
        description: desc,
        creatorPick: pick,
        opponentPick: null,
        units: units,
        status: 'open',
        createdAt: new Date().toISOString(),
        result: null
    };

    var challenges = getChallenges();
    challenges.unshift(challenge);
    saveChallenges(challenges);

    document.getElementById('createChallengeModal').style.display = 'none';
    document.getElementById('createChallengeForm').reset();
    renderChallengesList();
}

function openAcceptChallenge(challengeId) {
    if (!window.auth || !window.auth.isLoggedIn()) { alert('Please log in.'); return; }

    var challenges = getChallenges();
    var ch = challenges.find(function(c) { return c.id === challengeId; });
    if (!ch) return;

    var user = window.auth.getCurrentUser();
    if (ch.creator === (user.username || '')) { alert('You cannot accept your own challenge.'); return; }

    currentAcceptChallengeId = challengeId;
    var details = document.getElementById('acceptChallengeDetails');
    if (details) {
        details.innerHTML =
            '<div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; margin-bottom: 16px;">' +
            '<div style="color: #ff6b35; font-weight: 700; margin-bottom: 8px;">' + escapeHtml(ch.sport) + ' - ' + escapeHtml(ch.description) + '</div>' +
            '<div style="color: var(--text-secondary); font-size: 14px;">@' + escapeHtml(ch.creator) + ' picked: <strong style="color: var(--text-primary);">' + escapeHtml(ch.creatorPick) + '</strong></div>' +
            '<div style="color: var(--neon-gold); font-size: 14px; margin-top: 8px;">' + ch.units + ' units wagered</div>' +
            '</div>';
    }
    document.getElementById('acceptChallengeModal').style.display = 'flex';
}

function confirmAcceptChallenge() {
    if (!currentAcceptChallengeId) return;
    var pick = document.getElementById('acceptChallengePick').value.trim();
    if (!pick) { alert('Please enter your counter pick.'); return; }

    var user = window.auth.getCurrentUser();
    var challenges = getChallenges();
    var idx = challenges.findIndex(function(c) { return c.id === currentAcceptChallengeId; });
    if (idx === -1) return;

    challenges[idx].opponent = user.username || user.displayName || 'Anonymous';
    challenges[idx].opponentPick = pick;
    challenges[idx].status = 'accepted';
    challenges[idx].acceptedAt = new Date().toISOString();

    saveChallenges(challenges);
    document.getElementById('acceptChallengeModal').style.display = 'none';
    document.getElementById('acceptChallengePick').value = '';
    currentAcceptChallengeId = null;
    renderChallengesList();
}

function gradeChallenge(challengeId, winnerId) {
    var challenges = getChallenges();
    var idx = challenges.findIndex(function(c) { return c.id === challengeId; });
    if (idx === -1) return;

    var ch = challenges[idx];
    var loserId = winnerId === ch.creator ? ch.opponent : ch.creator;
    ch.status = 'completed';
    ch.result = { winner: winnerId, loser: loserId };
    ch.completedAt = new Date().toISOString();
    challenges[idx] = ch;
    saveChallenges(challenges);
    renderChallengesList();
}

function filterChallenges(mode, btn) {
    arenaFilterMode = mode;
    // Update tab styles
    document.querySelectorAll('.arena-tab').forEach(function(t) {
        t.style.background = 'transparent';
        t.style.color = '#6c7380';
        t.style.borderColor = '#333';
    });
    if (btn) {
        btn.style.background = 'rgba(255,107,53,0.2)';
        btn.style.color = '#ff6b35';
        btn.style.borderColor = '#ff6b35';
    }
    renderChallengesList();
}

function renderChallengesList() {
    var container = document.getElementById('challengesList');
    if (!container) return;

    var user = (window.auth && window.auth.isLoggedIn()) ? window.auth.getCurrentUser() : null;
    var username = user ? (user.username || '') : '';
    var challenges = getChallenges();

    // Update arena stats
    var myWins = 0, myLosses = 0, myActive = 0, myUnits = 0;
    challenges.forEach(function(ch) {
        if (ch.status === 'completed' && ch.result) {
            if (ch.result.winner === username) { myWins++; myUnits += ch.units; }
            if (ch.result.loser === username) { myLosses++; myUnits -= ch.units; }
        }
        if ((ch.status === 'open' || ch.status === 'accepted') && (ch.creator === username || ch.opponent === username)) myActive++;
    });

    var recEl = document.getElementById('arenaRecord');
    var wrEl = document.getElementById('arenaWinRate');
    var actEl = document.getElementById('arenaActive');
    var unitEl = document.getElementById('arenaUnits');
    if (recEl) recEl.textContent = myWins + '-' + myLosses;
    if (wrEl) wrEl.textContent = (myWins + myLosses > 0 ? Math.round((myWins / (myWins + myLosses)) * 100) : 0) + '%';
    if (actEl) actEl.textContent = myActive;
    if (unitEl) { unitEl.textContent = (myUnits >= 0 ? '+' : '') + myUnits.toFixed(1); unitEl.style.color = myUnits >= 0 ? '#00c853' : '#ff4444'; }

    // Filter
    var filtered = challenges;
    if (arenaFilterMode === 'open') filtered = challenges.filter(function(c) { return c.status === 'open'; });
    else if (arenaFilterMode === 'active') filtered = challenges.filter(function(c) { return c.status === 'accepted'; });
    else if (arenaFilterMode === 'completed') filtered = challenges.filter(function(c) { return c.status === 'completed'; });

    if (filtered.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #6c7380;"><div style="font-size: 48px; margin-bottom: 15px;">‚öîÔ∏è</div><p>No challenges found</p></div>';
        return;
    }

    var sportIcons = { NFL: 'üèà', NBA: 'üèÄ', NHL: 'üèí', MLB: '‚öæ', NCAAF: 'üéì', NCAAB: 'üè´' };
    var html = '';
    filtered.forEach(function(ch) {
        var icon = sportIcons[ch.sport] || 'üéØ';
        var statusColor = ch.status === 'open' ? '#ff9800' : ch.status === 'accepted' ? 'var(--neon-cyan)' : '#00c853';
        var statusLabel = ch.status === 'open' ? 'OPEN' : ch.status === 'accepted' ? 'ACTIVE' : 'COMPLETED';

        html += '<div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 14px; padding: 20px;">';
        html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">';
        html += '<span style="color: ' + statusColor + '; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">' + icon + ' ' + statusLabel + '</span>';
        html += '<span style="color: #6c7380; font-size: 12px;">' + new Date(ch.createdAt).toLocaleDateString() + '</span>';
        html += '</div>';

        html += '<h4 style="color: var(--text-primary); margin-bottom: 8px; font-size: 1rem;">' + escapeHtml(ch.description) + '</h4>';
        html += '<div style="color: var(--neon-gold); font-size: 13px; margin-bottom: 12px;">' + ch.units + ' units</div>';

        // Creator vs Opponent
        html += '<div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 12px; align-items: center; margin-bottom: 12px;">';
        html += '<div style="text-align: center; padding: 12px; background: rgba(255,107,53,0.1); border-radius: 10px;">';
        html += '<div style="color: #ff6b35; font-size: 12px; margin-bottom: 4px;">Creator</div>';
        html += '<div style="color: var(--text-primary); font-weight: 700;">@' + escapeHtml(ch.creator) + '</div>';
        html += '<div style="color: var(--text-secondary); font-size: 13px; margin-top: 4px;">' + escapeHtml(ch.creatorPick) + '</div>';
        html += '</div>';
        html += '<div style="color: #ff6b35; font-weight: 700; font-size: 18px;">VS</div>';
        html += '<div style="text-align: center; padding: 12px; background: rgba(0,255,255,0.1); border-radius: 10px;">';

        if (ch.opponent) {
            html += '<div style="color: var(--neon-cyan); font-size: 12px; margin-bottom: 4px;">Opponent</div>';
            html += '<div style="color: var(--text-primary); font-weight: 700;">@' + escapeHtml(ch.opponent) + '</div>';
            html += '<div style="color: var(--text-secondary); font-size: 13px; margin-top: 4px;">' + escapeHtml(ch.opponentPick || 'Pending...') + '</div>';
        } else {
            html += '<div style="color: #6c7380; font-size: 12px; margin-bottom: 4px;">Waiting</div>';
            html += '<div style="color: #6c7380; font-weight: 700;">Open Spot</div>';
        }
        html += '</div></div>';

        // Action buttons
        if (ch.status === 'open' && ch.creator !== username && username) {
            html += '<button onclick="openAcceptChallenge(\'' + ch.id + '\')" style="width: 100%; background: linear-gradient(135deg, var(--neon-cyan), #0088cc); color: #000; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 700;">Accept Challenge</button>';
        } else if (ch.status === 'accepted' && (ch.creator === username || ch.opponent === username)) {
            html += '<div style="display: flex; gap: 8px;">';
            html += '<button onclick="gradeChallenge(\'' + ch.id + '\',\'' + ch.creator + '\')" style="flex: 1; background: rgba(255,107,53,0.2); color: #ff6b35; border: 1px solid #ff6b35; padding: 8px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 12px;">@' + escapeHtml(ch.creator) + ' Won</button>';
            html += '<button onclick="gradeChallenge(\'' + ch.id + '\',\'' + ch.opponent + '\')" style="flex: 1; background: rgba(0,255,255,0.2); color: var(--neon-cyan); border: 1px solid var(--neon-cyan); padding: 8px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 12px;">@' + escapeHtml(ch.opponent) + ' Won</button>';
            html += '</div>';
        } else if (ch.status === 'completed' && ch.result) {
            var winnerColor = ch.result.winner === username ? '#00c853' : '#ff4444';
            html += '<div style="text-align: center; padding: 10px; background: rgba(' + (ch.result.winner === username ? '0,200,83' : '255,68,68') + ',0.1); border-radius: 8px; color: ' + winnerColor + '; font-weight: 700;">Winner: @' + escapeHtml(ch.result.winner) + ' (+' + ch.units + 'u)</div>';
        }

        html += '</div>';
    });

    container.innerHTML = html;
}

// ============ ARENA MODE TOGGLE & ARENA POLLS ============

var currentArenaMode = 'challenges';
var arenaPolllFilter = 'all';

function switchArenaMode(mode) {
    currentArenaMode = mode;
    var challengeSection = document.getElementById('arenaChallengesSection');
    var pollsSection = document.getElementById('arenaPollsSection');
    var challengeBtn = document.getElementById('arenaModeChallenge');
    var pollsBtn = document.getElementById('arenaModePolls');

    if (mode === 'challenges') {
        if (challengeSection) challengeSection.style.display = 'block';
        if (pollsSection) pollsSection.style.display = 'none';
        if (challengeBtn) { challengeBtn.style.background = 'rgba(255,107,53,0.2)'; challengeBtn.style.color = '#ff6b35'; challengeBtn.style.borderColor = '#ff6b35'; }
        if (pollsBtn) { pollsBtn.style.background = 'transparent'; pollsBtn.style.color = '#6c7380'; pollsBtn.style.borderColor = '#333'; }
        renderChallengesList();
    } else {
        if (challengeSection) challengeSection.style.display = 'none';
        if (pollsSection) pollsSection.style.display = 'block';
        if (pollsBtn) { pollsBtn.style.background = 'rgba(102,126,234,0.2)'; pollsBtn.style.color = '#667eea'; pollsBtn.style.borderColor = '#667eea'; }
        if (challengeBtn) { challengeBtn.style.background = 'transparent'; challengeBtn.style.color = '#6c7380'; challengeBtn.style.borderColor = '#333'; }
        renderArenaPollsList();
    }
}

function filterArenaPolls(category, btn) {
    arenaPolllFilter = category;
    document.querySelectorAll('.arena-poll-filter').forEach(function(t) {
        t.style.background = 'transparent';
        t.style.color = '#6c7380';
        t.style.borderColor = '#333';
    });
    if (btn) {
        btn.style.background = 'rgba(102,126,234,0.2)';
        btn.style.color = '#667eea';
        btn.style.borderColor = '#667eea';
    }
    renderArenaPollsList();
}

function renderArenaPollsList() {
    var container = document.getElementById('arenaPollsList');
    if (!container) return;

    var polls = getPolls();
    var now = new Date();
    var currentUser = (window.auth && window.auth.isLoggedIn()) ? window.auth.getCurrentUser() : null;
    var username = currentUser ? (currentUser.username || '') : '';

    if (arenaPolllFilter && arenaPolllFilter !== 'all') {
        polls = polls.filter(function(p) { return p.category === arenaPolllFilter; });
    }

    var active = polls.filter(function(p) { return new Date(p.expiresAt) > now; });
    var expired = polls.filter(function(p) { return new Date(p.expiresAt) <= now; });
    var sorted = active.concat(expired);

    if (sorted.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #6c7380;">' +
            '<div style="font-size: 64px; margin-bottom: 20px;">üìä</div>' +
            '<p style="font-size: 18px; margin-bottom: 10px;">No polls yet</p>' +
            '<p style="font-size: 14px; opacity: 0.7;">Create a prediction poll for the community!</p>' +
            '<button onclick="openCreatePollModal()" style="margin-top: 20px; padding: 12px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Create Poll</button>' +
            '</div>';
        return;
    }

    var catIcons = { nfl: 'üèà', nba: 'üèÄ', mlb: '‚öæ', nhl: 'üèí', ncaaf: 'üéì', ncaab: 'üè´', soccer: '‚öΩ', other: 'üé≤' };
    var html = '';
    sorted.forEach(function(poll) {
        var isExpired = new Date(poll.expiresAt) <= now;
        var totalVotes = 0;
        poll.options.forEach(function(o) { totalVotes += (o.votes || 0); });
        var hasVoted = false;
        var votedIndex = -1;
        if (username) {
            poll.options.forEach(function(o, idx) {
                if (o.voters && o.voters.indexOf(username) !== -1) { hasVoted = true; votedIndex = idx; }
            });
        }
        var showResults = hasVoted || isExpired;
        var timeLeft = '';
        if (!isExpired) {
            var diff = new Date(poll.expiresAt) - now;
            var days = Math.floor(diff / 86400000);
            var hours = Math.floor((diff % 86400000) / 3600000);
            if (days > 0) timeLeft = days + 'd ' + hours + 'h left';
            else if (hours > 0) timeLeft = hours + 'h left';
            else timeLeft = Math.floor((diff % 3600000) / 60000) + 'm left';
        } else {
            timeLeft = 'Ended';
        }
        var catIcon = catIcons[poll.category] || 'üìä';

        html += '<div style="background: var(--card-bg); border: 1px solid ' + (isExpired ? '#333' : 'var(--glass-border)') + '; border-radius: 14px; padding: 24px; opacity: ' + (isExpired ? '0.7' : '1') + ';">';
        html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">';
        html += '<span style="background: rgba(102,126,234,0.2); color: #667eea; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">' + catIcon + ' ' + (poll.category || 'general').toUpperCase() + '</span>';
        html += '<span style="color: ' + (isExpired ? '#ff4444' : '#6c7380') + '; font-size: 12px;">' + timeLeft + '</span>';
        html += '</div>';
        html += '<h4 style="color: var(--text-primary); font-size: 1.1rem; margin-bottom: 6px;">' + escapeHtml(poll.question) + '</h4>';
        html += '<p style="color: #6c7380; font-size: 12px; margin-bottom: 16px;">by @' + escapeHtml(poll.createdBy) + ' &middot; ' + totalVotes + ' votes</p>';

        poll.options.forEach(function(opt, idx) {
            var pct = totalVotes > 0 ? Math.round((opt.votes / totalVotes) * 100) : 0;
            var isWinner = showResults && pct === Math.max.apply(null, poll.options.map(function(o) { return totalVotes > 0 ? Math.round((o.votes / totalVotes) * 100) : 0; }));
            var isMyVote = votedIndex === idx;

            if (showResults) {
                html += '<div style="position: relative; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 12px 16px; margin-bottom: 8px; overflow: hidden; border: 1px solid ' + (isMyVote ? 'var(--neon-cyan)' : 'transparent') + ';">';
                html += '<div style="position: absolute; top: 0; left: 0; height: 100%; width: ' + pct + '%; background: ' + (isWinner ? 'rgba(0,200,83,0.15)' : 'rgba(102,126,234,0.1)') + '; border-radius: 10px;"></div>';
                html += '<div style="position: relative; display: flex; justify-content: space-between;">';
                html += '<span style="color: var(--text-primary); font-weight: ' + (isMyVote ? '700' : '500') + ';">' + escapeHtml(opt.text) + (isMyVote ? ' ‚úì' : '') + '</span>';
                html += '<span style="color: ' + (isWinner ? '#00c853' : '#6c7380') + '; font-weight: 700;">' + pct + '%</span>';
                html += '</div></div>';
            } else {
                html += '<button onclick="votePoll(\'' + poll.id + '\',' + idx + '); renderArenaPollsList();" style="display: block; width: 100%; text-align: left; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 10px; padding: 12px 16px; margin-bottom: 8px; color: var(--text-primary); cursor: pointer; font-size: 14px; transition: all 0.2s;" onmouseover="this.style.background=\'rgba(102,126,234,0.15)\'" onmouseout="this.style.background=\'rgba(255,255,255,0.05)\'">' + escapeHtml(opt.text) + '</button>';
            }
        });

        html += '<div style="display: flex; justify-content: space-between; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.05);">';
        html += '<span style="color: #6c7380; font-size: 12px;">üèÜ ' + (poll.points || 50) + ' pts</span>';
        html += '<span style="color: #6c7380; font-size: 12px;">' + totalVotes + ' votes</span>';
        html += '</div>';
        html += '</div>';
    });

    container.innerHTML = html;
}

// ============ CONTESTS SYSTEM ============

function getContests() {
    return JSON.parse(localStorage.getItem('tmr_contests') || '[]');
}
function saveContests(c) {
    localStorage.setItem('tmr_contests', JSON.stringify(c));
}

function seedWeeklyContest() {
    var contests = getContests();
    // Check if there's an active contest this week
    var now = new Date();
    var weekStart = new Date(now);
    weekStart.setDate(now.getDate() - now.getDay()); // Sunday
    weekStart.setHours(0, 0, 0, 0);

    var hasThisWeek = contests.some(function(c) {
        return new Date(c.weekStart) >= weekStart;
    });
    if (hasThisWeek) return;

    // Create sample contest
    var weekEnd = new Date(weekStart);
    weekEnd.setDate(weekEnd.getDate() + 7);

    var contest = {
        id: 'contest_' + Date.now(),
        title: 'Weekly Pick Challenge',
        description: 'Pick the winners of these featured games. Most correct picks wins!',
        weekStart: weekStart.toISOString(),
        weekEnd: weekEnd.toISOString(),
        status: 'active',
        games: [
            { id: 'g1', away: 'Team A', home: 'Team B', sport: 'NBA', description: 'NBA Featured Game 1' },
            { id: 'g2', away: 'Team C', home: 'Team D', sport: 'NFL', description: 'NFL Featured Game' },
            { id: 'g3', away: 'Team E', home: 'Team F', sport: 'NHL', description: 'NHL Featured Game' },
            { id: 'g4', away: 'Team G', home: 'Team H', sport: 'NBA', description: 'NBA Featured Game 2' },
            { id: 'g5', away: 'Team I', home: 'Team J', sport: 'MLB', description: 'MLB Featured Game' }
        ],
        entries: [
            { username: 'SharpMoney', picks: [{gameId:'g1',selection:'Team A'},{gameId:'g2',selection:'Team D'},{gameId:'g3',selection:'Team E'},{gameId:'g4',selection:'Team H'},{gameId:'g5',selection:'Team I'}], score: 3, submitted: true },
            { username: 'DiamondSharp', picks: [{gameId:'g1',selection:'Team B'},{gameId:'g2',selection:'Team C'},{gameId:'g3',selection:'Team F'},{gameId:'g4',selection:'Team G'},{gameId:'g5',selection:'Team J'}], score: 2, submitted: true }
        ],
        results: {}
    };

    contests.unshift(contest);
    saveContests(contests);
}

function renderContests() {
    var container = document.getElementById('contestsList');
    if (!container) return;

    var user = (window.auth && window.auth.isLoggedIn()) ? window.auth.getCurrentUser() : null;
    var username = user ? (user.username || '') : '';
    var contests = getContests();

    if (contests.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #6c7380;"><div style="font-size: 48px; margin-bottom: 15px;">üèÜ</div><p>No contests available yet. Check back soon!</p></div>';
        return;
    }

    var html = '';
    contests.forEach(function(contest) {
        var isActive = contest.status === 'active' && new Date(contest.weekEnd) > new Date();
        var hasEntered = contest.entries.some(function(e) { return e.username === username; });
        var daysLeft = isActive ? Math.ceil((new Date(contest.weekEnd) - new Date()) / 86400000) : 0;

        html += '<div style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 24px; margin-bottom: 20px;">';
        html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">';
        html += '<div>';
        html += '<h3 style="color: var(--text-primary); margin: 0 0 4px 0;">' + escapeHtml(contest.title) + '</h3>';
        html += '<p style="color: #6c7380; font-size: 13px; margin: 0;">' + escapeHtml(contest.description) + '</p>';
        html += '</div>';
        html += '<span style="background: ' + (isActive ? 'rgba(0,200,83,0.15)' : 'rgba(255,255,255,0.05)') + '; color: ' + (isActive ? '#00c853' : '#6c7380') + '; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600;">' + (isActive ? daysLeft + 'd left' : 'Ended') + '</span>';
        html += '</div>';

        // Games list
        html += '<div style="margin-bottom: 16px;">';
        contest.games.forEach(function(game, gIdx) {
            var myPick = '';
            if (hasEntered) {
                var entry = contest.entries.find(function(e) { return e.username === username; });
                if (entry) {
                    var pick = entry.picks.find(function(p) { return p.gameId === game.id; });
                    if (pick) myPick = pick.selection;
                }
            }
            html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">';
            html += '<div style="color: var(--text-primary); font-size: 14px;">' + escapeHtml(game.away) + ' @ ' + escapeHtml(game.home) + '</div>';
            if (myPick) {
                html += '<span style="color: var(--neon-cyan); font-size: 13px; font-weight: 600;">' + escapeHtml(myPick) + '</span>';
            } else if (isActive && !hasEntered) {
                html += '<span style="color: #6c7380; font-size: 12px;">Pick needed</span>';
            }
            html += '</div>';
        });
        html += '</div>';

        // Entry/Standings
        if (isActive && !hasEntered && username) {
            html += '<button onclick="openContestEntry(\'' + contest.id + '\')" style="width: 100%; background: linear-gradient(135deg, var(--neon-gold), #cc9900); color: #000; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 15px;">ENTER CONTEST</button>';
        } else if (hasEntered) {
            html += '<div style="text-align: center; padding: 8px; background: rgba(0,255,255,0.1); border-radius: 8px; color: var(--neon-cyan); font-weight: 600; font-size: 13px; margin-bottom: 12px;">You are entered!</div>';
        }

        // Standings
        if (contest.entries.length > 0) {
            var sorted = contest.entries.slice().sort(function(a, b) { return (b.score || 0) - (a.score || 0); });
            html += '<h4 style="color: var(--text-primary); margin: 16px 0 8px;">Standings</h4>';
            sorted.forEach(function(entry, rank) {
                var isMe = entry.username === username;
                html += '<div style="display: flex; justify-content: space-between; padding: 8px 12px; border-radius: 8px; margin-bottom: 4px; background: ' + (isMe ? 'rgba(0,255,255,0.1)' : 'transparent') + ';">';
                html += '<span style="color: ' + (isMe ? 'var(--neon-cyan)' : 'var(--text-primary)') + '; font-weight: ' + (isMe ? '700' : '500') + ';">#' + (rank + 1) + ' @' + escapeHtml(entry.username) + '</span>';
                html += '<span style="color: var(--neon-gold); font-weight: 700;">' + (entry.score || 0) + '/' + contest.games.length + '</span>';
                html += '</div>';
            });
        }

        html += '</div>';
    });

    container.innerHTML = html;
}

function openContestEntry(contestId) {
    if (!window.auth || !window.auth.isLoggedIn()) { alert('Please log in to enter.'); return; }

    var contests = getContests();
    var contest = contests.find(function(c) { return c.id === contestId; });
    if (!contest) return;

    // Build a simple pick form
    var html = '<h3 style="color: var(--neon-gold); margin-bottom: 16px;">Make Your Picks</h3>';
    contest.games.forEach(function(game) {
        html += '<div style="margin-bottom: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 10px;">';
        html += '<div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 8px;">' + escapeHtml(game.description) + '</div>';
        html += '<div style="display: flex; gap: 8px;">';
        html += '<button onclick="selectContestPick(\'' + game.id + '\',\'' + game.away + '\',this)" class="contest-pick-btn" style="flex: 1; padding: 10px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-primary); cursor: pointer; font-weight: 600;">' + escapeHtml(game.away) + '</button>';
        html += '<button onclick="selectContestPick(\'' + game.id + '\',\'' + game.home + '\',this)" class="contest-pick-btn" style="flex: 1; padding: 10px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-primary); cursor: pointer; font-weight: 600;">' + escapeHtml(game.home) + '</button>';
        html += '</div></div>';
    });
    html += '<button onclick="submitContestEntry(\'' + contestId + '\')" style="width: 100%; background: linear-gradient(135deg, var(--neon-gold), #cc9900); color: #000; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 16px; margin-top: 12px;">SUBMIT PICKS</button>';

    // Show in a simple modal
    var modal = document.getElementById('createChallengeModal');
    if (modal) {
        window._contestPicks = {};
        window._currentContestId = contestId;
        var inner = modal.querySelector('.modal-content');
        inner.innerHTML = '<span class="close-modal" onclick="document.getElementById(\'createChallengeModal\').style.display=\'none\'">&times;</span>' + html;
        modal.style.display = 'flex';
    }
}

function selectContestPick(gameId, selection, btn) {
    window._contestPicks = window._contestPicks || {};
    window._contestPicks[gameId] = selection;

    // Visual feedback
    var parent = btn.parentElement;
    parent.querySelectorAll('.contest-pick-btn').forEach(function(b) {
        b.style.borderColor = 'var(--glass-border)';
        b.style.background = 'var(--card-bg)';
    });
    btn.style.borderColor = 'var(--neon-gold)';
    btn.style.background = 'rgba(255,215,0,0.15)';
}

function submitContestEntry(contestId) {
    var user = window.auth.getCurrentUser();
    var contests = getContests();
    var idx = contests.findIndex(function(c) { return c.id === contestId; });
    if (idx === -1) return;

    var contest = contests[idx];
    var picks = [];
    var allPicked = true;
    contest.games.forEach(function(game) {
        var sel = window._contestPicks ? window._contestPicks[game.id] : null;
        if (!sel) allPicked = false;
        picks.push({ gameId: game.id, selection: sel || '' });
    });

    if (!allPicked) { alert('Please make a pick for every game.'); return; }

    contest.entries.push({
        username: user.username || 'Anonymous',
        picks: picks,
        score: 0,
        submitted: true
    });

    contests[idx] = contest;
    saveContests(contests);

    document.getElementById('createChallengeModal').style.display = 'none';
    renderContests();
}

// PROFILE MANAGEMENT SYSTEM

// Futuristic stats display with proper empty state handling
function updateProfileStatsDisplay(stats) {
    const allPicks = window._cachedBackendPicks || [];

    const totalPicks = allPicks.length;
    const wins = allPicks.filter(p => p.status === 'won').length;
    const losses = allPicks.filter(p => p.status === 'lost').length;
    const graded = wins + losses;

    // Calculate units from backend result_units
    let totalUnits = 0;
    allPicks.forEach(p => {
        totalUnits += (parseFloat(p.result_units) || 0);
    });

    // Calculate win rate
    const winRate = graded > 0 ? ((wins / graded) * 100).toFixed(1) : null;

    // Calculate ROI
    const totalRisked = graded;
    const roi = totalRisked > 0 ? ((totalUnits / totalRisked) * 100).toFixed(1) : null;

    // Calculate streak
    let streak = 0;
    let streakType = '';
    const sortedPicks = [...allPicks].reverse();
    for (const p of sortedPicks) {
        const result = p.status || p.result;
        if (!result || result === 'pending') continue;
        if (streakType === '') {
            streakType = result;
            streak = 1;
        } else if (result === streakType) {
            streak++;
        } else {
            break;
        }
    }

    // Helper to update stat box
    function updateStatBox(id, boxId, value, format = 'default') {
        const el = document.getElementById(id);
        const box = document.getElementById(boxId);
        if (!el) return;

        if (value === null || value === undefined || (typeof value === 'number' && isNaN(value))) {
            el.textContent = '‚Äî';
            if (box) {
                box.classList.add('no-data');
                box.classList.remove('positive', 'negative');
            }
            return;
        }

        let displayValue = value;
        let isPositive = false;
        let isNegative = false;

        switch (format) {
            case 'percent':
                displayValue = value + '%';
                isPositive = parseFloat(value) >= 55;
                isNegative = parseFloat(value) < 50;
                break;
            case 'units':
                const prefix = value >= 0 ? '+' : '';
                displayValue = prefix + parseFloat(value).toFixed(1) + 'u';
                isPositive = value > 0;
                isNegative = value < 0;
                break;
            case 'roi':
                const roiPrefix = value >= 0 ? '+' : '';
                displayValue = roiPrefix + value + '%';
                isPositive = parseFloat(value) > 0;
                isNegative = parseFloat(value) < 0;
                break;
            case 'streak':
                if (streak > 0) {
                    displayValue = (streakType === 'won' ? 'W' : 'L') + streak;
                    isPositive = streakType === 'won';
                    isNegative = streakType === 'lost';
                } else {
                    displayValue = '‚Äî';
                }
                break;
            case 'record':
                displayValue = wins + '-' + losses;
                break;
        }

        el.textContent = displayValue;

        if (box) {
            box.classList.remove('no-data', 'positive', 'negative');
            if (isPositive) box.classList.add('positive');
            if (isNegative) box.classList.add('negative');
        }
    }

    // Update all stat boxes
    updateStatBox('profileTotalPicks', 'statBoxPicks', totalPicks > 0 ? totalPicks : null);
    updateStatBox('profileWinRate', 'statBoxWinRate', graded > 0 ? winRate : null, 'percent');
    updateStatBox('profileUnits', 'statBoxUnits', graded > 0 ? totalUnits : null, 'units');
    updateStatBox('profileROI', 'statBoxROI', graded > 0 ? roi : null, 'roi');
    updateStatBox('profileStreak', 'statBoxStreak', streak > 0 ? streak : null, 'streak');
    updateStatBox('profileRecord', 'statBoxRecord', graded > 0 ? true : null, 'record');
}

function loadUserProfile() {
    // Merge auth user data with profile data for complete picture
    var profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
    var authUser = null;
    if (window.auth && window.auth.isLoggedIn()) {
        authUser = window.auth.getCurrentUser();
    }

    // Auth user takes priority, then profile, then defaults
    var displayName = (authUser && authUser.displayName) || profile.displayName || 'Your Name';
    var username = (authUser && authUser.username) || profile.username || 'username';
    var bio = profile.bio || (authUser && authUser.bio) || 'No bio yet. Click "Edit Profile" to add one.';
    var avatar = profile.avatar || (authUser && authUser.avatar) || 'üë§';

    // Update profile display
    var nameEl = document.getElementById('profileDisplayName');
    if (nameEl) nameEl.textContent = displayName;
    var userEl = document.getElementById('profileUsername');
    if (userEl) userEl.textContent = username;
    var bioEl = document.getElementById('profileBio');
    if (bioEl) bioEl.textContent = bio;

    // Update avatar
    var avatarDisplays = document.querySelectorAll('.avatar-display');
    avatarDisplays.forEach(function(el) { el.textContent = avatar; });

    // Ensure backend picks are loaded for stats
    if (!window._cachedBackendPicks || window._cachedBackendPicks.length === 0) {
        ensureBackendPicks();
    }

    // Calculate and display points
    var stats = calculateUserStats();
    var triviaPoints = stats.triviaPoints || 0;

    // Calculate poll points from actual poll data
    var pollPoints = 0;
    var polls = [];
    try { polls = JSON.parse(localStorage.getItem('trustmyrecord_polls') || '[]'); } catch(e) {}
    polls.forEach(function(poll) {
        poll.options.forEach(function(opt) {
            if (opt.voters && opt.voters.indexOf(username) !== -1) {
                pollPoints += 10; // points per vote
            }
        });
    });

    var totalPoints = triviaPoints + pollPoints;

    var trivPtsEl = document.getElementById('profileTriviaPoints');
    if (trivPtsEl) trivPtsEl.textContent = triviaPoints;
    var pollPtsEl = document.getElementById('profilePollPoints');
    if (pollPtsEl) pollPtsEl.textContent = pollPoints;
    var totalPtsEl = document.getElementById('profileTotalPoints');
    if (totalPtsEl) totalPtsEl.textContent = totalPoints;

    // Update profile stats with proper formatting
    updateProfileStatsDisplay(stats);

    // Merge and store back for edit form
    profile.displayName = displayName;
    profile.username = username;
    profile.bio = bio;
    profile.avatar = avatar;

    return profile;
}

function openProfileEditor() {
    const profile = loadUserProfile();
    document.getElementById('editDisplayName').value = profile.displayName || '';
    document.getElementById('editUsername').value = profile.username || '';
    document.getElementById('editBio').value = profile.bio || '';
    document.getElementById('editAvatar').value = profile.avatar || 'üë§';
    document.getElementById('profileEditModal').style.display = 'flex';
}

function closeProfileEditor() {
    document.getElementById('profileEditModal').style.display = 'none';
}

function changeAvatar() {
    openProfileEditor();
}

function editFavoriteTeams() {
    openTeamSelector();
}

// TEAM DATA
const ALL_TEAMS = {
    nba: [
        'Atlanta Hawks', 'Boston Celtics', 'Brooklyn Nets', 'Charlotte Hornets', 'Chicago Bulls',
        'Cleveland Cavaliers', 'Dallas Mavericks', 'Denver Nuggets', 'Detroit Pistons', 'Golden State Warriors',
        'Houston Rockets', 'Indiana Pacers', 'LA Clippers', 'Los Angeles Lakers', 'Memphis Grizzlies',
        'Miami Heat', 'Milwaukee Bucks', 'Minnesota Timberwolves', 'New Orleans Pelicans', 'New York Knicks',
        'Oklahoma City Thunder', 'Orlando Magic', 'Philadelphia 76ers', 'Phoenix Suns', 'Portland Trail Blazers',
        'Sacramento Kings', 'San Antonio Spurs', 'Toronto Raptors', 'Utah Jazz', 'Washington Wizards'
    ],
    nfl: [
        'Arizona Cardinals', 'Atlanta Falcons', 'Baltimore Ravens', 'Buffalo Bills', 'Carolina Panthers',
        'Chicago Bears', 'Cincinnati Bengals', 'Cleveland Browns', 'Dallas Cowboys', 'Denver Broncos',
        'Detroit Lions', 'Green Bay Packers', 'Houston Texans', 'Indianapolis Colts', 'Jacksonville Jaguars',
        'Kansas City Chiefs', 'Las Vegas Raiders', 'Los Angeles Chargers', 'Los Angeles Rams', 'Miami Dolphins',
        'Minnesota Vikings', 'New England Patriots', 'New Orleans Saints', 'New York Giants', 'New York Jets',
        'Philadelphia Eagles', 'Pittsburgh Steelers', 'San Francisco 49ers', 'Seattle Seahawks', 'Tampa Bay Buccaneers',
        'Tennessee Titans', 'Washington Commanders'
    ],
    mlb: [
        'Arizona Diamondbacks', 'Atlanta Braves', 'Baltimore Orioles', 'Boston Red Sox', 'Chicago Cubs',
        'Chicago White Sox', 'Cincinnati Reds', 'Cleveland Guardians', 'Colorado Rockies', 'Detroit Tigers',
        'Houston Astros', 'Kansas City Royals', 'Los Angeles Angels', 'Los Angeles Dodgers', 'Miami Marlins',
        'Milwaukee Brewers', 'Minnesota Twins', 'New York Mets', 'New York Yankees', 'Oakland Athletics',
        'Philadelphia Phillies', 'Pittsburgh Pirates', 'San Diego Padres', 'San Francisco Giants', 'Seattle Mariners',
        'St. Louis Cardinals', 'Tampa Bay Rays', 'Texas Rangers', 'Toronto Blue Jays', 'Washington Nationals'
    ],
    nhl: [
        'Anaheim Ducks', 'Arizona Coyotes', 'Boston Bruins', 'Buffalo Sabres', 'Calgary Flames',
        'Carolina Hurricanes', 'Chicago Blackhawks', 'Colorado Avalanche', 'Columbus Blue Jackets', 'Dallas Stars',
        'Detroit Red Wings', 'Edmonton Oilers', 'Florida Panthers', 'Los Angeles Kings', 'Minnesota Wild',
        'Montreal Canadiens', 'Nashville Predators', 'New Jersey Devils', 'New York Islanders', 'New York Rangers',
        'Ottawa Senators', 'Philadelphia Flyers', 'Pittsburgh Penguins', 'San Jose Sharks', 'Seattle Kraken',
        'St. Louis Blues', 'Tampa Bay Lightning', 'Toronto Maple Leafs', 'Vancouver Canucks', 'Vegas Golden Knights',
        'Washington Capitals', 'Winnipeg Jets'
    ]
};

const SPORT_ICONS = { nba: 'üèÄ', nfl: 'üèà', mlb: '‚öæ', nhl: 'üèí' };

let selectedTeamsTemp = [];

function openTeamSelector() {
    const profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
    selectedTeamsTemp = profile.favoriteTeams || [];
    renderTeamSelector('all');
    document.getElementById('teamSelectorModal').style.display = 'flex';
}

function closeTeamSelector() {
    document.getElementById('teamSelectorModal').style.display = 'none';
}

function filterTeamsBySport(sport) {
    document.querySelectorAll('.sport-filter-tab').forEach(t => t.classList.remove('active'));
    event.currentTarget.classList.add('active');
    renderTeamSelector(sport);
}

function renderTeamSelector(sportFilter) {
    const grid = document.getElementById('teamSelectorGrid');
    let html = '';

    const sportsToShow = sportFilter === 'all' ? ['nba', 'nfl', 'mlb', 'nhl'] : [sportFilter];

    sportsToShow.forEach(sport => {
        ALL_TEAMS[sport].forEach(team => {
            const isSelected = selectedTeamsTemp.some(t => t.name === team);
            html += `
                <div class="team-select-item ${isSelected ? 'selected' : ''}" onclick="toggleTeamSelection('${sport}', '${team}', this)">
                    <span>${SPORT_ICONS[sport]}</span>
                    <span>${team}</span>
                </div>
            `;
        });
    });

    grid.innerHTML = html;
}

function toggleTeamSelection(sport, teamName, element) {
    const index = selectedTeamsTemp.findIndex(t => t.name === teamName);

    if (index > -1) {
        selectedTeamsTemp.splice(index, 1);
        element.classList.remove('selected');
    } else {
        if (selectedTeamsTemp.length >= 10) {
            alert('Maximum 10 teams allowed');
            return;
        }
        selectedTeamsTemp.push({ sport, name: teamName, icon: SPORT_ICONS[sport] });
        element.classList.add('selected');
    }
}

function saveSelectedTeams() {
    const profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
    profile.favoriteTeams = selectedTeamsTemp;
    localStorage.setItem('trustMyRecordProfile', JSON.stringify(profile));

    updateFavoriteTeamsDisplay();
    closeTeamSelector();
    alert('Teams saved!');
}

function updateFavoriteTeamsDisplay() {
    const profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
    const teams = profile.favoriteTeams || [];
    const container = document.getElementById('profileFavoriteTeams');
    const noTeamsMsg = document.getElementById('noTeamsMessage');

    if (!container) return;

    if (teams.length === 0) {
        container.innerHTML = `
            <p class="no-data-message" id="noTeamsMessage">No teams selected yet.</p>
            <button class="add-teams-btn" onclick="openTeamSelector()">+ Add Your Teams</button>
        `;
    } else {
        let html = teams.map(t => `
            <div class="team-badge">
                ${t.icon} ${t.name}
                <span class="remove-team" onclick="removeTeam('${t.name}')">&times;</span>
            </div>
        `).join('');
        html += `<button class="add-teams-btn" onclick="openTeamSelector()">+ Edit</button>`;
        container.innerHTML = html;
    }
}

function removeTeam(teamName) {
    const profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
    profile.favoriteTeams = (profile.favoriteTeams || []).filter(t => t.name !== teamName);
    localStorage.setItem('trustMyRecordProfile', JSON.stringify(profile));
    updateFavoriteTeamsDisplay();
}

// Avatar functions
function uploadProfileImage() {
    document.getElementById('avatarFileInput')?.click() ||
    alert('Upload feature ready - add file input to profile form');
}

function handleAvatarUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const imageData = e.target.result;
        const profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
        profile.avatarImage = imageData;
        localStorage.setItem('trustMyRecordProfile', JSON.stringify(profile));

        const avatarImg = document.getElementById('profileAvatarImage');
        if (avatarImg) avatarImg.src = imageData;

        alert('Profile image updated!');
    };
    reader.readAsDataURL(file);
}

function setDefaultAvatar(type) {
    const maleSvg = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='30' r='22' fill='%234a90d9'/%3E%3Crect x='35' y='52' width='30' height='8' fill='%234a90d9'/%3E%3Cellipse cx='50' cy='80' rx='30' ry='22' fill='%234a90d9'/%3E%3C/svg%3E";
    const femaleSvg = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='28' r='20' fill='%23e75480'/%3E%3Cellipse cx='50' cy='75' rx='28' ry='28' fill='%23e75480'/%3E%3C/svg%3E";

    const avatarSrc = type === 'male' ? maleSvg : femaleSvg;

    const profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
    profile.avatarImage = avatarSrc;
    profile.avatarType = type;
    localStorage.setItem('trustMyRecordProfile', JSON.stringify(profile));

    const avatarImg = document.getElementById('profileAvatarImage');
    if (avatarImg) avatarImg.src = avatarSrc;
}

// Load real activity from localStorage
function loadRealActivity() {
    const container = document.getElementById('profileRecentActivity');
    if (!container) return;

    const picks = window._cachedBackendPicks || [];
    const triviaScores = JSON.parse(localStorage.getItem('trustMyRecordTriviaScores') || '[]');
    const pollVotes = JSON.parse(localStorage.getItem('trustMyRecordPollVotes') || '{}');

    let activities = [];

    // Add picks from backend
    picks.slice(0, 5).forEach(pick => {
        const pickDisplay = pick.selection + (pick.line_snapshot ? ' ' + pick.line_snapshot : '');
        activities.push({
            icon: 'üéØ',
            text: `Made a pick: ${pickDisplay}`,
            time: pick.locked_at || pick.commence_time,
            type: 'pick'
        });
    });

    // Add trivia
    triviaScores.slice(0, 3).forEach(score => {
        activities.push({
            icon: 'üß†',
            text: `Completed trivia (${score.correct}/${score.total})`,
            time: score.timestamp || new Date().toISOString(),
            type: 'trivia'
        });
    });

    // Sort by time
    activities.sort((a, b) => new Date(b.time) - new Date(a.time));

    if (activities.length === 0) {
        container.innerHTML = '<p class="no-data-message">No activity yet. Make picks, vote in polls, or take trivia to see your activity here!</p>';
        return;
    }

    const html = activities.slice(0, 8).map(act => {
        const timeAgo = getTimeAgo(act.time);
        return `
            <div class="activity-item">
                <span class="activity-icon">${act.icon}</span>
                <span class="activity-text">${act.text}</span>
                <span class="activity-time">${timeAgo}</span>
            </div>
        `;
    }).join('');

    container.innerHTML = html;
}

function getTimeAgo(timestamp) {
    const now = new Date();
    const time = new Date(timestamp);
    const diff = Math.floor((now - time) / 1000);

    if (diff < 60) return 'just now';
    if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
    if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
    return Math.floor(diff / 86400) + 'd ago';
}

// Load real achievements
function loadRealAchievements() {
    const container = document.getElementById('profileAchievements');
    if (!container) return;

    const stats = calculateUserStats();
    const picks = window._cachedBackendPicks || [];

    let achievements = [];

    if (picks.length >= 1) achievements.push({ icon: 'üéØ', title: 'First Pick' });
    if (picks.length >= 10) achievements.push({ icon: 'üìä', title: '10 Picks' });
    if (picks.length >= 50) achievements.push({ icon: 'üèÜ', title: '50 Picks' });
    if (parseFloat(stats.winRate) >= 55) achievements.push({ icon: 'üî•', title: 'Sharp Bettor' });
    if (parseFloat(stats.totalUnits) > 5) achievements.push({ icon: 'üí∞', title: 'Profitable' });
    if (stats.triviaPoints >= 100) achievements.push({ icon: 'üß†', title: 'Trivia Master' });

    if (achievements.length === 0) {
        container.innerHTML = '<p class="no-data-message" id="noAchievementsMessage">Complete activities to earn badges!</p>';
        return;
    }

    container.innerHTML = achievements.map(a =>
        `<div class="achievement-badge" title="${a.title}">${a.icon}</div>`
    ).join('');
}

// Enhanced loadUserProfile
const originalLoadUserProfile = loadUserProfile;
loadUserProfile = function() {
    const result = originalLoadUserProfile();

    // Load avatar image
    const profile = JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}');
    const avatarImg = document.getElementById('profileAvatarImage');
    if (avatarImg && profile.avatarImage) {
        avatarImg.src = profile.avatarImage;
    }

    // Load teams, activity, achievements
    updateFavoriteTeamsDisplay();
    loadRealActivity();
    loadRealAchievements();

    return result;
};

// Profile edit form submission
document.addEventListener('DOMContentLoaded', function() {
    const profileForm = document.getElementById('profileEditForm');
    if (profileForm) {
        profileForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const profile = {
                displayName: document.getElementById('editDisplayName').value,
                username: document.getElementById('editUsername').value,
                bio: document.getElementById('editBio').value,
                avatar: document.getElementById('editAvatar').value,
                favoriteTeams: JSON.parse(localStorage.getItem('trustMyRecordProfile') || '{}').favoriteTeams || []
            };

            localStorage.setItem('trustMyRecordProfile', JSON.stringify(profile));
            loadUserProfile();
            closeProfileEditor();
            alert('‚úÖ Profile updated successfully!');
        });
    }
});

// SOCIAL FEED SYSTEM
let feedPosts = JSON.parse(localStorage.getItem('trustMyRecordFeed') || '[]');

function createFeedPost() {
    const content = document.getElementById('newPostContent').value.trim();
    if (!content) {
        alert('Please enter some content!');
        return;
    }

    const profile = loadUserProfile();
    const post = {
        id: Date.now(),
        author: profile.username || 'username',
        avatar: profile.avatar || 'üë§',
        content: content,
        timestamp: new Date().toISOString(),
        likes: 0,
        comments: []
    };

    feedPosts.unshift(post);
    localStorage.setItem('trustMyRecordFeed', JSON.stringify(feedPosts));

    document.getElementById('newPostContent').value = '';
    loadSocialFeed();
    alert('‚úÖ Post created!');
}

function loadSocialFeed() {
    const container = document.getElementById('socialFeedContainer');
    if (!container) return;

    feedPosts = JSON.parse(localStorage.getItem('trustMyRecordFeed') || '[]');

    if (feedPosts.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No posts yet. Be the first to share!</p>';
        return;
    }

    container.innerHTML = feedPosts.map(post => `
        <div class="feed-post">
            <div class="post-header">
                <div class="post-author-info">
                    <span class="post-avatar">${post.avatar}</span>
                    <div class="post-meta">
                        <span class="post-author">@${post.author}</span>
                        <span class="post-time">${formatTimeAgo(post.timestamp)}</span>
                    </div>
                </div>
            </div>
            <div class="post-content">${post.content}</div>
            <div class="post-actions">
                <button class="post-action-btn" onclick="likePost(${post.id})">
                    ‚ù§Ô∏è ${post.likes || 0}
                </button>
                <button class="post-action-btn">
                    üí¨ ${post.comments ? post.comments.length : 0}
                </button>
                <button class="post-action-btn">
                    üîÑ Share
                </button>
            </div>
        </div>
    `).join('');
}

function likePost(postId) {
    const postIndex = feedPosts.findIndex(p => p.id === postId);
    if (postIndex !== -1) {
        feedPosts[postIndex].likes = (feedPosts[postIndex].likes || 0) + 1;
        localStorage.setItem('trustMyRecordFeed', JSON.stringify(feedPosts));
        loadSocialFeed();
    }
}

function filterFeed(type) {
    // Update active tab
    document.querySelectorAll('.feed-tab').forEach(tab => tab.classList.remove('active'));
    event.target.classList.add('active');

    // Filter logic would go here
    loadSocialFeed();
}

function filterByTag(tag) {
    alert(`Filtering by #${tag} - feature coming soon!`);
}

function formatTimeAgo(timestamp) {
    const now = new Date();
    const then = new Date(timestamp);
    const diffMs = now - then;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);

    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    return `${diffDays}d ago`;
}

// FOLLOWING SYSTEM
function followUser(username) {
    let following = JSON.parse(localStorage.getItem('trustMyRecordFollowing') || '[]');

    if (following.includes(username)) {
        following = following.filter(u => u !== username);
        localStorage.setItem('trustMyRecordFollowing', JSON.stringify(following));
        event.target.textContent = 'Follow';
        event.target.classList.remove('following');
        alert(`Unfollowed @${username}`);
    } else {
        following.push(username);
        localStorage.setItem('trustMyRecordFollowing', JSON.stringify(following));
        event.target.textContent = 'Following';
        event.target.classList.add('following');
        alert(`‚úÖ Now following @${username}`);
    }

    loadUserProfile();
}

// LEADERBOARD SYSTEM
function switchLeaderboard(type) {
    // Hide all panels
    document.querySelectorAll('.leaderboard-panel').forEach(panel => panel.classList.remove('active'));

    // Remove active from all tabs
    document.querySelectorAll('.lb-tab').forEach(tab => tab.classList.remove('active'));

    // Show selected panel
    document.getElementById(`${type}Leaderboard`).classList.add('active');
    event.target.classList.add('active');
}

// Update sidebar stats when viewing feed
function updateFeedSidebarStats() {
    const stats = calculateUserStats();

    if (document.getElementById('sidebarPicks')) {
        document.getElementById('sidebarPicks').textContent = stats.totalPicks;
        document.getElementById('sidebarWinRate').textContent = stats.winRate + '%';

        const followers = JSON.parse(localStorage.getItem('trustMyRecordFollowers') || '[]');
        document.getElementById('sidebarFollowers').textContent = followers.length;
    }
}

// Groups tab switching
function switchGroupsTab(tab) {
    // Hide all panels
    document.querySelectorAll('.groups-panel').forEach(panel => panel.classList.remove('active'));

    // Remove active from all tabs
    document.querySelectorAll('.groups-tab').forEach(tabBtn => tabBtn.classList.remove('active'));

    // Show selected panel
    const panels = {
        'discover': 'discoverGroups',
        'mygroups': 'myGroups',
        'syndicates': 'syndicates'
    };

    document.getElementById(panels[tab]).classList.add('active');
    event.currentTarget.classList.add('active');
}

function openCreateGroupModal() {
    alert('Create Group modal would open here. Feature coming soon!');
}

function openCreateSyndicateModal() {
    alert('Create Syndicate modal would open here. Premium feature!');
}

// Marketplace tab switching
function switchMarketTab(tab) {
    // Hide all panels
    document.querySelectorAll('.market-panel').forEach(panel => panel.classList.remove('active'));

    // Remove active from all tabs
    document.querySelectorAll('.market-tab').forEach(tabBtn => tabBtn.classList.remove('active'));

    // Show selected panel
    const panels = {
        'picks': 'pickMarket',
        'strategies': 'strategiesMarket',
        'tools': 'toolsMarket',
        'data': 'dataMarket'
    };

    document.getElementById(panels[tab]).classList.add('active');
    event.currentTarget.classList.add('active');
}

function openSellModal() {
    alert('Seller application modal would open here. Start selling your expertise!');
}

function openSellerApplication() {
    alert('Seller application form would open here. Apply to become a verified seller!');
}

// Premium upgrade
function upgradeTier(tier) {
    const tierNames = {
        'pro': 'Pro ($29.99/month)',
        'elite': 'Elite ($99.99/month)'
    };
    alert(`Upgrade to ${tierNames[tier]} selected! Payment modal would open here.`);
}

// Live games filtering
function filterLiveGames(sport) {
    const cards = document.querySelectorAll('.live-game-card');
    const buttons = document.querySelectorAll('.live-filter-btn');

    // Update active button
    buttons.forEach(btn => btn.classList.remove('active'));
    event.currentTarget.classList.add('active');

    // Filter cards
    cards.forEach(card => {
        if (sport === 'all') {
            card.style.display = 'block';
        } else {
            if (card.dataset.sport === sport) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        }
    });
}

// Enhanced poll voting - handled by votePoll() in main polls system above

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
    // Seed sample polls on first visit
    seedSamplePolls();
    // Seed sample challenges on first visit
    if (typeof seedSampleChallenges === 'function') seedSampleChallenges();
    // Seed weekly contest on first visit
    if (typeof seedWeeklyContest === 'function') seedWeeklyContest();

    if (document.getElementById('predictions-section')) {
        renderPollsGrid();
        showSubSection('predictions');
    }

    // Initialize trivia stats
    if (typeof updateTriviaTodayCard === 'function') updateTriviaTodayCard();
    if (typeof renderTriviaResults === 'function') renderTriviaResults();
    if (typeof renderTriviaLeaderboard === 'function') renderTriviaLeaderboard();

    // Load cached picks from localStorage for stat functions
    if (window.auth && window.auth.isLoggedIn()) {
        ensureBackendPicks(function() {
            loadUserProfile();
            updateFeedSidebarStats();
        });
    } else {
        loadUserProfile();
        updateFeedSidebarStats();
    }

    // Load social feed
    loadSocialFeed();
});
</script>
        </main>

        <footer style="background: rgba(0, 0, 0, 0.4); border-top: 1px solid rgba(0, 255, 255, 0.2); padding: 30px 0; text-align: center;">
            <div style="max-width: 1400px; margin: 0 auto; padding: 0 20px;">
                <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; flex-wrap: wrap;">
                    <a href="#home" onclick="showSection('home')" style="color: #b0b0c0; text-decoration: none; font-size: 0.9rem; transition: color 0.3s;">Home</a>
                    <a href="#profile" onclick="showSection('profile')" style="color: #b0b0c0; text-decoration: none; font-size: 0.9rem; transition: color 0.3s;">Profile</a>
                    <a href="#forums" onclick="showSection('forums')" style="color: #b0b0c0; text-decoration: none; font-size: 0.9rem; transition: color 0.3s;">Forums</a>
                    <a href="challenges.html" style="color: #b0b0c0; text-decoration: none; font-size: 0.9rem; transition: color 0.3s;">The Arena</a>
                    <a href="#leaderboards" onclick="showSection('leaderboards')" style="color: #b0b0c0; text-decoration: none; font-size: 0.9rem; transition: color 0.3s;">Leaderboards</a>
                </div>
                <p style="color: #808090; font-size: 0.85rem;">¬© 2026 TrustMyRecord.com - The End of the Bullshit. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        // USER STATS CALCULATION - uses cached backend data if available
        // _cachedBackendPicks is populated by async calls elsewhere
        window._cachedBackendPicks = null;

        function calculateUserStats() {
            // Use backend-cached picks if available, otherwise empty
            const picks = window._cachedBackendPicks || [];
            const pollVotes = JSON.parse(localStorage.getItem('trustMyRecordPollVotes') || '{}');
            const triviaScores = JSON.parse(localStorage.getItem('trustMyRecordTriviaScores') || '[]');

            const totalPicks = picks.length;
            const wins = picks.filter(p => p.status === 'won').length;
            const losses = picks.filter(p => p.status === 'lost').length;
            const pending = picks.filter(p => p.status === 'pending').length;
            const winRate = (wins + losses) > 0 ? ((wins / (wins + losses)) * 100).toFixed(1) : 0;

            let totalUnits = 0;
            picks.forEach(pick => {
                totalUnits += (parseFloat(pick.result_units) || 0);
            });

            // Calculate streak
            let currentStreak = 0;
            let streakType = '';
            const gradedPicks = picks.filter(p => p.status !== 'pending');
            for (let i = 0; i < gradedPicks.length; i++) {
                if (i === 0) {
                    currentStreak = 1;
                    streakType = gradedPicks[i].status;
                } else if (gradedPicks[i].status === streakType) {
                    currentStreak++;
                } else {
                    break;
                }
            }

            const triviaPoints = triviaScores.reduce((sum, score) => sum + (score.points || 0), 0);
            const pollVoteCount = Object.keys(pollVotes).length;

            return {
                totalPicks,
                winRate: isNaN(winRate) ? 0 : winRate,
                totalUnits: totalUnits.toFixed(2),
                currentStreak: streakType === 'won' ? `${currentStreak}W` : streakType === 'lost' ? `${currentStreak}L` : '0',
                triviaPoints,
                pollVoteCount
            };
        }

        // Load picks from localStorage for stat functions
        function ensureBackendPicks(callback) {
            if (!window._cachedBackendPicks) {
                try {
                    var allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]');
                    var user = window.auth ? window.auth.getCurrentUser() : null;
                    var userId = user ? (user.username || user.id || 'local') : 'local';
                    window._cachedBackendPicks = allPicks.filter(function(p) { return p.user_id === userId; });
                } catch (e) {
                    window._cachedBackendPicks = [];
                }
            }
            if (callback) callback();
        }

        function updateStatsDashboard() {
            const stats = calculateUserStats();
            const dashboard = document.getElementById('userStatsDashboard');
            if (!dashboard) return;

            // Check if user is logged in - ALWAYS show dashboard for logged-in users
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                dashboard.style.display = 'block';

                // Populate user profile info
                const user = JSON.parse(currentUser);
                const avatarEl = document.getElementById('dashboardAvatar');
                const usernameEl = document.getElementById('dashboardUsername');
                const joinDateEl = document.getElementById('dashboardJoinDate');
                const badgesEl = document.getElementById('dashboardBadges');

                if (avatarEl && user.avatar) avatarEl.src = user.avatar;
                if (usernameEl) usernameEl.textContent = user.displayName || user.username || 'Welcome Back!';
                if (joinDateEl && user.joinedDate) {
                    const joinDate = new Date(user.joinedDate);
                    joinDateEl.textContent = joinDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                }

                // Update badges based on user stats
                if (badgesEl) {
                    let badgesHTML = '';
                    if (stats.totalPicks === 0) {
                        badgesHTML = '<span class="badge-item newbie">Newcomer</span>';
                    } else {
                        if (stats.totalPicks >= 10) badgesHTML += '<span class="badge-item">10+ Picks</span>';
                        if (stats.totalPicks >= 50) badgesHTML += '<span class="badge-item winner">50+ Picks</span>';
                        if (stats.totalPicks >= 100) badgesHTML += '<span class="badge-item winner">Centurion</span>';
                        if (parseFloat(stats.winRate) >= 55) badgesHTML += '<span class="badge-item winner">Sharp</span>';
                        if (parseFloat(stats.totalUnits) > 10) badgesHTML += '<span class="badge-item winner">Profitable</span>';
                        if (badgesHTML === '') badgesHTML = '<span class="badge-item newbie">Getting Started</span>';
                    }
                    badgesEl.innerHTML = badgesHTML;
                }
            } else {
                // Not logged in - hide dashboard
                dashboard.style.display = 'none';
                return;
            }

            // Update main stat values
            const totalPicksEl = document.getElementById('totalPicks');
            const winRateEl = document.getElementById('winRate');
            const totalUnitsEl = document.getElementById('totalUnits');
            const currentStreakEl = document.getElementById('currentStreak');

            if (totalPicksEl) totalPicksEl.textContent = stats.totalPicks;
            if (winRateEl) winRateEl.textContent = stats.winRate + '%';
            if (totalUnitsEl) totalUnitsEl.textContent = (stats.totalUnits >= 0 ? '+' : '') + stats.totalUnits + 'u';
            if (currentStreakEl) currentStreakEl.textContent = stats.currentStreak;

            // Update extended stats
            const picksBreakdownEl = document.getElementById('picksBreakdown');
            const roiDisplayEl = document.getElementById('roiDisplay');
            const bestStreakEl = document.getElementById('bestStreak');

            if (picksBreakdownEl) {
                const picks = window._cachedBackendPicks || [];
                const wins = picks.filter(p => p.status === 'won').length;
                const losses = picks.filter(p => p.status === 'lost').length;
                const pending = picks.filter(p => p.status === 'pending').length;
                picksBreakdownEl.textContent = `${wins}W - ${losses}L - ${pending}P`;
            }

            if (roiDisplayEl) {
                const roi = stats.totalPicks > 0 ? ((parseFloat(stats.totalUnits) / stats.totalPicks) * 100).toFixed(1) : 0;
                roiDisplayEl.textContent = `${roi}% ROI`;
            }

            if (bestStreakEl) {
                // For now just show current streak as best
                bestStreakEl.textContent = 'Best: ' + stats.currentStreak;
            }

            // Update activity stats
            const triviaScoreEl = document.getElementById('triviaScore');
            const pollVotesEl = document.getElementById('pollVotes');
            const forumPostsEl = document.getElementById('forumPosts');
            const triviaCreatedEl = document.getElementById('triviaCreated');

            if (triviaScoreEl) triviaScoreEl.textContent = stats.triviaPoints;
            if (pollVotesEl) pollVotesEl.textContent = stats.pollVoteCount;
            if (forumPostsEl) {
                const forumPosts = JSON.parse(localStorage.getItem('trustMyRecordForumPosts') || '[]').length;
                forumPostsEl.textContent = forumPosts;
            }
            if (triviaCreatedEl) {
                const triviaCreated = JSON.parse(localStorage.getItem('trustMyRecordUserTrivia') || '[]').length;
                triviaCreatedEl.textContent = triviaCreated;
            }

            // Color code units
            if (totalUnitsEl) {
                if (parseFloat(stats.totalUnits) > 0) {
                    totalUnitsEl.style.color = 'var(--neon-green)';
                } else if (parseFloat(stats.totalUnits) < 0) {
                    totalUnitsEl.style.color = 'var(--neon-red)';
                } else {
                    totalUnitsEl.style.color = 'var(--neon-gold)';
                }
            }

            // Update recent picks section
            updateRecentPicksDisplay();
        }

        function updateRecentPicksDisplay() {
            const container = document.getElementById('dashboardRecentPicks');
            if (!container) return;

            const picks = window._cachedBackendPicks || [];

            if (picks.length === 0) {
                container.innerHTML = '<p class="no-picks-message">No picks yet. Make your first pick to start building your record!</p>';
                return;
            }

            const recentPicks = picks.slice(0, 5);
            let html = '';

            recentPicks.forEach(pick => {
                const statusClass = pick.status === 'won' ? 'won' : pick.status === 'lost' ? 'lost' : 'pending';
                const statusText = (pick.status || 'pending').toUpperCase();
                const matchup = (pick.away_team || '') + ' vs ' + (pick.home_team || '');
                const pickDisplay = pick.selection + (pick.line_snapshot ? ' ' + pick.line_snapshot : '');
                const odds = pick.odds_snapshot || '';
                html += `
                    <div class="recent-pick-item">
                        <div class="pick-info">
                            <div class="pick-game">${matchup}</div>
                            <div class="pick-details-text">${pickDisplay} (${odds > 0 ? '+' : ''}${odds}) - ${pick.units || 1}u</div>
                        </div>
                        <span class="pick-status ${statusClass}">${statusText}</span>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function exportUserData() {
            const data = {
                picks: window._cachedBackendPicks || [],
                pollVotes: JSON.parse(localStorage.getItem('trustMyRecordPollVotes') || '{}'),
                userPolls: JSON.parse(localStorage.getItem('trustMyRecordPolls') || '[]'),
                triviaScores: JSON.parse(localStorage.getItem('trustMyRecordTriviaScores') || '[]'),
                exportedAt: new Date().toISOString(),
                stats: calculateUserStats()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.href = url;
            link.download = `trustmyrecord-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            URL.revokeObjectURL(url);
            alert('‚úÖ Your data has been exported successfully!');
        }

        function importUserData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';

            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();

                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);

                        if (confirm('This will import poll/trivia data. Picks are managed by the backend. Continue?')) {
                            // Note: picks are now backend-managed, import only saves non-pick data
                            localStorage.setItem('trustMyRecordPollVotes', JSON.stringify(data.pollVotes || {}));
                            localStorage.setItem('trustMyRecordPolls', JSON.stringify(data.userPolls || []));
                            localStorage.setItem('trustMyRecordTriviaScores', JSON.stringify(data.triviaScores || []));

                            alert('‚úÖ Data imported successfully! Refreshing page...');
                            location.reload();
                        }
                    } catch (error) {
                        alert('‚ùå Error importing data. Please check the file format.');
                    }
                };

                reader.readAsText(file);
            };

            input.click();
        }

        // Navigation functionality
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.page-section');
            sections.forEach(section => section.classList.remove('active'));

            // Show selected section
            var targetEl = document.getElementById(sectionId);
            if (targetEl) targetEl.classList.add('active');

            // Update nav active states
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => link.classList.remove('active'));

            // Add active class to clicked nav item (if it exists)
            if (event && event.target) event.target.classList.add('active');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Update stats when showing home
            if (sectionId === 'home') {
                if (typeof updateStatsDashboard === 'function') updateStatsDashboard();
            }

            // Render section-specific content
            if (sectionId === 'polls-trivia') {
                if (typeof renderPollsGrid === 'function') renderPollsGrid();
            }
            if (sectionId === 'trivia') {
                if (typeof updateTriviaTodayCard === 'function') updateTriviaTodayCard();
                if (typeof renderTriviaResults === 'function') renderTriviaResults();
                if (typeof renderTriviaLeaderboard === 'function') renderTriviaLeaderboard();
            }
            if (sectionId === 'arena') {
                if (typeof currentArenaMode !== 'undefined' && currentArenaMode === 'polls') {
                    if (typeof renderArenaPollsList === 'function') renderArenaPollsList();
                } else {
                    if (typeof renderChallengesList === 'function') renderChallengesList();
                }
            }
            if (sectionId === 'contests') {
                if (typeof renderContests === 'function') renderContests();
            }
            if (sectionId === 'profile') {
                if (typeof ensureBackendPicks === 'function') ensureBackendPicks();
                if (typeof loadUserProfile === 'function') loadUserProfile();
            }
            if (sectionId === 'mypicks') {
                if (typeof ensureBackendPicks === 'function') ensureBackendPicks();
                if (typeof loadMyPicks === 'function') loadMyPicks(window.currentPicksTab || 'pending');
            }
            if (sectionId === 'picks') {
                if (typeof initGameCounts === 'function') initGameCounts();
            }
        }


        // Profile Tab Functions
        function showProfileTab(tabId) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.profile-tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Remove active from all tabs
            const tabs = document.querySelectorAll('.profile-tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            const selectedTab = document.getElementById('profile' + tabId.charAt(0).toUpperCase() + tabId.slice(1) + 'Tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Add active to clicked tab
            event.target.classList.add('active');

            // Load data for specific tabs
            if (tabId === 'friends') {
                loadFriendsData();
            } else if (tabId === 'picks') {
                loadPickHistory();
            } else if (tabId === 'posts') {
                loadUserPosts();
            } else if (tabId === 'community') {
                loadCommunityStats();
            }
        }

        // Load community stats from localStorage
        function loadCommunityStats() {
            var user = (window.auth && window.auth.isLoggedIn()) ? window.auth.getCurrentUser() : null;
            if (!user) {
                console.log('No user logged in, cannot load community stats');
                return;
            }
            var username = user.username || '';

            // Calculate trivia stats from localStorage
            var triviaScoresLocal = [];
            try { triviaScoresLocal = JSON.parse(localStorage.getItem('trustMyRecordTriviaScores') || '[]'); } catch(e) {}
            var myTriviaScores = triviaScoresLocal.filter(function(s) { return s.username === username || s.username === 'Guest'; });
            var triviaAnswered = 0, triviaCorrect = 0, triviaPoints = 0;
            myTriviaScores.forEach(function(s) {
                triviaAnswered += (s.total || 0);
                triviaCorrect += (s.score || 0);
                triviaPoints += (s.points || 0);
            });
            var triviaAccuracy = triviaAnswered > 0 ? Math.round((triviaCorrect / triviaAnswered) * 100) : 0;

            // Calculate poll stats from localStorage
            var polls = [];
            try { polls = JSON.parse(localStorage.getItem('trustmyrecord_polls') || '[]'); } catch(e) {}
            var pollsVoted = 0, pollPoints = 0;
            polls.forEach(function(poll) {
                poll.options.forEach(function(opt) {
                    if (opt.voters && opt.voters.indexOf(username) !== -1) {
                        pollsVoted++;
                        pollPoints += 10;
                    }
                });
            });

            // Calculate forum stats from localStorage
            var forumPosts = [];
            try { forumPosts = JSON.parse(localStorage.getItem('trustMyRecordForumPosts') || '[]'); } catch(e) {}
            var myForumPosts = forumPosts.filter(function(p) { return p.author === username; });

            var totalCommunityPoints = triviaPoints + pollPoints;

            // Update summary cards
            var el;
            el = document.getElementById('communityTotalPoints'); if (el) el.textContent = totalCommunityPoints;
            el = document.getElementById('communityTriviaAnswered'); if (el) el.textContent = triviaAnswered;
            el = document.getElementById('communityPollsVoted'); if (el) el.textContent = pollsVoted;
            el = document.getElementById('communityForumPosts'); if (el) el.textContent = myForumPosts.length;

            // Update trivia stats
            el = document.getElementById('triviaQuestionsAnswered'); if (el) el.textContent = triviaAnswered;
            el = document.getElementById('triviaCorrect'); if (el) el.textContent = triviaCorrect;
            el = document.getElementById('triviaAccuracy'); if (el) el.textContent = triviaAccuracy + '%';
            el = document.getElementById('triviaTotalPoints'); if (el) el.textContent = triviaPoints;

            // Update poll stats
            el = document.getElementById('pollsVoted'); if (el) el.textContent = pollsVoted;
            el = document.getElementById('pollsTotalPoints'); if (el) el.textContent = pollPoints;

            // Update forum stats
            el = document.getElementById('forumPostsMade'); if (el) el.textContent = myForumPosts.length;

            // Update overview tab points
            el = document.getElementById('profileTriviaPoints'); if (el) el.textContent = triviaPoints;
            el = document.getElementById('profilePollPoints'); if (el) el.textContent = pollPoints;
            el = document.getElementById('profileTotalPoints'); if (el) el.textContent = totalCommunityPoints;
        }

        // Render recent community activity
        function renderCommunityRecentActivity(data) {
            const container = document.getElementById('communityRecentActivity');
            const activities = [];

            // Combine trivia attempts
            if (data.trivia?.recent_attempts) {
                data.trivia.recent_attempts.forEach(attempt => {
                    activities.push({
                        type: 'trivia',
                        icon: attempt.is_correct ? '‚úÖ' : '‚ùå',
                        title: attempt.question_text?.substring(0, 50) + (attempt.question_text?.length > 50 ? '...' : ''),
                        detail: attempt.is_correct ? `+${attempt.points_earned} pts` : 'Incorrect',
                        category: attempt.category_name,
                        date: new Date(attempt.created_at)
                    });
                });
            }

            // Combine poll votes
            if (data.polls?.recent_votes) {
                data.polls.recent_votes.forEach(vote => {
                    activities.push({
                        type: 'poll',
                        icon: vote.is_correct === true ? '‚úÖ' : vote.is_correct === false ? '‚ùå' : 'üó≥Ô∏è',
                        title: vote.title?.substring(0, 50) + (vote.title?.length > 50 ? '...' : ''),
                        detail: vote.is_correct !== null ? (vote.is_correct ? `+${vote.points_earned} pts` : 'Incorrect') : `Voted: ${vote.voted_option}`,
                        category: vote.category_name,
                        date: new Date(vote.voted_at)
                    });
                });
            }

            // Combine forum activity
            if (data.forum?.recent_activity) {
                data.forum.recent_activity.forEach(activity => {
                    activities.push({
                        type: activity.type === 'thread' ? 'forum-thread' : 'forum-post',
                        icon: activity.type === 'thread' ? 'üìù' : 'üí¨',
                        title: activity.title?.substring(0, 50) + (activity.title?.length > 50 ? '...' : ''),
                        detail: activity.type === 'thread' ? `${activity.reply_count} replies` : `${activity.reply_count} likes`,
                        category: activity.category_name,
                        date: new Date(activity.created_at)
                    });
                });
            }

            // Sort by date descending
            activities.sort((a, b) => b.date - a.date);

            if (activities.length === 0) {
                container.innerHTML = `
                    <p class="no-data-message" style="color: var(--text-secondary); text-align: center; padding: 30px;">
                        No community activity yet. Start playing trivia, voting in polls, or posting in forums!
                    </p>
                `;
                return;
            }

            container.innerHTML = activities.slice(0, 15).map(activity => {
                const timeAgo = getTimeAgo(activity.date);
                const typeColors = {
                    'trivia': 'var(--neon-cyan)',
                    'poll': '#8a2be2',
                    'forum-thread': '#00ff88',
                    'forum-post': '#00ff88'
                };
                const typeLabels = {
                    'trivia': 'TRIVIA',
                    'poll': 'POLL',
                    'forum-thread': 'THREAD',
                    'forum-post': 'POST'
                };

                return `
                    <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-bottom: 10px;">
                        <span style="font-size: 20px;">${activity.icon}</span>
                        <div style="flex: 1; min-width: 0;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                <span style="font-size: 10px; padding: 2px 6px; background: ${typeColors[activity.type]}; color: #000; border-radius: 3px; font-weight: 600;">${typeLabels[activity.type]}</span>
                                <span style="font-size: 11px; color: var(--text-secondary);">${activity.category}</span>
                            </div>
                            <div style="color: var(--text-primary); font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${activity.title}</div>
                            <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                <span style="font-size: 12px; color: ${activity.detail.includes('+') ? '#00ff88' : 'var(--text-secondary)'};">${activity.detail}</span>
                                <span style="font-size: 11px; color: var(--text-secondary);">${timeAgo}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Helper function for time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }

        // Friends subtab switching
        function showFriendsSubtab(subtab) {
            // Toggle subtab buttons
            const subtabs = document.querySelectorAll('.friends-subtab');
            subtabs.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Toggle lists
            const followingList = document.getElementById('friendsFollowingList');
            const followersList = document.getElementById('friendsFollowersList');

            if (subtab === 'following') {
                followingList.style.display = 'grid';
                followersList.style.display = 'none';
            } else {
                followingList.style.display = 'none';
                followersList.style.display = 'grid';
            }
        }

        // Load friends data from localStorage
        function loadFriendsData() {
            const following = JSON.parse(localStorage.getItem('trustMyRecordFollowing') || localStorage.getItem('following') || '[]');
            const followers = JSON.parse(localStorage.getItem('trustMyRecordFollowers') || localStorage.getItem('followers') || '[]');

            document.getElementById('followingCount').textContent = following.length;
            document.getElementById('followersCount').textContent = followers.length;

            // Populate following list
            const followingList = document.getElementById('friendsFollowingList');
            if (following.length > 0) {
                followingList.innerHTML = following.map(user => `
                    <div class="friend-card">
                        <div class="friend-avatar">${user.avatar || 'üë§'}</div>
                        <div class="friend-info">
                            <div class="friend-name">${user.displayName || user.username}</div>
                            <div class="friend-stats">${user.record || 'No record yet'}</div>
                        </div>
                        <button class="friend-action" onclick="viewUserProfile('${user.username}')">View</button>
                    </div>
                `).join('');
            }
        }

        // Filter picks in pick history
        function filterPicks(filter) {
            const buttons = document.querySelectorAll('#profilePicksTab .posts-filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Get picks from localStorage and filter
            const picks = JSON.parse(localStorage.getItem('pickHistory') || '[]');
            const filtered = filter === 'all' ? picks : picks.filter(p => p.status === filter);

            displayFilteredPicks(filtered);
        }

        // Display filtered picks
        function displayFilteredPicks(picks) {
            const container = document.getElementById('profilePickHistory');
            if (!container) return;
            if (picks.length === 0) {
                container.innerHTML = '<p class="no-data-message">No picks found for this filter.</p>';
                return;
            }

            container.innerHTML = picks.map(pick => {
                const status = pick.status || 'pending';
                const matchup = (pick.away_team || pick.team1 || '?') + ' vs ' + (pick.home_team || pick.team2 || '?');
                const selection = pick.selection || pick.pick || '-';
                const line = pick.line_snapshot || '';
                const odds = pick.odds_snapshot || pick.odds || -110;
                const units = pick.units || 1;
                const dateStr = new Date(pick.locked_at || pick.timestamp || Date.now()).toLocaleDateString();
                const resultUnits = pick.result_units;
                const statusBg = status === 'won' ? 'rgba(0,200,83,0.2)' : status === 'lost' ? 'rgba(255,68,68,0.2)' : 'rgba(255,152,0,0.2)';
                const statusColor = status === 'won' ? '#00c853' : status === 'lost' ? '#ff4444' : '#ff9800';
                const unitsDisplay = resultUnits !== undefined && resultUnits !== null ? ' | ' + (resultUnits >= 0 ? '+' : '') + parseFloat(resultUnits).toFixed(2) + 'u' : '';
                return '<div class="user-post-card" style="margin-bottom: 10px;">' +
                    '<div class="user-post-header">' +
                    '<span class="user-post-type" style="background: ' + statusBg + '; color: ' + statusColor + '">' + status.toUpperCase() + '</span>' +
                    '<span class="user-post-date">' + dateStr + '</span>' +
                    '</div>' +
                    '<div class="user-post-pick">' +
                    '<div class="user-post-pick-team">' + matchup + '</div>' +
                    '<div class="user-post-pick-details">' + selection + ' ' + line + ' (' + odds + ') - ' + units + 'u' + unitsDisplay + '</div>' +
                    '</div></div>';
            }).join('');
        }

        // Load pick history
        function loadPickHistory() {
            let picks = [];
            try {
                const allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]');
                if (window.auth && window.auth.isLoggedIn()) {
                    const user = window.auth.getCurrentUser();
                    const userId = user.username || user.id || 'local';
                    picks = allPicks.filter(p => p.user_id === userId);
                } else {
                    picks = allPicks;
                }
            } catch(e) { picks = []; }
            displayFilteredPicks(picks);
        }

        // Filter posts
        function filterPosts(filter) {
            const buttons = document.querySelectorAll('#profilePostsTab .posts-filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Filter logic would go here
            loadUserPosts(filter);
        }

        // Load user posts
        function loadUserPosts(filter = 'all') {
            const activity = JSON.parse(localStorage.getItem('userActivity') || '[]');
            let picks = [];
            try {
                const allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]');
                if (window.auth && window.auth.isLoggedIn()) {
                    const user = window.auth.getCurrentUser();
                    const userId = user.username || user.id || 'local';
                    picks = allPicks.filter(p => p.user_id === userId);
                } else {
                    picks = allPicks;
                }
            } catch(e) { picks = []; }

            // Combine and sort by timestamp
            let posts = [];

            if (filter === 'all' || filter === 'picks') {
                posts = posts.concat(picks.map(p => ({ ...p, type: 'pick' })));
            }

            if (filter === 'all' || filter === 'trivia') {
                const triviaActivity = activity.filter(a => a.type === 'trivia');
                posts = posts.concat(triviaActivity);
            }

            if (filter === 'all' || filter === 'polls') {
                const pollActivity = activity.filter(a => a.type === 'poll');
                posts = posts.concat(pollActivity);
            }

            posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            const container = document.getElementById('userPostsFeed');
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="user-post-card">
                        <div class="user-post-header">
                            <span class="user-post-type">INFO</span>
                            <span class="user-post-date">Just now</span>
                        </div>
                        <div class="user-post-content">
                            Your picks and activity will appear here as you use Trust My Record.
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = posts.slice(0, 20).map(post => {
                if (post.type === 'pick') {
                    const matchup = (post.away_team || post.team1 || '?') + ' vs ' + (post.home_team || post.team2 || '?');
                    const selection = post.selection || post.pick || '-';
                    const odds = post.odds_snapshot || post.odds || '';
                    const status = post.status || 'pending';
                    const statusColor = status === 'won' ? '#00c853' : status === 'lost' ? '#ff4444' : '#ff9800';
                    const dateStr = new Date(post.locked_at || post.timestamp || Date.now()).toLocaleDateString();
                    return '<div class="user-post-card"><div class="user-post-header">' +
                        '<span class="user-post-type" style="color: ' + statusColor + ';">' + status.toUpperCase() + '</span>' +
                        '<span class="user-post-date">' + dateStr + '</span></div>' +
                        '<div class="user-post-pick"><div class="user-post-pick-team">' + matchup + '</div>' +
                        '<div class="user-post-pick-details">' + selection + (odds ? ' (' + odds + ')' : '') + '</div></div></div>';
                } else {
                    return '<div class="user-post-card"><div class="user-post-header">' +
                        '<span class="user-post-type">' + (post.type || 'INFO').toUpperCase() + '</span>' +
                        '<span class="user-post-date">' + new Date(post.timestamp || Date.now()).toLocaleDateString() + '</span></div>' +
                        '<div class="user-post-content">' + (post.description || 'Activity recorded') + '</div></div>';
                }
            }).join('');
        }


        // Pick form submission (legacy - only if pickForm exists)
        const pickFormElement = document.getElementById('pickForm');
        if (pickFormElement) {
        pickFormElement.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const pick = {
                sport: formData.get('sport'),
                team1: formData.get('team1'),
                team2: formData.get('team2'),
                betType: formData.get('betType'),
                pick: formData.get('pick'),
                odds: formData.get('odds'),
                confidence: formData.get('confidence'),
                units: formData.get('units'),
                reasoning: formData.get('reasoning'),
                timestamp: new Date().toISOString(),
                status: 'pending'
            };

            // Add pick to history (in a real app, this would go to a database)
            addPickToHistory(pick);
            
            // Reset form
            this.reset();
            
            // Show success message
            alert('Pick submitted successfully! It has been added to your permanent record.');
        });
        } // End pickForm null check

        // Function to add pick to history display
        function addPickToHistory(pick) {
            const container = document.getElementById('picksContainer');
            const pickElement = document.createElement('div');
            pickElement.className = 'pick-item pending';
            
            pickElement.innerHTML = `
                <div class="pick-details">
                    <div class="pick-game">${pick.team1} vs ${pick.team2}</div>
                    <div class="pick-bet">${pick.pick} (${pick.odds}) | ${pick.units} Units</div>
                </div>
                <div class="pick-result pending">PENDING</div>
            `;
            
            // Add to top of list
            container.insertBefore(pickElement, container.firstChild);
        }

        // Signup handled by forms-fixed.js

        // Interactive card effects
        document.addEventListener('mousemove', (e) => {
            const cards = document.querySelectorAll('.glass-card');
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = (y - centerY) / 20;
                    const rotateY = (centerX - x) / 20;
                    
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-8px)`;
                } else {
                    card.style.transform = '';
                }
            });
        });

        // Dynamic background effect
        document.addEventListener('mousemove', (e) => {
            try {
                const mouseX = e.clientX / window.innerWidth;
                const mouseY = e.clientY / window.innerHeight;
                
                document.body.style.backgroundImage = `
                    radial-gradient(circle at ${25 + mouseX * 10}% ${75 - mouseY * 10}%, rgba(0, 255, 255, 0.06) 0%, transparent 50%),
                    radial-gradient(circle at ${75 - mouseX * 10}% ${25 + mouseY * 10}%, rgba(255, 215, 0, 0.06) 0%, transparent 50%),
                    linear-gradient(180deg, var(--darker-bg) 0%, var(--dark-bg) 100%)
                `;
            } catch (error) {
                // Silently handle any errors
            }
        });

        // Initialize active nav state for home
        document.addEventListener('DOMContentLoaded', function() {
            // Set home as active by default
            const homeSection = document.getElementById('home');
            if (homeSection) {
                homeSection.classList.add('active');
            }

            // Load and display user stats
            updateStatsDashboard();

            // Initialize picks page when switching to it
            const picksNavLink = document.querySelector('a[onclick*="picks"]');
            if (picksNavLink) {
                picksNavLink.addEventListener('click', function() {
                    setTimeout(() => {
                        if (typeof initPicksPage === 'function') {
                            initPicksPage();
                        }
                    }, 100);
                });
            }

            // Initialize user search with debouncing
            const searchInput = document.getElementById('userSearch');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function(e) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (typeof renderUserSearch === 'function') {
                            renderUserSearch(e.target.value);
                        }
                    }, 300);
                });
            }

            // Initialize signup form
            const signupForm = document.getElementById('signupForm');
            if (signupForm) {
                signupForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleSignup(e);
                });
            }

            // Load feed when switching to feed page
            const feedSection = document.getElementById('feed');
            if (feedSection) {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.target.classList.contains('active')) {
                            loadFeed('following');
                        }
                    });
                });
                observer.observe(feedSection, { attributes: true, attributeFilter: ['class'] });
            }
        });

        // Handle user signup
        function handleSignup(e) {
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const email = formData.get('email');
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            try {
                const user = auth.register(username, email, password);

                // Update optional fields
                const updates = {};
                if (formData.get('displayName')) updates.displayName = formData.get('displayName');
                if (formData.get('favoriteTeam')) updates.favoriteTeam = formData.get('favoriteTeam');
                if (formData.get('favoriteSport')) updates.favoriteSport = formData.get('favoriteSport');
                if (formData.get('location')) updates.location = formData.get('location');
                if (formData.get('bio')) updates.bio = formData.get('bio');

                if (Object.keys(updates).length > 0) {
                    auth.updateProfile(updates);
                }

                // Auto-login
                auth.login(username, password);

                alert('Account created successfully! Welcome to Trust My Record!');
                showSection('home');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Switch feed tabs
        function switchFeedTab(tabName) {
            // Update active tab
            document.querySelectorAll('.feed-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Load appropriate feed
            loadFeed(tabName);
        }

        // Load feed content
        function loadFeed(feedType) {
            if (typeof social === 'undefined') return;

            const container = document.getElementById('feedContent');
            if (!container) return;

            let picks = [];

            switch(feedType) {
                case 'following':
                    picks = social.getFeed(50);
                    break;
                case 'global':
                    picks = social.getGlobalFeed(50);
                    break;
                case 'trending':
                    picks = social.getTrendingPicks(20);
                    break;
            }

            if (picks.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:var(--text-secondary);margin-top:50px;">No picks to show yet. Follow some users or make your first pick!</p>';
                return;
            }

            container.innerHTML = picks.map(pick => renderPickCard(pick)).join('');
        }

        // Toggle follow user
        function toggleFollow(userId) {
            if (!auth.isLoggedIn()) {
                alert('Please sign up or login to follow users');
                showSection('signup');
                return;
            }

            try {
                const isNowFollowing = auth.toggleFollow(userId);

                // Update button state
                const btn = event.target;
                if (isNowFollowing) {
                    btn.classList.add('following');
                    btn.textContent = 'Unfollow';
                } else {
                    btn.classList.remove('following');
                    btn.textContent = 'Follow';
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Toggle pick like
        function togglePickLike(pickId) {
            if (!auth.isLoggedIn()) {
                alert('Please sign up or login to like picks');
                showSection('signup');
                return;
            }

            try {
                const isLiked = social.toggleLike(pickId);

                // Update UI
                const btn = event.target;
                const likeCount = social.getLikeCount(pickId);

                if (isLiked) {
                    btn.classList.add('liked');
                } else {
                    btn.classList.remove('liked');
                }

                btn.innerHTML = `‚ù§Ô∏è ${likeCount}`;
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Show comments for a pick
        function showComments(pickId) {
            alert('Comments feature coming soon!');
            // TODO: Implement comment modal/section
        }

        // ========== FORUM FUNCTIONS ==========

        let currentCategoryId = null;
        let currentThreadId = null;

        // Render forum categories
        function renderForumCategories() {
            if (typeof forums === 'undefined') return;

            const container = document.getElementById('forumCategoriesTable');
            if (!container) return;

            const categories = forums.categories;

            container.innerHTML = categories.map(cat => {
                const stats = forums.getCategoryStats(cat.id);
                const threads = forums.getThreadsByCategory(cat.id, 'activity', 1);
                const lastThread = threads[0];

                let lastPostHTML = '<div class="no-posts">No posts yet</div>';
                if (lastThread) {
                    const lastPostTime = timeAgo(lastThread.lastActivityTime);
                    lastPostHTML = `
                        <div class="lastpost-info">
                            <div class="lastpost-title">${lastThread.title.substring(0, 30)}${lastThread.title.length > 30 ? '...' : ''}</div>
                            <div class="lastpost-meta">
                                by <strong>${lastThread.authorUsername}</strong><br>
                                ${lastPostTime}
                            </div>
                        </div>
                    `;
                }

                return `
                    <tr class="forum-row" onclick="showCategoryThreads('${cat.id}')">
                        <td class="forum-name">
                            <div class="forum-icon" style="color: ${cat.color}">${cat.icon}</div>
                            <div class="forum-info">
                                <h3 class="forum-title">${cat.name}</h3>
                                <p class="forum-desc">${cat.description}</p>
                            </div>
                        </td>
                        <td class="forum-threads">${stats.threadCount}</td>
                        <td class="forum-posts">${stats.replyCount}</td>
                        <td class="forum-lastpost">${lastPostHTML}</td>
                    </tr>
                `;
            }).join('');

            // Update breadcrumb
            document.getElementById('breadcrumbCategory').innerHTML = '';
            document.getElementById('breadcrumbThread').innerHTML = '';
        }

        // Show category threads
        function showCategoryThreads(categoryId) {
            currentCategoryId = categoryId;

            const category = forums.categories.find(c => c.id === categoryId);

            document.getElementById('forumCategoriesView').style.display = 'none';
            document.getElementById('categoryThreadsView').style.display = 'block';
            document.getElementById('threadDetailView').style.display = 'none';

            // Update breadcrumb
            document.getElementById('breadcrumbCategory').innerHTML = ' &raquo; <a onclick="showCategoryThreads(\'' + categoryId + '\')">' + category.name + '</a>';
            document.getElementById('breadcrumbThread').innerHTML = '';

            renderThreads();
        }

        // Render threads
        function renderThreads() {
            const sortBy = document.getElementById('threadSort')?.value || 'activity';
            const threads = forums.getThreadsByCategory(currentCategoryId, sortBy);

            const container = document.getElementById('threadsTableBody');
            if (!container) return;

            if (threads.length === 0) {
                container.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:40px;color:var(--text-secondary);">No threads yet. Be the first to start a discussion!</td></tr>';
                return;
            }

            container.innerHTML = threads.map(thread => {
                const replies = forums.getReplies(thread.id);
                const lastReply = replies.length > 0 ? replies[replies.length - 1] : null;
                const lastPostUser = lastReply ? auth.getUser(lastReply.authorId) : auth.getUser(thread.authorId);
                const lastPostTime = lastReply ? lastReply.timestamp : thread.timestamp;

                return `
                    <tr class="thread-row ${thread.isPinned ? 'pinned-thread' : ''}" onclick="showThreadDetail('${thread.id}')">
                        <td class="thread-title">
                            ${thread.isPinned ? '<span class="pin-icon">üìå</span>' : ''}
                            <div class="thread-title-text">${thread.title}</div>
                            <div class="thread-starter">Started by <strong>${thread.authorUsername}</strong>, ${timeAgo(thread.timestamp)}</div>
                        </td>
                        <td class="thread-replies">${thread.replyCount}</td>
                        <td class="thread-views">${thread.views}</td>
                        <td class="thread-lastpost">
                            <div class="lastpost-info">
                                <div class="lastpost-meta">
                                    by <strong>${lastPostUser?.username || 'Unknown'}</strong><br>
                                    ${timeAgo(lastPostTime)}
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Sort threads
        function sortThreads() {
            renderThreads();
        }

        // Show thread detail
        function showThreadDetail(threadId) {
            currentThreadId = threadId;
            forums.incrementViews(threadId);

            const thread = forums.getThread(threadId);
            const author = auth.getUser(thread.authorId);
            const category = forums.categories.find(c => c.id === thread.categoryId);

            document.getElementById('categoryThreadsView').style.display = 'none';
            document.getElementById('threadDetailView').style.display = 'block';

            // Update breadcrumb
            document.getElementById('breadcrumbThread').innerHTML = ' &raquo; ' + thread.title;

            const container = document.getElementById('threadPostsContainer');

            // Render original post + all replies
            const replies = forums.getReplies(currentThreadId, 'oldest');
            const allPosts = [{ ...thread, isOP: true }, ...replies];

            container.innerHTML = allPosts.map((post, index) => {
                const postAuthor = auth.getUser(post.authorId || post.userId);
                const postDate = new Date(post.timestamp);
                const userVote = forums.getUserVote(post.isOP ? 'thread' : 'reply', post.id);
                const score = (post.upvotes || 0) - (post.downvotes || 0);

                return `
                    <table class="post-table">
                        <tr>
                            <td class="post-user-cell">
                                <div class="post-userinfo">
                                    <img src="${postAuthor?.avatar}" class="post-user-avatar" onclick="showProfile('${postAuthor?.username}')">
                                    <div class="post-username">${post.authorUsername || postAuthor?.username}</div>
                                    <div class="post-user-stats">
                                        <div>Posts: ${postAuthor?.stats?.totalPicks || 0}</div>
                                        <div>Joined: ${new Date(postAuthor?.joinedDate).toLocaleDateString()}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="post-content-cell">
                                <div class="post-header-bar">
                                    <div class="post-number">#${index + 1}</div>
                                    <div class="post-date">${postDate.toLocaleString()}</div>
                                </div>
                                ${post.isOP ? `<h2 class="thread-title-post">${post.title}</h2>` : ''}
                                <div class="post-message">${post.content}</div>
                                <div class="post-footer">
                                    <div class="post-voting">
                                        <button class="vote-btn-classic ${userVote === 'up' ? 'voted' : ''}" onclick="event.stopPropagation(); ${post.isOP ? 'voteThread' : 'voteReply'}('${post.id}', 'up')">üëç ${post.upvotes || 0}</button>
                                        <button class="vote-btn-classic ${userVote === 'down' ? 'voted' : ''}" onclick="event.stopPropagation(); ${post.isOP ? 'voteThread' : 'voteReply'}('${post.id}', 'down')">üëé ${post.downvotes || 0}</button>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                `;
            }).join('');
        }

        // Vote on thread
        function voteThread(threadId, voteType) {
            if (!auth.isLoggedIn()) {
                alert('Please login to vote');
                showSection('signup');
                return;
            }

            try {
                forums.vote('thread', threadId, voteType);
                showThreadDetail(threadId); // Refresh
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Vote on reply
        function voteReply(replyId, voteType) {
            if (!auth.isLoggedIn()) {
                alert('Please login to vote');
                showSection('signup');
                return;
            }

            try {
                forums.vote('reply', replyId, voteType);
                showThreadDetail(currentThreadId); // Refresh entire thread
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Submit reply
        function submitReply() {
            if (!auth.isLoggedIn()) {
                alert('Please login to reply');
                showSection('signup');
                return;
            }

            const content = document.getElementById('replyTextarea').value;

            if (!content || content.trim().length < 5) {
                alert('Reply must be at least 5 characters');
                return;
            }

            try {
                forums.addReply(currentThreadId, content.trim());
                document.getElementById('replyTextarea').value = '';
                showThreadDetail(currentThreadId); // Refresh thread
                alert('Reply posted!');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Show create thread form
        function showCreateThreadForm() {
            if (!auth.isLoggedIn()) {
                alert('Please login to create threads');
                showSection('signup');
                return;
            }

            document.getElementById('createThreadModal').style.display = 'flex';
        }

        // Close create thread form
        function closeCreateThreadForm() {
            document.getElementById('createThreadModal').style.display = 'none';
            document.getElementById('createThreadForm').reset();
        }

        // Back to categories
        function showForumCategories() {
            document.getElementById('forumCategoriesView').style.display = 'block';
            document.getElementById('categoryThreadsView').style.display = 'none';
            document.getElementById('threadDetailView').style.display = 'none';
            renderForumCategories();
        }

        // Back to threads
        function backToThreads() {
            showCategoryThreads(currentCategoryId);
        }

        // Initialize forums when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Render forums when switching to forums page
            const forumsSection = document.getElementById('forums');
            if (forumsSection) {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.target.classList.contains('active')) {
                            renderForumCategories();
                        }
                    });
                });
                observer.observe(forumsSection, { attributes: true, attributeFilter: ['class'] });
            }

            // Handle create thread form submission
            const createThreadForm = document.getElementById('createThreadForm');
            if (createThreadForm) {
                createThreadForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const title = document.getElementById('threadTitle').value;
                    const content = document.getElementById('threadContent').value;
                    const tagsInput = document.getElementById('threadTags').value;
                    const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()) : [];

                    try {
                        forums.createThread(currentCategoryId, title, content, tags);
                        closeCreateThreadForm();
                        renderThreads();
                        alert('Thread created successfully!');
                    } catch (error) {
                        alert('Error: ' + error.message);
                    }
                });
            }
        });
    </script>

    <!-- External Scripts -->
    <script src="static/js/config.js?v=20251208c"></script>
    <script src="static/js/api.js?v=20251208c"></script>
    <script src="static/js/auth-persistent.js?v=20251208c"></script>
    <script src="static/js/forms-fixed.js?v=20251208c"></script>
    <script>
        // Notifications System
        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        function markAllRead() {
            const unreadItems = document.querySelectorAll('.notification-item.unread');
            unreadItems.forEach(item => item.classList.remove('unread'));
            document.getElementById('notificationBadge').textContent = '0';
            document.getElementById('notificationBadge').style.display = 'none';
            document.getElementById('unreadCount').textContent = '0';
        }

        // Enhanced Notification Functions
        function filterNotifications(type) {
            const items = document.querySelectorAll('.notification-item');
            const buttons = document.querySelectorAll('.notif-filter-btn');

            // Update active button
            buttons.forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Filter notifications
            items.forEach(item => {
                if (type === 'all') {
                    item.style.display = 'flex';
                } else {
                    if (item.dataset.type === type) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
        }

        // Notification Action Functions
        function viewPick(pickId) {
            console.log('Viewing pick:', pickId);
            showSection('picks');
            // In real implementation, would scroll to/highlight specific pick
        }

        function viewEngagement() {
            console.log('Viewing engagement');
            showSection('profile');
        }

        function replyComment(commentId) {
            console.log('Replying to comment:', commentId);
            // In real implementation, would open comment reply modal
            alert('Reply feature coming soon!');
        }

        function viewProfile(username) {
            console.log('Viewing profile:', username);
            showSection('profile');
        }

        function viewPost(postId) {
            console.log('Viewing post:', postId);
            showSection('feed');
        }

        function viewAchievements() {
            console.log('Viewing achievements');
            showSection('profile');
        }

        // Update unread count dynamically
        function updateUnreadCount() {
            const unreadItems = document.querySelectorAll('.notification-item.unread');
            const count = unreadItems.length;
            const badge = document.getElementById('notificationBadge');
            const unreadCount = document.getElementById('unreadCount');

            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'block';
                unreadCount.textContent = count;
            } else {
                badge.style.display = 'none';
                unreadCount.textContent = '0';
            }
        }

        // Mark individual notification as read on click
        document.addEventListener('DOMContentLoaded', function() {
            const notificationItems = document.querySelectorAll('.notification-item');
            notificationItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    // Don't mark as read if clicking action button
                    if (!e.target.classList.contains('notif-action-btn')) {
                        this.classList.remove('unread');
                        updateUnreadCount();
                    }
                });
            });

            // Initial count update
            updateUnreadCount();
        });

        function toggleSearch() {
            alert('Search functionality coming soon!');
        }

        // Login is handled by forms-fixed.js

        // Close notifications when clicking outside
        document.addEventListener('click', function(event) {
            const panel = document.getElementById('notificationsPanel');
            const btn = document.getElementById('notificationBtn');
            if (panel && btn && !panel.contains(event.target) && !btn.contains(event.target)) {
                panel.style.display = 'none';
            }
        });
    </script>

    <script src="static/js/social.js?v=20251208c"></script>
    <script src="static/js/forums.js?v=20251208c"></script>
    <!-- forms.js REMOVED - forms-fixed.js handles login/signup -->
    <script src="static/js/navigation.js?v=20251208c"></script>
    <script src="static/js/effects.js?v=20251208c"></script>
    <script src="static/js/grading.js?v=20260105"></script>
    <script src="static/js/social-hub.js?v=20251216"></script>

    <!-- Backend API Integration -->
    <script src="static/js/backend-api.js?v=20260121"></script>
    <script src="static/js/app.js?v=20260121"></script>

    <script>
    // COMPLETE PICKS MODULE - FIXED VERSION v2 - January 13, 2026
    // CRITICAL: Export core functions IMMEDIATELY before any other code runs
    console.log('[TMR] Script starting - v2 build');

    // ===== CORE VARIABLES (defined FIRST) =====
    let selectedSport = null;
    let selectedBetType = null;
    let selectedGame = null;
    let selectedConfidence = 3;
    let selectedUnits = 1;
    let currentFilteredGames = [];
    let currentSelectedPick = null;

    const sportKeyMap = {
        'NFL': 'americanfootball_nfl',
        'NBA': 'basketball_nba',
        'NHL': 'icehockey_nhl',
        'MLB': 'baseball_mlb',
        'NCAAF': 'americanfootball_ncaaf',
        'NCAAB': 'basketball_ncaab'
    };

    // Games loaded from backend

    // ===== CORE FUNCTIONS DEFINED AND EXPORTED IMMEDIATELY =====
    // These MUST be available before onclick handlers fire

    function showPickStep(stepId) {
        console.log('[TMR] showPickStep:', stepId);
        const allSteps = document.querySelectorAll('.pick-step');
        allSteps.forEach(s => s.classList.remove('active'));
        const el = document.getElementById(stepId);
        if (el) el.classList.add('active');
    }
    // window.showPickStep - DEFINED EARLY in <head>, do not overwrite

    function goBackToSports() {
        showPickStep('sportSelection');
    }
    window.goBackToSports = goBackToSports;

    function goBackToGames() {
        showPickStep('gamesListSection');
    }
    window.goBackToGames = goBackToGames;

    // NOTE: selectSportAndShowGames is defined EARLY in <head> (line 42) with inline renderer
    // DO NOT redefine it here - that breaks the working version!
    console.log('[TMR] Using early selectSportAndShowGames definition (line 42)');

    // Global error handler for debugging
    window.onerror = function(message, source, lineno, colno, error) {
        console.error('[TMR ERROR]', message, 'at', source, 'line', lineno);
        return false;
    };

    // ===== GAMES LOADING AND DISPLAY =====
    async function loadGamesWithAllBets() {
        console.log('[TMR] loadGamesWithAllBets called, selectedSport:', selectedSport);

        const container = document.getElementById('gamesListContainer');
        const countBadge = document.getElementById('gamesCountBadge');

        if (!container) {
            console.error('[TMR] Container not found!');
            return;
        }

        container.innerHTML = '<div class="loading-games">Loading games...</div>';

        const sportKey = sportKeyMap[selectedSport];
        console.log('[TMR] Sport key for', selectedSport, ':', sportKey);

        if (!sportKey) {
            console.error('[TMR] Invalid sport key for:', selectedSport);
            container.innerHTML = '<div class="no-games-message"><h4>Invalid sport</h4><p>Please select a valid sport.</p></div>';
            return;
        }

        console.log('[TMR] loadGamesWithAllBets calling ESPN for:', sportKey);
        window.TMR.fetchGamesFromESPN(sportKey, function(games, err) {
            if (err) {
                console.error('Error loading games:', err);
                container.innerHTML = '<div class="no-games-message">' +
                    '<h4>Unable to Load Games</h4>' +
                    '<p style="color: var(--neon-red);">' + err + '</p>' +
                    '<p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-muted);">Please try again or select a different sport.</p>' +
                    '<div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">' +
                    '<button onclick="loadGamesWithAllBets()" style="padding: 12px 24px; background: var(--gradient-neon); border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer;">Try Again</button>' +
                    '<button onclick="goBackToSports()" style="padding: 12px 24px; background: transparent; border: 2px solid var(--neon-cyan); border-radius: 8px; color: var(--neon-cyan); font-weight: 700; cursor: pointer;">Choose Sport</button>' +
                    '</div></div>';
                return;
            }

            console.log('Loaded', games.length, 'games for', selectedSport);
            if (countBadge) countBadge.textContent = games.length + ' games';

            if (!games || games.length === 0) {
                container.innerHTML = '<div class="no-games-message">' +
                    '<h4>No Games Scheduled</h4>' +
                    '<p>No ' + selectedSport + ' games are scheduled right now.</p>' +
                    '<p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-muted);">Check back closer to game time.</p>' +
                    '<button onclick="goBackToSports()" style="margin-top: 20px; padding: 12px 24px; background: var(--gradient-neon); border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer;">Choose Another Sport</button>' +
                    '</div>';
                return;
            }

            renderGamesWithAllBets(games);
        });
    }
    window.loadGamesWithAllBets = loadGamesWithAllBets;
    console.log('TMR Picks: loadGamesWithAllBets exported');

    function renderGamesWithAllBets(games) {
        const container = document.getElementById('gamesListContainer');
        if (!container) return;

        let html = '';

        games.forEach((game, index) => {
            const bookmaker = game.bookmakers && game.bookmakers[0];
            const markets = bookmaker ? bookmaker.markets : [];

            // Extract odds
            let homeSpread = '--', awaySpread = '--', homeSpreadOdds = '', awaySpreadOdds = '';
            let homeML = '--', awayML = '--';
            let total = '--', overOdds = '', underOdds = '';

            markets.forEach(market => {
                if (market.key === 'spreads') {
                    market.outcomes.forEach(outcome => {
                        if (outcome.name === game.home_team) {
                            homeSpread = outcome.point > 0 ? '+' + outcome.point : outcome.point;
                            homeSpreadOdds = outcome.price > 0 ? '+' + outcome.price : outcome.price;
                        } else {
                            awaySpread = outcome.point > 0 ? '+' + outcome.point : outcome.point;
                            awaySpreadOdds = outcome.price > 0 ? '+' + outcome.price : outcome.price;
                        }
                    });
                }
                if (market.key === 'h2h') {
                    market.outcomes.forEach(outcome => {
                        if (outcome.name === game.home_team) {
                            homeML = outcome.price > 0 ? '+' + outcome.price : outcome.price;
                        } else {
                            awayML = outcome.price > 0 ? '+' + outcome.price : outcome.price;
                        }
                    });
                }
                if (market.key === 'totals') {
                    market.outcomes.forEach(outcome => {
                        if (outcome.name === 'Over') {
                            total = outcome.point;
                            overOdds = outcome.price > 0 ? '+' + outcome.price : outcome.price;
                        } else {
                            underOdds = outcome.price > 0 ? '+' + outcome.price : outcome.price;
                        }
                    });
                }
            });

            const gameTime = new Date(game.commence_time);
            const timeStr = gameTime.toLocaleString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });

            html += `
            <div class="game-card-new" data-game-index="${index}">
                <div class="game-card-header">
                    <span class="game-time-new">${timeStr}</span>
                    <span class="game-status">Upcoming</span>
                </div>

                <div class="game-teams-section">
                    <!-- Away Team Row -->
                    <div class="team-row">
                        <div class="team-info-left">
                            <span class="team-name-large">${game.away_team}</span>
                        </div>
                        <div class="bet-buttons-row">
                            <button class="bet-pick-btn" onclick="selectGameBet(${index}, 'spread', '${game.away_team}', '${awaySpread}', '${awaySpreadOdds}', '${game.away_team}', '${game.home_team}')">
                                <span class="line">${awaySpread}</span>
                                <span class="odds">${awaySpreadOdds}</span>
                            </button>
                            <button class="bet-pick-btn" onclick="selectGameBet(${index}, 'ml', '${game.away_team}', 'ML', '${awayML}', '${game.away_team}', '${game.home_team}')">
                                <span class="line">ML</span>
                                <span class="odds">${awayML}</span>
                            </button>
                        </div>
                    </div>

                    <!-- Home Team Row -->
                    <div class="team-row">
                        <div class="team-info-left">
                            <span class="team-name-large">${game.home_team}</span>
                        </div>
                        <div class="bet-buttons-row">
                            <button class="bet-pick-btn" onclick="selectGameBet(${index}, 'spread', '${game.home_team}', '${homeSpread}', '${homeSpreadOdds}', '${game.away_team}', '${game.home_team}')">
                                <span class="line">${homeSpread}</span>
                                <span class="odds">${homeSpreadOdds}</span>
                            </button>
                            <button class="bet-pick-btn" onclick="selectGameBet(${index}, 'ml', '${game.home_team}', 'ML', '${homeML}', '${game.away_team}', '${game.home_team}')">
                                <span class="line">ML</span>
                                <span class="odds">${homeML}</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Totals Row -->
                <div class="totals-row">
                    <button class="total-btn" onclick="selectGameBet(${index}, 'over', 'Over', '${total}', '${overOdds}', '${game.away_team}', '${game.home_team}')">
                        <span class="label">OVER</span>
                        <span class="value">${total}</span>
                        <span class="odds">${overOdds}</span>
                    </button>
                    <button class="total-btn" onclick="selectGameBet(${index}, 'under', 'Under', '${total}', '${underOdds}', '${game.away_team}', '${game.home_team}')">
                        <span class="label">UNDER</span>
                        <span class="value">${total}</span>
                        <span class="odds">${underOdds}</span>
                    </button>
                </div>

                <!-- More Markets Toggle -->
                <button class="more-markets-btn" onclick="toggleMoreMarkets(${index})">
                    <span>More Markets</span>
                    <span>‚ñº</span>
                </button>

                <div id="expandedMarkets${index}" class="expanded-markets">
                    <div class="market-section">
                        <div class="market-title">Team Totals</div>
                        <div class="team-totals-grid" style="display: grid; gap: 10px;">
                            <div class="team-total-row" style="display: flex; align-items: center; gap: 10px;">
                                <span class="team-name" style="min-width: 100px; font-weight: 600;">${game.away_team.split(' ').pop()}</span>
                                <button class="bet-pick-btn tt-over" onclick="selectGameBet(${index}, 'teamtotal', '${game.away_team} Over', '${Math.round(total/2)}', '-110', '${game.away_team}', '${game.home_team}')">
                                    <span class="line">O ${Math.round(total/2)}</span>
                                    <span class="odds">-110</span>
                                </button>
                                <button class="bet-pick-btn tt-under" onclick="selectGameBet(${index}, 'teamtotal', '${game.away_team} Under', '${Math.round(total/2)}', '-110', '${game.away_team}', '${game.home_team}')">
                                    <span class="line">U ${Math.round(total/2)}</span>
                                    <span class="odds">-110</span>
                                </button>
                            </div>
                            <div class="team-total-row" style="display: flex; align-items: center; gap: 10px;">
                                <span class="team-name" style="min-width: 100px; font-weight: 600;">${game.home_team.split(' ').pop()}</span>
                                <button class="bet-pick-btn tt-over" onclick="selectGameBet(${index}, 'teamtotal', '${game.home_team} Over', '${Math.round(total/2)}', '-110', '${game.away_team}', '${game.home_team}')">
                                    <span class="line">O ${Math.round(total/2)}</span>
                                    <span class="odds">-110</span>
                                </button>
                                <button class="bet-pick-btn tt-under" onclick="selectGameBet(${index}, 'teamtotal', '${game.home_team} Under', '${Math.round(total/2)}', '-110', '${game.away_team}', '${game.home_team}')">
                                    <span class="line">U ${Math.round(total/2)}</span>
                                    <span class="odds">-110</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="market-section">
                        <div class="market-title">Player Props & Alt Lines</div>
                        <p style="color: var(--text-muted); font-size: 0.9rem;">Coming soon</p>
                    </div>
                </div>
            </div>
            `;
        });

        container.innerHTML = html;
    }
    window.renderGamesWithAllBets = renderGamesWithAllBets;
    console.log('TMR Picks: renderGamesWithAllBets exported');

    function toggleMoreMarkets(gameIndex) {
        const el = document.getElementById('expandedMarkets' + gameIndex);
        if (el) el.classList.toggle('show');
    }

    function selectGameBet(gameIndex, betType, team, line, odds, awayTeam, homeTeam) {
        console.log('selectGameBet called:', { gameIndex, betType, team, line, odds });

        // Get game time from stored games
        let gameTime = null;
        let gameId = null;
        if (window.TMR && window.TMR.currentGames && window.TMR.currentGames[gameIndex]) {
            const game = window.TMR.currentGames[gameIndex];
            gameTime = game.commence_time;
            gameId = game.id;
        }

        // Store the selection
        currentSelectedPick = {
            gameIndex,
            betType,
            team,
            line,
            odds,
            awayTeam,
            homeTeam,
            sport: window.TMR.selectedSport || selectedSport,
            gameTime: gameTime,
            gameId: gameId
        };
        window.TMR.currentSelectedPick = currentSelectedPick;

        // Update UI to show selection - remove selected from all, then find matching button
        document.querySelectorAll('.bet-pick-btn, .total-btn').forEach(btn => btn.classList.remove('selected'));

        // Update summary
        const summaryGame = document.getElementById('summaryGame');
        const summaryPick = document.getElementById('summaryPick');
        const summaryOdds = document.getElementById('summaryOdds');

        if (summaryGame) summaryGame.textContent = awayTeam + ' @ ' + homeTeam;
        if (summaryPick) summaryPick.textContent = team + ' ' + line;
        if (summaryOdds) summaryOdds.textContent = odds;

        // Go to confirmation
        showPickStep('pickDetails');
    }
    // window.selectGameBet - DEFINED EARLY in <head>, do not overwrite
    // submitPickNew / lockInPick - DEFINED EARLY in <head>, do not overwrite
    console.log('TMR Picks: Using early-block lockInPick (inline confirmation, no alerts)');

    // Initialize game counts on page load
    async function initGameCounts() {
        const sportMap = {
            'NBA': 'basketball_nba', 'NFL': 'americanfootball_nfl', 'NHL': 'icehockey_nhl',
            'NCAAB': 'basketball_ncaab', 'NCAAF': 'americanfootball_ncaaf', 'MLB': 'baseball_mlb'
        };
        const sports = ['NBA', 'NFL', 'NHL', 'NCAAB', 'NCAAF', 'MLB'];
        for (const sport of sports) {
            const el = document.getElementById(sport.toLowerCase() + '-game-count');
            if (el) el.textContent = 'Loading...';
        }
        // Fetch real game counts from ESPN
        for (const sport of sports) {
            const el = document.getElementById(sport.toLowerCase() + '-game-count');
            if (!el) continue;
            const sportKey = sportMap[sport];
            if (window.TMR && window.TMR.fetchGamesFromESPN) {
                try {
                    window.TMR.fetchGamesFromESPN(sportKey, function(games, err) {
                        if (err || !games) {
                            el.textContent = 'Click to view';
                        } else {
                            el.textContent = games.length + ' game' + (games.length !== 1 ? 's' : '') + ' today';
                            el.style.color = games.length > 0 ? '#00c853' : '#6c7380';
                        }
                    });
                } catch(e) {
                    el.textContent = 'Click to view';
                }
            } else {
                el.textContent = 'Click to view';
            }
        }
    }

    // Call init on page load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initGameCounts);
    } else {
        initGameCounts();
    }

    // Bet type labels per sport
    const betTypeLabels = {
        'NHL': { spread: 'Puck Line', moneyline: 'Money Line', total: 'Over/Under', teamTotal: 'Team Totals', prop: 'Player Props', alt: 'Alternate Lines' },
        'MLB': { spread: 'Run Line', moneyline: 'Money Line', total: 'Over/Under', teamTotal: 'Team Totals', prop: 'Player Props', alt: 'Alternate Lines' },
        'NFL': { spread: 'Point Spread', moneyline: 'Money Line', total: 'Over/Under', teamTotal: 'Team Totals', prop: 'Player Props', alt: 'Alternate Lines' },
        'NBA': { spread: 'Point Spread', moneyline: 'Money Line', total: 'Over/Under', teamTotal: 'Team Totals', prop: 'Player Props', alt: 'Alternate Lines' },
        'NCAAF': { spread: 'Point Spread', moneyline: 'Money Line', total: 'Over/Under', teamTotal: 'Team Totals', prop: 'Player Props', alt: 'Alternate Lines' },
        'NCAAB': { spread: 'Point Spread', moneyline: 'Money Line', total: 'Over/Under', teamTotal: 'Team Totals', prop: 'Player Props', alt: 'Alternate Lines' }
    };

    function selectSport(sport) {
        selectedSport = sport;
        document.querySelectorAll('.sport-card').forEach(card => card.classList.remove('selected'));
        if (event && event.currentTarget) event.currentTarget.classList.add('selected');

        // Update bet type labels
        const labels = betTypeLabels[sport] || betTypeLabels['NFL'];
        if (document.getElementById('spreadLabel')) document.getElementById('spreadLabel').textContent = labels.spread;
        if (document.getElementById('moneylineLabel')) document.getElementById('moneylineLabel').textContent = labels.moneyline;
        if (document.getElementById('totalLabel')) document.getElementById('totalLabel').textContent = labels.total;
        if (document.getElementById('teamTotalLabel')) document.getElementById('teamTotalLabel').textContent = labels.teamTotal;
        if (document.getElementById('propLabel')) document.getElementById('propLabel').textContent = labels.prop;
        if (document.getElementById('altLabel')) document.getElementById('altLabel').textContent = labels.alt;

        setTimeout(() => showStep('betType'), 300);
    }

    function showStep(step) {
        document.querySelectorAll('.pick-step').forEach(s => s.classList.remove('active'));
        const steps = { 'sport': 'sportSelection', 'betType': 'betTypeSelection', 'game': 'gameSelection', 'details': 'pickDetails' };
        const el = document.getElementById(steps[step]);
        if (el) el.classList.add('active');
    }

    function goBack(toStep) {
        showStep(toStep);
    }

    function selectBetType(betType) {
        selectedBetType = betType;
        document.querySelectorAll('.bet-type-btn').forEach(btn => btn.classList.remove('selected'));
        if (event && event.currentTarget) event.currentTarget.classList.add('selected');

        // Load games immediately when bet type is selected
        loadGames();
        setTimeout(() => showStep('game'), 300);
    }

    // REAL API ONLY - NO FAKE DATA
    // Games loaded from backend

    async function loadGames() {
        console.log('Loading REAL games for:', selectedSport, selectedBetType);
        const gamesGrid = document.getElementById('gamesGrid');
        if (!gamesGrid) {
            console.error('gamesGrid element not found');
            return;
        }

        gamesGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--neon-cyan);">Loading games...</div>';

        const sportKey = sportKeyMap[selectedSport];
        if (!sportKey) {
            gamesGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--neon-red);">Invalid sport selected</div>';
            return;
        }

        console.log('[TMR] Third path calling ESPN for:', sportKey);
        window.TMR.fetchGamesFromESPN(sportKey, function(rawGames, err) {
            if (err) {
                console.error('Error loading games (third path):', err);
                gamesGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--neon-red);">Failed to load games: ' + err + '</div>';
                return;
            }
            console.log('ESPN returned', rawGames.length, 'raw games');

            if (!rawGames || rawGames.length === 0) {
                gamesGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);">No games scheduled for ' + selectedSport + ' right now.<br><br>Check back closer to game time.</div>';
                return;
            }

            // Format the games
            const games = rawGames.map(game => {
                const bookmaker = game.bookmakers && game.bookmakers[0];
                const markets = bookmaker ? bookmaker.markets : [];

                const h2h = markets.find(m => m.key === 'h2h');
                const spreads = markets.find(m => m.key === 'spreads');
                const totals = markets.find(m => m.key === 'totals');

                return {
                    id: game.id,
                    sport: game.sport_key,
                    sport_title: game.sport_title,
                    commence_time: game.commence_time,
                    home_team: game.home_team,
                    away_team: game.away_team,
                    odds: {
                        moneyline: h2h ? {
                            home: h2h.outcomes.find(o => o.name === game.home_team)?.price,
                            away: h2h.outcomes.find(o => o.name === game.away_team)?.price
                        } : null,
                        spread: spreads ? {
                            home: {
                                point: spreads.outcomes.find(o => o.name === game.home_team)?.point,
                                price: spreads.outcomes.find(o => o.name === game.home_team)?.price
                            },
                            away: {
                                point: spreads.outcomes.find(o => o.name === game.away_team)?.point,
                                price: spreads.outcomes.find(o => o.name === game.away_team)?.price
                            }
                        } : null,
                        totals: totals ? {
                            over: {
                                point: totals.outcomes.find(o => o.name === 'Over')?.point,
                                price: totals.outcomes.find(o => o.name === 'Over')?.price
                            },
                            under: {
                                point: totals.outcomes.find(o => o.name === 'Under')?.point,
                                price: totals.outcomes.find(o => o.name === 'Under')?.price
                            }
                        } : null
                    }
                };
            });

            // Sort by game time
            games.sort((a, b) => new Date(a.commence_time) - new Date(b.commence_time));
            currentFilteredGames = games;
            renderGames(gamesGrid, games);
            console.log('Rendered', games.length, 'REAL games');

        });
    }

    function renderGames(container, games) {
        const labels = betTypeLabels[selectedSport] || betTypeLabels['NFL'];

        container.innerHTML = games.map((game, index) => {
            const date = new Date(game.commence_time);
            const now = new Date();
            const hoursUntil = (date - now) / (1000 * 60 * 60);

            let dateStr = hoursUntil < 0 ? 'LIVE' :
                         hoursUntil < 24 ? 'Today ' + date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) :
                         hoursUntil < 48 ? 'Tomorrow ' + date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) :
                         date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ' + date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

            let oddsDisplay = generateOddsDisplay(game, selectedBetType, labels);

            return '<div class="game-card" onclick="selectGameFromGrid(' + index + ')">' +
                '<div class="game-time">' + dateStr + '</div>' +
                '<div class="game-matchup">' +
                    '<div class="team away"><span class="team-name">' + game.away_team + '</span></div>' +
                    '<div class="at-symbol">@</div>' +
                    '<div class="team home"><span class="team-name">' + game.home_team + '</span></div>' +
                '</div>' +
                oddsDisplay +
            '</div>';
        }).join('');

        console.log('Rendered ' + games.length + ' ' + selectedSport + ' games');
    }

    function generateOddsDisplay(game, betType, labels) {
        if (!game.odds) return '<div class="game-odds"><div class="no-odds">Odds coming soon</div></div>';

        const awayShort = game.away_team.split(' ').pop();
        const homeShort = game.home_team.split(' ').pop();

        switch(betType) {
            case 'spread':
                if (!game.odds.spread) return '<div class="game-odds"><div class="no-odds">Spread not available</div></div>';
                const homeSpread = game.odds.spread.home.point > 0 ? '+' + game.odds.spread.home.point : game.odds.spread.home.point;
                const awaySpread = game.odds.spread.away.point > 0 ? '+' + game.odds.spread.away.point : game.odds.spread.away.point;
                return '<div class="game-odds">' +
                    '<div class="odds-row"><span class="team-short">' + awayShort + '</span> <span class="odds-value">' + awaySpread + ' (' + formatOdds(game.odds.spread.away.price) + ')</span></div>' +
                    '<div class="odds-row"><span class="team-short">' + homeShort + '</span> <span class="odds-value">' + homeSpread + ' (' + formatOdds(game.odds.spread.home.price) + ')</span></div>' +
                '</div>';

            case 'moneyline':
                if (!game.odds.moneyline) return '<div class="game-odds"><div class="no-odds">Moneyline not available</div></div>';
                return '<div class="game-odds">' +
                    '<div class="odds-row"><span class="team-short">' + awayShort + '</span> <span class="odds-value ml">' + formatOdds(game.odds.moneyline.away) + '</span></div>' +
                    '<div class="odds-row"><span class="team-short">' + homeShort + '</span> <span class="odds-value ml">' + formatOdds(game.odds.moneyline.home) + '</span></div>' +
                '</div>';

            case 'total':
                if (!game.odds.totals) return '<div class="game-odds"><div class="no-odds">Totals not available</div></div>';
                return '<div class="game-odds">' +
                    '<div class="odds-row"><span class="total-label">Over</span> <span class="odds-value">' + game.odds.totals.over.point + ' (' + formatOdds(game.odds.totals.over.price) + ')</span></div>' +
                    '<div class="odds-row"><span class="total-label">Under</span> <span class="odds-value">' + game.odds.totals.under.point + ' (' + formatOdds(game.odds.totals.under.price) + ')</span></div>' +
                '</div>';

            case 'teamTotal':
                if (!game.odds.totals) return '<div class="game-odds"><div class="no-odds">Team totals available after game selection</div></div>';
                const halfTotal = (game.odds.totals.over.point / 2).toFixed(1);
                return '<div class="game-odds">' +
                    '<div class="odds-row"><span class="team-short">' + awayShort + '</span> <span class="odds-value">O/U ' + halfTotal + '</span></div>' +
                    '<div class="odds-row"><span class="team-short">' + homeShort + '</span> <span class="odds-value">O/U ' + halfTotal + '</span></div>' +
                '</div>';

            case 'prop':
                return '<div class="game-odds"><div class="prop-notice">Player props available - click to select</div></div>';

            case 'alt':
                return '<div class="game-odds">' +
                    '<div class="alt-notice">Alternate spreads & totals</div>' +
                    '<div class="alt-preview">Multiple lines available</div>' +
                '</div>';

            default:
                return '<div class="game-odds"><div class="no-odds">Select a bet type</div></div>';
        }
    }

    function formatOdds(odds) {
        if (!odds && odds !== 0) return 'N/A';
        return odds > 0 ? '+' + odds : '' + odds;
    }

    function selectGameFromGrid(index) {
        if (!currentFilteredGames || !currentFilteredGames[index]) {
            console.error('Game not found at index:', index);
            return;
        }

        const game = currentFilteredGames[index];
        selectedGame = game.away_team + ' @ ' + game.home_team;
        currentSelectedPick = { game: game, index: index };

        // Update summary
        document.getElementById('summaryGame').textContent = selectedGame;

        // Auto-populate pick based on bet type
        updatePickSummary(game);

        showStep('details');
    }

    function updatePickSummary(game) {
        const summaryPick = document.getElementById('summaryPick');
        const summaryOdds = document.getElementById('summaryOdds');

        if (selectedBetType === 'spread' && game.odds && game.odds.spread) {
            const homeSpread = game.odds.spread.home.point > 0 ? '+' + game.odds.spread.home.point : game.odds.spread.home.point;
            summaryPick.textContent = game.home_team + ' ' + homeSpread;
            summaryOdds.textContent = formatOdds(game.odds.spread.home.price);
        } else if (selectedBetType === 'moneyline' && game.odds && game.odds.moneyline) {
            summaryPick.textContent = game.home_team + ' ML';
            summaryOdds.textContent = formatOdds(game.odds.moneyline.home);
        } else if (selectedBetType === 'total' && game.odds && game.odds.totals) {
            summaryPick.textContent = 'Over ' + game.odds.totals.over.point;
            summaryOdds.textContent = formatOdds(game.odds.totals.over.price);
        } else if (selectedBetType === 'teamTotal') {
            const halfTotal = game.odds && game.odds.totals ? (game.odds.totals.over.point / 2).toFixed(1) : '0';
            summaryPick.textContent = game.home_team + ' Over ' + halfTotal;
            summaryOdds.textContent = '-110';
        } else {
            summaryPick.textContent = 'Select your pick';
            summaryOdds.textContent = 'TBD';
        }
    }

    function setConfidence(level) {
        selectedConfidence = level;
        document.querySelectorAll('.conf-btn').forEach(btn => btn.classList.remove('active'));
        // Find button by data-conf attribute (more reliable than event.currentTarget)
        const targetBtn = document.querySelector(`.conf-btn[data-conf="${level}"]`);
        if (targetBtn) targetBtn.classList.add('active');
    }

    // setUnitsMode and getUnitsValue are defined in the early script block on window.TMR
    // Local aliases for convenience
    var selectedUnitsMode = window.TMR.selectedUnitsMode;

    function getUnitsValue() {
        return window.TMR.getUnitsValue();
    }

    function setUnits(units) {
        console.log('[TMR] setUnits called with:', units);
        selectedUnits = units;
        var input = document.getElementById('unitsInput');
        if (input) input.value = units;
    }

    function submitPick() {
        if (!selectedSport || !selectedBetType || !selectedGame) {
            alert('Please complete all selections before submitting.');
            return;
        }

        const reasoning = document.getElementById('pickReasoning') ? document.getElementById('pickReasoning').value : '';
        const summaryPick = document.getElementById('summaryPick').textContent;
        const summaryOdds = document.getElementById('summaryOdds').textContent;

        const pick = {
            id: Date.now(),
            sport: selectedSport,
            betType: selectedBetType,
            game: selectedGame,
            pick: summaryPick,
            odds: summaryOdds,
            confidence: selectedConfidence,
            units: getUnitsValue(),
            unitsMode: window.TMR.selectedUnitsMode || 'risk',
            reasoning: reasoning,
            timestamp: new Date().toISOString(),
            status: 'pending'
        };

        // Save to localStorage
        if (window.auth && window.auth.isLoggedIn()) {
            const marketTypeMap = { ml: 'h2h', spread: 'spreads', over: 'totals', under: 'totals', total: 'totals' };
            const marketType = marketTypeMap[pick.betType] || 'h2h';
            const selection = pick.pick || '';
            const units = Math.max(0.5, Math.min(10, parseFloat(pick.units) || 1));
            const sportKeyMap = { 'NFL': 'americanfootball_nfl', 'NBA': 'basketball_nba', 'NHL': 'icehockey_nhl', 'MLB': 'baseball_mlb', 'NCAAF': 'americanfootball_ncaaf', 'NCAAB': 'basketball_ncaab' };
            const user = window.auth.getCurrentUser();

            const newPick = {
                id: 'pick_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
                user_id: user.username || user.id || 'local',
                game_id: (pick.game && pick.game.id) || '',
                sport_key: sportKeyMap[pick.sport] || pick.sport || '',
                sport_display: pick.sport || '',
                home_team: pick.homeTeam || '',
                away_team: pick.awayTeam || '',
                selection: selection,
                market_type: marketType,
                line_snapshot: pick.line ? parseFloat(pick.line) : null,
                odds_snapshot: parseInt(pick.odds, 10) || -110,
                units: units,
                status: 'pending',
                result_units: null,
                locked_at: new Date().toISOString(),
                commence_time: pick.gameTime || new Date().toISOString(),
                graded_at: null,
                home_score: null,
                away_score: null
            };

            let allPicks = [];
            try { allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]'); } catch(e) { allPicks = []; }
            allPicks.unshift(newPick);
            localStorage.setItem('tmr_picks', JSON.stringify(allPicks));
            console.log('Pick saved to localStorage:', newPick);
            alert('Pick submitted and saved to your permanent record!');
        } else {
            alert('Please log in to submit picks.');
            return;
        }

        // Update history display
        loadPicksHistory();

        // Reset form
        resetPickForm();
        showStep('sport');
    }

    function resetPickForm() {
        selectedSport = null;
        selectedBetType = null;
        selectedGame = null;
        selectedConfidence = 3;
        selectedUnits = 1;
        window.TMR.selectedUnitsMode = 'risk';
        currentSelectedPick = null;

        document.querySelectorAll('.sport-card').forEach(c => c.classList.remove('selected'));
        document.querySelectorAll('.bet-type-btn').forEach(b => b.classList.remove('selected'));
        document.querySelectorAll('.conf-btn').forEach(b => b.classList.remove('active'));

        const defaultConf = document.querySelector('.conf-btn[data-conf="3"]');
        if (defaultConf) defaultConf.classList.add('active');

        var unitsInput = document.getElementById('unitsInput');
        if (unitsInput) unitsInput.value = '1';
        if (typeof setUnitsMode === 'function') setUnitsMode('risk');

        const reasoning = document.getElementById('pickReasoning');
        if (reasoning) reasoning.value = '';

        const gamesGrid = document.getElementById('gamesGrid');
        if (gamesGrid) gamesGrid.innerHTML = '';
    }

    async function loadPicksHistory() {
        const container = document.getElementById('recentPicksContainer');
        if (!container) return;

        // Read from localStorage
        let picks = [];
        if (window.auth && window.auth.isLoggedIn()) {
            try {
                const user = window.auth.getCurrentUser();
                const userId = user.username || user.id || 'local';
                const allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]');
                picks = allPicks.filter(p => p.user_id === userId).slice(0, 10).map(p => ({
                    status: p.status || 'pending',
                    game: (p.away_team || '') + ' vs ' + (p.home_team || ''),
                    pick: p.selection + (p.line_snapshot ? ' ' + p.line_snapshot : ''),
                    odds: p.odds_snapshot || -110,
                    units: p.units || 1,
                    timestamp: p.locked_at || p.commence_time,
                    finalScore: (p.home_score !== null && p.away_score !== null) ? p.away_team + ' ' + p.away_score + ' - ' + p.home_team + ' ' + p.home_score : null
                }));
            } catch (e) {
                console.warn('Failed to load picks history from backend:', e);
            }
        }

        if (picks.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No picks yet. Make your first pick above!</p>';
            return;
        }

        const sortedPicks = picks;

        container.innerHTML = sortedPicks.slice(0, 10).map((pick, idx) => {
            const status = pick.status || 'pending';
            const isWin = status === 'won' || status === 'win';
            const isLoss = status === 'lost' || status === 'loss';
            const isPending = status === 'pending' || !status;
            const isPush = status === 'push';

            // Color coding
            let borderColor = 'var(--neon-gold)'; // pending = gold
            let statusBg = 'rgba(255, 215, 0, 0.2)';
            let statusColor = 'var(--neon-gold)';

            if (isWin) {
                borderColor = 'var(--neon-green)';
                statusBg = 'rgba(57, 255, 20, 0.2)';
                statusColor = 'var(--neon-green)';
            } else if (isLoss) {
                borderColor = 'var(--neon-red)';
                statusBg = 'rgba(255, 7, 58, 0.2)';
                statusColor = 'var(--neon-red)';
            } else if (isPush) {
                borderColor = 'var(--neon-purple)';
                statusBg = 'rgba(255, 0, 255, 0.2)';
                statusColor = 'var(--neon-purple)';
            }

            const game = pick.game || (pick.team1 && pick.team2 ? pick.team1 + ' vs ' + pick.team2 : 'Game');
            const pickDisplay = pick.pick || 'Pick';
            const odds = pick.odds || '-110';
            const units = pick.units || '1';
            const date = pick.timestamp ? new Date(pick.timestamp).toLocaleDateString() : '';
            const originalIdx = picks.indexOf(pick);

            return `
                <div style="background: rgba(0,0,0,0.3); border-left: 4px solid ${borderColor}; border-radius: 8px; padding: 15px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #fff; font-size: 1rem; margin-bottom: 4px;">${game}</div>
                            <div style="color: var(--neon-cyan); font-size: 0.95rem;">${pickDisplay} (${odds}) - ${units}u</div>
                            <div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 4px;">${date}</div>
                        </div>
                        <div style="background: ${statusBg}; color: ${statusColor}; padding: 6px 14px; border-radius: 20px; font-weight: 700; font-size: 0.85rem; text-transform: uppercase;">
                            ${status}
                        </div>
                    </div>
                    ${isPending ? `
                    <div style="display: flex; gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <button onclick="quickGrade(${originalIdx}, 'win')" style="flex:1; padding: 8px; background: rgba(57,255,20,0.15); border: 1px solid var(--neon-green); border-radius: 6px; color: var(--neon-green); cursor: pointer; font-weight: 600; font-size: 0.85rem;">WIN</button>
                        <button onclick="quickGrade(${originalIdx}, 'loss')" style="flex:1; padding: 8px; background: rgba(255,7,58,0.15); border: 1px solid var(--neon-red); border-radius: 6px; color: var(--neon-red); cursor: pointer; font-weight: 600; font-size: 0.85rem;">LOSS</button>
                        <button onclick="quickGrade(${originalIdx}, 'push')" style="flex:1; padding: 8px; background: rgba(255,0,255,0.15); border: 1px solid var(--neon-purple); border-radius: 6px; color: var(--neon-purple); cursor: pointer; font-weight: 600; font-size: 0.85rem;">PUSH</button>
                    </div>
                    ` : (pick.finalScore ? `<div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 5px;">Final: ${pick.finalScore}</div>` : '')}
                </div>
            `;
        }).join('');
    }

    // Quick grade disabled - grading is now server-side
    function quickGrade(idx, result) {
        console.log('[TMR] Manual grading is disabled. Picks are graded automatically by the server.');
        alert('Pick grading is now automatic! The server grades picks every 15 minutes.');
        loadPicksHistory();
    }
    window.quickGrade = quickGrade;

    // Try auto-grading all pending picks (delegates to the real grading engine)
    function tryAutoGradeAll() {
        if (typeof window.autoGradeAll === 'function') {
            window.autoGradeAll().then(function() {
                loadPicksHistory();
                if (typeof updateStatsDashboard === 'function') updateStatsDashboard();
                if (typeof loadMyRecordPage === 'function') loadMyRecordPage();
            }).catch(function(err) {
                console.error('Auto-grade error:', err);
            });
        }
    }
    window.tryAutoGradeAll = tryAutoGradeAll;

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('Picks module initialized');
        showStep('sport');
        // Ensure backend picks are cached before loading history
        if (typeof ensureBackendPicks === 'function') {
            await ensureBackendPicks();
        }
        loadPicksHistory();

        // Update game counts
        updateGameCounts();

        // Units input validation
        var unitsInput = document.getElementById('unitsInput');
        if (unitsInput) {
            unitsInput.addEventListener('change', function() {
                var val = parseFloat(this.value);
                if (isNaN(val) || val < 0.5) val = 0.5;
                if (val > 5) val = 5;
                val = Math.round(val * 2) / 2;
                this.value = val;
                selectedUnits = val;
                console.log('[TMR] Units set to:', val);
            });
        }
    });

    async function updateGameCounts() {
        // Update the "X games today" text on sport cards
        const sportCards = document.querySelectorAll('.sport-card');
        sportCards.forEach(card => {
            const sport = card.getAttribute('data-sport');
            const gamesSpan = card.querySelector('.sport-games');
            if (gamesSpan && sport) {
                // For now use placeholder - will update with real API data
                const counts = { 'NFL': 14, 'NBA': 12, 'NHL': 10, 'MLB': 15, 'NCAAF': 25, 'NCAAB': 40 };
                gamesSpan.textContent = (counts[sport] || 0) + ' games available';
            }
        });
    }

    // Export all functions
    window.selectSport = selectSport;
    window.selectBetType = selectBetType;
    window.showStep = showStep;
    window.goBack = goBack;
    window.setConfidence = setConfidence;
    window.setUnits = setUnits;
    window.submitPick = submitPick;
    window.loadGames = loadGames;
    window.selectGameFromGrid = selectGameFromGrid;
    window.loadPicksHistory = loadPicksHistory;
    window.formatOdds = formatOdds;
    // window.selectSportAndShowGames - DEFINED EARLY in <head>, do not overwrite!
    // window.showPickStep - DEFINED EARLY in <head>, do not overwrite!
    // window.goBackToSports - DEFINED EARLY in <head>, do not overwrite!
    // window.goBackToGames - DEFINED EARLY in <head>, do not overwrite!
    window.loadGamesWithAllBets = loadGamesWithAllBets;
    // window.selectGameBet - DEFINED EARLY in <head>, do not overwrite
    // window.submitPickNew - DEFINED EARLY in <head>, do not overwrite

    // ========== ADVANCED STATS ENGINE ==========
    // Comprehensive analytics for TrustMyRecord.com

    const SPORT_ICONS = {
        'NBA': 'üèÄ', 'NFL': 'üèà', 'NHL': 'üèí', 'MLB': '‚öæ',
        'NCAAB': 'üè´', 'NCAAF': 'üéì', 'SOCCER': '‚öΩ', 'OTHER': 'üéØ'
    };

    // Calculate units won/lost for a pick
    function calculatePickUnits(pick) {
        const units = parseFloat(pick.units) || 1;
        const odds = parseFloat(pick.odds) || -110;

        if (pick.status === 'won') {
            return odds > 0 ? units * (odds / 100) : units * (100 / Math.abs(odds));
        } else if (pick.status === 'lost') {
            return -units;
        }
        return 0;
    }

    // Calculate implied probability from odds
    function impliedProbability(odds) {
        odds = parseFloat(odds) || -110;
        if (odds > 0) return 100 / (odds + 100);
        return Math.abs(odds) / (Math.abs(odds) + 100);
    }

    // Calculate Z-Score for statistical significance
    function calculateZScore(wins, total, avgImpliedProb) {
        if (total < 2) return 0;
        const expectedWinRate = avgImpliedProb || 0.5;
        const actualWinRate = wins / total;
        const stdDev = Math.sqrt(expectedWinRate * (1 - expectedWinRate) / total);
        if (stdDev === 0) return 0;
        return (actualWinRate - expectedWinRate) / stdDev;
    }

    // Calculate streaks (current and best)
    function calculateStreaks(picks) {
        const graded = picks.filter(p => p.status === 'won' || p.status === 'lost')
            .sort((a, b) => new Date(b.locked_at || b.timestamp || 0) - new Date(a.locked_at || a.timestamp || 0));

        let currentStreak = 0, currentType = '', bestWin = 0, bestLoss = 0;
        let tempStreak = 0, tempType = '';

        for (let i = 0; i < graded.length; i++) {
            const status = graded[i].status;
            if (i === 0 || status === tempType) {
                tempStreak++;
                tempType = status;
            } else {
                if (tempType === 'won' && tempStreak > bestWin) bestWin = tempStreak;
                if (tempType === 'lost' && tempStreak > bestLoss) bestLoss = tempStreak;
                tempStreak = 1;
                tempType = status;
            }
            if (i === 0) { currentStreak = tempStreak; currentType = tempType; }
        }
        // Check last streak
        if (tempType === 'won' && tempStreak > bestWin) bestWin = tempStreak;
        if (tempType === 'lost' && tempStreak > bestLoss) bestLoss = tempStreak;

        // Update current streak count
        for (let i = 0; i < graded.length; i++) {
            if (graded[i].status === graded[0]?.status) currentStreak = i + 1;
            else break;
        }

        return { current: currentStreak, currentType: graded[0]?.status || '', bestWin, bestLoss };
    }

    // Main function to load advanced stats page
    function loadMyRecordPage() {
        const picks = window._cachedBackendPicks || [];

        // Basic counts - backend uses 'won'/'lost' not 'win'/'loss'
        const wins = picks.filter(p => p.status === 'won').length;
        const losses = picks.filter(p => p.status === 'lost').length;
        const pushes = picks.filter(p => p.status === 'push').length;
        const graded = wins + losses + pushes;
        const total = picks.length;

        // Calculate units
        let unitsProfit = 0, totalRisked = 0;
        let oddsSum = 0, oddsCount = 0;

        picks.forEach(pick => {
            unitsProfit += calculatePickUnits(pick);
            if (pick.status !== 'pending' && pick.status) {
                totalRisked += parseFloat(pick.units) || 1;
            }
            const odds = parseFloat(pick.odds);
            if (!isNaN(odds)) { oddsSum += odds; oddsCount++; }
        });

        const avgOdds = oddsCount > 0 ? Math.round(oddsSum / oddsCount) : -110;
        const winRate = graded > 0 ? (wins / graded * 100).toFixed(1) : '0.0';
        const roi = totalRisked > 0 ? (unitsProfit / totalRisked * 100).toFixed(1) : '0.0';

        // Average implied probability
        let avgImplied = 0;
        picks.forEach(p => { avgImplied += impliedProbability(p.odds); });
        avgImplied = picks.length > 0 ? avgImplied / picks.length : 0.5;

        const zScore = calculateZScore(wins, graded, avgImplied);
        const streaks = calculateStreaks(picks);
        const avgUnits = picks.length > 0 ? (picks.reduce((s,p) => s + (parseFloat(p.units)||1), 0) / picks.length).toFixed(1) : '1.0';

        // Update Primary Stats
        updateEl('advRecordDisplay', `${wins}-${losses}-${pushes}`);
        updateEl('advWinRate', `${winRate}%`);

        const unitsEl = document.getElementById('advUnitsProfit');
        if (unitsEl) {
            unitsEl.textContent = (unitsProfit >= 0 ? '+' : '') + unitsProfit.toFixed(2);
            unitsEl.className = 'big-stat-value ' + (unitsProfit >= 0 ? 'positive' : 'negative');
        }

        const roiEl = document.getElementById('advROI');
        if (roiEl) {
            roiEl.textContent = (parseFloat(roi) >= 0 ? '+' : '') + roi + '%';
            roiEl.className = 'big-stat-value ' + (parseFloat(roi) >= 0 ? 'positive' : 'negative');
        }

        // Secondary Stats
        updateEl('advZScore', zScore.toFixed(2));
        updateEl('advAvgOdds', avgOdds > 0 ? '+' + avgOdds : avgOdds.toString());
        updateEl('advCurrentStreak', streaks.current > 0 ? streaks.current + (streaks.currentType === 'won' ? 'W' : 'L') : '-');
        updateEl('advBestStreak', streaks.bestWin + 'W');
        updateEl('advAvgUnits', avgUnits);
        updateEl('advTotalPicks', total.toString());

        // Sport Breakdown Table
        renderSportBreakdown(picks);

        // Bet Type Breakdown Table
        renderBetTypeBreakdown(picks);

        // Load history (hidden by default)
        filterAdvHistory('all');
    }

    function updateEl(id, value) {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
    }

    // Render sport breakdown table
    function renderSportBreakdown(picks) {
        const tbody = document.getElementById('sportBreakdownBody');
        if (!tbody) return;

        const stats = {};
        picks.forEach(p => {
            const sport = (p.sport || 'OTHER').toUpperCase();
            if (!stats[sport]) stats[sport] = { w: 0, l: 0, p: 0, units: 0, risked: 0 };
            if (p.status === 'won') { stats[sport].w++; stats[sport].units += calculatePickUnits(p); stats[sport].risked += parseFloat(p.units)||1; }
            else if (p.status === 'lost') { stats[sport].l++; stats[sport].units += calculatePickUnits(p); stats[sport].risked += parseFloat(p.units)||1; }
            else if (p.status === 'push') stats[sport].p++;
        });

        if (Object.keys(stats).length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color: var(--text-muted);">No graded picks yet</td></tr>';
            return;
        }

        tbody.innerHTML = Object.entries(stats)
            .sort((a, b) => (b[1].w + b[1].l) - (a[1].w + a[1].l))
            .map(([sport, s]) => {
                const total = s.w + s.l + s.p;
                const winPct = (s.w + s.l) > 0 ? (s.w / (s.w + s.l) * 100).toFixed(1) : '0.0';
                const roi = s.risked > 0 ? (s.units / s.risked * 100).toFixed(1) : '0.0';
                const icon = SPORT_ICONS[sport] || 'üéØ';
                return `<tr>
                    <td><span class="sport-icon">${icon}</span>${sport}</td>
                    <td>${s.w}-${s.l}-${s.p}</td>
                    <td>${winPct}%</td>
                    <td class="${s.units >= 0 ? 'positive' : 'negative'}">${s.units >= 0 ? '+' : ''}${s.units.toFixed(2)}</td>
                    <td class="${parseFloat(roi) >= 0 ? 'positive' : 'negative'}">${parseFloat(roi) >= 0 ? '+' : ''}${roi}%</td>
                </tr>`;
            }).join('');
    }

    // Render bet type breakdown
    function renderBetTypeBreakdown(picks) {
        const tbody = document.getElementById('betTypeBreakdownBody');
        if (!tbody) return;

        const stats = {};
        picks.forEach(p => {
            let type = (p.betType || 'OTHER').toUpperCase();
            if (type === 'MONEYLINE') type = 'ML';
            if (!stats[type]) stats[type] = { w: 0, l: 0, p: 0, units: 0, risked: 0 };
            if (p.status === 'won') { stats[type].w++; stats[type].units += calculatePickUnits(p); stats[type].risked += parseFloat(p.units)||1; }
            else if (p.status === 'lost') { stats[type].l++; stats[type].units += calculatePickUnits(p); stats[type].risked += parseFloat(p.units)||1; }
            else if (p.status === 'push') stats[type].p++;
        });

        if (Object.keys(stats).length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color: var(--text-muted);">No graded picks yet</td></tr>';
            return;
        }

        tbody.innerHTML = Object.entries(stats)
            .sort((a, b) => (b[1].w + b[1].l) - (a[1].w + a[1].l))
            .map(([type, s]) => {
                const winPct = (s.w + s.l) > 0 ? (s.w / (s.w + s.l) * 100).toFixed(1) : '0.0';
                const roi = s.risked > 0 ? (s.units / s.risked * 100).toFixed(1) : '0.0';
                return `<tr>
                    <td>${type}</td>
                    <td>${s.w}-${s.l}-${s.p}</td>
                    <td>${winPct}%</td>
                    <td class="${s.units >= 0 ? 'positive' : 'negative'}">${s.units >= 0 ? '+' : ''}${s.units.toFixed(2)}</td>
                    <td class="${parseFloat(roi) >= 0 ? 'positive' : 'negative'}">${parseFloat(roi) >= 0 ? '+' : ''}${roi}%</td>
                </tr>`;
            }).join('');
    }

    // Toggle full history visibility
    function toggleFullHistory() {
        const section = document.getElementById('fullHistorySection');
        const text = document.getElementById('historyToggleText');
        if (section) {
            const isHidden = section.style.display === 'none';
            section.style.display = isHidden ? 'block' : 'none';
            if (text) text.textContent = isHidden ? 'Hide History' : 'Show Full History';
            if (isHidden) filterAdvHistory('all');
        }
    }

    // Filter and render history
    function filterAdvHistory(filter) {
        document.querySelectorAll('.hist-filter').forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-filter') === filter);
        });

        const picks = window._cachedBackendPicks || [];
        const container = document.getElementById('advHistoryList');
        if (!container) return;

        let filtered = picks;
        if (filter !== 'all') {
            filtered = picks.filter(p => {
                if (filter === 'pending') return !p.status || p.status === 'pending';
                if (filter === 'win') return p.status === 'won';
                if (filter === 'loss') return p.status === 'lost';
                return p.status === filter;
            });
        }

        filtered.sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0));

        if (filtered.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-muted); padding: 40px;">No picks found.</p>';
            return;
        }

        container.innerHTML = filtered.map((pick, idx) => {
            const status = pick.status || 'pending';
            const game = pick.game || `${pick.team1 || ''} vs ${pick.team2 || ''}`;
            const bet = pick.pick || pick.betType || 'Bet';
            const units = pick.units || 1;
            const odds = pick.odds || '-110';
            const date = pick.timestamp ? new Date(pick.timestamp).toLocaleDateString() : '';
            const originalIdx = picks.indexOf(pick);

            const isPending = status === 'pending' || !pick.status;

            return `
                <div class="history-pick-card ${status}">
                    <div class="pick-card-main">
                        <div class="pick-card-game">${game}</div>
                        <div class="pick-card-details">${bet} (${odds}) ‚Ä¢ ${units}u</div>
                        <div class="pick-card-meta">${date}${pick.finalScore ? ' ‚Ä¢ ' + pick.finalScore : ''}</div>
                        ${isPending ? `
                        <div class="pick-grade-btns">
                            <button class="grade-btn-inline win-btn" onclick="quickGradeAdv(${originalIdx}, 'win')">WIN</button>
                            <button class="grade-btn-inline loss-btn" onclick="quickGradeAdv(${originalIdx}, 'loss')">LOSS</button>
                            <button class="grade-btn-inline push-btn" onclick="quickGradeAdv(${originalIdx}, 'push')">PUSH</button>
                        </div>
                        ` : ''}
                    </div>
                    <div class="pick-card-result ${status}">${status.toUpperCase()}</div>
                </div>
            `;
        }).join('');
    }

    // Quick grade disabled - grading is server-side
    function quickGradeAdv(idx, result) {
        console.log('[TMR] Manual grading is disabled. Picks are graded automatically by the server.');
        alert('Pick grading is now automatic! The server grades picks every 15 minutes.');
        if (typeof loadMyRecordPage === 'function') loadMyRecordPage();
        loadPicksHistory();
        if (typeof updateStatsDashboard === 'function') updateStatsDashboard();
    }

    // Refresh stats
    function refreshAdvancedStats() {
        if (typeof autoGradePicks === 'function') {
            autoGradePicks().then(r => {
                loadMyRecordPage();
                loadPicksHistory();
                if (typeof updateStatsDashboard === 'function') updateStatsDashboard();
                alert(`Refreshed! ${r.graded > 0 ? 'Graded ' + r.graded + ' picks.' : 'No new grades.'}`);
            }).catch(() => {
                loadMyRecordPage();
                alert('Stats refreshed.');
            });
        } else {
            loadMyRecordPage();
        }
    }

    // Override showSection to load My Record data
    const originalShowSection = window.showSection;
    window.showSection = function(sectionId) {
        if (originalShowSection) originalShowSection(sectionId);
        if (sectionId === 'my-record') {
            loadMyRecordPage();
        }
    };

    // Export functions
    window.loadMyRecordPage = loadMyRecordPage;
    window.toggleFullHistory = toggleFullHistory;
    window.filterAdvHistory = filterAdvHistory;
    window.quickGradeAdv = quickGradeAdv;
    window.refreshAdvancedStats = refreshAdvancedStats;

    // =====================================================
    // USER PROFILES SYSTEM - Public profile pages with full stats
    // =====================================================

    let viewingUserId = null; // Track which profile we're viewing

    /**
     * Show any user's profile - accessible via URL or click
     * @param {string} usernameOrId - Username or user ID to display
     */
    function showProfile(usernameOrId) {
        if (!usernameOrId) return;

        // Get all users
        const users = JSON.parse(localStorage.getItem('trustmyrecord_users') || '[]');
        const user = users.find(u =>
            u.id === usernameOrId ||
            u.username?.toLowerCase() === usernameOrId?.toLowerCase()
        );

        if (!user) {
            alert('User not found');
            return;
        }

        viewingUserId = user.id;

        // Load profile data
        loadUserProfileData(user);

        // Show profile section
        showSection('profile');
    }

    /**
     * Load all profile data for a user
     */
    function loadUserProfileData(user) {
        if (!user) return;

        // Basic info
        updateEl('profileDisplayName', user.displayName || user.username);
        updateEl('profileUsername', user.username);

        // Avatar
        const avatarImg = document.getElementById('profileAvatarImage');
        if (avatarImg && user.avatar) {
            avatarImg.src = user.avatar;
        }

        // Bio
        const bio = document.getElementById('profileBio');
        if (bio) {
            bio.textContent = user.bio || 'No bio yet.';
        }

        // Stats
        const stats = calculateUserStatsById(user.id);

        updateEl('profileTotalPicks', stats.totalPicks || '0');
        updateEl('profileWinRate', stats.winRate ? stats.winRate + '%' : '-');
        updateEl('profileUnits', stats.units !== undefined ? (stats.units >= 0 ? '+' : '') + stats.units.toFixed(2) : '-');
        updateEl('profileROI', stats.roi ? (stats.roi >= 0 ? '+' : '') + stats.roi + '%' : '-');
        updateEl('profileStreak', stats.currentStreak || '-');
        updateEl('profileRecord', stats.record || '-');

        // Points
        updateEl('profileTriviaPoints', user.triviaPoints || 0);
        updateEl('profilePollPoints', user.pollPoints || 0);
        updateEl('profileTotalPoints', (user.triviaPoints || 0) + (user.pollPoints || 0));

        // Show/hide edit button based on if viewing own profile
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        const editBtn = document.querySelector('.edit-profile-btn');
        if (editBtn) {
            editBtn.style.display = currentUser?.id === user.id ? 'inline-block' : 'none';
        }

        // Load user's picks for display
        loadUserPendingPicks(user.id);
        loadUserRecentActivity(user.id);
    }

    /**
     * Calculate stats for a specific user by ID
     */
    function calculateUserStatsById(userId) {
        const picks = window._cachedBackendPicks || [];

        const wins = picks.filter(p => p.status === 'won').length;
        const losses = picks.filter(p => p.status === 'lost').length;
        const pushes = picks.filter(p => p.status === 'push').length;
        const graded = wins + losses + pushes;

        let units = 0, risked = 0;
        picks.forEach(p => {
            units += calculatePickUnits(p);
            if (p.status !== 'pending') risked += parseFloat(p.units) || 1;
        });

        const winRate = graded > 0 ? (wins / graded * 100).toFixed(1) : 0;
        const roi = risked > 0 ? (units / risked * 100).toFixed(1) : 0;
        const streaks = calculateStreaks(picks);

        return {
            totalPicks: picks.length,
            wins, losses, pushes,
            record: `${wins}-${losses}${pushes > 0 ? '-' + pushes : ''}`,
            winRate,
            units,
            roi,
            currentStreak: streaks.current > 0 ? streaks.current + (streaks.currentType === 'won' ? 'W' : 'L') : '-',
            bestWinStreak: streaks.bestWin
        };
    }

    /**
     * Load pending picks for profile view
     */
    async function loadUserPendingPicks(userId) {
        const container = document.getElementById('profilePendingPicks');
        if (!container) return;

        let pending = [];
        if (window.auth && window.auth.isLoggedIn()) {
            try {
                const allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]');
                const uid = (window.auth.getCurrentUser().username || window.auth.getCurrentUser().id || 'local');
                pending = allPicks.filter(p => p.user_id === uid && p.status === 'pending').slice(0, 5);
            } catch (e) { console.warn('Failed to load pending picks:', e); }
        }

        if (pending.length === 0) {
            container.innerHTML = '<p class="no-data-message">No pending picks.</p>';
            return;
        }

        container.innerHTML = pending.map(pick => {
            const matchup = (pick.away_team || '') + ' vs ' + (pick.home_team || '');
            const pickDisplay = pick.selection + (pick.line_snapshot ? ' ' + pick.line_snapshot : '');
            const odds = pick.odds_snapshot || -110;
            return `
                <div class="pending-pick-item">
                    <div class="pick-game">${matchup}</div>
                    <div class="pick-info">${pickDisplay} (${odds > 0 ? '+' : ''}${odds}) - ${pick.units || 1}u</div>
                </div>
            `;
        }).join('');
    }

    /**
     * Load recent activity for profile
     */
    async function loadUserRecentActivity(userId) {
        const container = document.getElementById('profileRecentActivity');
        if (!container) return;

        let graded = [];
        if (window.auth && window.auth.isLoggedIn()) {
            try {
                const allPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]');
                const uid = (window.auth.getCurrentUser().username || window.auth.getCurrentUser().id || 'local');
                graded = allPicks.filter(p => p.user_id === uid && p.status && p.status !== 'pending').slice(0, 5);
            } catch (e) { console.warn('Failed to load recent activity:', e); }
        }

        if (graded.length === 0) {
            container.innerHTML = '<p class="no-data-message">No recent activity.</p>';
            return;
        }

        container.innerHTML = graded.map(pick => {
            const icon = pick.status === 'won' ? '‚úÖ' : pick.status === 'lost' ? '‚ùå' : '‚ûñ';
            const date = pick.locked_at ? new Date(pick.locked_at).toLocaleDateString() : '';
            const matchup = (pick.away_team || '') + ' vs ' + (pick.home_team || '');
            const pickDisplay = pick.selection + (pick.line_snapshot ? ' ' + pick.line_snapshot : '');
            const odds = pick.odds_snapshot || -110;
            return `
                <div class="activity-item ${pick.status}">
                    <span class="activity-icon">${icon}</span>
                    <div class="activity-details">
                        <div class="activity-text">${pick.status.toUpperCase()}: ${matchup}</div>
                        <div class="activity-meta">${date} ‚Ä¢ ${pick.units || 1}u @ ${odds > 0 ? '+' : ''}${odds}</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    window.showProfile = showProfile;
    window.loadUserProfileData = loadUserProfileData;

    // =====================================================
    // DYNAMIC LEADERBOARDS - Real user data
    // =====================================================

    /**
     * Load leaderboards with real user data
     */
    function loadDynamicLeaderboards() {
        const users = JSON.parse(localStorage.getItem('trustmyrecord_users') || '[]');

        // Calculate stats for all users
        const userStats = users.map(user => {
            const stats = calculateUserStatsById(user.id);
            return {
                ...user,
                ...stats,
                totalPoints: (user.triviaPoints || 0) + (user.pollPoints || 0),
                triviaPoints: user.triviaPoints || 0,
                pollPoints: user.pollPoints || 0
            };
        });

        // Sort and render different leaderboards
        renderLeaderboard('pointsLeaderboardBody', userStats, 'totalPoints');
        renderLeaderboard('picksLeaderboardBody', userStats, 'winRate');
        renderLeaderboard('triviaLeaderboardBody', userStats, 'triviaPoints');
        renderLeaderboard('pollsLeaderboardBody', userStats, 'pollPoints');
        renderLeaderboard('unitsLeaderboardBody', userStats, 'units');
    }

    function renderLeaderboard(containerId, users, sortKey) {
        const container = document.getElementById(containerId);
        if (!container) return;

        const sorted = [...users].sort((a, b) => {
            const aVal = parseFloat(a[sortKey]) || 0;
            const bVal = parseFloat(b[sortKey]) || 0;
            return bVal - aVal;
        }).slice(0, 10);

        if (sorted.length === 0) {
            container.innerHTML = `
                <div class="lb-row empty">
                    <div style="text-align:center; padding: 20px; color: var(--text-muted);">
                        No users yet. Be the first!
                    </div>
                </div>
            `;
            return;
        }

        container.innerHTML = sorted.map((user, idx) => {
            const rankClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
            const displayValue = getLeaderboardDisplayValue(user, sortKey);

            return `
                <div class="lb-row" onclick="showProfile('${user.username}')">
                    <div class="lb-col-rank"><span class="rank-badge ${rankClass}">${idx + 1}</span></div>
                    <div class="lb-col-user">
                        <img src="${user.avatar || 'data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 100 100%27%3E%3Ccircle cx=%2750%27 cy=%2735%27 r=%2725%27 fill=%27%2366717d%27/%3E%3Cellipse cx=%2750%27 cy=%2785%27 rx=%2735%27 ry=%2725%27 fill=%27%2766717d%27/%3E%3C/svg%3E'}" class="user-avatar-tiny" style="width:24px;height:24px;border-radius:50%;margin-right:8px;">
                        <span class="user-name-lb">@${user.username}</span>
                    </div>
                    <div class="lb-col-stat">${user.record || '0-0'}</div>
                    <div class="lb-col-stat">${user.winRate || 0}%</div>
                    <div class="lb-col-total">${displayValue}</div>
                </div>
            `;
        }).join('');
    }

    function getLeaderboardDisplayValue(user, sortKey) {
        switch(sortKey) {
            case 'totalPoints': return (user.totalPoints || 0).toLocaleString();
            case 'winRate': return user.winRate + '%';
            case 'triviaPoints': return (user.triviaPoints || 0).toLocaleString();
            case 'pollPoints': return (user.pollPoints || 0).toLocaleString();
            case 'units': return (user.units >= 0 ? '+' : '') + (user.units || 0).toFixed(2) + 'u';
            default: return user[sortKey] || '-';
        }
    }

    window.loadDynamicLeaderboards = loadDynamicLeaderboards;

    // =====================================================
    // COMPARISON ENGINE - Compare two handicappers
    // =====================================================

    let compareUser1 = null;
    let compareUser2 = null;

    function openCompareModal() {
        document.getElementById('compareModal').style.display = 'flex';
        loadCompareUserOptions();
    }

    function closeCompareModal() {
        document.getElementById('compareModal').style.display = 'none';
    }

    function loadCompareUserOptions() {
        const users = JSON.parse(localStorage.getItem('trustmyrecord_users') || '[]');
        const select1 = document.getElementById('compareSelect1');
        const select2 = document.getElementById('compareSelect2');

        if (!select1 || !select2) return;

        const options = users.map(u => `<option value="${u.id}">${u.username}</option>`).join('');
        select1.innerHTML = '<option value="">Select User 1</option>' + options;
        select2.innerHTML = '<option value="">Select User 2</option>' + options;
    }

    function runComparison() {
        const userId1 = document.getElementById('compareSelect1')?.value;
        const userId2 = document.getElementById('compareSelect2')?.value;

        if (!userId1 || !userId2) {
            alert('Please select two users to compare');
            return;
        }

        if (userId1 === userId2) {
            alert('Please select two different users');
            return;
        }

        const users = JSON.parse(localStorage.getItem('trustmyrecord_users') || '[]');
        const user1 = users.find(u => u.id === userId1);
        const user2 = users.find(u => u.id === userId2);

        if (!user1 || !user2) return;

        const stats1 = calculateUserStatsById(userId1);
        const stats2 = calculateUserStatsById(userId2);

        // Render comparison results
        const resultsDiv = document.getElementById('compareResults');
        if (!resultsDiv) return;

        resultsDiv.innerHTML = `
            <div class="compare-header-row">
                <div class="compare-user-header" onclick="showProfile('${user1.username}')">
                    <img src="${user1.avatar || ''}" class="compare-avatar">
                    <div class="compare-name">@${user1.username}</div>
                </div>
                <div class="compare-vs">VS</div>
                <div class="compare-user-header" onclick="showProfile('${user2.username}')">
                    <img src="${user2.avatar || ''}" class="compare-avatar">
                    <div class="compare-name">@${user2.username}</div>
                </div>
            </div>

            <div class="compare-stats-table">
                ${renderCompareRow('Record', stats1.record, stats2.record)}
                ${renderCompareRow('Win Rate', stats1.winRate + '%', stats2.winRate + '%', parseFloat(stats1.winRate), parseFloat(stats2.winRate))}
                ${renderCompareRow('Total Picks', stats1.totalPicks, stats2.totalPicks, stats1.totalPicks, stats2.totalPicks)}
                ${renderCompareRow('Units +/-', (stats1.units >= 0 ? '+' : '') + stats1.units.toFixed(2), (stats2.units >= 0 ? '+' : '') + stats2.units.toFixed(2), stats1.units, stats2.units)}
                ${renderCompareRow('ROI', stats1.roi + '%', stats2.roi + '%', parseFloat(stats1.roi), parseFloat(stats2.roi))}
                ${renderCompareRow('Best Streak', stats1.bestWinStreak + 'W', stats2.bestWinStreak + 'W', stats1.bestWinStreak, stats2.bestWinStreak)}
            </div>
        `;

        resultsDiv.style.display = 'block';
    }

    function renderCompareRow(label, val1, val2, num1 = 0, num2 = 0) {
        const winner = num1 > num2 ? 'user1' : num2 > num1 ? 'user2' : 'tie';
        return `
            <div class="compare-row">
                <div class="compare-val ${winner === 'user1' ? 'winner' : ''}">${val1}</div>
                <div class="compare-label">${label}</div>
                <div class="compare-val ${winner === 'user2' ? 'winner' : ''}">${val2}</div>
            </div>
        `;
    }

    window.openCompareModal = openCompareModal;
    window.closeCompareModal = closeCompareModal;
    window.runComparison = runComparison;

    // =====================================================
    // PICK ARCHIVING SYSTEM - Immutable timestamped records
    // =====================================================

    /**
     * Archive a pick - creates immutable record
     * Called automatically when pick is made
     */
    function archivePick(pick) {
        if (!pick) return null;

        const archivedPick = {
            ...pick,
            archiveId: generateArchiveId(),
            archivedAt: new Date().toISOString(),
            archived: true,
            // Hash for verification (simple implementation)
            hash: simpleHash(JSON.stringify({
                game: pick.game,
                pick: pick.pick,
                odds: pick.odds,
                units: pick.units,
                timestamp: pick.timestamp
            }))
        };

        // Store in archive
        const archive = JSON.parse(localStorage.getItem('trustMyRecordArchive') || '[]');
        archive.push(archivedPick);
        localStorage.setItem('trustMyRecordArchive', JSON.stringify(archive));

        return archivedPick;
    }

    function generateArchiveId() {
        return 'arch_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function simpleHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return hash.toString(16);
    }

    /**
     * Verify pick integrity
     */
    function verifyPick(archiveId) {
        const archive = JSON.parse(localStorage.getItem('trustMyRecordArchive') || '[]');
        const pick = archive.find(p => p.archiveId === archiveId);

        if (!pick) return { valid: false, error: 'Pick not found' };

        const expectedHash = simpleHash(JSON.stringify({
            game: pick.game,
            pick: pick.pick,
            odds: pick.odds,
            units: pick.units,
            timestamp: pick.timestamp
        }));

        return {
            valid: pick.hash === expectedHash,
            pick,
            verifiedAt: new Date().toISOString()
        };
    }

    /**
     * Get archived picks for user
     */
    function getArchivedPicks(userId, filters = {}) {
        const archive = JSON.parse(localStorage.getItem('trustMyRecordArchive') || '[]');
        let picks = archive.filter(p => !userId || p.userId === userId);

        if (filters.sport) {
            picks = picks.filter(p => p.sport?.toLowerCase() === filters.sport.toLowerCase());
        }
        if (filters.status) {
            picks = picks.filter(p => p.status === filters.status);
        }
        if (filters.startDate) {
            picks = picks.filter(p => new Date(p.timestamp) >= new Date(filters.startDate));
        }
        if (filters.endDate) {
            picks = picks.filter(p => new Date(p.timestamp) <= new Date(filters.endDate));
        }

        return picks.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    }

    window.archivePick = archivePick;
    window.verifyPick = verifyPick;
    window.getArchivedPicks = getArchivedPicks;

    // =====================================================
    // Enhanced showSection for all pages
    // =====================================================

    const enhancedShowSection = window.showSection;
    window.showSection = function(sectionId) {
        if (enhancedShowSection) enhancedShowSection(sectionId);

        if (sectionId === 'leaderboards') {
            loadDynamicLeaderboards();
        }
        if (sectionId === 'profile') {
            // If no specific user set by showProfile(), reset and load current user
            if (!viewingUserId) {
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
                if (currentUser) {
                    // Ensure picks are loaded first, then update profile data
                    if (typeof ensureBackendPicks === 'function') ensureBackendPicks();
                    loadUserProfileData(currentUser);
                }
            }
            viewingUserId = null; // Reset after loading so next showSection('profile') loads own profile
        }
        if (sectionId === 'mypicks') {
            // Auto-grade pending picks when viewing My Picks section
            if (typeof window.autoGradeAll === 'function') {
                window.autoGradeAll().then(function() {
                    loadMyPicks('pending');
                }).catch(function() {
                    loadMyPicks('pending');
                });
            } else {
                loadMyPicks('pending');
            }
        }
    };

    // =====================================================
    // MY PICKS SECTION - Load picks from localStorage
    // =====================================================

    let currentPicksTab = 'pending';

    const sportDisplayMap = {
        'basketball_nba': 'NBA', 'americanfootball_nfl': 'NFL', 'icehockey_nhl': 'NHL',
        'baseball_mlb': 'MLB', 'americanfootball_ncaaf': 'NCAAF', 'basketball_ncaab': 'NCAAB'
    };

    function loadMyPicks(tab = 'pending') {
        currentPicksTab = tab;
        window.currentPicksTab = tab;
        const container = document.getElementById('myPicksList');
        if (!container) return;

        // Check login via localStorage auth
        if (!window.auth || !window.auth.isLoggedIn()) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #6c7380;">
                    <div style="font-size: 48px; margin-bottom: 16px;">&#128274;</div>
                    <h3 style="color: #fff; margin-bottom: 10px;">Login Required</h3>
                    <p>Please log in to view your picks.</p>
                    <button onclick="openLoginModal()" style="margin-top: 20px; background: linear-gradient(135deg, #00ffff, #0088cc); border: none; padding: 12px 24px; border-radius: 8px; color: #000; font-weight: 700; cursor: pointer;">
                        Log In
                    </button>
                </div>`;
            return;
        }

        // Read picks from localStorage
        let allUserPicks = [];
        try { allUserPicks = JSON.parse(localStorage.getItem('tmr_picks') || '[]'); } catch(e) { allUserPicks = []; }

        // Filter to current user
        const user = window.auth.getCurrentUser();
        const userId = user.username || user.id || 'local';
        allUserPicks = allUserPicks.filter(p => p.user_id === userId);

        // Filter by tab
        let picks = allUserPicks;
        if (tab === 'pending') {
            picks = allUserPicks.filter(p => p.status === 'pending');
        } else if (tab === 'graded') {
            picks = allUserPicks.filter(p => p.status !== 'pending');
        }
        // 'all' = no filter

        // Update pending count
        const pendingPicks = allUserPicks.filter(p => p.status === 'pending');
        const pendingCountEl = document.getElementById('pendingCount');
        const myStatsPendingEl = document.getElementById('myStatsPending');
        if (pendingCountEl) pendingCountEl.textContent = pendingPicks.length;
        if (myStatsPendingEl) myStatsPendingEl.textContent = pendingPicks.length;

        // Calculate stats from all picks
        updateMyPicksStats(allUserPicks);

        if (picks.length === 0) {
            const emoji = tab === 'pending' ? '&#128197;' : '&#128202;';
            const title = tab === 'pending' ? 'No Pending Picks' : 'No Graded Picks';
            const msg = tab === 'pending' ? 'Make a pick to get started!' : 'Your graded picks will appear here.';
            const btn = tab === 'pending' ? '<button onclick="showSection(\'picks\')" style="margin-top: 20px; background: linear-gradient(135deg, #00c853, #00a648); border: none; padding: 12px 24px; border-radius: 8px; color: #000; font-weight: 700; cursor: pointer;">Make a Pick</button>' : '';
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c7380;"><div style="font-size: 48px; margin-bottom: 16px;">' + emoji + '</div><h3 style="color: #fff; margin-bottom: 10px;">' + title + '</h3><p>' + msg + '</p>' + btn + '</div>';
            return;
        }

        container.innerHTML = picks.map(pick => renderPickCard(pick)).join('');
    }

    function renderPickCard(pick) {
        const sportLabel = sportDisplayMap[pick.sport_key] || pick.sport_display || pick.sport_key || '';
        const gameDate = new Date(pick.commence_time || pick.locked_at).toLocaleDateString('en-US', {
            weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit'
        });
        const pickDisplay = pick.selection + (pick.line_snapshot ? ' ' + pick.line_snapshot : '');
        const matchup = (pick.away_team || '') + ' @ ' + (pick.home_team || '');
        const odds = pick.odds_snapshot || -110;
        const units = pick.units || 1;
        const resultUnits = pick.result_units;

        const statusColors = {
            pending: { bg: '#ff9800', text: '#000' },
            won: { bg: '#00c853', text: '#000' },
            lost: { bg: '#ff5252', text: '#fff' },
            push: { bg: '#6c7380', text: '#fff' }
        };

        const status = pick.status || 'pending';
        const statusColor = statusColors[status] || statusColors.pending;
        const resultText = (resultUnits !== null && resultUnits !== undefined && status !== 'pending')
            ? (resultUnits > 0 ? '+' + parseFloat(resultUnits).toFixed(2) + 'u' : parseFloat(resultUnits).toFixed(2) + 'u')
            : '';

        const sportEmojis = { NBA: '&#127936;', NFL: '&#127944;', NHL: '&#127954;', MLB: '&#9918;', NCAAF: '&#127891;', NCAAB: '&#127979;' };

        // Score display for graded picks
        let scoreHtml = '';
        if (pick.home_score !== null && pick.home_score !== undefined && pick.away_score !== null && pick.away_score !== undefined) {
            scoreHtml = '<div style="font-size: 12px; color: #a0a8b8; margin-top: 4px;">Final: ' + pick.away_team + ' ' + pick.away_score + ' - ' + pick.home_team + ' ' + pick.home_score + '</div>';
        }

        return '<div style="background: #22262e; border-radius: 10px; padding: 16px; margin-bottom: 12px; border-left: 4px solid ' + statusColor.bg + ';">'
            + '<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">'
            + '<div>'
            + '<span style="font-size: 20px;">' + (sportEmojis[sportLabel] || '&#127919;') + '</span>'
            + '<span style="color: #6c7380; font-size: 12px; margin-left: 8px;">' + sportLabel + '</span>'
            + '<span style="color: #6c7380; font-size: 12px; margin-left: 8px;">&bull;</span>'
            + '<span style="color: #6c7380; font-size: 12px; margin-left: 8px;">' + gameDate + '</span>'
            + '</div>'
            + '<div style="display: flex; align-items: center; gap: 10px;">'
            + (resultText ? '<span style="font-weight: 700; color: ' + (resultUnits > 0 ? '#00c853' : '#ff5252') + ';">' + resultText + '</span>' : '')
            + '<span style="background: ' + statusColor.bg + '; color: ' + statusColor.text + '; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase;">'
            + status
            + '</span>'
            + '</div>'
            + '</div>'
            + '<div style="margin-bottom: 8px;">'
            + '<div style="font-size: 18px; font-weight: 700; color: #fff;">' + pickDisplay + '</div>'
            + '<div style="font-size: 14px; color: #a0a8b8;">' + matchup + '</div>'
            + scoreHtml
            + '</div>'
            + '<div style="display: flex; gap: 20px; font-size: 13px; color: #6c7380;">'
            + '<span>Odds: <span style="color: #fff;">' + (odds > 0 ? '+' : '') + odds + '</span></span>'
            + '<span>Units: <span style="color: #fff;">' + units + '</span></span>'
            + '</div>'
            + '</div>';
    }

    function updateMyPicksStats(picks) {
        const graded = picks.filter(p => p.status && p.status !== 'pending');
        const wins = graded.filter(p => p.status === 'won').length;
        const losses = graded.filter(p => p.status === 'lost').length;
        const totalUnits = graded.reduce((sum, p) => sum + (parseFloat(p.result_units) || 0), 0);
        const winRate = graded.length > 0 ? ((wins / graded.length) * 100).toFixed(1) : 0;

        const recordEl = document.getElementById('myStatsRecord');
        const winRateEl = document.getElementById('myStatsWinRate');
        const unitsEl = document.getElementById('myStatsUnits');

        if (recordEl) recordEl.textContent = wins + '-' + losses;
        if (winRateEl) winRateEl.textContent = winRate + '%';
        if (unitsEl) {
            unitsEl.textContent = (totalUnits >= 0 ? '+' : '') + totalUnits.toFixed(2);
            unitsEl.style.color = totalUnits >= 0 ? '#00c853' : '#ff5252';
        }
    }

    function switchPicksTab(tab) {
        currentPicksTab = tab;
        window.currentPicksTab = tab;

        // Update tab styles
        ['pending', 'graded', 'all'].forEach(t => {
            const tabEl = document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1));
            if (tabEl) {
                if (t === tab) {
                    tabEl.style.color = '#00ffff';
                    tabEl.style.borderBottomColor = '#00ffff';
                } else {
                    tabEl.style.color = '#6c7380';
                    tabEl.style.borderBottomColor = 'transparent';
                }
            }
        });

        loadMyPicks(tab);
    }

    window.loadMyPicks = loadMyPicks;
    window.switchPicksTab = switchPicksTab;

    </script>

<!-- Comparison Modal -->
<div id="compareModal" class="modal" style="display: none;">
    <div class="modal-content compare-modal">
        <span class="close-modal" onclick="closeCompareModal()">&times;</span>
        <h2>Compare Handicappers</h2>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Select two users to compare their performance head-to-head.
        </p>

        <div class="compare-selectors">
            <select id="compareSelect1" class="compare-select">
                <option value="">Select User 1</option>
            </select>
            <span class="compare-vs-text">VS</span>
            <select id="compareSelect2" class="compare-select">
                <option value="">Select User 2</option>
            </select>
        </div>

        <button class="compare-btn" onclick="runComparison()">Compare</button>

        <div id="compareResults" style="display: none;">
            <!-- Results populated by JS -->
        </div>
    </div>
</div>

<style>
/* Comparison Modal Styles */
.compare-modal {
    max-width: 700px;
    background: var(--card-bg);
    border: 2px solid var(--neon-cyan);
    border-radius: 20px;
    padding: 40px;
}

.compare-selectors {
    display: flex;
    align-items: center;
    gap: 20px;
    justify-content: center;
    margin-bottom: 30px;
}

.compare-select {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 15px 20px;
    color: var(--text-primary);
    font-size: 16px;
    min-width: 180px;
    cursor: pointer;
}

.compare-select:focus {
    outline: none;
    border-color: var(--neon-cyan);
}

.compare-vs-text {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5rem;
    color: var(--neon-gold);
}

.compare-btn {
    display: block;
    width: 100%;
    background: var(--gradient-neon);
    border: none;
    border-radius: 12px;
    padding: 15px 30px;
    color: var(--dark-bg);
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    margin-bottom: 30px;
    transition: all 0.3s;
}

.compare-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
}

/* Comparison Results */
.compare-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--glass-border);
}

.compare-user-header {
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s;
}

.compare-user-header:hover {
    transform: scale(1.05);
}

.compare-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 2px solid var(--neon-cyan);
    margin-bottom: 10px;
}

.compare-name {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-cyan);
}

.compare-vs {
    font-family: 'Orbitron', sans-serif;
    font-size: 2rem;
    color: var(--neon-gold);
    text-shadow: 0 0 20px var(--neon-gold);
}

.compare-stats-table {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.compare-row {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 20px;
    align-items: center;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    border: 1px solid var(--glass-border);
}

.compare-val {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2rem;
    font-weight: 700;
    text-align: center;
    padding: 10px 20px;
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.3);
}

.compare-val.winner {
    background: rgba(0, 255, 136, 0.2);
    border: 1px solid #00ff88;
    color: #00ff88;
}

.compare-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    text-align: center;
    min-width: 100px;
}

/* Activity items */
.activity-item {
    display: flex;
    gap: 12px;
    padding: 12px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    margin-bottom: 8px;
    border-left: 3px solid var(--glass-border);
}

.activity-item.win { border-left-color: #00ff88; }
.activity-item.loss { border-left-color: #ff4444; }
.activity-item.push { border-left-color: var(--neon-gold); }

.activity-icon { font-size: 1.2rem; }
.activity-details { flex: 1; }
.activity-text { font-weight: 600; color: var(--text-primary); }
.activity-meta { font-size: 0.8rem; color: var(--text-muted); margin-top: 4px; }

/* Pending pick items */
.pending-pick-item {
    padding: 12px;
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 8px;
    margin-bottom: 8px;
}

.pick-game { font-weight: 600; color: var(--text-primary); }
.pick-info { font-size: 0.85rem; color: var(--neon-gold); margin-top: 4px; }

/* Leaderboard row hover */
.lb-row {
    cursor: pointer;
    transition: all 0.2s;
}

.lb-row:hover {
    background: rgba(0, 255, 255, 0.1);
    transform: translateX(5px);
}

@media (max-width: 768px) {
    .compare-selectors {
        flex-direction: column;
    }

    .compare-row {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .compare-val {
        font-size: 1rem;
    }

    .compare-header-row {
        flex-direction: column;
        gap: 20px;
    }
}
</style>

</body>
</html>
<!-- Deploy: Tue, Jan 20, 2026  9:59:20 PM -->
